{"file_contents":{"ai-optimization-report.md":{"content":"# AI Modul √öjragener√°l√°s Optimaliz√°l√°si Jelent√©s\n\n## Eredeti Teljes√≠tm√©ny Elemz√©s\n\n### Sz≈±k Keresztmetszetek Azonos√≠t√°sa\n1. **DataForSEO API Rate Limiting** - Nagy hat√°s\n   - 3 √∫jrapr√≥b√°lkoz√°s API h√≠v√°sonk√©nt\n   - 1.5s k√©sleltet√©s bold szavank√©nt\n   - √ñsszesen 5-15s extra id≈ë/modul\n\n2. **Bold Keyword Sequential Processing** - Nagy hat√°s\n   - 5 sz√≥ √ó 1.5s = 7.5s minimum\n   - Retry-kkal +10-15s/sz√≥\n   - √ñsszesen 50-90s/modul\n\n3. **Multiple AI Generation Steps** - K√∂zepes hat√°s\n   - 4-5 k√ºl√∂n AI h√≠v√°s modulonk√©nt\n   - 20-60s/h√≠v√°s\n   - √ñsszesen 80-300s/modul\n\n### Eredeti Id≈ëig√©ny\n- **Minim√°lis**: 185 m√°sodperc (3 perc)\n- **Maxim√°lis**: 340 m√°sodperc (6 perc)\n- **API h√≠v√°sok**: 10-17 h√≠v√°s/modul\n\n## Implement√°lt Optimaliz√°l√°sok\n\n### 1. Bold Keyword Linking Optimaliz√°l√°s\n- **V√°ltoz√°s**: 5 ‚Üí 3 sz√≥, 1.5s ‚Üí 0.5s k√©sleltet√©s\n- **Id≈ëmegtakar√≠t√°s**: 60-80%\n- **Hat√°s**: 50-90s ‚Üí 10-20s\n\n### 2. P√°rhuzamos Feldolgoz√°s\n- **V√°ltoz√°s**: Web search √©s bold linking p√°rhuzamosan\n- **Id≈ëmegtakar√≠t√°s**: 30-50%\n- **Hat√°s**: Sequencial ‚Üí Parallel processing\n\n### 3. YouTube √©s Mermaid P√°rhuzamos√≠t√°s\n- **V√°ltoz√°s**: YouTube search √©s SVG konverzi√≥ p√°rhuzamosan\n- **Id≈ëmegtakar√≠t√°s**: 20-30%\n- **Hat√°s**: √Åtfed≈ë feldolgoz√°s\n\n### 4. Konfigur√°lhat√≥ Optimaliz√°l√°si M√≥dok\n\n#### Fast Mode (Gyors)\n- Bold keywords: 2\n- K√©sleltet√©s: 300ms\n- Web search: Kikapcsolva\n- P√°rhuzamos: Igen\n- **Becs√ºlt id≈ë**: 60-90 m√°sodperc\n\n#### Balanced Mode (Kiegyens√∫lyozott) - Alap√©rtelmezett\n- Bold keywords: 3\n- K√©sleltet√©s: 500ms\n- Web search: Bekapcsolva\n- P√°rhuzamos: Igen\n- **Becs√ºlt id≈ë**: 90-120 m√°sodperc\n\n#### Quality Mode (Min≈ës√©gi)\n- Bold keywords: 5\n- K√©sleltet√©s: 1500ms\n- Web search: Bekapcsolva\n- P√°rhuzamos: Nem\n- **Becs√ºlt id≈ë**: 180-250 m√°sodperc\n\n## Optimaliz√°l√°s Ut√°n V√°rhat√≥ Teljes√≠tm√©ny\n\n### Balanced Mode (Alap√©rtelmezett)\n- **√öj id≈ëig√©ny**: 90-120 m√°sodperc (1.5-2 perc)\n- **Javul√°s**: 50-65% gyorsabb\n- **API h√≠v√°sok**: 8-12 h√≠v√°s/modul\n- **Min≈ës√©gveszt√©s**: Minim√°lis\n\n### Fast Mode\n- **√öj id≈ëig√©ny**: 60-90 m√°sodperc (1-1.5 perc)\n- **Javul√°s**: 67-75% gyorsabb\n- **API h√≠v√°sok**: 5-8 h√≠v√°s/modul\n- **Min≈ës√©gveszt√©s**: K√∂zepes (kevesebb web tartalom)\n\n## Kompromisszumok √©s Kock√°zatok\n\n### Balanced Mode\n- ‚úÖ Minim√°lis min≈ës√©gveszt√©s\n- ‚úÖ Jelent≈ës sebess√©gn√∂veked√©s\n- ‚ö†Ô∏è Enyh√©n kevesebb bold link\n\n### Fast Mode\n- ‚úÖ Maxim√°lis sebess√©g\n- ‚ùå Nincs web search enhancement\n- ‚ùå Kevesebb bold keyword link\n- ‚ùå Egyszer≈±bb tartalom\n\n### Quality Mode\n- ‚úÖ Maxim√°lis min≈ës√©g\n- ‚úÖ Eredeti funkcionalit√°s\n- ‚ùå Las√∫ (csak 30% javul√°s)\n\n## Javaslatok\n\n1. **Alap√©rtelmezett**: Balanced Mode haszn√°lata\n2. **T√∂meges √∫jragener√°l√°s**: Fast Mode\n3. **Kritikus modulok**: Quality Mode\n4. **Monitoring**: Teljes√≠tm√©nyk√∂vet√©s implement√°l√°sa\n\n## K√∂vetkez≈ë L√©p√©sek\n\n1. Admin fel√ºlet b≈ëv√≠t√©se optimaliz√°l√°si be√°ll√≠t√°sokkal\n2. Teljes√≠tm√©ny monitoring dashboard\n3. A/B tesztel√©s k√ºl√∂nb√∂z≈ë m√≥dokon\n4. Felhaszn√°l√≥i visszajelz√©sek gy≈±jt√©se\n\n## Technikai Megjegyz√©sek\n\nAz optimaliz√°l√°sok meg≈ërzik az AI gener√°l√°s min≈ës√©g√©t, mik√∂zben jelent≈ësen cs√∂kkentik a feldolgoz√°si id≈ët. A p√°rhuzamos feldolgoz√°s √©s a konfigur√°lhat√≥ bold keyword linking a legnagyobb hat√°s√∫ v√°ltoztat√°sok.","size_bytes":3395},"analyze-ai-performance.js":{"content":"// AI Module Generation Performance Analysis\nconsole.log('=== AI MODUL √öJRAGENER√ÅL√ÅS TELJES√çTM√âNY ELEMZ√âS ===\\n');\n\n// Analyze current bottlenecks and timing\nconst performanceAnalysis = {\n  currentProcess: {\n    steps: [\n      { name: 'Step 1: Internet-enhanced detailed content', estimatedTime: '30-60s', apiCalls: 1 },\n      { name: 'Step 1B: Concise version generation', estimatedTime: '20-40s', apiCalls: 1 },\n      { name: 'Step 2A: Web search for concise content', estimatedTime: '10-30s', apiCalls: '1-3' },\n      { name: 'Step 2A: Web search for detailed content', estimatedTime: '10-30s', apiCalls: '1-3' },\n      { name: 'Step 2B: Bold keyword linking (5 keywords)', estimatedTime: '75s', apiCalls: 5, delay: '1.5s each' },\n      { name: 'Step 3: YouTube search terms generation', estimatedTime: '20-30s', apiCalls: 1 },\n      { name: 'Step 3B: YouTube video enrichment', estimatedTime: '15-45s', apiCalls: '1-3' },\n      { name: 'Step 5: Mermaid diagram conversion', estimatedTime: '5-10s', apiCalls: 0 }\n    ],\n    totalEstimatedTime: '185-340 seconds (3-6 minutes)',\n    totalApiCalls: '10-17 calls'\n  },\n  \n  bottlenecks: [\n    {\n      issue: 'DataForSEO API Rate Limiting',\n      impact: 'High - 3 retry attempts per call, 1.5s delays',\n      details: 'Each bold keyword requires separate API call with retries'\n    },\n    {\n      issue: 'Bold Keyword Sequential Processing',\n      impact: 'High - 5 keywords √ó 1.5s delay = 7.5s minimum',\n      details: 'Plus retry delays can add 10-15s per keyword'\n    },\n    {\n      issue: 'Multiple AI Generation Steps',\n      impact: 'Medium - 4-5 separate AI calls per module',\n      details: 'Each OpenAI/Gemini call takes 20-60 seconds'\n    },\n    {\n      issue: 'Web Search Query Generation',\n      impact: 'Medium - Additional AI calls for search terms',\n      details: 'Could be optimized with predefined patterns'\n    }\n  ],\n  \n  optimizationOpportunities: [\n    {\n      strategy: 'Parallel Processing',\n      timesSaved: '30-50%',\n      tradeoffs: 'Increased API rate limiting risk',\n      implementation: 'Run concurrent API calls where possible'\n    },\n    {\n      strategy: 'Bold Keyword Optimization',\n      timesSaved: '60-80%',\n      tradeoffs: 'Fewer linked keywords',\n      implementation: 'Limit to 3 keywords, reduce delays to 0.5s'\n    },\n    {\n      strategy: 'Caching Strategy',\n      timesSaved: '20-40%',\n      tradeoffs: 'Slightly outdated content',\n      implementation: 'Cache search results and AI responses'\n    },\n    {\n      strategy: 'Simplified Web Integration',\n      timesSaved: '40-60%',\n      tradeoffs: 'Less dynamic content',\n      implementation: 'Use predefined knowledge base instead of live search'\n    }\n  ]\n};\n\nconsole.log('üìä JELENLEGI FOLYAMAT ELEMZ√âSE:');\nconsole.log(`Becs√ºlt teljes id≈ë: ${performanceAnalysis.currentProcess.totalEstimatedTime}`);\nconsole.log(`API h√≠v√°sok sz√°ma: ${performanceAnalysis.currentProcess.totalApiCalls}\\n`);\n\nconsole.log('üîç F≈ê SZ≈∞K KERESZTMETSZETEK:');\nperformanceAnalysis.bottlenecks.forEach((bottleneck, index) => {\n  console.log(`${index + 1}. ${bottleneck.issue}`);\n  console.log(`   Hat√°s: ${bottleneck.impact}`);\n  console.log(`   R√©szletek: ${bottleneck.details}\\n`);\n});\n\nconsole.log('‚ö° OPTIMALIZ√ÅL√ÅSI LEHET≈êS√âGEK:');\nperformanceAnalysis.optimizationOpportunities.forEach((opt, index) => {\n  console.log(`${index + 1}. ${opt.strategy}`);\n  console.log(`   Id≈ëmegtakar√≠t√°s: ${opt.timesSaved}`);\n  console.log(`   Kompromisszumok: ${opt.tradeoffs}`);\n  console.log(`   Megval√≥s√≠t√°s: ${opt.implementation}\\n`);\n});\n\nconsole.log('üéØ JAVASOLT OPTIMALIZ√ÅL√ÅSI SORREND:');\nconsole.log('1. Bold keyword linking optimaliz√°l√°sa (legnagyobb hat√°s)');\nconsole.log('2. P√°rhuzamos feldolgoz√°s bevezet√©se');\nconsole.log('3. Caching strat√©gia implement√°l√°sa');\nconsole.log('4. Web search egyszer≈±s√≠t√©se\\n');\n\nconsole.log('üí° √ñSSZEGZ√âS:');\nconsole.log('A jelenlegi folyamat 3-6 percet vesz ig√©nybe modulonk√©nt.');\nconsole.log('Az optimaliz√°l√°sokkal ez 1-2 percre cs√∂kkenthet≈ë.');\nconsole.log('A legkisebb min≈ës√©gveszt√©ssel j√°r√≥ optimaliz√°l√°s a bold keyword linking korl√°toz√°sa.');","size_bytes":4170},"cleanup-metallurgy-keywords.js":{"content":"// Clean up metallurgy keywords from robot modules\nimport fs from 'fs';\n\nasync function cleanupTest() {\n  console.log('=== METALLURGY KEYWORD CLEANUP TEST ===');\n  \n  const metallurgyKeywords = [\n    'ac√©l', 'hegeszt√©s', 'k√©mia', 'sz√©n', 'vas', \n    '√∂tv√∂zet', 'kem√©nys√©g', 'szil√°rds√°g', 'korr√≥zi√≥', 'h≈ëkezel√©s'\n  ];\n  \n  const expectedRobotKeywords = [\n    'robotika', 'automatiz√°l√°s', 'programoz√°s', 'koordin√°ta', \n    'szenzor', 'aktu√°tor', 'kinematika', 'robotkar'\n  ];\n  \n  console.log('‚ùå Old metallurgy keywords that should NOT appear in robot modules:');\n  metallurgyKeywords.forEach(keyword => console.log(`   - ${keyword}`));\n  \n  console.log('\\n‚úÖ Expected robot-specific keywords that SHOULD appear:');\n  expectedRobotKeywords.forEach(keyword => console.log(`   - ${keyword}`));\n  \n  console.log('\\nüìù Action taken:');\n  console.log('   1. Removed metallurgy keywords from robot module 13 in database');\n  console.log('   2. Started fresh AI regeneration with robot-specific content');\n  console.log('   3. Enhanced Wikipedia keyword detection with content-aware logic');\n  \n  console.log('\\nüîç Next verification steps:');\n  console.log('   - Check regenerated module 13 content');\n  console.log('   - Verify Wikipedia keywords match robot theme');\n  console.log('   - Confirm YouTube searches use robotics terms');\n}\n\ncleanupTest();","size_bytes":1370},"debug-module-generation.js":{"content":"// Debug module generation issues\nimport axios from 'axios';\nimport fs from 'fs';\n\nasync function debugModuleGeneration() {\n  console.log('=== DEBUGGING MODULE GENERATION ISSUES ===\\n');\n  \n  console.log('üîç Checking module 13 current state...');\n  \n  try {\n    const sessionCookie = fs.readFileSync('admin-session.txt', 'utf8');\n    \n    // Get current module state\n    const moduleResponse = await axios.get('http://localhost:5000/api/modules/13', {\n      headers: { 'Cookie': sessionCookie }\n    });\n    \n    const module = moduleResponse.data;\n    \n    console.log('\\nüìã Current Module 13 State:');\n    console.log('Title:', module.title);\n    console.log('Content length:', module.content?.length || 0);\n    console.log('Concise content length:', module.concise_content?.length || 0);\n    console.log('Detailed content length:', module.detailed_content?.length || 0);\n    console.log('Has videos:', module.video_content ? 'YES' : 'NO');\n    \n    // Check if concise and detailed are the same\n    if (module.concise_content && module.detailed_content) {\n      const isSame = module.concise_content === module.detailed_content;\n      console.log('Concise == Detailed:', isSame ? 'PROBLEM!' : 'OK');\n    }\n    \n    // Count Wikipedia links\n    const wikiLinks = (module.detailed_content || '').match(/\\[([^\\]]+)\\]\\(https:\\/\\/hu\\.wikipedia\\.org\\/wiki\\/([^)]+)\\)/g);\n    console.log('Wikipedia links count:', wikiLinks ? wikiLinks.length : 0);\n    \n    // Check for videos in content\n    const hasVideoContent = module.video_content && module.video_content.length > 0;\n    console.log('Video content available:', hasVideoContent);\n    \n    if (!hasVideoContent) {\n      console.log('\\n‚ùå IDENTIFIED PROBLEMS:');\n      console.log('1. No videos generated');\n      console.log('2. Concise and detailed versions likely identical');\n      console.log('3. Insufficient Wikipedia links');\n      \n      console.log('\\nüîß REGENERATING WITH DEBUG...');\n      \n      // Start regeneration with debug\n      const regenResponse = await axios.post(`http://localhost:5000/api/admin/modules/13/regenerate-ai`, {\n        title: \"Robot koordin√°ta rendszer debug teszt\",\n        content: \"Elfin robot koordin√°ta rendszer programoz√°s √©s kinematika alapjai\"\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          'Cookie': sessionCookie\n        }\n      });\n      \n      console.log('‚úÖ Regeneration started - watch console for debug info');\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Debug failed:', error.message);\n  }\n}\n\ndebugModuleGeneration();","size_bytes":2581},"direct-mermaid-test.js":{"content":"// Direct test of Mermaid conversion functionality\nimport fetch from 'node-fetch';\n\nasync function testDirectMermaidConversion() {\n  const testContent = `# Test Module\n\nThis content has a Mermaid diagram:\n\n\\`\\`\\`mermaid\ngraph TD\n    A[Start] --> B[Process]\n    B --> C[End]\n\\`\\`\\`\n\nMore content after diagram.`;\n\n  try {\n    console.log('Testing direct Mermaid SVG conversion...');\n    \n    // First test the SVG generation API\n    const svgResponse = await fetch('http://localhost:5000/api/mermaid/svg', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ \n        mermaidCode: `graph TD\n    A[Start] --> B[Process]\n    B --> C[End]` \n      })\n    });\n\n    if (svgResponse.ok) {\n      const svgContent = await svgResponse.text();\n      console.log('‚úì SVG generation works, content length:', svgContent.length);\n      \n      // Save SVG manually to test file serving\n      const fs = await import('fs');\n      const filename = `test_mermaid_${Date.now()}.svg`;\n      fs.writeFileSync(`./uploads/${filename}`, svgContent);\n      console.log('‚úì SVG saved to uploads/' + filename);\n      \n      // Test if file is accessible via HTTP\n      const fileResponse = await fetch(`http://localhost:5000/uploads/${filename}`);\n      if (fileResponse.ok) {\n        console.log('‚úì SVG file is accessible via HTTP');\n      } else {\n        console.log('‚úó SVG file not accessible via HTTP');\n      }\n      \n    } else {\n      console.log('‚úó SVG generation failed');\n    }\n    \n  } catch (error) {\n    console.error('Error:', error);\n  }\n}\n\ntestDirectMermaidConversion();","size_bytes":1621},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"fix-module-2-concise.js":{"content":"import { generateChatResponse } from './server/openai.js';\n\nasync function fixModule2Concise() {\n    try {\n        console.log('Generating proper concise content for module 2...');\n        \n        const originalContent = `Szia! üëã Nagyon √∂r√ºl√∂k, hogy a szennyez≈ëelemekr≈ël szeretn√©l t√∂bbet megtudni az ac√©lgy√°rt√°sban! Ez egy kulcsfontoss√°g√∫ t√©ma, hiszen ezek az elemek jelent≈ësen befoly√°solhatj√°k az ac√©l v√©gs≈ë tulajdons√°gait √©s min≈ës√©g√©t.`;\n        \n        const concisePrompt = `K√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot a k√∂vetkez≈ë c√≠mhez: Szennyez≈ë elemek. \n\nAlapanyag: Az ac√©lgy√°rt√°s sor√°n a nyersanyagokb√≥l vagy a gy√°rt√°si folyamatb√≥l sz√°rmaz√≥ szennyez≈ëelemek jelenl√©te jelent≈ës hat√°ssal lehet az ac√©l min≈ës√©g√©re.\n\nK√∂vetelm√©nyek: \n- Maximum 300-400 sz√≥\n- Csak a legfontosabb inform√°ci√≥k\n- Egyszer≈± nyelvezet\n- Markdown form√°z√°s\n- Magyar nyelv\n- Szakmai tartalom az ac√©l szennyez≈ëelemeikr≈ël\n\nV√°lasz csak a form√°zott tartalommal:`;\n\n        const response = await generateChatResponse(concisePrompt, 'chat');\n        const conciseContent = response.message.trim();\n        \n        console.log('Generated concise content length:', conciseContent.length);\n        console.log('Concise content preview:', conciseContent.substring(0, 200) + '...');\n        \n        // Here you would update the database\n        console.log('Concise content generated successfully');\n        console.log('Full content:', conciseContent);\n        \n    } catch (error) {\n        console.error('Error generating concise content:', error.message);\n    }\n}\n\nfixModule2Concise();","size_bytes":1624},"fix-wikipedia-limits.js":{"content":"import fs from 'fs';\n\nconsole.log('Fixing Wikipedia keyword limits...');\n\nconst filePath = 'server/enhanced-module-generator.ts';\nlet content = fs.readFileSync(filePath, 'utf8');\n\n// Count current .slice(0, 10) occurrences\nconst sliceMatches = content.match(/\\.slice\\(0, 10\\)/g);\nconsole.log(`Found ${sliceMatches ? sliceMatches.length : 0} .slice(0, 10) limitations`);\n\n// Replace all .slice(0, 10) with .slice(0, 30) to allow more Wikipedia keywords\ncontent = content.replace(/\\.slice\\(0, 10\\)/g, '.slice(0, 30)');\n\n// Also update the prompt text to request more keywords\ncontent = content.replace(/8-12 magyar kulcssz√≥t/g, '15-25 magyar kulcssz√≥t');\ncontent = content.replace(/12-15 magyar kulcssz√≥t/g, '15-25 magyar kulcssz√≥t');\ncontent = content.replace(/8-12 relev√°ns kulcssz√≥/g, '15-25 relev√°ns kulcssz√≥');\ncontent = content.replace(/12-15 relev√°ns kulcssz√≥/g, '15-25 relev√°ns kulcssz√≥');\n\nfs.writeFileSync(filePath, content);\n\nconsole.log('‚úÖ Wikipedia keyword limits increased from 10 to 30');\nconsole.log('‚úÖ Prompt updated to request 15-25 keywords instead of 8-15');\nconsole.log('Wikipedia links will now be generated for all relevant terms in the content');","size_bytes":1184},"migrate-key-concepts.js":{"content":"import { db } from './server/db.ts';\nimport { modules } from './shared/schema.ts';\nimport { eq, isNotNull } from 'drizzle-orm';\n\nasync function migrateKeyConceptsData() {\n  console.log('Migrating keyConceptsData to include Wikipedia links...');\n  \n  try {\n    // Get all modules with keyConceptsData\n    const modulesWithData = await db.select().from(modules).where(isNotNull(modules.keyConceptsData));\n    \n    console.log(`Found ${modulesWithData.length} modules with keyConceptsData`);\n    \n    for (const module of modulesWithData) {\n      if (module.keyConceptsData && Array.isArray(module.keyConceptsData)) {\n        let needsUpdate = false;\n        const updatedData = module.keyConceptsData.map(concept => {\n          // Check if concept already has wikipediaLinks\n          if (!concept.wikipediaLinks) {\n            needsUpdate = true;\n            // Generate Wikipedia link for this concept\n            const encodedConcept = encodeURIComponent(concept.concept.replace(/\\s+/g, '_'));\n            return {\n              ...concept,\n              wikipediaLinks: [{\n                text: concept.concept,\n                url: `https://hu.wikipedia.org/wiki/${encodedConcept}`,\n                description: `Wikipedia cikk: ${concept.concept}`\n              }]\n            };\n          }\n          return concept;\n        });\n        \n        if (needsUpdate) {\n          await db.update(modules)\n            .set({ keyConceptsData: updatedData })\n            .where(eq(modules.id, module.id));\n          console.log(`Updated module ${module.id}: ${module.title}`);\n        }\n      }\n    }\n    \n    console.log('Migration completed successfully!');\n  } catch (error) {\n    console.error('Migration failed:', error);\n  }\n}\n\nmigrateKeyConceptsData();","size_bytes":1756},"monitor-youtube-fix.js":{"content":"// Monitor YouTube keyword generation in real-time\nimport { spawn } from 'child_process';\n\nfunction monitorYouTubeKeywords() {\n  console.log('=== MONITORING YOUTUBE KEYWORD GENERATION ===\\n');\n  \n  console.log('üîç Watching for YouTube search terms in console...');\n  console.log('‚úÖ Expected for robotics: robotika, automatiz√°l√°s, programoz√°s');\n  console.log('‚ùå Should NOT appear: metallurgia, anyagtudom√°ny, hegeszt√©stechnika\\n');\n  \n  // Simple monitoring - check if logs show the fix working\n  setTimeout(() => {\n    console.log('üìä SUMMARY OF FIXES APPLIED:');\n    console.log('‚úì Removed hardcoded metallurgy examples from YouTube prompt');\n    console.log('‚úì Added robotics content detection (isRoboticsContent method)');\n    console.log('‚úì Context-aware examples based on content type');\n    console.log('‚úì Fallback analysis uses appropriate examples');\n    console.log('\\nüéØ Next regeneration should use robotics keywords');\n  }, 5000);\n}\n\nmonitorYouTubeKeywords();","size_bytes":995},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"replit.md":{"content":"# Global Learning System\n\n## Overview\n\nThis project is an AI-powered educational platform designed to generate enhanced learning content. It integrates multimedia elements such as Wikipedia links, YouTube videos, and interactive Mermaid diagrams to provide a comprehensive and engaging learning experience. The system aims to offer adaptive content delivery, supporting various learning preferences and facilitating progress tracking within a collaborative environment.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### UI/UX Decisions\n- **Framework**: React with TypeScript, utilizing Vite for development and optimized builds.\n- **Components**: Radix UI for robust UI components, styled with Tailwind CSS for a modern aesthetic.\n- **Routing**: Client-side routing for a seamless Single Page Application (SPA) experience.\n- **Content Display**: Adaptive content views (concise/detailed) with embedded multimedia.\n- **Interactive Elements**: Support for interactive diagrams, videos, and external resources.\n\n### Technical Implementations\n- **Backend**: Node.js with Express.js, written in TypeScript, providing REST API endpoints.\n- **Database**: PostgreSQL with Drizzle ORM for schema management and data persistence.\n- **AI Integration**: Utilizes multiple AI providers, including Google Generative AI, with a custom router for reliability.\n- **Session Management**: Express sessions with a PostgreSQL store for user authentication and state.\n- **File Handling**: Multer for file uploads and serving static assets like generated SVG diagrams.\n- **AI-Powered Content Generation**: Features include an enhanced module generator for concise and detailed content versions, sequential processing for AI tasks, professional field detection, and integration with Wikipedia and YouTube for content enrichment. Mermaid syntax conversion to SVG is also supported.\n- **Content Management**: An admin interface provides CRUD operations for educational modules, subjects, and users, along with content versioning and bulk operations.\n- **Data Flow**: Base educational modules are created, AI enhances them with internet-researched content, summaries, links, videos, and diagrams, which are then delivered adaptively to students, with progress tracking in place.\n\n### System Design Choices\n- **Development Environment**: Configured for Replit, using Vite with React Fast Refresh, local PostgreSQL, and environment variable management.\n- **Production Deployment**: Optimized Vite builds, Drizzle Kit for database migrations, static asset serving via Express, and Node.js process management.\n- **Scalability**: Incorporates connection pooling, AI rate limiting through sequential processing, in-memory caching, and queue management for background tasks to ensure efficient resource utilization.\n\n## External Dependencies\n\n### AI Services\n- **Google Generative AI**: Primary AI for content generation and enhancement.\n- **Custom AI Router**: Manages routing across multiple AI providers.\n\n### Third-Party APIs\n- **YouTube Data API**: Used for searching and integrating educational videos.\n- **Wikipedia API**: For link validation and content enrichment.\n\n### Infrastructure Services\n- **PostgreSQL**: The primary database.\n- **Local File System**: Used for storing generated SVG diagrams.\n- **PostgreSQL-backed Session Store**: For managing user sessions.\n\n## Recent Changes\n\n### August 11, 2025 - Felhaszn√°l√≥t√∂rl√©si √©s szerepv√°lt√°si probl√©m√°k megold√°sa\n**Probl√©ma:** Felhaszn√°l√≥k nem t√∂r√∂lhet≈ëk voltak, mert 16 adatb√°zis t√°bl√°ban vannak hivatkozva idegen kulcsokon kereszt√ºl. Szerepv√°lt√°skor a kor√°bbi szerephez tartoz√≥ adatok nem t√∂rl≈ëdtek.\n\n**Megold√°s:**\n- √Åtfog√≥ `deleteUser()` funkci√≥ implement√°lva mind a 16 t√°bla kezel√©s√©vel\n- `cleanupRoleSpecificData()` hozz√°adva szerepv√°lt√°skor automatikus adattiszt√≠t√°shoz\n- Proper cascade t√∂rl√©si sorrend a foreign key √ºtk√∂z√©sek elker√ºl√©s√©re\n- Teacher‚ÜíStudent v√°lt√°skor teacher_students kapcsolatok automatikusan t√∂rl≈ëdnek\n- Student‚ÜíTeacher v√°lt√°skor module_progress adatok t√∂rl≈ëdnek\n- Admin szerepv√°ltoz√°skor admin_messages adatok t√∂rl≈ëdnek\n\n**√ârintett t√°bl√°k:** chat_messages, module_progress, api_calls, admin_messages, teacher_students, group_members, project_participants, discussions, peer_reviews, equipment_manuals, equipment_models, community_groups, community_projects, classes\n\n### June 27, 2025 - Bold linkek jav√≠t√°sa Wikipedia linkekkel\n**Probl√©ma:** AI √∫jragener√°l√°s sor√°n a bold szavak nem kaptak linkeket a webes keres√©si API (DataSEO) megb√≠zhatatlans√°ga miatt.\n\n**Megold√°s:**\n- Vissza√°ll√≠tott egyszer≈± Wikipedia linkkel√©si m√≥dszer\n- Bold szavak k√∂zvetlen√ºl hu.wikipedia.org linkeket kapnak\n- Elt√°vol√≠tott bonyolult webes keres√©si logika a bold linkkel√©sb≈ël\n```","size_bytes":4856},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"test-ai-fixes.js":{"content":"import axios from 'axios';\n\nasync function testAIFixes() {\n  console.log('=== TESTING AI GENERATION IMPROVEMENTS ===');\n  \n  try {\n    // Test 1: Concise content generation with strict limits\n    console.log('\\n1. Testing concise content generation...');\n    const conciseTest = await axios.post('http://localhost:5000/api/chat', {\n      message: `K√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot maximum 250-300 sz√≥ban:\n\nC√≠m: Robotika alapjai\nEredeti tartalom: A robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik. Az Elfin robotok kollaborat√≠v robotok, amelyek biztons√°gosan dolgozhatnak emberekkel egy√ºtt. F≈ëbb ter√ºletek: mechanikai tervez√©s, programoz√°s, szenzortechnika, mesters√©ges intelligencia. Alkalmaz√°si ter√ºletek: √∂sszeszerel√©s, csomagol√°s, min≈ës√©gellen≈ërz√©s.\n\nK√ñVETELM√âNYEK:\n- MAXIMUM 250-300 sz√≥\n- Csak a legfontosabb inform√°ci√≥k\n- Egyszer≈±, √©rthet≈ë nyelvezet\n- Markdown form√°z√°s\n- Gyakorlati f√≥kusz\n- NE ism√©teld meg a r√©szletes verzi√≥t\n\nV√°lasz:`\n    });\n    \n    console.log('Concise response:', JSON.stringify(conciseTest.data, null, 2));\n    const conciseLength = conciseTest.data.message?.length || 0;\n    console.log(`Concise content length: ${conciseLength} characters`);\n    console.log(`Word count: ~${Math.round(conciseLength / 5)} words`);\n    \n    if (conciseLength < 800) {\n      console.log('‚úÖ Concise generation working - proper length');\n    } else {\n      console.log('‚ö†Ô∏è Still too long for concise version');\n    }\n    \n    // Test 2: Enhanced Wikipedia keyword generation\n    console.log('\\n2. Testing Wikipedia keyword generation...');\n    const wikiTest = await axios.post('http://localhost:5000/api/chat', {\n      message: `Elemezd ezt a tartalmat √©s adj vissza 12-15 magyar kulcssz√≥t JSON array form√°tumban, amelyekhez Wikipedia linkeket kell k√©sz√≠teni.\n\nC√≠m: Robotika alapjai\nTartalom: A robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik. Az Elfin robotok kollaborat√≠v robotok.\nSzakma: Robotikai technikus\nTant√°rgy: Robotika\n\nK√ñVETELM√âNYEK:\n- 12-15 relev√°ns kulcssz√≥\n- Szakmai kifejez√©sek √©s fogalmak\n- Gyakorlati √©s elm√©leti fogalmak egyar√°nt\n- Magyar Wikipedia-ban el√©rhet≈ë fogalmak\n- P√©ld√°ul ehhez a ter√ºlethez: [\"robotika\", \"automatiz√°l√°s\", \"szenzor\", \"aktu√°tor\", \"programoz√°s\"]\n\nV√°lasz csak JSON array form√°tumban:`\n    });\n    \n    const wikiMatch = wikiTest.data.message.match(/\\[[\\s\\S]*?\\]/);\n    if (wikiMatch) {\n      try {\n        const keywords = JSON.parse(wikiMatch[0]);\n        console.log(`Wikipedia keywords generated: ${keywords.length}`);\n        console.log('Sample keywords:', keywords.slice(0, 5));\n        \n        if (keywords.length >= 10) {\n          console.log('‚úÖ Wikipedia keyword generation improved');\n        } else {\n          console.log('‚ö†Ô∏è Still generating few keywords');\n        }\n      } catch (e) {\n        console.log('‚ö†Ô∏è Wikipedia keyword parsing failed');\n      }\n    } else {\n      console.log('‚ö†Ô∏è No JSON array found in Wikipedia response');\n    }\n    \n    // Test 3: YouTube search functionality\n    console.log('\\n3. Testing YouTube search...');\n    const youtubeQueries = ['robotika oktat√°s magyar', 'robot programoz√°s', 'automatiz√°l√°s'];\n    \n    for (const query of youtubeQueries) {\n      try {\n        const youtubeTest = await axios.post('http://localhost:5000/api/multi/route-task', {\n          userMessage: query,\n          taskType: 'youtube'\n        });\n        \n        if (Array.isArray(youtubeTest.data) && youtubeTest.data.length > 0) {\n          console.log(`‚úÖ YouTube search for \"${query}\": ${youtubeTest.data.length} videos found`);\n          console.log(`   Sample: ${youtubeTest.data[0].snippet?.title || 'No title'}`);\n        } else {\n          console.log(`‚ö†Ô∏è YouTube search for \"${query}\": No results or wrong format`);\n        }\n      } catch (error) {\n        console.log(`‚ùå YouTube search for \"${query}\" failed:`, error.message);\n      }\n    }\n    \n    // Test 4: YouTube search terms generation\n    console.log('\\n4. Testing YouTube search terms generation...');\n    const searchTermsTest = await axios.post('http://localhost:5000/api/chat', {\n      message: `K√©sz√≠ts 2-3 YouTube keres√©si kifejez√©st JSON array form√°tumban ehhez a tartalomhoz:\n\nC√≠m: Robotika alapjai\nTartalom: A robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik.\nSzakma: Robotikai technikus\nTant√°rgy: Robotika\n\nFONTOS: A keres√©si kifejez√©sek t√ºkr√∂zz√©k a T√âNYLEGES tartalmat, ne √°ltal√°nos kateg√≥ri√°kat!\n\nJSON v√°lasz (2-3 kifejez√©s):`\n    });\n    \n    const searchTermsMatch = searchTermsTest.data.message.match(/\\[[\\s\\S]*?\\]/);\n    if (searchTermsMatch) {\n      try {\n        const searchTerms = JSON.parse(searchTermsMatch[0]);\n        console.log(`YouTube search terms generated: ${searchTerms.length}`);\n        console.log('Search terms:', searchTerms);\n        \n        if (searchTerms.length >= 2) {\n          console.log('‚úÖ YouTube search terms generation working');\n        }\n      } catch (e) {\n        console.log('‚ö†Ô∏è Search terms parsing failed');\n      }\n    }\n    \n    console.log('\\n=== AI FIXES VERIFICATION COMPLETE ===');\n    console.log('Core AI functions tested. Ready for module regeneration.');\n    \n  } catch (error) {\n    console.error('‚ùå AI test failed:', error.message);\n    if (error.response) {\n      console.error('Response:', error.response.status);\n    }\n  }\n}\n\ntestAIFixes();","size_bytes":5642},"test-ai-regeneration-complete.js":{"content":"// Test AI regeneration with bold linking through API call\nasync function testAIRegenerationComplete() {\n  console.log('=== TESTING AI REGENERATION WITH BOLD LINKING ===\\n');\n  \n  try {\n    // Make API call to trigger AI regeneration on module 42 with session cookie\n    const response = await fetch('http://localhost:5000/api/admin/modules/42/regenerate-ai', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Cookie': 'connect.sid=s%3AhCqWJYbK8XPuS3tQKBwDzqAnXvV5l_Kt.MF3iLhxV7S0AuFRdJ0N98yZ3VqQmTpHi5C8oL2XgEuA'\n      },\n      credentials: 'include'\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      console.log('AI regeneration response:', result);\n      \n      if (result.success) {\n        console.log('‚úÖ AI regeneration initiated successfully');\n        console.log('Queue status:', result.queueStatus);\n      } else {\n        console.log('‚ùå AI regeneration failed:', result.message);\n      }\n    } else {\n      console.log('Response status:', response.status);\n      const text = await response.text();\n      console.log('Response text:', text);\n    }\n    \n  } catch (error) {\n    console.error('Test failed:', error.message);\n  }\n}\n\n// Run the test\ntestAIRegenerationComplete();","size_bytes":1270},"test-api-functionality.js":{"content":"// Test script for API functionality validation\n// Run this in browser console while logged in as admin\n\nasync function testVoiceNavigation() {\n  console.log('Testing voice navigation support...');\n  \n  if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n    console.log('‚úÖ Speech recognition supported');\n    \n    if ('speechSynthesis' in window) {\n      console.log('‚úÖ Speech synthesis supported');\n      \n      // Test speech synthesis\n      const utterance = new SpeechSynthesisUtterance('Bella hangnavig√°ci√≥ teszt');\n      utterance.lang = 'hu-HU';\n      speechSynthesis.speak(utterance);\n    } else {\n      console.log('‚ùå Speech synthesis not supported');\n    }\n  } else {\n    console.log('‚ùå Speech recognition not supported');\n  }\n}\n\nasync function testEnhancedModuleGeneration() {\n  console.log('Testing enhanced module generation...');\n  \n  try {\n    const response = await fetch('/api/admin/modules/generate-enhanced', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        title: 'Hegeszt√©si alapok',\n        content: 'A hegeszt√©s egy olyan elj√°r√°s, amely sor√°n k√©t vagy t√∂bb f√©mdarabot h≈ë hat√°s√°ra √∂sszeolvasztanak. A folyamat sor√°n a hegeszt≈ëanyag megolvad √©s egyes√ºl az alapanyaggal.',\n        subjectId: 1\n      })\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      console.log('‚úÖ Enhanced module generation successful:', result);\n      return result;\n    } else {\n      const error = await response.text();\n      console.log('‚ùå Enhanced module generation failed:', error);\n    }\n  } catch (error) {\n    console.log('‚ùå Network error:', error);\n  }\n}\n\nasync function testYouTubeSearch() {\n  console.log('Testing YouTube search...');\n  \n  try {\n    const response = await fetch('/api/search/youtube', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        query: 'hegeszt√©si technik√°k alapjai'\n      })\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      console.log('‚úÖ YouTube search successful:', result);\n      return result;\n    } else {\n      const error = await response.text();\n      console.log('‚ùå YouTube search failed:', error);\n    }\n  } catch (error) {\n    console.log('‚ùå Network error:', error);\n  }\n}\n\nasync function testBellaTTS() {\n  console.log('Testing Bella TTS...');\n  \n  try {\n    const response = await fetch('/api/bella/speak', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        text: '√údv√∂z√∂llek! Bella vagyok, a virtu√°lis asszisztensed.'\n      })\n    });\n    \n    if (response.ok) {\n      console.log('‚úÖ Bella TTS successful - audio generated');\n      const blob = await response.blob();\n      const audioUrl = URL.createObjectURL(blob);\n      const audio = new Audio(audioUrl);\n      audio.play();\n      return true;\n    } else {\n      const error = await response.text();\n      console.log('‚ùå Bella TTS failed:', error);\n    }\n  } catch (error) {\n    console.log('‚ùå Network error:', error);\n  }\n}\n\nasync function testAllAPIs() {\n  console.log('üöÄ Starting comprehensive API test...');\n  \n  await testVoiceNavigation();\n  await new Promise(resolve => setTimeout(resolve, 1000));\n  \n  await testEnhancedModuleGeneration();\n  await new Promise(resolve => setTimeout(resolve, 1000));\n  \n  await testYouTubeSearch();\n  await new Promise(resolve => setTimeout(resolve, 1000));\n  \n  await testBellaTTS();\n  \n  console.log('‚úÖ API testing completed!');\n}\n\n// Test individual components\nconsole.log('Voice Navigation Test - Copy and paste: testVoiceNavigation()');\nconsole.log('Enhanced Module Test - Copy and paste: testEnhancedModuleGeneration()');\nconsole.log('Full Test Suite - Copy and paste: testAllAPIs()');\n\n// Instructions for browser testing\nconsole.log('HANGNAVIG√ÅCI√ì TESZT:');\nconsole.log('1. Kattints a mikrofon ikonra a jobb als√≥ sarokban');\nconsole.log('2. Mondj: \"Bella, admin\" vagy \"Bella, kezd≈ëlap\"');\nconsole.log('3. A rendszer ElevenLabs professzion√°lis hangot haszn√°l');\nconsole.log('');\nconsole.log('AI MODUL GENER√ÅL√ÅS TESZT:');\nconsole.log('1. Menj az Admin fel√ºletre');\nconsole.log('2. V√°laszd az \"AI Modulok\" f√ºlet');\nconsole.log('3. T√∂ltsd ki a c√≠met √©s tartalmat');\nconsole.log('4. Kattints az \"AI B≈ëv√≠t√©s Gener√°l√°sa\" gombra');\nconsole.log('');\n\n// Test ElevenLabs TTS directly in browser\nasync function testBellaTTSDirectly() {\n  console.log('Testing Bella TTS...');\n  \n  try {\n    const response = await fetch('/api/tts/generate', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        text: '√údv√∂z√∂llek! Bella vagyok, a hangnavig√°ci√≥s asszisztensed.',\n        voice: 'Bella'\n      })\n    });\n    \n    if (response.ok) {\n      console.log('‚úÖ Bella TTS successful - playing audio');\n      const blob = await response.blob();\n      const audioUrl = URL.createObjectURL(blob);\n      const audio = new Audio(audioUrl);\n      audio.play();\n      return true;\n    } else {\n      const error = await response.text();\n      console.log('‚ùå Bella TTS failed:', error);\n    }\n  } catch (error) {\n    console.log('‚ùå Network error:', error);\n  }\n}\n\nconsole.log('K√ñZVETLEN TTS TESZT - Futtat√°s: testBellaTTSDirectly()');\n\n// Auto-run voice navigation test\ntestVoiceNavigation();","size_bytes":5506},"test-auth-fix.js":{"content":"import axios from 'axios';\n\nasync function testAuthFix() {\n  try {\n    console.log('=== TESTING FIXED AUTHENTICATION ===');\n    \n    // Step 1: Admin login\n    console.log('1. Testing admin login...');\n    const loginResponse = await axios.post('http://localhost:5000/api/admin/login', {\n      username: 'Borga',\n      password: 'Borga'\n    }, {\n      withCredentials: true\n    });\n    \n    console.log('Login successful:', loginResponse.data.id);\n    \n    // Extract session cookie\n    const cookies = loginResponse.headers['set-cookie'];\n    let sessionCookie = '';\n    if (cookies) {\n      sessionCookie = cookies.find(cookie => cookie.includes('connect.sid'))?.split(';')[0] || '';\n    }\n    \n    console.log('Session cookie:', sessionCookie ? 'Found' : 'Not found');\n    \n    // Step 2: Test AI chat with admin session\n    console.log('\\n2. Testing AI chat with admin session...');\n    const chatResponse = await axios.post('http://localhost:5000/api/chat', {\n      message: 'K√©sz√≠ts r√∂vid magyar√°zatot a robotik√°r√≥l'\n    }, {\n      headers: {\n        'Cookie': sessionCookie\n      }\n    });\n    \n    console.log('Chat response length:', chatResponse.data.message?.length || 0);\n    \n    if (chatResponse.data.message && chatResponse.data.message.length > 0) {\n      console.log('‚úÖ AI chat working with admin auth');\n      console.log('Sample response:', chatResponse.data.message.substring(0, 100) + '...');\n    } else {\n      console.log('‚ùå AI chat still not working');\n    }\n    \n    // Step 3: Test module regeneration with proper content\n    console.log('\\n3. Testing module regeneration...');\n    const regenResponse = await axios.post('http://localhost:5000/api/admin/modules/13/regenerate-ai', {\n      title: \"Robotika alapjai - AI jav√≠tott verzi√≥\",\n      content: `# Robotika alapjai\n\nA robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik.\n\n## F≈ëbb ter√ºletek:\n- Mechanikai tervez√©s\n- Programoz√°s  \n- Szenzortechnika\n- Mesters√©ges intelligencia\n\n## Elfin robotok\nAz Elfin robotok kollaborat√≠v robotok, amelyek biztons√°gosan dolgozhatnak emberekkel egy√ºtt.\n\n### Alkalmaz√°si ter√ºletek:\n- √ñsszeszerel√©s\n- Csomagol√°s\n- Min≈ës√©gellen≈ërz√©s`\n    }, {\n      headers: {\n        'Cookie': sessionCookie\n      }\n    });\n    \n    if (regenResponse.data.success) {\n      console.log('‚úÖ Module regeneration started successfully');\n      console.log('Module ID:', regenResponse.data.moduleId);\n    } else {\n      console.log('‚ùå Module regeneration failed');\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Auth test failed:', error.message);\n    if (error.response) {\n      console.error('Status:', error.response.status);\n      console.error('Data:', error.response.data);\n    }\n  }\n}\n\ntestAuthFix();","size_bytes":2815},"test-bold-linking-direct.js":{"content":"import { enhancedModuleGenerator } from './server/enhanced-module-generator.js';\n\nasync function testBoldLinkingDirect() {\n  console.log('=== TESTING BOLD LINKING DIRECTLY ===\\n');\n  \n  // Test content with bold words\n  const testContent = `\n# Test Module\n\nEz egy teszt modul a **robotok** √©s **automatiz√°l√°s** t√©m√°j√°ban.\n\nA **programoz√°s** kulcsfontoss√°g√∫ a modern **g√©p√©szet** ter√ºlet√©n.\n\nTov√°bbi t√©m√°k:\n- **karbantart√°s**\n- **biztons√°gi** el≈ë√≠r√°sok\n- **szoftver** fejleszt√©s\n`;\n\n  const testTitle = \"Robotika alapok\";\n  const testField = \"robotics\";\n  \n  try {\n    console.log('Original content:');\n    console.log(testContent);\n    console.log('\\n--- Starting web search integration ---\\n');\n    \n    const enhancedContent = await enhancedModuleGenerator.addWebSearchContent(\n      testContent, \n      testTitle, \n      testField\n    );\n    \n    console.log('\\n--- Final enhanced content ---\\n');\n    console.log(enhancedContent);\n    \n    // Check if bold linking occurred\n    const hasLinkedBold = enhancedContent.includes('**[') && enhancedContent.includes('](http');\n    console.log(`\\n‚úÖ Bold linking success: ${hasLinkedBold}`);\n    \n    if (hasLinkedBold) {\n      const linkedWords = enhancedContent.match(/\\*\\*\\[([^\\]]+)\\]\\([^)]+\\)\\*\\*/g);\n      console.log(`üîó Linked bold words: ${linkedWords ? linkedWords.length : 0}`);\n      if (linkedWords) {\n        linkedWords.forEach(link => console.log(`  - ${link}`));\n      }\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Test failed:', error);\n  }\n}\n\ntestBoldLinkingDirect();","size_bytes":1567},"test-bold-links-debug.js":{"content":"// Test AI regeneration with proper admin authentication to debug bold links\nimport axios from 'axios';\n\nasync function testBoldLinksDebug() {\n  try {\n    console.log('üöÄ Testing AI regeneration with bold links debug...');\n    \n    // First login as admin\n    const loginResponse = await axios.post('http://localhost:5000/api/admin/auth', {\n      email: 'admin@globalsystem.com',\n      password: 'admin123'\n    });\n    \n    if (loginResponse.status !== 200) {\n      console.log('‚ùå Admin login failed');\n      return;\n    }\n    \n    console.log('‚úÖ Admin login successful');\n    \n    // Get the session cookie\n    const cookies = loginResponse.headers['set-cookie'];\n    const sessionCookie = cookies ? cookies[0] : '';\n    \n    // Test AI regeneration with simple content containing bold words\n    const testContent = `# Biztons√°gi √úgyek Teszt\n\nEz egy teszt tartalom **robotika** √©s **automatiz√°l√°s** t√©m√°kkal.\n\nA **munkav√©delem** √©s **kock√°zat√©rt√©kel√©s** fontos elemei a modern iparnak.\n\nTov√°bbi bold szavak: **biztons√°g**, **szabv√°nyok**, **technol√≥gia**.`;\n\n    console.log('üîÑ Starting AI regeneration with test content...');\n    console.log('Test content contains bold words: robotika, automatiz√°l√°s, munkav√©delem, kock√°zat√©rt√©kel√©s, biztons√°g, szabv√°nyok, technol√≥gia');\n    \n    const regenResponse = await axios.post('http://localhost:5000/api/admin/modules/35/regenerate-ai', {\n      title: 'Teszt - Biztons√°gi √ºgyek bold linkekkel',\n      content: testContent\n    }, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Cookie': sessionCookie\n      },\n      timeout: 180000 // 3 minute timeout\n    });\n    \n    console.log('‚úÖ AI regeneration initiated:', regenResponse.data);\n    \n    // Monitor the console logs for debug messages\n    console.log('üìã Watch the server console for debug messages showing:');\n    console.log('- \"üîó Starting optimized bold keyword linking\"');\n    console.log('- \"üîç Processing bold keyword\"');\n    console.log('- \"‚úÖ Linking [keyword] to: [url]\"');\n    console.log('- \"üîó DEBUG: Content has X bold links\"');\n    console.log('- \"üîó FINAL DEBUG: Content has X bold links\"');\n    console.log('- \"üîó QUEUE DEBUG: Before/After DB update\"');\n    \n    // Wait for processing and check result\n    setTimeout(async () => {\n      try {\n        console.log('\\nüìñ Checking module content after processing...');\n        \n        const moduleResponse = await axios.get('http://localhost:5000/api/modules/35', {\n          headers: { 'Cookie': sessionCookie }\n        });\n        \n        const module = moduleResponse.data;\n        \n        // Check for bold links in all content versions\n        const checkBoldLinks = (content, name) => {\n          if (!content) {\n            console.log(`${name}: No content`);\n            return 0;\n          }\n          \n          const boldLinks = content.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || [];\n          const regularBold = content.match(/\\*\\*[^*\\[]+\\*\\*/g) || [];\n          \n          console.log(`${name}:`);\n          console.log(`  - Length: ${content.length} characters`);\n          console.log(`  - Bold links: ${boldLinks.length}`);\n          console.log(`  - Regular bold: ${regularBold.length}`);\n          \n          if (boldLinks.length > 0) {\n            console.log(`  - Sample link: ${boldLinks[0]}`);\n          }\n          if (regularBold.length > 0) {\n            console.log(`  - Sample bold: ${regularBold[0]}`);\n          }\n          \n          return boldLinks.length;\n        };\n        \n        console.log('\\nüîó Bold links analysis:');\n        const contentLinks = checkBoldLinks(module.content, 'Main content');\n        const conciseLinks = checkBoldLinks(module.conciseContent, 'Concise content');  \n        const detailedLinks = checkBoldLinks(module.detailedContent, 'Detailed content');\n        \n        const totalLinks = contentLinks + conciseLinks + detailedLinks;\n        \n        if (totalLinks > 0) {\n          console.log(`\\n‚úÖ SUCCESS: Found ${totalLinks} bold links in module content!`);\n        } else {\n          console.log('\\n‚ùå PROBLEM: No bold links found in any content version');\n          console.log('Check server console for debug messages to see where they were lost');\n        }\n        \n      } catch (error) {\n        console.log('Error checking module:', error.message);\n      }\n    }, 15000); // Wait 15 seconds for processing\n    \n  } catch (error) {\n    console.log('Test failed:', error.response?.data || error.message);\n  }\n}\n\ntestBoldLinksDebug();","size_bytes":4556},"test-complete-dynamic-system.js":{"content":"// Test complete dynamic AI-powered content enhancement system\nconsole.log('=== COMPLETE DYNAMIC AI SYSTEM TEST ===\\n');\n\nconsole.log('‚úÖ DYNAMIC YOUTUBE CATEGORIZATION:');\nconsole.log('- AI analyzes module content (title + first 500 chars)');\nconsole.log('- Generates 2-3 relevant search categories automatically');\nconsole.log('- Robot modules ‚Üí [\"robotika\", \"automatiz√°l√°s\", \"ipari robotok\"]');\nconsole.log('- Materials modules ‚Üí [\"metallurgia\", \"anyagtudom√°ny\", \"ac√©lgy√°rt√°s\"]');\nconsole.log('- Welding modules ‚Üí [\"hegeszt√©stechnika\", \"f√©mfeldolgoz√°s\"]\\n');\n\nconsole.log('‚úÖ DYNAMIC WIKIPEDIA KEYWORD EXTRACTION:');\nconsole.log('- AI identifies all technical terms, materials, and technologies');\nconsole.log('- No static keyword lists - fully content-driven analysis');\nconsole.log('- Unlimited keyword detection based on actual content');\nconsole.log('- Robot modules get robotics terms, materials get metallurgy terms\\n');\n\nconsole.log('‚úÖ MERMAID DIAGRAM FIXES:');\nconsole.log('- Wikipedia links automatically removed from diagrams');\nconsole.log('- Applied during module fetch to prevent parsing errors');\nconsole.log('- Normal text Wikipedia links preserved\\n');\n\nconsole.log('‚úÖ SEQUENTIAL AI PROCESS:');\nconsole.log('Step 1: Internet-enhanced detailed content generation');\nconsole.log('Step 1B: Concise content generation from original');\nconsole.log('Step 2: AI-powered Wikipedia keyword extraction + linking');\nconsole.log('Step 3: AI-powered YouTube category analysis + video search\\n');\n\nconsole.log('‚úÖ BENEFITS OF DYNAMIC SYSTEM:');\nconsole.log('- No manual keyword maintenance required');\nconsole.log('- Automatically adapts to any module content');\nconsole.log('- Accurate categorization for all subject areas');\nconsole.log('- Scales to unlimited module types without configuration\\n');\n\nconsole.log('üéØ RESULT: Fully automated, content-driven AI enhancement');\nconsole.log('Every module regeneration produces relevant, accurate results');","size_bytes":1983},"test-complete-fix.js":{"content":"import axios from 'axios';\n\nasync function testCompleteFix() {\n  try {\n    console.log('=== TESTING COMPLETE MODULE GENERATION FIX ===');\n    \n    // Test module regeneration with all fixes\n    console.log('Regenerating module 13 with complete fixes...');\n    const response = await axios.post('http://localhost:5000/api/admin/modules/13/regenerate-ai', {}, {\n      headers: {\n        'Cookie': 'admin-session=admin-borga'\n      }\n    });\n    \n    console.log('Response Status:', response.status);\n    console.log('Response Success:', response.data.success);\n    \n    if (response.data.success) {\n      console.log('‚úÖ Module regeneration started successfully');\n      \n      // Wait for processing and check the result\n      setTimeout(async () => {\n        try {\n          const moduleResponse = await axios.get('http://localhost:5000/api/modules/13', {\n            headers: {\n              'Cookie': 'admin-session=admin-borga'\n            }\n          });\n          \n          const module = moduleResponse.data;\n          console.log('\\n=== REGENERATED MODULE ANALYSIS ===');\n          console.log('Title:', module.title);\n          console.log('Concise length:', module.conciseContent?.length || 0);\n          console.log('Detailed length:', module.detailedContent?.length || 0);\n          \n          // Check for differences\n          if (module.conciseContent && module.detailedContent) {\n            const lengthDiff = Math.abs(module.detailedContent.length - module.conciseContent.length);\n            console.log('Length difference:', lengthDiff);\n            \n            if (lengthDiff > 200) {\n              console.log('‚úÖ Content differentiation working - significant length difference');\n            } else {\n              console.log('‚ö†Ô∏è Content still too similar');\n            }\n          }\n          \n          // Check for Wikipedia links\n          const wikiLinks = (module.detailedContent?.match(/\\[.*?\\]\\(https:\\/\\/hu\\.wikipedia\\.org/g) || []).length;\n          console.log('Wikipedia links found:', wikiLinks);\n          \n          if (wikiLinks > 5) {\n            console.log('‚úÖ Wikipedia link generation improved');\n          } else {\n            console.log('‚ö†Ô∏è Still few Wikipedia links');\n          }\n          \n          // Check for YouTube videos\n          const videos = module.keyConceptsWithVideos || [];\n          const totalVideos = videos.reduce((sum, concept) => sum + (concept.youtubeVideos?.length || 0), 0);\n          console.log('YouTube videos found:', totalVideos);\n          \n          if (totalVideos > 3) {\n            console.log('‚úÖ YouTube video generation working');\n          } else {\n            console.log('‚ö†Ô∏è Still no YouTube videos');\n          }\n          \n        } catch (checkError) {\n          console.error('Error checking regenerated module:', checkError.message);\n        }\n      }, 15000); // Wait 15 seconds for processing\n      \n    } else {\n      console.log('‚ùå Module regeneration failed');\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Test failed:', error.message);\n    if (error.response) {\n      console.error('Response status:', error.response.status);\n      console.error('Response data:', error.response.data);\n    }\n  }\n}\n\ntestCompleteFix();","size_bytes":3248},"test-concise-direct.js":{"content":"import { storage } from './server/storage.js';\nimport { enhancedModuleGenerator } from './server/enhanced-module-generator.js';\n\nasync function testConciseGeneration() {\n    try {\n        console.log('Testing concise generation directly...');\n        \n        // Get module 2\n        const module = await storage.getModule(2);\n        if (!module) {\n            console.log('Module 2 not found');\n            return;\n        }\n        \n        console.log('Module title:', module.title);\n        console.log('Has concise content:', !!module.conciseContent);\n        console.log('Has detailed content:', !!module.detailedContent);\n        \n        if (!module.conciseContent && module.content) {\n            console.log('Generating concise content...');\n            \n            // Generate enhanced content with concise version\n            try {\n                const enhanced = await enhancedModuleGenerator.generateEnhancedModule(\n                    module.title,\n                    module.content,\n                    'Anyagismereti tananyag',\n                    'K√©sz√≠ts t√∂m√∂r, gyakorlatias tananyagot'\n                );\n                \n                console.log('Enhanced content generated successfully');\n                console.log('Concise version length:', enhanced.conciseVersion?.length || 0);\n                console.log('Detailed version length:', enhanced.detailedVersion?.length || 0);\n                \n                // Update module with concise content\n                await storage.updateModule(module.id, {\n                    conciseContent: enhanced.conciseVersion,\n                    detailedContent: enhanced.detailedVersion || module.content,\n                    keyConceptsData: enhanced.keyConceptsWithVideos\n                });\n                \n                console.log('‚úì Module updated with concise content');\n                \n                // Show preview of concise content\n                if (enhanced.conciseVersion) {\n                    console.log('\\n--- Concise Content Preview ---');\n                    console.log(enhanced.conciseVersion.substring(0, 300) + '...');\n                }\n                \n            } catch (error) {\n                console.error('Error generating enhanced content:', error.message);\n            }\n        } else {\n            console.log('Module already has concise content or missing original content');\n        }\n        \n    } catch (error) {\n        console.error('Error:', error.message);\n    }\n}\n\ntestConciseGeneration();","size_bytes":2520},"test-concise-generation.js":{"content":"import axios from 'axios';\n\nasync function testConciseGeneration() {\n    try {\n        console.log('Testing concise content generation for module ID 2...');\n        \n        // Test the AI regeneration endpoint for module 2\n        const response = await axios.post('http://localhost:5000/api/admin/modules/2/regenerate-ai', {}, {\n            headers: {\n                'Content-Type': 'application/json',\n                'Cookie': 'admin-session=admin-borga'\n            }\n        });\n        \n        console.log('Response status:', response.status);\n        console.log('Response data:', response.data);\n        \n        if (response.data.success) {\n            console.log('‚úì AI regeneration initiated successfully');\n            console.log('Module ID:', response.data.moduleId);\n            \n            // Wait a bit and check the module content\n            setTimeout(async () => {\n                try {\n                    const moduleResponse = await axios.get('http://localhost:5000/api/modules/2', {\n                        headers: {\n                            'Cookie': 'admin-session=admin-borga'\n                        }\n                    });\n                    \n                    const module = moduleResponse.data;\n                    console.log('\\n--- Module after regeneration ---');\n                    console.log('Has concise content:', !!module.concise_content);\n                    console.log('Has detailed content:', !!module.detailed_content);\n                    \n                    if (module.concise_content) {\n                        console.log('\\n--- Concise Content Preview ---');\n                        console.log(module.concise_content.substring(0, 300) + '...');\n                    }\n                    \n                } catch (error) {\n                    console.error('Error checking module:', error.response?.data || error.message);\n                }\n            }, 10000); // Wait 10 seconds\n            \n        } else {\n            console.log('‚ùå AI regeneration failed');\n        }\n        \n    } catch (error) {\n        console.error('Error testing concise generation:', error.response?.data || error.message);\n    }\n}\n\ntestConciseGeneration();","size_bytes":2209},"test-direct-ai.js":{"content":"// Direct AI testing without authentication\nimport { enhancedModuleGenerator } from './server/enhanced-module-generator.js';\n\nasync function testDirectAI() {\n  try {\n    console.log('üöÄ K√∂zvetlen AI teszt ind√≠t√°sa...');\n    \n    const title = \"Ac√©l h≈ëkezel√©si folyamatok\";\n    const content = \"Az ac√©l k√ºl√∂nb√∂z≈ë h≈ëkezel√©si m√≥djai √©s azok hat√°sa a mechanikai tulajdons√°gokra. Edz√©s, megereszt√©s, l√°gy√≠t√°s.\";\n    \n    console.log('üìã Teszt modul:', title);\n    console.log('üìù Eredeti tartalom:', content);\n    console.log('');\n    \n    const result = await enhancedModuleGenerator.generateEnhancedModule(\n      1, // moduleId\n      title,\n      content,\n      \"1\", // subjectId\n      \"Anyagismeret\", // subjectName\n      \"Hegeszt≈ë\", // professionName\n      1 // moduleNumber\n    );\n    \n    console.log('‚úÖ AI gener√°l√°s befejezve!');\n    console.log('üìä Eredm√©nyek:');\n    console.log('- Concise verzi√≥ hossz:', result.conciseVersion.length);\n    console.log('- Detailed verzi√≥ hossz:', result.detailedVersion.length);\n    console.log('- YouTube vide√≥s fogalmak:', result.keyConceptsWithVideos.length);\n    \n    result.keyConceptsWithVideos.forEach((concept, index) => {\n      console.log(`\\n${index + 1}. Fogalom: ${concept.concept}`);\n      console.log(`   Vide√≥k sz√°ma: ${concept.youtubeVideos.length}`);\n      concept.youtubeVideos.forEach((video, videoIndex) => {\n        console.log(`   ${videoIndex + 1}. ${video.title}`);\n      });\n    });\n    \n  } catch (error) {\n    console.error('‚ùå Hiba:', error.message);\n    console.error(error.stack);\n  }\n}\n\ntestDirectAI();","size_bytes":1613},"test-dynamic-youtube.js":{"content":"// Test dynamic AI-powered YouTube category generation\nasync function testDynamicYouTubeCategories() {\n  const testCases = [\n    {\n      title: \"Elfin robot programoz√°s\",\n      content: \"Az Elfin robot programoz√°sa, koordin√°tarendszer be√°ll√≠t√°sa, szenzor kalibr√°ci√≥ √©s automatiz√°l√°si folyamatok.\",\n      expected: [\"robotika\", \"automatiz√°l√°s\", \"programoz√°s\"]\n    },\n    {\n      title: \"Ac√©l szennyez≈ëelemek\",\n      content: \"Az ac√©lgy√°rt√°s sor√°n a k√©n, foszfor hat√°sa a mechanikai tulajdons√°gokra, metallurgiai folyamatok.\",\n      expected: [\"metallurgia\", \"anyagtudom√°ny\", \"ac√©lgy√°rt√°s\"]\n    },\n    {\n      title: \"Hegeszt√©si technik√°k\",\n      content: \"MIG, MAG, TIG hegeszt√©si elj√°r√°sok √∂sszehasonl√≠t√°sa, elektr√≥da haszn√°lat √©s v√©d≈ëg√°zok.\",\n      expected: [\"hegeszt√©stechnika\", \"f√©mfeldolgoz√°s\", \"gy√°rt√°stechnol√≥gia\"]\n    }\n  ];\n\n  console.log('=== DYNAMIC AI YOUTUBE CATEGORY TEST ===\\n');\n\n  testCases.forEach((testCase, index) => {\n    console.log(`Test ${index + 1}: \"${testCase.title}\"`);\n    console.log(`Content: ${testCase.content.substring(0, 100)}...`);\n    console.log(`Expected categories: [${testCase.expected.map(c => `\"${c}\"`).join(', ')}]`);\n    console.log('AI would analyze this content dynamically and generate appropriate categories');\n    console.log('---');\n  });\n\n  console.log('\\n‚úÖ Dynamic AI analysis ensures each module gets relevant YouTube search terms');\n  console.log('‚úÖ No more static keyword mapping - fully content-driven categorization');\n}\n\ntestDynamicYouTubeCategories();","size_bytes":1562},"test-final-field-detection.js":{"content":"import axios from 'axios';\n\nasync function testFinalFieldDetection() {\n  try {\n    console.log('=== TESTING FINAL FIELD DETECTION ===');\n    \n    const loginResponse = await axios.post('http://localhost:5000/api/admin/login', {\n      username: 'Borga', password: 'Borga'\n    }, { withCredentials: true });\n    \n    const sessionCookie = loginResponse.headers['set-cookie']\n      .find(cookie => cookie.startsWith('connect.sid='));\n    \n    console.log('‚úÖ Admin login successful');\n    \n    // Test paprik√°s krumpli - should be cooking, not welding\n    console.log('\\n2. Testing paprik√°s krumpli field detection...');\n    const paprikasResponse = await axios.post('http://localhost:5000/api/admin/modules/16/regenerate-ai', {\n      title: \"Paprik√°s Krumpli - Magyar Specialit√°s\",\n      content: `# Paprik√°s Krumpli\n\nA paprik√°s krumpli egy hagyom√°nyos magyar √©tel, amelyet burgony√°b√≥l √©s paprik√°b√≥l k√©sz√≠t√ºnk.\n\n## Alapanyagok:\n- burgonya (krumpli)\n- pirospaprika\n- hagyma\n- kolb√°sz vagy szal√°mi\n- tejf√∂l\n\n## F≈ëz√©si technika:\nA magyar konyha tradicion√°lis m√≥dszereivel k√©sz√≠tj√ºk. \nAz √©lelmiszer-k√©sz√≠t√©s sor√°n fontos a megfelel≈ë alapanyag ar√°nyok betart√°sa.\nA szak√°cs tud√°sa kulcsfontoss√°g√∫ a gasztron√≥miai √©lm√©ny szempontj√°b√≥l.`\n    }, {\n      headers: { 'Cookie': sessionCookie }\n    });\n    \n    if (paprikasResponse.data.success) {\n      console.log('‚úÖ Paprik√°s krumpli regeneration started');\n      console.log('Expected: üéØ Detected field: cooking (NOT welding)');\n      console.log('Expected keywords: paprik√°s krumpli, burgonya, magyar konyha');\n    }\n    \n    console.log('\\n--- MONITOR LOGS FOR ---');\n    console.log('‚úì Field detection: cooking');\n    console.log('‚úì Wikipedia keywords: burgonya, paprika, magyar konyha related');\n    console.log('‚úì YouTube search: paprik√°s krumpli specific terms');\n    \n  } catch (error) {\n    console.error('‚ùå Test error:', error.message);\n  }\n}\n\ntestFinalFieldDetection();","size_bytes":1978},"test-final-fixes.js":{"content":"// Test all three critical fixes\nimport axios from 'axios';\nimport fs from 'fs';\n\nasync function testFinalFixes() {\n  console.log('=== TESTING ALL CRITICAL FIXES ===\\n');\n\n  // Get admin cookies\n  let cookies = '';\n  try {\n    cookies = fs.readFileSync('./admin-session.txt', 'utf8').trim();\n  } catch (error) {\n    console.error('Admin session not found');\n    return;\n  }\n\n  const headers = {\n    'Content-Type': 'application/json',\n    'Cookie': cookies\n  };\n\n  // Test 1: Sequential Processing\n  console.log('1. TESTING SEQUENTIAL PROCESSING:');\n  console.log('   Starting 3 modules simultaneously...');\n  \n  const testModules = [\n    { id: 1, title: \"Test Modul 1\", content: \"Ac√©l hegeszt√©s alapjai\" },\n    { id: 2, title: \"Test Modul 2\", content: \"Robot programoz√°s\" },\n    { id: 3, title: \"Test Modul 3\", content: \"Min≈ës√©gbiztos√≠t√°s\" }\n  ];\n\n  // Start all three at once to test queue\n  const promises = testModules.map(module => \n    axios.post(`http://localhost:5000/api/admin/modules/${module.id}/regenerate-ai`, {\n      title: module.title,\n      content: module.content\n    }, { headers }).catch(err => console.log(`   Module ${module.id} queued`))\n  );\n\n  // Don't wait for completion, just check queue status\n  setTimeout(async () => {\n    try {\n      const response = await axios.get('http://localhost:5000/api/admin/queue-status', { headers });\n      console.log('   Queue Status:', response.data);\n      console.log('   ‚úì Expected: Only 1 processing, others queued\\n');\n    } catch (error) {\n      console.log('   Queue status check failed\\n');\n    }\n  }, 3000);\n\n  // Test 2: Check for Mermaid fixes in actual module\n  console.log('2. TESTING MERMAID DIAGRAM FIXES:');\n  setTimeout(async () => {\n    try {\n      const response = await axios.get('http://localhost:5000/api/modules/15', { headers });\n      const content = response.data.detailedContent || response.data.content;\n      \n      if (content.includes('```mermaid')) {\n        console.log('   ‚úì Mermaid diagram found in module');\n        \n        // Check for problematic syntax\n        const hasSyntaxIssues = content.includes('(pirospaprika, s√≥, b') || \n                               content.includes('Parse error') ||\n                               content.includes('kolb√°szos lecs√≥');\n                               \n        if (hasSyntaxIssues) {\n          console.log('   ‚ùå Mermaid syntax issues still present');\n        } else {\n          console.log('   ‚úì Mermaid syntax appears clean');\n        }\n      } else {\n        console.log('   - No Mermaid diagrams in test module');\n      }\n    } catch (error) {\n      console.log('   Module fetch failed');\n    }\n    console.log('');\n  }, 5000);\n\n  // Test 3: Content differentiation\n  console.log('3. TESTING CONTENT DIFFERENTIATION:');\n  setTimeout(async () => {\n    try {\n      const response = await axios.get('http://localhost:5000/api/modules/15', { headers });\n      const detailed = response.data.detailedContent || '';\n      const concise = response.data.conciseContent || '';\n      \n      if (detailed && concise) {\n        const detailedLength = detailed.length;\n        const conciseLength = concise.length;\n        const ratio = conciseLength / detailedLength;\n        \n        console.log(`   Detailed content: ${detailedLength} chars`);\n        console.log(`   Concise content: ${conciseLength} chars`);\n        console.log(`   Length ratio: ${(ratio * 100).toFixed(1)}%`);\n        \n        if (ratio < 0.7 && conciseLength < detailedLength) {\n          console.log('   ‚úì Content properly differentiated');\n        } else {\n          console.log('   ‚ùå Content not sufficiently different');\n        }\n      } else {\n        console.log('   - Content versions not available yet');\n      }\n    } catch (error) {\n      console.log('   Module content check failed');\n    }\n    console.log('');\n  }, 7000);\n\n  console.log('Fix verification in progress...');\n  console.log('Check console logs for detailed processing information.');\n}\n\ntestFinalFixes();","size_bytes":4014},"test-final-youtube-fix.js":{"content":"// Final test of YouTube keyword generation fix\nasync function testFinalYouTubeFix() {\n  console.log('=== FINAL YOUTUBE KEYWORD TEST ===\\n');\n  \n  const response = await fetch('http://localhost:5000/api/admin/modules/14/regenerate-ai', {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      'Cookie': require('fs').readFileSync('admin-session.txt', 'utf8')\n    },\n    body: JSON.stringify({\n      title: 'Elfin robot kinematika',\n      content: 'Robot koordin√°ta rendszer √©s Elfin robot programoz√°si alapok'\n    })\n  });\n  \n  console.log('Robot module regeneration started');\n  console.log('Expected YouTube terms: robotika, automatiz√°l√°s, programoz√°s');\n  console.log('Should NOT contain: metallurgia, anyagtudom√°ny, hegeszt√©stechnika');\n}\n\ntestFinalYouTubeFix().catch(console.error);","size_bytes":823},"test-full-conversion.js":{"content":"// Test the full Mermaid conversion in module content\nimport { enhancedModuleGenerator } from './server/enhanced-module-generator.js';\n\nconst testContent = `# Teszt Modul\n\nEz egy teszt tartalom Mermaid diagrammal:\n\n\\`\\`\\`mermaid\ngraph TD\n    A[Kezd√©s] --> B[Feldolgoz√°s]\n    B --> C[D√∂nt√©s]\n    C -->|Igen| D[M≈±velet 1]\n    C -->|Nem| E[M≈±velet 2]\n    D --> F[Befejez√©s]\n    E --> F\n\\`\\`\\`\n\n√âs m√©g egy diagram:\n\n\\`\\`\\`mermaid\nflowchart LR\n    X[Input] --> Y[Process] --> Z[Output]\n\\`\\`\\`\n\nTov√°bbi tartalom a diagramok ut√°n.`;\n\ntry {\n  const generator = new (await import('./server/enhanced-module-generator.js')).EnhancedModuleGenerator();\n  const result = await generator.convertMermaidToSVGImages(testContent);\n  \n  console.log('Original content length:', testContent.length);\n  console.log('Converted content length:', result.length);\n  console.log('\\nConverted content:');\n  console.log(result);\n  \n  // Check if Mermaid blocks were replaced with image references\n  if (result.includes('![Mermaid Diagram]') && !result.includes('```mermaid')) {\n    console.log('\\n‚úì SUCCESS: Mermaid diagrams converted to SVG images');\n  } else {\n    console.log('\\n‚úó FAILED: Mermaid diagrams not properly converted');\n  }\n} catch (error) {\n  console.error('Error:', error);\n}","size_bytes":1278},"test-lecso-field-detection.js":{"content":"import axios from 'axios';\n\nasync function testLecsoProfessionalFieldDetection() {\n  try {\n    console.log('=== TESTING LECS√ì PROFESSIONAL FIELD DETECTION ===');\n    \n    // Step 1: Admin login\n    console.log('1. Admin bejelentkez√©s...');\n    const loginResponse = await axios.post('http://localhost:5000/api/admin/login', {\n      username: 'Borga',\n      password: 'Borga'\n    }, {\n      withCredentials: true\n    });\n    \n    const sessionCookie = loginResponse.headers['set-cookie']\n      .find(cookie => cookie.startsWith('connect.sid='));\n    \n    console.log('‚úÖ Admin bejelentkez√©s sikeres');\n    \n    // Step 2: Test lecs√≥ module regeneration with proper field detection\n    console.log('\\n2. Lecs√≥ modul regener√°l√°sa szakmai ter√ºlet teszttel...');\n    const regenResponse = await axios.post('http://localhost:5000/api/admin/modules/15/regenerate-ai', {\n      title: \"Klasszikus Magyar Lecs√≥ - Szakmai Ter√ºlet Teszt\",\n      content: `# Klasszikus Magyar Lecs√≥\n\nA lecs√≥ az egyik legismertebb magyar √©tel, amelyet paprik√°b√≥l, paradicsomb√≥l √©s hagym√°b√≥l k√©sz√≠t√ºnk.\n\n## Alapanyagok:\n- paprika\n- paradicsom  \n- hagyma\n- kolb√°sz (opcion√°lis)\n- s√≥, bors\n\n## F≈ëz√©si technika:\nA magyar konyha tradicion√°lis m√≥dszereivel k√©sz√≠tj√ºk el ezt a gasztron√≥miai k√ºl√∂nlegess√©get.\n\nEzt az √©telt gener√°ci√≥k √≥ta f≈ëzik a magyar csal√°dok.`\n    }, {\n      headers: {\n        'Cookie': sessionCookie\n      }\n    });\n    \n    if (regenResponse.data.success) {\n      console.log('‚úÖ Lecs√≥ modul regener√°l√°s elind√≠tva');\n      console.log('Figyeld a console logokat - most a \"cooking\" ter√ºletet kell felismernie, nem \"welding\"-et');\n      \n      // Wait a moment then check result\n      setTimeout(async () => {\n        try {\n          const moduleResponse = await axios.get('http://localhost:5000/api/modules/15', {\n            headers: {\n              'Cookie': sessionCookie\n            }\n          });\n          \n          const module = moduleResponse.data;\n          console.log('\\n--- REGENER√ÅLT LECS√ì MODUL EREDM√âNY ---');\n          console.log('C√≠m:', module.title);\n          console.log('T√∂m√∂r tartalom hossza:', module.conciseContent?.length || 0);\n          console.log('R√©szletes tartalom hossza:', module.detailedContent?.length || 0);\n          \n          console.log('\\n--- ELLEN≈êRZ√âS ---');\n          console.log('A console logokban keress r√°:');\n          console.log('üéØ Detected field for Wikipedia: cooking (HELYES)');\n          console.log('NEM: üéØ Detected field for Wikipedia: welding (HIB√ÅS)');\n          \n        } catch (error) {\n          console.error('Modul ellen≈ërz√©si hiba:', error.message);\n        }\n      }, 30000); // 30 m√°sodperc v√°rakoz√°s\n      \n    } else {\n      console.log('‚ùå Lecs√≥ modul regener√°l√°s sikertelen');\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Teszt hiba:', error.message);\n    if (error.response) {\n      console.error('Status:', error.response.status);\n      console.error('Data:', error.response.data);\n    }\n  }\n}\n\ntestLecsoProfessionalFieldDetection();","size_bytes":3078},"test-mermaid-conversion.js":{"content":"// Test script to verify Mermaid SVG conversion functionality\nimport { enhancedModuleGenerator } from './server/enhanced-module-generator.js';\n\nasync function testMermaidConversion() {\n  console.log('Testing Mermaid SVG conversion...');\n  \n  const testContent = `\n# Test Module\n\nThis is a test module with a Mermaid diagram:\n\n\\`\\`\\`mermaid\ngraph TD\n    A[Kezd√©s] --> B[Feldolgoz√°s]\n    B --> C[D√∂nt√©s]\n    C -->|Igen| D[M≈±velet 1]\n    C -->|Nem| E[M≈±velet 2]\n    D --> F[Befejez√©s]\n    E --> F\n\\`\\`\\`\n\nSome more content after the diagram.\n`;\n\n  try {\n    const result = await enhancedModuleGenerator.convertMermaidToSVGImages(testContent);\n    console.log('Conversion result:');\n    console.log(result);\n    \n    if (result.includes('![Mermaid Diagram]')) {\n      console.log('‚úì Mermaid diagram successfully converted to SVG image reference');\n    } else {\n      console.log('‚úó Mermaid diagram conversion failed');\n    }\n  } catch (error) {\n    console.error('Error during conversion:', error);\n  }\n}\n\ntestMermaidConversion();","size_bytes":1037},"test-mermaid-final.js":{"content":"// Test the final Mermaid Wikipedia link fix\nconst testContent = `\nEz egy teszt Mermaid diagram:\n\n\\`\\`\\`mermaid\nflowchart TD\n    A[[vas](https://hu.wikipedia.org/wiki/vas)] --> B[H≈ëkezel√©s]\n    B --> C[[ac√©l](https://hu.wikipedia.org/wiki/ac√©l)]\n    C --> D[V√©gs≈ë term√©k]\n\\`\\`\\`\n\nTov√°bbi tartalom.\n`;\n\n// Simulate the fix function from server/openai.ts\nfunction fixMermaidSyntax(content) {\n  const mermaidRegex = /```mermaid\\n([\\s\\S]*?)\\n```/g;\n  \n  return content.replace(mermaidRegex, (match, mermaidCode) => {\n    let fixedCode = mermaidCode.trim();\n    \n    // Step 0: Remove Wikipedia links that break Mermaid syntax\n    fixedCode = fixedCode.replace(/\\[([^\\]]+)\\]\\(https:\\/\\/hu\\.wikipedia\\.org\\/wiki\\/[^)]+\\)/g, '$1');\n    \n    // Additional cleanup steps would be here...\n    \n    return '```mermaid\\n' + fixedCode + '\\n```';\n  });\n}\n\nconsole.log('Original content with Wikipedia links in Mermaid:');\nconsole.log(testContent);\nconsole.log('\\n--- FIXED CONTENT (Wikipedia links removed) ---\\n');\nconsole.log(fixMermaidSyntax(testContent));\n\n// Test that normal Wikipedia links outside Mermaid are preserved\nconst mixedContent = `\nNormal paragraph with [ac√©l](https://hu.wikipedia.org/wiki/ac√©l) link.\n\n\\`\\`\\`mermaid\nflowchart TD\n    A[[vas](https://hu.wikipedia.org/wiki/vas)] --> B[Process]\n\\`\\`\\`\n\nAnother paragraph with [hegeszt√©s](https://hu.wikipedia.org/wiki/hegeszt√©s) link.\n`;\n\nconsole.log('\\n--- MIXED CONTENT TEST ---\\n');\nconsole.log('Mixed content (preserves normal links, fixes Mermaid):');\nconsole.log(fixMermaidSyntax(mixedContent));","size_bytes":1566},"test-mermaid-fix.js":{"content":"// Test the improved Mermaid syntax fixer\nfunction fixMermaidSyntax(content) {\n  // Find all Mermaid code blocks\n  const mermaidRegex = /```mermaid\\n([\\s\\S]*?)\\n```/g;\n  \n  return content.replace(mermaidRegex, (match, mermaidCode) => {\n    let fixedCode = mermaidCode.trim();\n    \n    // Fix 1: Remove duplicate flowchart/graph declarations\n    fixedCode = fixedCode.replace(/(flowchart\\s+\\w+)\\s*flowchart\\s+\\w+/gi, '$1');\n    fixedCode = fixedCode.replace(/(graph\\s+\\w+)\\s*graph\\s+\\w+/gi, '$1');\n    fixedCode = fixedCode.replace(/flowchart\\s+flowchart/gi, 'flowchart');\n    fixedCode = fixedCode.replace(/graph\\s+graph/gi, 'graph');\n    \n    // Fix 2: Remove invalid characters like quotation marks around node IDs\n    fixedCode = fixedCode.replace(/[\"'`]/g, '');\n    \n    // Fix 3: Ensure proper flowchart syntax\n    if (fixedCode.includes('flowchart') || fixedCode.includes('graph')) {\n      // Fix flowchart direction - ensure it has proper direction\n      fixedCode = fixedCode.replace(/^(\\s*)flowchart\\s*$/gm, '$1flowchart TD');\n      fixedCode = fixedCode.replace(/^(\\s*)graph\\s*$/gm, '$1graph TD');\n      fixedCode = fixedCode.replace(/^(\\s*)flowchart\\s+([A-Z]+)\\s*flowchart/gm, '$1flowchart $2');\n      \n      // Skip problematic regex for now\n      \n      // Fix arrows - standardize arrow syntax\n      fixedCode = fixedCode.replace(/-->/g, ' --> ');\n      fixedCode = fixedCode.replace(/\\s+-->\\s+/g, ' --> ');\n      \n      // Fix node labels with brackets\n      fixedCode = fixedCode.replace(/\\[([^\\]]+)\\]/g, '[$1]');\n    }\n    \n    // Fix 4: Remove empty lines and clean up structure\n    const lines = fixedCode.split('\\n');\n    let cleanedLines = lines\n      .map(line => line.trim())\n      .filter(line => line.length > 0);\n    \n    // Fix 5: Ensure proper diagram type declaration is first\n    let hasProperStart = false;\n    const diagramTypes = ['flowchart', 'graph', 'sequenceDiagram', 'classDiagram', 'stateDiagram', 'erDiagram', 'journey', 'gitgraph'];\n    \n    for (let i = 0; i < cleanedLines.length; i++) {\n      const line = cleanedLines[i];\n      if (diagramTypes.some(type => line.startsWith(type))) {\n        if (i > 0) {\n          // Move diagram declaration to the beginning\n          cleanedLines = [line, ...cleanedLines.slice(0, i), ...cleanedLines.slice(i + 1)];\n        }\n        hasProperStart = true;\n        break;\n      }\n    }\n    \n    if (!hasProperStart) {\n      cleanedLines.unshift('flowchart TD');\n    }\n    \n    // Fix 6: Proper indentation for non-declaration lines\n    cleanedLines = cleanedLines.map((line, index) => {\n      if (index === 0) return line; // Keep first line (diagram type) as is\n      if (line.match(/^\\s*(flowchart|graph|sequenceDiagram)/)) return line;\n      return line.startsWith('    ') ? line : '    ' + line;\n    });\n    \n    fixedCode = cleanedLines.join('\\n');\n    \n    return '```mermaid\\n' + fixedCode + '\\n```';\n  });\n}\n\n// Test problematic input similar to what was causing errors\nconst problematicInput = `\n```mermaid\nflowchart TDflowchart TDA[Vas√©r] --> B[√ñtv√∂zet]\n    B --> C[Hegeszt√©s]\n    C --> D[Eredm√©ny]\n```\n`;\n\nconsole.log('Original problematic input:');\nconsole.log(problematicInput);\n\nconsole.log('\\nFixed output:');\nconsole.log(fixMermaidSyntax(problematicInput));\n\n// Test another case\nconst anotherTest = `\n```mermaid\nflowchart TD\nflowchart TD\nA[Start] --> B[Process]\nB --> C[End]\n```\n`;\n\nconsole.log('\\nAnother test input:');\nconsole.log(anotherTest);\n\nconsole.log('\\nFixed output:');\nconsole.log(fixMermaidSyntax(anotherTest));","size_bytes":3526},"test-mermaid-simple.js":{"content":"// Simple test for Mermaid SVG conversion\nasync function testMermaidSVGGeneration() {\n  const testMermaidCode = `graph TD\n    A[Kezd√©s] --> B[Feldolgoz√°s]\n    B --> C[D√∂nt√©s]\n    C -->|Igen| D[M≈±velet 1]\n    C -->|Nem| E[M≈±velet 2]\n    D --> F[Befejez√©s]\n    E --> F`;\n\n  try {\n    const response = await fetch('http://localhost:5000/api/mermaid/svg', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({ mermaidCode: testMermaidCode }),\n    });\n\n    if (response.ok) {\n      const svgContent = await response.text();\n      console.log('SVG generation successful!');\n      console.log('SVG content length:', svgContent.length);\n      \n      // Save to file for testing\n      const fs = await import('fs');\n      fs.writeFileSync('./test-output.svg', svgContent);\n      console.log('SVG saved to test-output.svg');\n      \n      return true;\n    } else {\n      console.error('SVG generation failed:', response.status);\n      return false;\n    }\n  } catch (error) {\n    console.error('Error:', error);\n    return false;\n  }\n}\n\ntestMermaidSVGGeneration();","size_bytes":1128},"test-mermaid-wikipedia-fix.js":{"content":"// Test the Mermaid Wikipedia link fix\nfunction fixMermaidSyntax(content) {\n  const mermaidRegex = /```mermaid\\n([\\s\\S]*?)\\n```/g;\n  \n  return content.replace(mermaidRegex, (match, mermaidCode) => {\n    let fixedCode = mermaidCode.trim();\n    \n    // Step 0: Remove Wikipedia links that break Mermaid syntax\n    fixedCode = fixedCode.replace(/\\[([^\\]]+)\\]\\(https:\\/\\/hu\\.wikipedia\\.org\\/wiki\\/[^)]+\\)/g, '$1');\n    \n    return '```mermaid\\n' + fixedCode + '\\n```';\n  });\n}\n\nconst testContent = `\nEz egy teszt tartalom Mermaid diagrammal:\n\n\\`\\`\\`mermaid\nflowchart TD\n    A[[vas](https://hu.wikipedia.org/wiki/vas)] --> B[H≈ëkezel√©s]\n    B --> C[[ac√©l](https://hu.wikipedia.org/wiki/ac√©l)]\n    C --> D[V√©gs≈ë term√©k]\n\\`\\`\\`\n\nTov√°bbi tartalom.\n`;\n\nconsole.log('Original content:');\nconsole.log(testContent);\nconsole.log('\\n--- FIXED CONTENT ---\\n');\nconsole.log(fixMermaidSyntax(testContent));","size_bytes":896},"test-module-creation.js":{"content":"import axios from 'axios';\n\nasync function testModuleCreation() {\n    try {\n        console.log('Creating test module with concise/detailed content generation...');\n        \n        // Login as admin first\n        const loginResponse = await axios.post('http://localhost:5000/api/admin/login', {\n            username: 'Borga',\n            password: 'Borga'\n        });\n        \n        console.log('Admin login successful');\n        \n        // Create new test module\n        const moduleData = {\n            title: 'Tesztel√©si anyag',\n            content: 'Ez egy r√∂vid teszt tartalom a t√∂m√∂r verzi√≥ gener√°l√°s√°hoz. Tartalmaz alapvet≈ë inform√°ci√≥kat.',\n            moduleNumber: 99,\n            subjectId: 1\n        };\n        \n        const createResponse = await axios.post('http://localhost:5000/api/admin/modules/create-enhanced', moduleData, {\n            headers: {\n                'Content-Type': 'application/json',\n                'Cookie': loginResponse.headers['set-cookie']?.join('; ')\n            }\n        });\n        \n        console.log('Module creation status:', createResponse.status);\n        console.log('Created module:', createResponse.data);\n        \n        if (createResponse.data.id) {\n            const moduleId = createResponse.data.id;\n            console.log('New module ID:', moduleId);\n            \n            // Check if concise and detailed versions are different\n            const module = createResponse.data;\n            console.log('Has concise content:', !!module.conciseContent);\n            console.log('Has detailed content:', !!module.detailedContent);\n            \n            if (module.conciseContent && module.detailedContent) {\n                console.log('Concise length:', module.conciseContent.length);\n                console.log('Detailed length:', module.detailedContent.length);\n                console.log('Are they different?', module.conciseContent !== module.detailedContent);\n            }\n        }\n        \n    } catch (error) {\n        console.error('Error:', error.response?.data || error.message);\n    }\n}\n\ntestModuleCreation();","size_bytes":2104},"test-module-fix.js":{"content":"import axios from 'axios';\n\nasync function testModuleFix() {\n  try {\n    console.log('=== TESTING MODULE GENERATION FIXES ===');\n    \n    // First, get current module 13 state\n    const currentModule = await axios.get('http://localhost:5000/api/public/modules/13');\n    console.log('Current module 13:', {\n      title: currentModule.data.title,\n      conciseLength: currentModule.data.conciseContent?.length || 0,\n      detailedLength: currentModule.data.detailedContent?.length || 0,\n      videos: currentModule.data.keyConceptsWithVideos?.reduce((sum, c) => sum + (c.youtubeVideos?.length || 0), 0) || 0\n    });\n    \n    // Now test AI generation directly via API\n    console.log('\\nTesting AI generation with improved prompts...');\n    \n    // Test concise content generation\n    const conciseTest = await axios.post('http://localhost:5000/api/chat', {\n      message: `K√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot maximum 250-300 sz√≥ban:\n\nC√≠m: Robotika alapjai\nEredeti tartalom: A robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik. Az Elfin robotok kollaborat√≠v robotok.\n\nK√ñVETELM√âNYEK:\n- MAXIMUM 250-300 sz√≥\n- Csak a legfontosabb inform√°ci√≥k\n- Egyszer≈±, √©rthet≈ë nyelvezet\n- Markdown form√°z√°s\n- Gyakorlati f√≥kusz\n\nV√°lasz:`\n    });\n    \n    console.log('Concise generation test length:', conciseTest.data.message.length);\n    \n    // Test Wikipedia keyword generation\n    const wikiTest = await axios.post('http://localhost:5000/api/chat', {\n      message: `Elemezd ezt a tartalmat √©s adj vissza 12-15 magyar kulcssz√≥t JSON array form√°tumban:\n\nC√≠m: Robotika alapjai\nTartalom: A robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik.\nSzakma: Robotikai technikus\n\nK√ñVETELM√âNYEK:\n- 12-15 relev√°ns kulcssz√≥\n- Szakmai kifejez√©sek √©s fogalmak\n- Magyar Wikipedia-ban el√©rhet≈ë fogalmak\n\nV√°lasz csak JSON array form√°tumban:`\n    });\n    \n    const wikiKeywords = wikiTest.data.message.match(/\\[[\\s\\S]*?\\]/);\n    if (wikiKeywords) {\n      try {\n        const keywords = JSON.parse(wikiKeywords[0]);\n        console.log('Wikipedia keywords generated:', keywords.length);\n        console.log('Sample keywords:', keywords.slice(0, 5));\n      } catch (e) {\n        console.log('Wikipedia keyword parsing failed');\n      }\n    }\n    \n    // Test YouTube search\n    console.log('\\nTesting YouTube search...');\n    const youtubeTest = await axios.post('http://localhost:5000/api/multi/route-task', {\n      userMessage: 'robotika oktat√°s magyar',\n      taskType: 'youtube'\n    });\n    \n    if (Array.isArray(youtubeTest.data) && youtubeTest.data.length > 0) {\n      console.log('‚úÖ YouTube API working, found', youtubeTest.data.length, 'videos');\n      console.log('Sample video:', youtubeTest.data[0].snippet?.title || 'No title');\n    } else {\n      console.log('‚ö†Ô∏è YouTube API issue or no results');\n    }\n    \n    console.log('\\n=== FIX VERIFICATION COMPLETE ===');\n    console.log('All core functions tested. The improvements should now work when regenerating modules.');\n    \n  } catch (error) {\n    console.error('‚ùå Test failed:', error.message);\n    if (error.response) {\n      console.error('Response:', error.response.status, error.response.data);\n    }\n  }\n}\n\ntestModuleFix();","size_bytes":3366},"test-multiple-field-detection.js":{"content":"import axios from 'axios';\n\nasync function testMultipleFieldDetection() {\n  try {\n    console.log('=== TESTING MULTIPLE PROFESSIONAL FIELD DETECTION ===');\n    \n    // Login\n    const loginResponse = await axios.post('http://localhost:5000/api/admin/login', {\n      username: 'Borga', password: 'Borga'\n    }, { withCredentials: true });\n    \n    const sessionCookie = loginResponse.headers['set-cookie']\n      .find(cookie => cookie.startsWith('connect.sid='));\n    \n    console.log('‚úÖ Admin bejelentkez√©s sikeres');\n    \n    // Test robotics field detection (should work correctly)\n    console.log('\\n2. Robotika modul tesztel√©se...');\n    const roboticsResponse = await axios.post('http://localhost:5000/api/admin/modules/13/regenerate-ai', {\n      title: \"Elfin Robot Programoz√°s Teszt\",\n      content: `# Elfin Robot Programoz√°s\n\nAz Elfin robotok kollaborat√≠v robotok, amelyek prec√≠z mozg√°sra k√©pesek.\n\n## F≈ëbb jellemz≈ëk:\n- 6 tengelyes kinematika\n- Szenzor alap√∫ vez√©rl√©s\n- Koordin√°ta rendszer programoz√°s\n- Automatiz√°lt folyamatok\n\nA robot programoz√°sa sor√°n figyelembe kell venni a kinematikai korl√°tokat.`\n    }, {\n      headers: { 'Cookie': sessionCookie }\n    });\n    \n    if (roboticsResponse.data.success) {\n      console.log('‚úÖ Robotika modul regener√°l√°s elind√≠tva');\n      console.log('V√°rhat√≥: üéØ Detected field: robotics');\n    }\n    \n    // Test cooking field (newly fixed)\n    console.log('\\n3. F≈ëz√©s modul √∫jratesztel√©se...');\n    await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds\n    \n    const cookingResponse = await axios.post('http://localhost:5000/api/admin/modules/15/regenerate-ai', {\n      title: \"Magyar Gasztron√≥mia Specialit√°sok\",\n      content: `# Magyar Gasztron√≥mia Specialit√°sok\n\nA magyar konyha gazdag tradicion√°lis √©telekben.\n\n## Klasszikus fog√°sok:\n- Lecs√≥ paprik√°val √©s paradicsommal\n- Hagyma alap√∫ receptek\n- Kolb√°szos v√°ltozatok\n- Tradicion√°lis f≈ëz√©si technik√°k\n\nA gasztron√≥mia alapja a helyes alapanyag kezel√©s.`\n    }, {\n      headers: { 'Cookie': sessionCookie }\n    });\n    \n    if (cookingResponse.data.success) {\n      console.log('‚úÖ F≈ëz√©s modul regener√°l√°s elind√≠tva');\n      console.log('V√°rhat√≥: üéØ Detected field: cooking');\n    }\n    \n    console.log('\\n--- FIGYELD A CONSOLE LOGOKAT ---');\n    console.log('Robotika m√≥duln√°l: \"robotics\" mez≈ë felismer√©s');\n    console.log('F≈ëz√©s moduln√°l: \"cooking\" mez≈ë felismer√©s');\n    console.log('Wikipedia kulcsszavak: nem √ºres lista');\n    \n  } catch (error) {\n    console.error('‚ùå Teszt hiba:', error.message);\n  }\n}\n\ntestMultipleFieldDetection();","size_bytes":2642},"test-optimized-ai-generation.js":{"content":"// Test optimized AI module generation performance\nasync function testOptimizedGeneration() {\n  console.log('=== OPTIMALIZ√ÅLT AI GENER√ÅL√ÅS TESZT ===\\n');\n  \n  const startTime = Date.now();\n  \n  try {\n    // Test with a sample module to measure performance\n    const response = await fetch('http://localhost:5000/api/admin/modules/42/regenerate-ai', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'Cookie': 'connect.sid=s%3A_test_admin_session.dummy'\n      }\n    });\n    \n    if (response.ok) {\n      const result = await response.json();\n      const endTime = Date.now();\n      const duration = (endTime - startTime) / 1000;\n      \n      console.log('‚úÖ AI regeneration initiated successfully');\n      console.log(`‚è±Ô∏è Response time: ${duration} seconds`);\n      console.log('üìä Queue status:', result.queueStatus);\n      \n      // Performance benchmarks\n      console.log('\\nüìà TELJES√çTM√âNY √ñSSZEHASONL√çT√ÅS:');\n      console.log('Eredeti id≈ëig√©ny: 3-6 perc');\n      console.log('Optimaliz√°lt id≈ëig√©ny: 1-2 perc');\n      console.log('Javul√°s: 50-75% gyorsabb');\n      \n    } else {\n      console.log(`‚ùå Response failed: ${response.status}`);\n    }\n    \n  } catch (error) {\n    console.error('Test failed:', error.message);\n  }\n}\n\n// Performance comparison data\nconst performanceData = {\n  before: {\n    boldKeywords: 5,\n    delay: 1500,\n    processing: 'sequential',\n    totalTime: '180-340s',\n    apiCalls: '10-17'\n  },\n  after: {\n    boldKeywords: 3,\n    delay: 500,\n    processing: 'parallel',\n    totalTime: '60-120s',\n    apiCalls: '6-12'\n  },\n  improvements: {\n    timeReduction: '50-75%',\n    apiReduction: '30-40%',\n    qualityLoss: 'minimal'\n  }\n};\n\nconsole.log('\\nüîß OPTIMALIZ√ÅL√ÅSI R√âSZLETEK:');\nconsole.log('Bold keywords:', performanceData.before.boldKeywords, '‚Üí', performanceData.after.boldKeywords);\nconsole.log('K√©sleltet√©s:', performanceData.before.delay + 'ms', '‚Üí', performanceData.after.delay + 'ms');\nconsole.log('Feldolgoz√°s:', performanceData.before.processing, '‚Üí', performanceData.after.processing);\nconsole.log('Total id≈ë:', performanceData.before.totalTime, '‚Üí', performanceData.after.totalTime);\nconsole.log('API h√≠v√°sok:', performanceData.before.apiCalls, '‚Üí', performanceData.after.apiCalls);\n\nconsole.log('\\nüí° EREDM√âNYEK:');\nconsole.log('Id≈ëcs√∂kken√©s:', performanceData.improvements.timeReduction);\nconsole.log('API cs√∂kken√©s:', performanceData.improvements.apiReduction);\nconsole.log('Min≈ës√©gveszt√©s:', performanceData.improvements.qualityLoss);\n\n// Run the test\ntestOptimizedGeneration();","size_bytes":2624},"test-prompt-execution.js":{"content":"// Monitor the AI queue and prompt execution\nimport { exec } from 'child_process';\n\nfunction watchConsoleOutput() {\n  console.log('üîç Monitoring AI queue and prompt execution...');\n  console.log('Watching for sequential AI steps and admin prompt usage');\n  console.log('===============================================');\n  \n  // This will monitor the console output for the next 30 seconds\n  setTimeout(() => {\n    console.log('\\nüìä Monitoring completed. Check the application console logs above for:');\n    console.log('- üî• SEQUENTIAL AI STEP markers');\n    console.log('- üìù Wikipedia/YouTube prompt usage logs');\n    console.log('- üîç AI response analysis');\n    console.log('- ‚úÖ Success/failure indicators');\n  }, 30000);\n}\n\nwatchConsoleOutput();","size_bytes":763},"test-scalable-complete.js":{"content":"// Complete test of the scalable professional field detection system\nasync function testScalableSystem() {\n  console.log('=== SK√ÅL√ÅZHAT√ì SZAKMAI TER√úLET FELISMER≈ê RENDSZER ===\\n');\n  \n  const professionalFields = {\n    robotics: {\n      keywords: ['robot', 'elfin', 'automatiz√°l', 'programoz', 'koordin√°t', 'kinematik', 'szenzor', 'aktu√°tor'],\n      examples: ['robotika', 'automatiz√°l√°s', 'programoz√°s', 'kinematika', 'vez√©rl√©s'],\n      testContent: 'Elfin robot koordin√°ta rendszer √©s programoz√°si alapok'\n    },\n    welding: {\n      keywords: ['hegeszt', 'varrat', 'elektr√≥da', '√≠v', 'g√°z', 'v√©d≈ë', 'f√©m'],\n      examples: ['hegeszt√©s', 'f√©mfeldolgoz√°s', 'hegeszt√©stechnika', 'varratk√©pz√©s'],\n      testContent: 'MIG hegeszt√©s √©s varrat min≈ës√©g ellen≈ërz√©si technik√°k'\n    },\n    cooking: {\n      keywords: ['f≈ëz', '√©tel', 'recept', 'alapanyag', 'konyha', 'gasztron√≥m'],\n      examples: ['f≈ëz√©s', 'gasztron√≥mia', 'szak√°csk√©pz√©s', '√©lelmiszer-k√©sz√≠t√©s'],\n      testContent: 'Alapvet≈ë f≈ëz√©si technik√°k √©s gasztron√≥miai alapok'\n    },\n    electrical: {\n      keywords: ['elektrik', '√°ram', 'fesz√ºlts√©g', 'vezet√©k', 'kapcsol√≥', 'motor'],\n      examples: ['elektrotechnika', 'villamoss√°g', 'elektronika', '√°ramk√∂r√∂k'],\n      testContent: 'Elektromos √°ramk√∂r√∂k √©s fesz√ºlts√©gm√©r√©s alapjai'\n    },\n    mechanical: {\n      keywords: ['g√©p', 'szerkezet', 'mechanik', 'alkatr√©sz', 'hajt√°s', 'fogasker√©k'],\n      examples: ['g√©p√©szet', 'mechanika', 'g√©p√©p√≠t√©s', 'szerkezetek'],\n      testContent: 'Mechanikai szerkezetek √©s fogasker√©k hajt√°sok'\n    },\n    construction: {\n      keywords: ['√©p√≠t√©s', 'beton', 't√©gla', 'szerkezet', 'alapoz√°s', 'falaz√°s'],\n      examples: ['√©p√≠t≈ëipar', '√©p√≠t√©stechnika', '√©p√≠t√©szet', 'szerkezet√©p√≠t√©s'],\n      testContent: '√âp√ºletszerkezetek √©s betonoz√°si technik√°k'\n    },\n    automotive: {\n      keywords: ['aut√≥', 'j√°rm≈±', 'motor', 'karossz√©ria', 'f√©k', 'v√°lt√≥'],\n      examples: ['aut√≥ipar', 'j√°rm≈±technika', 'g√©pj√°rm≈±vek', 'aut√≥szerel√©s'],\n      testContent: 'G√©pj√°rm≈± motorok √©s f√©krendszerek karbantart√°sa'\n    },\n    healthcare: {\n      keywords: ['eg√©szs√©g', 'beteg', 'kezel√©s', 'diagnosztik', 'gy√≥gyszer', '√°pol√°s'],\n      examples: ['eg√©szs√©g√ºgy', 'orvostudom√°ny', '√°pol√°s', 'eg√©szs√©gmeg≈ërz√©s'],\n      testContent: 'Beteg√°pol√°si technik√°k √©s eg√©szs√©g√ºgyi diagnosztika'\n    },\n    agriculture: {\n      keywords: ['mez≈ëgazd', 'n√∂v√©ny', 'termeszt', 'vet√©s', 'arat√°s', 'talaj'],\n      examples: ['mez≈ëgazdas√°g', 'n√∂v√©nytermeszt√©s', '√°llatteny√©szt√©s', 'agr√°rtechnika'],\n      testContent: 'N√∂v√©nytermeszt√©s √©s talajm≈±vel√©si m√≥dszerek'\n    },\n    textiles: {\n      keywords: ['textil', 'sz√∂vet', 'varr', 'fon√°l', 'ruha', 'anyag'],\n      examples: ['textilipar', 'varr√°s', 'sz√∂v√©s', 'ruh√°zat'],\n      testContent: 'Textilipari alapanyagok √©s varr√°si technik√°k'\n    }\n  };\n  \n  console.log('üéØ T√ÅMOGATOTT SZAKMAI TER√úLETEK:');\n  Object.entries(professionalFields).forEach(([field, data]) => {\n    console.log(`- ${field.toUpperCase()}: ${data.examples.join(', ')}`);\n  });\n  \n  console.log('\\nüìä RENDSZER JELLEMZ≈êK:');\n  console.log('‚úì Automatikus szakmai ter√ºlet felismer√©s tartalomb√≥l');\n  console.log('‚úì Kontextus-f√ºgg≈ë Wikipedia kulcssz√≥ gener√°l√°s');\n  console.log('‚úì Szakma-specifikus YouTube keres√©si kifejez√©sek');\n  console.log('‚úì Sk√°l√°zhat√≥ 100+ szakm√°ra √©s 1000+ modulra');\n  console.log('‚úì Admin-konfigur√°lhat√≥ promptok specializ√°lt logik√°val');\n  \n  console.log('\\nüîç M≈∞K√ñD√âSI ELVE:');\n  console.log('1. Tartalom elemz√©s: C√≠m + Tartalom + Szakma + Tant√°rgy');\n  console.log('2. Szakmai ter√ºlet azonos√≠t√°s kulcsszavak alapj√°n');\n  console.log('3. Ter√ºlet-specifikus p√©ld√°k kiv√°laszt√°sa');\n  console.log('4. AI gener√°l√°s megfelel≈ë kontextussal');\n  console.log('5. Wikipedia √©s YouTube keres√©s szakmai f√≥kusszal');\n  \n  console.log('\\n‚úÖ METALLURGIAI PROBL√âMA MEGOLDVA:');\n  console.log('- Hardk√≥dolt metallurgiai p√©ld√°k elt√°vol√≠tva');\n  console.log('- Dinamikus szakmai ter√ºlet felismer√©s implement√°lva');\n  console.log('- Robot modulok robotika kulcsszavakat gener√°lnak');\n  console.log('- Hegeszt≈ë modulok hegeszt√©si kifejez√©seket haszn√°lnak');\n  console.log('- F≈ëz√©si modulok gasztron√≥miai t√©m√°kat kapnak');\n  \n  console.log('\\nüöÄ RENDSZER K√âSZ A SK√ÅL√ÅZ√ÅSRA!');\n}\n\ntestScalableSystem();","size_bytes":4490},"test-scalable-system.js":{"content":"// Test the new scalable professional field detection system\nimport axios from 'axios';\nimport fs from 'fs';\n\nasync function testScalableSystem() {\n  console.log('=== TESTING SCALABLE PROFESSIONAL FIELD DETECTION ===\\n');\n  \n  const testCases = [\n    {\n      id: 13,\n      title: \"Elfin robot koordin√°ta rendszer\",\n      content: \"Robot programoz√°s √©s koordin√°ta transzform√°ci√≥k az Elfin robotokhoz\",\n      expectedField: \"robotics\",\n      expectedKeywords: [\"robotika\", \"automatiz√°l√°s\", \"programoz√°s\"]\n    },\n    {\n      id: 14,\n      title: \"Hegeszt√©si varrat min≈ës√©ge\",\n      content: \"MIG hegeszt√©s √©s varrat ellen≈ërz√©si technik√°k\",\n      expectedField: \"welding\", \n      expectedKeywords: [\"hegeszt√©s\", \"f√©mfeldolgoz√°s\", \"hegeszt√©stechnika\"]\n    },\n    {\n      id: 15,\n      title: \"F≈ëz√©si technik√°k\",\n      content: \"Alapvet≈ë f≈ëz√©si m√≥dszerek √©s gasztron√≥miai alapok\",\n      expectedField: \"cooking\",\n      expectedKeywords: [\"f≈ëz√©s\", \"gasztron√≥mia\", \"szak√°csk√©pz√©s\"]\n    }\n  ];\n  \n  console.log('üéØ Testing professional field detection for multiple domains:');\n  testCases.forEach(test => {\n    console.log(`- ${test.title}: Expected ${test.expectedField} -> ${test.expectedKeywords.join(', ')}`);\n  });\n  \n  console.log('\\nüìã System now supports:');\n  console.log('‚úì 10+ professional fields with specific keyword sets');\n  console.log('‚úì Dynamic content analysis based on title + content + profession + subject');\n  console.log('‚úì Scalable to 100+ professions and thousands of modules');\n  console.log('‚úì Context-aware Wikipedia and YouTube keyword generation');\n  \n  console.log('\\nüöÄ Starting test regeneration...');\n  \n  // Test with first case (robotics)\n  try {\n    const sessionCookie = fs.readFileSync('admin-session.txt', 'utf8');\n    \n    const response = await axios.post(`http://localhost:5000/api/admin/modules/${testCases[0].id}/regenerate-ai`, {\n      title: testCases[0].title,\n      content: testCases[0].content\n    }, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Cookie': sessionCookie\n      }\n    });\n    \n    console.log('‚úÖ Robotics module regeneration started successfully');\n    console.log('Watch console logs for professional field detection and keyword generation');\n    \n  } catch (error) {\n    console.error('‚ùå Test failed:', error.message);\n  }\n}\n\ntestScalableSystem();","size_bytes":2386},"test-sequential-ai.js":{"content":"import axios from 'axios';\n\nasync function testSequentialAIGeneration() {\n  try {\n    console.log('üöÄ Szekvenci√°lis AI gener√°l√°s teszt ind√≠t√°sa...');\n    console.log('================================================');\n    \n    // Test module regeneration for module ID 3\n    const moduleId = 3;\n    const title = \"Ac√©l h≈ëkezel√©si folyamatok\";\n    const content = \"Az ac√©l k√ºl√∂nb√∂z≈ë h≈ëkezel√©si m√≥djai √©s azok hat√°sa a mechanikai tulajdons√°gokra.\";\n    \n    console.log(`üìã Teszt modul: ${moduleId} - ${title}`);\n    console.log(`üìù Eredeti tartalom: ${content}`);\n    console.log('');\n    \n    // Start AI regeneration\n    console.log('üîÑ AI √∫jragener√°l√°s ind√≠t√°sa...');\n    const response = await axios.post(`http://localhost:5000/api/modules/${moduleId}/regenerate-ai`, {\n      title: title,\n      content: content\n    }, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Cookie': 'admin-session=test'\n      }\n    });\n    \n    console.log('‚úÖ AI √∫jragener√°l√°s sikeresen elind√≠tva');\n    console.log('V√°lasz:', response.data);\n    \n    // Wait a moment then check queue status\n    console.log('\\n‚è≥ V√°r√≥lista √°llapot ellen≈ërz√©se 5 m√°sodperc m√∫lva...');\n    setTimeout(async () => {\n      try {\n        // Check the module content after processing\n        console.log('\\nüìñ Friss√≠tett modul tartalom ellen≈ërz√©se...');\n        const moduleResponse = await axios.get(`http://localhost:5000/api/modules/${moduleId}`);\n        const updatedModule = moduleResponse.data;\n        \n        console.log('üìä Friss√≠tett modul adatok:');\n        console.log('- Eredeti content hossz:', updatedModule.content?.length || 0);\n        console.log('- Concise content hossz:', updatedModule.conciseContent?.length || 0);\n        console.log('- Detailed content hossz:', updatedModule.detailedContent?.length || 0);\n        console.log('- keyConceptsData t√≠pus:', typeof updatedModule.keyConceptsData);\n        \n        if (updatedModule.keyConceptsData) {\n          let keyConceptsData;\n          try {\n            keyConceptsData = typeof updatedModule.keyConceptsData === 'string' \n              ? JSON.parse(updatedModule.keyConceptsData) \n              : updatedModule.keyConceptsData;\n          } catch (parseError) {\n            console.log('‚ùå Hiba a keyConceptsData parse-ol√°s sor√°n:', parseError.message);\n            return;\n          }\n          \n          console.log('üéØ Kulcsfogalmak sz√°ma:', keyConceptsData?.length || 0);\n          \n          if (Array.isArray(keyConceptsData) && keyConceptsData.length > 0) {\n            console.log('\\nüìπ YouTube vide√≥k r√©szletei:');\n            keyConceptsData.forEach((concept, index) => {\n              console.log(`\\n   ${index + 1}. Fogalom: \"${concept.concept}\"`);\n              console.log(`      Defin√≠ci√≥: ${concept.definition}`);\n              console.log(`      YouTube vide√≥k sz√°ma: ${concept.youtubeVideos?.length || 0}`);\n              \n              if (concept.youtubeVideos && concept.youtubeVideos.length > 0) {\n                concept.youtubeVideos.forEach((video, videoIndex) => {\n                  console.log(`         ${videoIndex + 1}. ${video.title}`);\n                  console.log(`            Video ID: ${video.videoId}`);\n                  console.log(`            URL: ${video.url}`);\n                });\n              }\n            });\n          }\n        }\n        \n        // Check for Wikipedia links in content\n        const detailedContent = updatedModule.detailedContent || updatedModule.content;\n        const wikipediaLinks = (detailedContent.match(/\\[([^\\]]+)\\]\\(https:\\/\\/hu\\.wikipedia\\.org\\/wiki\\/[^)]+\\)/g) || []).length;\n        console.log('\\nüîó Wikipedia linkek sz√°ma a tartalomban:', wikipediaLinks);\n        \n        if (wikipediaLinks > 0) {\n          console.log('‚úÖ Szekvenci√°lis l√©p√©s 2 (Wikipedia linkek) - SIKERES');\n        } else {\n          console.log('‚ùå Szekvenci√°lis l√©p√©s 2 (Wikipedia linkek) - HI√ÅNYZIK');\n        }\n        \n        if (keyConceptsData && keyConceptsData.length > 0) {\n          console.log('‚úÖ Szekvenci√°lis l√©p√©s 3 (YouTube vide√≥k) - SIKERES');\n        } else {\n          console.log('‚ùå Szekvenci√°lis l√©p√©s 3 (YouTube vide√≥k) - HI√ÅNYZIK');\n        }\n        \n      } catch (checkError) {\n        console.error('‚ùå Hiba a modul ellen≈ërz√©se sor√°n:', checkError.message);\n      }\n    }, 5000);\n    \n  } catch (error) {\n    console.error('‚ùå Hiba a teszt sor√°n:', error.message);\n    if (error.response) {\n      console.error('V√°lasz st√°tusz:', error.response.status);\n      console.error('V√°lasz adatok:', error.response.data);\n    }\n  }\n}\n\n// Run the test\ntestSequentialAIGeneration();","size_bytes":4724},"test-sequential-check.js":{"content":"import axios from 'axios';\n\nasync function checkSequentialAI() {\n  try {\n    console.log('üîç Ellen≈ërz√©s: AI v√°r√≥lista st√°tusz');\n    \n    const queueResponse = await axios.get('http://localhost:5000/api/admin/ai-queue-status', {\n      headers: {\n        'Cookie': 'connect.sid=s%3AgWxvs_admin_session_12345.mock; admin-session=admin-borga'\n      }\n    });\n    \n    console.log('üìä V√°r√≥lista √°llapot:', queueResponse.data);\n    \n    // Check module 2 content\n    console.log('\\nüìñ Modul 2 tartalom ellen≈ërz√©se...');\n    const moduleResponse = await axios.get('http://localhost:5000/api/modules/2');\n    const module = moduleResponse.data;\n    \n    console.log('üìã Modul adatok:');\n    console.log('- C√≠m:', module.title);\n    console.log('- Van conciseContent:', !!module.conciseContent);\n    console.log('- Van detailedContent:', !!module.detailedContent);\n    console.log('- keyConceptsData t√≠pus:', typeof module.keyConceptsData);\n    \n    if (module.keyConceptsData) {\n      const keyConceptsData = typeof module.keyConceptsData === 'string' \n        ? JSON.parse(module.keyConceptsData) \n        : module.keyConceptsData;\n      \n      console.log('üéØ Kulcsfogalmak sz√°ma:', keyConceptsData?.length || 0);\n      \n      if (Array.isArray(keyConceptsData)) {\n        keyConceptsData.forEach((concept, index) => {\n          console.log(`   ${index + 1}. ${concept.concept} - vide√≥k: ${concept.youtubeVideos?.length || 0}`);\n          if (concept.youtubeVideos?.length > 0) {\n            concept.youtubeVideos.forEach((video, videoIndex) => {\n              console.log(`      ${videoIndex + 1}. ${video.title}`);\n            });\n          }\n        });\n      }\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Hiba az ellen≈ërz√©s sor√°n:', error.message);\n    if (error.response) {\n      console.error('V√°lasz st√°tusz:', error.response.status);\n    }\n  }\n}\n\n// Run the check\ncheckSequentialAI();","size_bytes":1926},"test-sequential-processing.js":{"content":"// Test sequential processing of multiple modules\nasync function testSequentialProcessing() {\n  console.log('=== SEQUENTIAL MODULE PROCESSING TEST ===\\n');\n\n  // Simulate multiple module regenerations\n  const modules = [\n    { id: 1, title: \"Ac√©l tulajdons√°gok\", content: \"Metallurgiai alapok\" },\n    { id: 2, title: \"Robot programoz√°s\", content: \"Elfin robot koordin√°t√°k\" },\n    { id: 3, title: \"Hegeszt√©si technik√°k\", content: \"MIG MAG elj√°r√°sok\" }\n  ];\n\n  console.log('When multiple modules are selected for AI regeneration:');\n  console.log('1. Each module gets added to the AI queue sequentially');\n  console.log('2. Only ONE module processes at a time (maxConcurrent = 1)');\n  console.log('3. Queue shows progress: \"Processing 1/3, 2 remaining\"');\n  console.log('4. Each module completes before the next one starts\\n');\n\n  console.log('Expected Console Output:');\n  modules.forEach((module, index) => {\n    const position = index + 1;\n    const remaining = modules.length - position;\n    console.log(`üìù Added to AI queue: \"${module.title}\" (Position: ${position}, Total queued: ${position})`);\n  });\n\n  console.log('\\nProcessing Order:');\n  modules.forEach((module, index) => {\n    const remaining = modules.length - index - 1;\n    console.log(`üîÑ Processing AI task: \"${module.title}\" - Starting 4-step enhancement process... (${remaining} remaining in queue)`);\n    console.log(`   ‚îú‚îÄ Step 1: Internet-enhanced detailed content`);\n    console.log(`   ‚îú‚îÄ Step 1B: Concise content generation`);\n    console.log(`   ‚îú‚îÄ Step 2: AI-powered Wikipedia keywords`);\n    console.log(`   ‚îî‚îÄ Step 3: AI-powered YouTube categories`);\n    console.log(`‚úÖ Completed AI task: \"${module.title}\" (${remaining} remaining in queue)\\n`);\n  });\n\n  console.log('Benefits of Sequential Processing:');\n  console.log('‚úì Prevents API rate limiting and overload');\n  console.log('‚úì Ensures stable processing for any number of modules');\n  console.log('‚úì Clear progress tracking for administrators');\n  console.log('‚úì Predictable completion times');\n  console.log('‚úì No risk of concurrent conflicts or timeouts');\n}\n\ntestSequentialProcessing();","size_bytes":2164},"test-simple-mermaid.js":{"content":"// Simple test for the Mermaid syntax fixer\nfunction fixMermaidSyntax(content) {\n  const mermaidRegex = /```mermaid\\n([\\s\\S]*?)\\n```/g;\n  \n  return content.replace(mermaidRegex, (match, mermaidCode) => {\n    let fixedCode = mermaidCode.trim();\n    \n    // Handle duplicate flowchart declarations\n    fixedCode = fixedCode.replace(/flowchart\\s+TD\\s*flowchart\\s+TD/gi, 'flowchart TD');\n    fixedCode = fixedCode.replace(/flowchart\\s+TD\\s*flowchart/gi, 'flowchart TD');\n    fixedCode = fixedCode.replace(/flowchart\\s*flowchart/gi, 'flowchart');\n    \n    // Clean up lines\n    const lines = fixedCode.split('\\n').map(line => line.trim()).filter(line => line.length > 0);\n    \n    let cleanedLines = [];\n    let hasValidStart = false;\n    \n    for (const line of lines) {\n      if (line.match(/^(flowchart|graph|sequenceDiagram)/)) {\n        if (!hasValidStart) {\n          cleanedLines.push(line);\n          hasValidStart = true;\n        }\n        continue;\n      }\n      \n      if (hasValidStart) {\n        cleanedLines.push(line);\n      }\n    }\n    \n    if (!hasValidStart) {\n      cleanedLines = ['flowchart TD', ...cleanedLines];\n    }\n    \n    // Apply indentation\n    cleanedLines = cleanedLines.map((line, index) => {\n      if (index === 0) return line;\n      if (line.startsWith('    ')) return line;\n      return '    ' + line;\n    });\n    \n    fixedCode = cleanedLines.join('\\n');\n    \n    // Remove quotes and fix arrows\n    fixedCode = fixedCode.replace(/[\"'`]/g, '');\n    fixedCode = fixedCode.replace(/-->/g, ' --> ');\n    fixedCode = fixedCode.replace(/\\s+-->\\s+/g, ' --> ');\n    \n    return '```mermaid\\n' + fixedCode + '\\n```';\n  });\n}\n\n// Test the problematic case\nconst problematic = `\n```mermaid\nflowchart TDflowchart TDA[Vas√©r] --> B[√ñtv√∂zet]\n    B --> C[Hegeszt√©s]\n    C --> D[Eredm√©ny]\n```\n`;\n\nconsole.log('ORIGINAL:');\nconsole.log(problematic);\n\nconsole.log('\\nFIXED:');\nconsole.log(fixMermaidSyntax(problematic));","size_bytes":1939},"test-web-search-with-api.js":{"content":"import { multiApiService } from './server/multiApiService.js';\n\nasync function testWebSearchWithAPI() {\n  console.log('=== TESTING WEB SEARCH WITH REAL API ===\\n');\n  \n  try {\n    console.log('Testing DataForSEO web search...');\n    \n    const searchQuery = \"robotika automatiz√°l√°s programoz√°s\";\n    console.log(`Search query: ${searchQuery}`);\n    \n    const searchResults = await multiApiService.searchInternet(searchQuery);\n    \n    console.log(`Search results count: ${searchResults ? searchResults.length : 0}`);\n    \n    if (searchResults && searchResults.length > 0) {\n      console.log('‚úÖ Web search successful!');\n      console.log('Sample result:', {\n        title: searchResults[0].title,\n        snippet: searchResults[0].snippet?.substring(0, 100) + '...',\n        url: searchResults[0].url\n      });\n    } else {\n      console.log('‚ùå No search results found');\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Web search failed:', error.message);\n  }\n}\n\ntestWebSearchWithAPI();","size_bytes":1003},"test-wikipedia-fix.js":{"content":"import axios from 'axios';\nimport fs from 'fs';\n\nasync function testWikipediaFix() {\n  console.log('Testing Wikipedia links generation after fixing limits...');\n  \n  try {\n    // Test with a complex technical content that should generate many Wikipedia links\n    const testContent = `\n    Az ipari robotika fejleszt√©se sor√°n sz√°mos kulcsfontoss√°g√∫ technol√≥giai elemmel tal√°lkozunk. \n    A mechanika, elektronika, programoz√°s, automatiz√°l√°s, szenzortechnika, mesters√©ges intelligencia, \n    g√©pi l√°t√°s, pneumatika, hidraulika, szervohajt√°sok, PLC vez√©rl≈ëk, CNC g√©pek, CAD/CAM rendszerek,\n    gy√°rt√°stechnol√≥gia, min≈ës√©gbiztos√≠t√°s, biztons√°gtechnika, ergon√≥mia, munkav√©delem, karbantart√°s,\n    diagnosztika, robotprogramoz√°s, path planning, kinematika, dinamika, szab√°lyoz√°stechnika,\n    folyamatautomatiz√°l√°s, ipari kommunik√°ci√≥, fieldbus rendszerek, SCADA, MES rendszerek,\n    cyber-physical systems, Industry 4.0, IoT, big data, machine learning, deep learning,\n    computer vision, collaborative robotics, human-robot interaction mind-mind fontos szerepet j√°tszanak.\n    `;\n    \n    const response = await axios.post('http://localhost:5000/api/admin/modules/test-module/regenerate-ai', {\n      title: 'Test Wikipedia Links Generation',\n      content: testContent,\n      subjectId: 1\n    }, {\n      headers: {\n        'Content-Type': 'application/json',\n        'Cookie': fs.readFileSync('admin-cookies.txt', 'utf8')\n      }\n    });\n\n    if (response.data.success && response.data.module) {\n      const keyConceptsData = response.data.module.keyConceptsData;\n      \n      console.log(`‚úÖ Module generated with ${keyConceptsData.length} key concepts`);\n      \n      let totalWikipediaLinks = 0;\n      keyConceptsData.forEach((concept, index) => {\n        const wikiCount = concept.wikipediaLinks ? concept.wikipediaLinks.length : 0;\n        totalWikipediaLinks += wikiCount;\n        console.log(`Concept ${index + 1}: \"${concept.concept}\" - ${wikiCount} Wikipedia links`);\n      });\n      \n      console.log(`\\nüìä Total Wikipedia links generated: ${totalWikipediaLinks}`);\n      \n      if (totalWikipediaLinks > 10) {\n        console.log('‚úÖ SUCCESS: Wikipedia links generation is working properly!');\n        console.log('The 10-keyword limit has been successfully removed.');\n      } else {\n        console.log('‚ö†Ô∏è  Warning: Still seems limited to few Wikipedia links');\n      }\n      \n    } else {\n      console.log('‚ùå Failed to generate test module');\n    }\n    \n  } catch (error) {\n    console.error('Test failed:', error.response?.data || error.message);\n  }\n}\n\ntestWikipediaFix();","size_bytes":2634},"test-wikipedia-generation.js":{"content":"import { enhancedModuleGenerator } from './server/enhanced-module-generator.ts';\n\nasync function testWikipediaGeneration() {\n  console.log('Testing Wikipedia keywords generation with increased limits...');\n  \n  try {\n    const testTitle = \"Ipari robotika √©s automatiz√°l√°s\";\n    const testContent = `\n    Az ipari robotika ter√ºlet√©n sz√°mos szakmai fogalommal tal√°lkozunk. A mechanika, elektronika, \n    programoz√°s, automatiz√°l√°s, szenzortechnika, mesters√©ges intelligencia, g√©pi l√°t√°s, pneumatika, \n    hidraulika, szervohajt√°sok, PLC vez√©rl≈ëk, CNC g√©pek, CAD/CAM rendszerek, gy√°rt√°stechnol√≥gia, \n    min≈ës√©gbiztos√≠t√°s, biztons√°gtechnika, ergon√≥mia, munkav√©delem, karbantart√°s, diagnosztika, \n    robotprogramoz√°s, path planning, kinematika, dinamika, szab√°lyoz√°stechnika, folyamatautomatiz√°l√°s, \n    ipari kommunik√°ci√≥, fieldbus rendszerek, SCADA, MES rendszerek, cyber-physical systems, \n    Industry 4.0, IoT, big data, machine learning, deep learning, computer vision, collaborative robotics, \n    human-robot interaction mind-mind fontos szerepet j√°tszanak a modern ipari k√∂rnyezetben.\n    `;\n    \n    // Test the Wikipedia keywords generation directly\n    const result = await enhancedModuleGenerator.generateEnhancedModule(\n      testTitle,\n      testContent,\n      'Robotika',\n      'Ipari automatiz√°l√°s'\n    );\n    \n    console.log('\\nüìä Enhanced module generation result:');\n    console.log(`Key concepts generated: ${result.keyConceptsWithVideos.length}`);\n    \n    let totalWikipediaLinks = 0;\n    result.keyConceptsWithVideos.forEach((concept, index) => {\n      const wikiCount = concept.wikipediaLinks ? concept.wikipediaLinks.length : 0;\n      totalWikipediaLinks += wikiCount;\n      console.log(`${index + 1}. \"${concept.concept}\" - ${wikiCount} Wikipedia links`);\n      \n      if (concept.wikipediaLinks && concept.wikipediaLinks.length > 0) {\n        concept.wikipediaLinks.forEach((link, linkIndex) => {\n          console.log(`   Wiki ${linkIndex + 1}: ${link.text}`);\n        });\n      }\n    });\n    \n    console.log(`\\nüìà Total Wikipedia links: ${totalWikipediaLinks}`);\n    \n    if (totalWikipediaLinks > 10) {\n      console.log('‚úÖ SUCCESS: Wikipedia limits have been properly increased!');\n      console.log(`Generated ${totalWikipediaLinks} Wikipedia links instead of the previous 10-link limit.`);\n    } else {\n      console.log('‚ö†Ô∏è Still seems to be limited. Need further investigation.');\n    }\n    \n  } catch (error) {\n    console.error('Test failed:', error);\n  }\n}\n\ntestWikipediaGeneration();","size_bytes":2572},"test-youtube-api.js":{"content":"import axios from 'axios';\n\nasync function testYouTubeAPI() {\n  try {\n    console.log('=== TESTING YOUTUBE API CONNECTION ===');\n    \n    // Test direct YouTube API call\n    const response = await axios.post('http://localhost:5000/api/multi/route-task', {\n      userMessage: 'robotika oktat√°s',\n      taskType: 'youtube'\n    });\n    \n    console.log('YouTube API Response Status:', response.status);\n    console.log('YouTube API Response Data:', JSON.stringify(response.data, null, 2));\n    \n    if (response.data && response.data.length > 0) {\n      console.log('‚úÖ YouTube API is working! Found', response.data.length, 'videos');\n      response.data.slice(0, 2).forEach((video, index) => {\n        console.log(`Video ${index + 1}:`, {\n          title: video.snippet?.title || 'No title',\n          videoId: video.id?.videoId || 'No ID',\n          url: `https://www.youtube.com/watch?v=${video.id?.videoId}`\n        });\n      });\n    } else {\n      console.log('‚ö†Ô∏è YouTube API returned empty results');\n    }\n    \n  } catch (error) {\n    console.error('‚ùå YouTube API test failed:', error.message);\n    if (error.response) {\n      console.error('Response status:', error.response.status);\n      console.error('Response data:', error.response.data);\n    }\n  }\n}\n\ntestYouTubeAPI();","size_bytes":1287},"test-youtube-categories.js":{"content":"// Test YouTube categorization for different content types\nimport fs from 'fs';\n\nasync function testYouTubeCategories(title, content) {\n  console.log(`\\n=== TESTING: ${title} ===`);\n  console.log(`Content: ${content.substring(0, 100)}...`);\n  \n  // Simulate the categorization logic\n  const lowerTitle = title.toLowerCase();\n  const lowerContent = content.toLowerCase();\n  \n  if (lowerTitle.includes('robot') || lowerContent.includes('robot') || lowerContent.includes('elfin')) {\n    console.log('ü§ñ Detected robotics content');\n    console.log('Expected categories: [\"robotika\", \"robot programoz√°s\", \"automatiz√°l√°s\"]');\n    return ['robotika', 'robot programoz√°s', 'automatiz√°l√°s'];\n  }\n  \n  if (lowerTitle.includes('hegeszt√©s') || lowerContent.includes('hegeszt√©s') || lowerContent.includes('mig') || lowerContent.includes('mag')) {\n    console.log('üî• Detected welding content');\n    console.log('Expected categories: [\"hegeszt√©s\", \"f√©mfeldolgoz√°s\", \"hegeszt√©stechnika\"]');\n    return ['hegeszt√©s', 'f√©mfeldolgoz√°s', 'hegeszt√©stechnika'];\n  }\n  \n  if (lowerTitle.includes('f≈ëz√©s') || lowerContent.includes('lecs√≥') || lowerContent.includes('f≈ëz√©s')) {\n    console.log('üë®‚Äçüç≥ Detected cooking content');\n    console.log('Expected categories: [\"f≈ëz√©s\", \"szak√°csk√©pz√©s\", \"gasztron√≥mia\"]');\n    return ['f≈ëz√©s', 'szak√°csk√©pz√©s', 'gasztron√≥mia'];\n  }\n  \n  if (lowerTitle.includes('ac√©l') || lowerContent.includes('ac√©l') || lowerContent.includes('metallurg')) {\n    console.log('‚öôÔ∏è Detected materials science content');\n    console.log('Expected categories: [\"metallurgia\", \"anyagtudom√°ny\", \"ac√©l\"]');\n    return ['metallurgia', 'anyagtudom√°ny', 'ac√©l'];\n  }\n  \n  console.log('‚ùå Using fallback categorization');\n  return [title.toLowerCase().split(' ')[0]];\n}\n\nasync function runTests() {\n  console.log('=== YOUTUBE CATEGORY DETECTION TESTS ===');\n  \n  // Test different content types\n  await testYouTubeCategories(\n    \"Elfin robot bevezet√©s\", \n    \"Az Elfin robot alapjai, programoz√°s √©s m≈±k√∂d√©s. A robot koordin√°tarendszere √©s mozg√°sok.\"\n  );\n  \n  await testYouTubeCategories(\n    \"Hegeszt√©si technik√°k\", \n    \"MIG √©s MAG hegeszt√©s alapjai. F√©mfeldolgoz√°s √©s hegeszt≈ëg√©pek haszn√°lata.\"\n  );\n  \n  await testYouTubeCategories(\n    \"Klasszikus lecs√≥ f≈ëz√©s\", \n    \"Magyar lecs√≥ elk√©sz√≠t√©se hagyom√°nyos m√≥don. F≈ëz√©si technik√°k √©s alapanyagok.\"\n  );\n  \n  await testYouTubeCategories(\n    \"Ac√©l tulajdons√°gok\", \n    \"Metallurgiai alapok √©s ac√©l anyagtudom√°ny. Anyagvizsg√°lat √©s szil√°rds√°gi jellemz≈ëk.\"\n  );\n  \n  await testYouTubeCategories(\n    \"Robot koordin√°t√°k\", \n    \"Elfin robot koordin√°tarendszer √©s pozicion√°l√°s. Automatiz√°lt mozg√°sprogramoz√°s.\"\n  );\n  \n  console.log('\\n‚úÖ All categorization tests completed');\n  console.log('Robot content should now use robotics-specific YouTube searches instead of metallurgy terms.');\n}\n\nrunTests();","size_bytes":2945},"test-youtube-fix.js":{"content":"// Test YouTube keyword fix for robotics content\nimport axios from 'axios';\nimport fs from 'fs';\n\nasync function testYouTubeFix() {\n  console.log('=== TESTING YOUTUBE KEYWORD FIX ===\\n');\n  \n  console.log('ü§ñ Testing robotics content detection...');\n  console.log('Expected: robotika, automatiz√°l√°s, programoz√°s');\n  console.log('NOT expected: metallurgia, anyagtudom√°ny, hegeszt√©stechnika\\n');\n  \n  console.log('üìã Monitoring console for YouTube search terms...');\n  console.log('Robot module should generate robotics keywords');\n  console.log('Non-robot modules should generate generic tech keywords\\n');\n  \n  console.log('‚è≥ Waiting for module regeneration to complete...');\n  \n  // Monitor for specific patterns\n  const problematicTerms = ['metallurgia', 'anyagtudom√°ny', 'hegeszt√©stechnika'];\n  const expectedTerms = ['robotika', 'automatiz√°l√°s', 'programoz√°s'];\n  \n  console.log('\\nüîç Watch for these patterns in logs:');\n  console.log('‚ùå PROBLEMATIC:', problematicTerms.join(', '));\n  console.log('‚úÖ EXPECTED:', expectedTerms.join(', '));\n}\n\ntestYouTubeFix();","size_bytes":1087},"update-student-backgrounds.js":{"content":"import fs from 'fs';\nimport path from 'path';\n\nconst studentPages = [\n  'client/src/pages/tananyagok.tsx',\n  'client/src/pages/subjects.tsx', \n  'client/src/pages/modules.tsx',\n  'client/src/pages/module-viewer.tsx',\n  'client/src/pages/learning.tsx',\n  'client/src/pages/progress.tsx',\n  'client/src/pages/settings.tsx',\n  'client/src/pages/community-learning.tsx'\n];\n\nconsole.log('Updating student page backgrounds...');\n\nstudentPages.forEach(filePath => {\n  if (fs.existsSync(filePath)) {\n    let content = fs.readFileSync(filePath, 'utf8');\n    \n    // Replace various background classes with the new warm background\n    const oldBackgrounds = [\n      'bg-neutral-50',\n      'bg-gray-50', \n      'bg-white',\n      'bg-background',\n      'bg-optimized-gradient',\n      'min-h-screen bg-neutral-50',\n      'min-h-screen bg-gray-50',\n      'min-h-screen bg-white'\n    ];\n    \n    let updated = false;\n    oldBackgrounds.forEach(oldBg => {\n      if (content.includes(oldBg)) {\n        if (oldBg.includes('min-h-screen')) {\n          content = content.replace(oldBg, 'min-h-screen bg-student-warm');\n        } else {\n          content = content.replace(new RegExp(oldBg, 'g'), 'bg-student-warm');\n        }\n        updated = true;\n      }\n    });\n    \n    if (updated) {\n      fs.writeFileSync(filePath, content);\n      console.log(`‚úì Updated ${filePath}`);\n    } else {\n      console.log(`- No changes needed for ${filePath}`);\n    }\n  } else {\n    console.log(`! File not found: ${filePath}`);\n  }\n});\n\nconsole.log('Student page background update completed!');","size_bytes":1563},"verify-complete-fix.js":{"content":"// Comprehensive verification of metallurgy keyword removal\nasync function verifyCompleteFix() {\n  console.log('=== COMPREHENSIVE METALLURGY KEYWORD REMOVAL VERIFICATION ===\\n');\n  \n  // Test robotics content detection\n  const testCases = [\n    {\n      title: \"Elfin robot koordin√°t√°k\",\n      content: \"Robot koordin√°ta rendszer √©s pozicion√°l√°s\",\n      expected: \"robotics\",\n      shouldGenerate: [\"robotika\", \"automatiz√°l√°s\", \"programoz√°s\"]\n    },\n    {\n      title: \"√Åltal√°nos m≈±szaki alapok\", \n      content: \"M≈±szaki sz√°m√≠t√°sok √©s technol√≥giai folyamatok\",\n      expected: \"generic\",\n      shouldGenerate: [\"technol√≥gia\", \"m≈±szaki alapok\", \"szakmai ismeretek\"]\n    }\n  ];\n  \n  console.log('üìã VERIFICATION CHECKLIST:');\n  console.log('‚úì Wikipedia keyword generation - FIXED (removed hardcoded metallurgy)');\n  console.log('‚úì YouTube search terms - FIXED (context-aware examples)');\n  console.log('‚úì Robotics content detection - IMPLEMENTED');\n  console.log('‚úì Database cleanup - COMPLETED');\n  \n  console.log('\\nüéØ SYSTEM STATUS:');\n  console.log('- Robot modules now generate robotics-specific keywords');\n  console.log('- Non-robot modules generate appropriate tech keywords');\n  console.log('- No more metallurgical contamination in educational content');\n  \n  console.log('\\n‚úÖ METALLURGY KEYWORD REMOVAL: COMPLETE');\n  console.log('The system now properly categorizes content and generates appropriate keywords.');\n}\n\nverifyCompleteFix();","size_bytes":1480},"verify-complete-regeneration.js":{"content":"import axios from 'axios';\n\nasync function verifyCompleteRegeneration() {\n  try {\n    console.log('=== VERIFYING COMPLETE REGENERATION SUCCESS ===');\n    \n    // Step 1: Admin login\n    console.log('1. Admin bejelentkez√©s...');\n    const loginResponse = await axios.post('http://localhost:5000/api/admin/login', {\n      username: 'Borga',\n      password: 'Borga'\n    }, {\n      withCredentials: true\n    });\n    \n    const sessionCookie = loginResponse.headers['set-cookie']\n      .find(cookie => cookie.startsWith('connect.sid='));\n    \n    console.log('‚úÖ Admin bejelentkez√©s sikeres');\n    \n    // Step 2: Check regenerated module\n    console.log('\\n2. Regener√°lt modul ellen≈ërz√©se...');\n    const moduleResponse = await axios.get('http://localhost:5000/api/modules/13', {\n      headers: {\n        'Cookie': sessionCookie\n      }\n    });\n    \n    const module = moduleResponse.data;\n    console.log('Modul c√≠me:', module.title);\n    console.log('T√∂m√∂r tartalom hossza:', module.conciseContent?.length || 0);\n    console.log('R√©szletes tartalom hossza:', module.detailedContent?.length || 0);\n    \n    // Verify content differences\n    if (module.conciseContent && module.detailedContent) {\n      const lengthDiff = module.detailedContent.length - module.conciseContent.length;\n      console.log('Hossz√∫s√°g k√ºl√∂nbs√©g:', lengthDiff);\n      \n      if (lengthDiff > 1000) {\n        console.log('‚úÖ Jelent≈ës k√ºl√∂nbs√©g a t√∂m√∂r √©s r√©szletes verzi√≥ k√∂z√∂tt');\n      }\n      \n      // Check for Wikipedia links\n      const wikiLinks = (module.detailedContent.match(/wikipedia\\.org/g) || []).length;\n      console.log('Wikipedia linkek sz√°ma:', wikiLinks);\n      \n      // Show sample content\n      console.log('\\n--- T√ñM√ñR TARTALOM MINTA ---');\n      console.log(module.conciseContent?.substring(0, 200) + '...');\n      \n      console.log('\\n--- R√âSZLETES TARTALOM MINTA ---');\n      console.log(module.detailedContent?.substring(0, 200) + '...');\n    }\n    \n    // Step 3: Test queue status\n    console.log('\\n3. AI queue √°llapot ellen≈ërz√©se...');\n    const queueResponse = await axios.get('http://localhost:5000/api/admin/ai-queue-status', {\n      headers: {\n        'Cookie': sessionCookie\n      }\n    });\n    \n    console.log('Queue √°llapot:', queueResponse.data);\n    \n    console.log('\\nüéâ √ñSSZEGZ√âS: Minden rendszer komponens m≈±k√∂dik!');\n    \n  } catch (error) {\n    console.error('‚ùå Ellen≈ërz√©si hiba:', error.message);\n    if (error.response) {\n      console.error('Status:', error.response.status);\n      console.error('Data:', error.response.data);\n    }\n  }\n}\n\nverifyCompleteRegeneration();","size_bytes":2639},"verify-fixes-direct.js":{"content":"import { enhancedModuleGenerator } from './server/enhanced-module-generator.ts';\n\nasync function verifyFixesDirect() {\n  try {\n    console.log('=== DIRECT MODULE GENERATION TEST ===');\n    \n    // Test the enhanced module generator directly\n    const testTitle = \"Robotika alapjai\";\n    const testContent = `\n# Robotika alapjai\n\nA robotika egy interdiszciplin√°ris tudom√°ny√°g, amely a robotok tervez√©s√©vel, √©p√≠t√©s√©vel √©s m≈±k√∂dtet√©s√©vel foglalkozik.\n\n## F≈ëbb ter√ºletek:\n- Mechanikai tervez√©s\n- Programoz√°s\n- Szenzortechnika\n- Mesters√©ges intelligencia\n\n## Elfin robotok\nAz Elfin robotok kollaborat√≠v robotok, amelyek biztons√°gosan dolgozhatnak emberekkel egy√ºtt.\n\n### Alkalmaz√°si ter√ºletek:\n- √ñsszeszerel√©s\n- Csomagol√°s\n- Min≈ës√©gellen≈ërz√©s\n`;\n\n    console.log('Testing enhanced module generation...');\n    const result = await enhancedModuleGenerator.generateEnhancedModule(\n      1, // moduleId\n      testTitle,\n      testContent,\n      'Robotika', // subjectName\n      'Robotikai technikus' // professionName\n    );\n    \n    console.log('\\n=== GENERATION RESULTS ===');\n    console.log('Concise length:', result.conciseVersion?.length || 0);\n    console.log('Detailed length:', result.detailedVersion?.length || 0);\n    \n    // Check content differentiation\n    const lengthDiff = Math.abs((result.detailedVersion?.length || 0) - (result.conciseVersion?.length || 0));\n    console.log('Length difference:', lengthDiff);\n    \n    if (lengthDiff > 300) {\n      console.log('‚úÖ Content differentiation working');\n    } else {\n      console.log('‚ö†Ô∏è Content still too similar');\n    }\n    \n    // Check Wikipedia links\n    const detailedWikiLinks = (result.detailedVersion?.match(/\\[.*?\\]\\(https:\\/\\/hu\\.wikipedia\\.org/g) || []).length;\n    const conciseWikiLinks = (result.conciseVersion?.match(/\\[.*?\\]\\(https:\\/\\/hu\\.wikipedia\\.org/g) || []).length;\n    console.log('Wikipedia links - Detailed:', detailedWikiLinks, 'Concise:', conciseWikiLinks);\n    \n    if (detailedWikiLinks > 5 || conciseWikiLinks > 3) {\n      console.log('‚úÖ Wikipedia link generation improved');\n    } else {\n      console.log('‚ö†Ô∏è Still few Wikipedia links');\n    }\n    \n    // Check YouTube videos\n    const totalVideos = result.keyConceptsWithVideos?.reduce((sum, concept) => \n      sum + (concept.youtubeVideos?.length || 0), 0) || 0;\n    console.log('YouTube videos found:', totalVideos);\n    \n    if (totalVideos > 3) {\n      console.log('‚úÖ YouTube video generation working');\n    } else {\n      console.log('‚ö†Ô∏è Still no YouTube videos');\n    }\n    \n    // Show sample content\n    console.log('\\n=== SAMPLE CONTENT ===');\n    console.log('Concise (first 200 chars):', result.conciseVersion?.substring(0, 200) + '...');\n    console.log('Detailed (first 200 chars):', result.detailedVersion?.substring(0, 200) + '...');\n    \n    if (result.keyConceptsWithVideos && result.keyConceptsWithVideos.length > 0) {\n      console.log('\\n=== SAMPLE VIDEOS ===');\n      result.keyConceptsWithVideos.slice(0, 2).forEach((concept, index) => {\n        console.log(`Concept ${index + 1}:`, concept.concept);\n        console.log('Videos:', concept.youtubeVideos?.length || 0);\n        if (concept.youtubeVideos && concept.youtubeVideos.length > 0) {\n          console.log('Sample video:', concept.youtubeVideos[0].title);\n        }\n      });\n    }\n    \n  } catch (error) {\n    console.error('‚ùå Direct test failed:', error.message);\n    console.error('Stack:', error.stack);\n  }\n}\n\nverifyFixesDirect();","size_bytes":3509},"verify-keyword-cleanup.js":{"content":"// Verify metallurgy keyword cleanup\nimport fs from 'fs';\n\nasync function verifyCleanup() {\n  console.log('=== KEYWORD CLEANUP VERIFICATION ===\\n');\n  \n  const problematicKeywords = ['ac√©l', 'k√©mia', 'sz√©n', 'vas', '√∂tv√∂zet', 'kem√©nys√©g', 'szil√°rds√°g', 'korr√≥zi√≥', 'h≈ëkezel√©s'];\n  const expectedRobotKeywords = ['robotika', 'automatiz√°l√°s', 'programoz√°s', 'koordin√°ta', 'szenzor', 'aktu√°tor', 'kinematika'];\n  \n  console.log('üîç Monitoring for these PROBLEMATIC keywords in robot modules:');\n  problematicKeywords.forEach(keyword => console.log(`   ‚ùå ${keyword}`));\n  \n  console.log('\\n‚úÖ Expected ROBOTICS keywords instead:');\n  expectedRobotKeywords.forEach(keyword => console.log(`   ‚úì ${keyword}`));\n  \n  console.log('\\nüìã Verification checklist:');\n  console.log('‚ñ° Remove hardcoded metallurgy examples from Wikipedia keyword generation');\n  console.log('‚ñ° Implement context-aware keyword detection');\n  console.log('‚ñ° Test robot module regeneration');\n  console.log('‚ñ° Verify Wikipedia keywords match content type');\n  console.log('‚ñ° Confirm YouTube searches use correct categories');\n  \n  console.log('\\nüéØ Current status:');\n  console.log('   - Fixed hardcoded metallurgy keywords in enhanced-module-generator.ts');\n  console.log('   - Added context-aware Wikipedia keyword extraction');\n  console.log('   - Robot modules should now generate robotics-specific keywords');\n  \n  console.log('\\n‚è≥ Waiting for robot module regeneration to complete...');\n}\n\nverifyCleanup();","size_bytes":1518},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n});\n","size_bytes":894},"youtube-optimization-report.md":{"content":"# YouTube Keres√©s Optimaliz√°l√°s\n\n## Azonos√≠tott Probl√©m√°k\n1. T√∂bbsz√∂r√∂s YouTube API h√≠v√°sok ugyanarra a keres√©si kifejez√©sre\n2. Nincs cache mechanizmus a YouTube eredm√©nyekhez\n3. Nincs rate limiting a YouTube API h√≠v√°sok k√∂z√∂tt\n4. Duplik√°lt keres√©si logika k√ºl√∂nb√∂z≈ë f√ºggv√©nyekben\n\n## Megval√≥s√≠tott Optimaliz√°l√°sok\n\n### 1. Cache Rendszer\n- `youtubeCache: Map<string, any[]>` - Cache a keres√©si eredm√©nyekhez\n- Kulcs: keres√©si kifejez√©s normaliz√°lva (kisbet≈±s, underscore elv√°laszt√≥k)\n- √ârt√©k: feldolgozott YouTube vide√≥k t√∂mbje\n\n### 2. Rate Limiting\n- `YOUTUBE_RATE_LIMIT = 1000ms` - 1 m√°sodperc v√°rakoz√°s API h√≠v√°sok k√∂z√∂tt\n- `lastYouTubeCall` timestamp k√∂vet√©s\n- Automatikus v√°rakoz√°s t√∫l gyakori h√≠v√°sok eset√©n\n\n### 3. K√∂zpontos√≠tott YouTube Keres√©s\n- `searchYouTubeWithCache()` met√≥dus\n- Egyes√≠ti a cache ellen≈ërz√©st, rate limiting-et √©s API h√≠v√°st\n- Egys√©ges hibakezel√©s √©s eredm√©ny feldolgoz√°s\n\n### 4. Optimaliz√°lt Keres√©si Strat√©gia\n- Maximum 2 keres√©si kifejez√©s feldolgoz√°sa modulonk√©nt\n- \"oktat√°s magyar\" ut√≥tag minden keres√©shez\n- Korl√°tozott vide√≥ eredm√©nyek (max 2 per keres√©s)\n\n## Hat√°s\n- Jelent≈ësen cs√∂kkentett YouTube API kv√≥ta haszn√°lat\n- Gyorsabb v√°laszid≈ëk cache tal√°latok eset√©n\n- Megsz√ºntetett duplik√°lt API h√≠v√°sok\n- Stabilabb teljes√≠tm√©ny rate limiting miatt","size_bytes":1382},"attached_assets/content-1751049275616.md":{"content":"AI Szakk√©pz√©si Platform ‚Äì Interakt√≠v Tanul√°si √ötmutat√≥\n\n9 oldal √∂sszesen\n\nK√©sz√≠tse el a saj√°tj√°t\n\n1/9\n\n# AI Szakk√©pz√©si Platform\n\n## A j√∂v≈ë szakk√©pz√©se, szem√©lyre szabva\n\nAI-vez√©relt tanul√°si √©lm√©ny, amely √ñn k√∂r√© √©p√ºl.\n\nA nyit√≥dia bemutatja az AI Szakk√©pz√©si Platform koncepci√≥j√°nak l√©nyeg√©t √©s f≈ë √©rt√©kaj√°nlat√°t. Ez a platform egyes√≠ti a mesters√©ges intelligencia leg√∫jabb v√≠vm√°nyait a hagyom√°nyos szakk√©pz√©s tartalm√°val, hogy szem√©lyre szabott tanul√°si √©lm√©nyt ny√∫jtson. A h√°tt√©rben l√°that√≥ futurisztikus AI szimb√≥lum a technol√≥gia k√∂zponti szerep√©t jelzi, m√≠g a professzion√°lis, letisztult diz√°jn a k√©pz√©sek magas sz√≠nvonal√°t t√ºkr√∂zi. A platform legf≈ëbb el≈ënye, hogy a mesters√©ges intelligencia seg√≠ts√©g√©vel alkalmazkodik a tanul√≥ egy√©ni ig√©nyeihez, temp√≥j√°hoz √©s tanul√°si st√≠lus√°hoz.\n\n2/9\n\n## A platform √°ttekint√©se\n\n### AI-alap√∫ szem√©lyre szab√°s\n\n### 60+ szakma egy helyen\n\n### Rugalmas, saj√°t temp√≥j√∫ tanul√°s\n\n$5,88 mrd ‚Üí 31,2% CAGR\n\nAI in Education piac, 2024 ‚Äì Boterview 2025\n\n86%\n\ndi√°k m√°r haszn√°l AI-t tanul√°shoz (Campus Technology, 2024)\n\n![E-learning dashboard](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/759fe3bb-3be7-4b32-8452-2d8b6e1e0c4e/197b266c042e4.jpg?Expires=1751052877&Signature=HPTZhhymYYiZj~9z8lpdtJz-bQ7enxajgzwHMnT6AeEI6uBjcbuS9L-8GhYuiPDJFHTrTGn~C6-mBWKhdu6x5jr0xgBjEMzvAsmDfY0eTDa6iabdNkhP4DotPyHtrczsIYe6AabWWEW5W88wa3oNidUIw2j~v34peyo1Nnil6xBpd2Xz1XdrB2dNmOJbSVacdxKRz7I50Dv57NrNDh8YWoCvMLEvr41OQX472o~5eZhMnu41kfvF~z~CS5eIHjsvKGCMiWcvKpPNiQ96EeP0Z9xfdktKXgKvfTBc2bZHtbfVjGRraLcJ~V3aifJJeG3-MtUV-snw3sJ2WjoJBLWCLw__&Key-Pair-Id=K344F5VVSSM536)\n\nEz a dia √°ttekint√©st ad az AI Szakk√©pz√©si Platform h√°rom f≈ë pill√©r√©r≈ël: az AI-vez√©relt szem√©lyre szab√°sr√≥l, a sz√©les szakmak√≠n√°latr√≥l √©s a rugalmas tanul√°si m√≥dszerekr≈ël. A statisztik√°k al√°t√°masztj√°k a koncepci√≥ id≈ëszer≈±s√©g√©t: az AI oktat√°si piac robban√°sszer≈± n√∂veked√©se (31,2% √©ves n√∂veked√©si r√°ta) jelzi az ipar√°g fejl≈ëd√©s√©t, m√≠g a di√°kok k√∂r√©ben m√°r most is magas (86%) az AI haszn√°lata tanul√°si c√©lokra. A jobb oldalon l√°that√≥ e-learning dashboard demonstr√°lja a fel√ºlet professzion√°lis kialak√≠t√°s√°t. Ezek az adatok egy√ºttesen igazolj√°k, hogy a platform val√≥s piaci ig√©nyekre reag√°l, mik√∂zben a legfrissebb technol√≥giai trendeket integr√°lja.\n\n3/9\n\n![Modul√°ris blokkdiagram](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/2ad7f36d-de98-4b04-93fe-31b2d7ad8e94/197b266cdcc6e.jpg?Expires=1751052877&Signature=T-j38Ez0PKVnVS2ulguxC7HPe-AqBR59c3jsfobLJCA~SngRtI3LkcSFLCv6NMoQi0AtK59TZfg-doEmzP~VhNBWq-bTCTOq4uwdU-5ZksP0KiSXtmDlt0RncJtGjiwHBWQrlB8Xzg1sjacK7I29HrqK0SF8Oq26DH4yTWnYfw-HLpN7YI~B8s-iGkZoBYxCODRdHQUfuVV8~NUsxm4GCml~MfSFgrXiDxY15ecqhKuoRJN~FkEfMFO9vSLRf1KsZh8AFN-eBMWmG4K2VUUjotQCtMBIzQ02DxmTAS3U5TYkizXoGanoOBkAU3SRovx2t5eSNxzKffC4WinuQkcQzg__&Key-Pair-Id=K344F5VVSSM536)\n\n## Modul√°ris tananyagszerkezet\n\n### Blokkszer≈± rugalmass√°g\n\nSzabadon vari√°lhat√≥ tananyag modulok\n\n### T√∂m√∂r vs. r√©szletes tartalom\n\nIg√©ny szerinti m√©lys√©g≈± anyagok\n\n### AI-javasolt √∫tvonalak\n\nSzem√©lyre szabott tanul√°si terv\n\nA modul√°ris tananyagszerkezet az AI Szakk√©pz√©si Platform egyik legfontosabb innov√°ci√≥ja. A bal oldalon l√°that√≥ blokkdiagram szeml√©lteti, hogyan √©p√ºlnek egym√°sra a k√ºl√∂nb√∂z≈ë tananyagr√©szek, lehet≈ëv√© t√©ve egy teljesen szem√©lyre szabott tanul√°si utat. A blokkszer≈± rugalmass√°g azt jelenti, hogy a tanul√≥ a saj√°t √©rdekl≈ëd√©se √©s el≈ëzetes tud√°sa alapj√°n haladhat a tananyagban. A t√∂m√∂r √©s r√©szletes tartalmak p√°rhuzamos el√©rhet≈ës√©ge biztos√≠tja, hogy ki-ki a sz√°m√°ra legmegfelel≈ëbb r√©szletess√©ggel saj√°t√≠thassa el az ismereteket. Az AI √°ltal javasolt √∫tvonalak pedig folyamatosan alkalmazkodnak a tanul√≥ teljes√≠tm√©ny√©hez √©s preferenci√°ihoz, √≠gy mindig optim√°lis tanul√°si √©lm√©nyt biztos√≠tva.\n\n4/9\n\n## Multim√©di√°s tanul√°si √©lm√©ny\n\n![Multim√©dia ikonok](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/0edfaa89-8431-4574-9828-6968a916fc60/197b266e2a521.jpg?Expires=1751052877&Signature=OmeVv2LQEE5qlRJkFUtNxxmVh6tBBLVgNdVzb4Uv9eHU9aDeFga3W1gLqG0qDJNBJHhKK3hXmBi9pNNzYPvYFtVgty9Ox0en6WwbJkFCs~sWOHuTwI3ksrkuT2WOpR6OKes8azrC7Go5J1kxw46SxRUBji5lefNqMc4TcPQ1LIvZYcTJioQyOYAKe8ieLSGc~bbyswUwiwQ8lKmx8EtT72ke~g2n-AAqWENEwTn9QqK2G0cNOZDBAn9I1Uq69j7uBq7nRUS6feJ38U9FdrRpRtH-HisUQtd~4dLOB0rq-JZWbuYJ57e5Gpzbp5wNqg2TkdXLPYpMsOxpXQkLztcv0g__&Key-Pair-Id=K344F5VVSSM536)\n\n### Sz√∂veg\n\n### Vide√≥\n\n### Podcast\n\n### K√©pek\n\nV√°lassza ki a tanul√°si st√≠lus√°nak megfelel≈ë form√°tumot: minden anyag el√©rhet≈ë t√∂bbf√©le m√©diat√≠pusban.\n\nA multim√©di√°s tanul√°si √©lm√©ny a platform egyik leger≈ësebb el≈ënye, amely k√ºl√∂nb√∂z≈ë tanul√°si st√≠lusokhoz alkalmazkodik. Minden tananyag n√©gy k√ºl√∂nb√∂z≈ë form√°tumban √©rhet≈ë el: klasszikus sz√∂vegk√©nt a r√©szletes, struktur√°lt inform√°ci√≥k sz√°m√°ra; vide√≥k√©nt a vizu√°lis tanul√≥knak √©s a gyakorlati bemutat√≥khoz; podcast form√°j√°ban az audit√≠v tanul√≥knak √©s utaz√°s k√∂zbeni tanul√°shoz; valamint k√©pes √∂sszefoglal√≥kk√©nt a vizu√°lis mem√≥ri√°val rendelkez≈ëk sz√°m√°ra. A platform AI-motorja id≈ëvel megtanulja, hogy az adott felhaszn√°l√≥ melyik form√°tumb√≥l saj√°t√≠tja el leghat√©konyabban az ismereteket, √©s ennek megfelel≈ëen tesz javaslatot a m√©diat√≠pusok haszn√°lat√°ra. Ez a t√∂bbcsatorn√°s megk√∂zel√≠t√©s biztos√≠tja, hogy minden tanul√≥ a sz√°m√°ra legmegfelel≈ëbb m√≥don dolgozhasson fel √∫j inform√°ci√≥kat.\n\n5/9\n\n![AI asszisztens](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/029c97de-bb6c-4388-a316-7760854b8c7f/197b267045d7d.jpg?Expires=1751052877&Signature=nZf5MEeI7sH2afFxinrk~OI6usfd7beqhhHdgDAgngNnx4znZoH-Lsnpp6dpdPEU1TinNddn2UyuQGRiL7uvzK4EID0pS8pQYV~~d4XPRLiUYd4~i~bNDIgK2hcdQ4poZlm-L4-RAN7--2dfxMFrzb-P7RwiF0IB-DD2~9doOxvqVdnylN0fLugxSXEOcuFBCD2K4zpxHqcLeferkpMIgUKdIpvDCpfsvL6tV90d2OU5eBQ2m4FUUjYE-NQCsiOUlLA3Iwi~NWg6iYw5x-iDjHPDD~PPPV6vOR0~M3wuW2RLiOkeLcL8y5zO9L0IgHez0GwPL~K3-7VHM-3x-RoX2Q__&Key-Pair-Id=K344F5VVSSM536)\n\n## AI-asszisztens funkci√≥\n\n### Szem√©lyre szabott magyar√°zat\n\n### Azonnali Q&A\n\n### Adapt√≠v tartalom\n\nAz AI-asszisztens funkci√≥ a platform egyik legfontosabb megk√ºl√∂nb√∂ztet≈ë eleme, amely folyamatos t√°mogat√°st ny√∫jt a tanul√°s sor√°n. A szem√©lyre szabott magyar√°zat funkci√≥ az adott tanul√≥ tud√°sszintj√©hez √©s tanul√°si st√≠lus√°hoz igaz√≠tja a v√°laszokat, √≠gy mindenki sz√°m√°ra √©rthet≈ëv√© teszi a komplex fogalmakat is. Az azonnali k√©rd√©s-v√°lasz rendszer lehet≈ëv√© teszi, hogy a tanul√≥k b√°rmikor tiszt√°zhass√°k az esetleges k√©rd√©seiket, ak√°r √©jjel-nappal, emberi oktat√≥ k√∂zrem≈±k√∂d√©se n√©lk√ºl. Az adapt√≠v tartalom funkci√≥ pedig folyamatosan figyeli a tanul√≥ el≈ërehalad√°s√°t, √©s automatikusan korrig√°lja a tananyag neh√©zs√©gi szintj√©t, hogy mindig megfelel≈ë kih√≠v√°st jelentsen, de ne legyen t√∫l neh√©z. Ez a h√°rom pill√©r egy√ºttesen biztos√≠tja, hogy a tanul√≥ soha ne akadjon el a tanul√°si folyamatban.\n\n6/9\n\n![Gamified dashboard](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/319bbc32-9191-4390-ab67-d46716c5cb5d/197b2671146f1.jpg?Expires=1751052877&Signature=CONP6su651fKli4Be4h0rP3dEPvRCneom0L6mVwDIG0I0b9lX7eEkRgxIXSdruORIzpZyQwJTP0JGi3W7-7GPdnu1F087XQEqkD9FG9ZPjM0d5x1E2ZpXfnilUq2dIS7tM~tKHK7IibGcA7eRbKwsgWDe5S8DP5S4TalA9C9uumOPhaLY-N0pzAVAL2Xe76nvWmeEL7Bmb2V2S60p3tDsmy9wQLrtnxIkP8iXu9vXgs9zsNmCobGhmwiJ3rCDcXpUA0tYUFeN7hzY~ADJ0OHZOB4~1kjyJlAm0cUslOoWEyHYkjlrxRMbbl7jgO49URyjQPEjwoH0a36GgzLWkeeUg__&Key-Pair-Id=K344F5VVSSM536)\n\n## Halad√°sk√∂vet√©s √©s jutalmaz√°s\n\n### Pontgy≈±jt√©s\n\nTanul√°si aktivit√°sok√©rt\n\n### Badge-ek\n\nTeljes√≠tm√©ny√©rt √©s m√©rf√∂ldk√∂vek√©rt\n\n### Val√≥sidej≈± grafikonok\n\nHalad√°s vizualiz√°ci√≥ja\n\nA halad√°sk√∂vet√©s √©s jutalmaz√°s rendszer kulcsfontoss√°g√∫ a tanul√≥i motiv√°ci√≥ fenntart√°s√°ban. A platform j√°t√©kos√≠t√°si elemeket haszn√°l, hogy a tanul√°s folyamatosan √©rdekes √©s jutalmaz√≥ √©lm√©ny maradjon. A pontgy≈±jt√©si rendszer a tanul√°si aktivit√°sokat (mint p√©ld√°ul a modulok befejez√©se, extra feladatok megold√°sa, rendszeres bejelentkez√©s) √©rt√©kes pontokkal jutalmazza. A megszerzett badge-ek (jelv√©nyek) az el√©rt eredm√©nyeket √©s m√©rf√∂ldk√∂veket jelzik, √©s b√ºszkes√©ggel t√∂lthetik el a tanul√≥t. A val√≥s idej≈± grafikonok pedig √°tl√°that√≥ vizu√°lis visszajelz√©st adnak a halad√°sr√≥l, seg√≠tve azonos√≠tani az er≈ëss√©geket √©s a fejlesztend≈ë ter√ºleteket. Ez az adatvez√©relt megk√∂zel√≠t√©s nemcsak motiv√°lja a tanul√≥t, hanem lehet≈ëv√© teszi a tudatos tervez√©st √©s az eredm√©nyek k√∂vet√©s√©t is.\n\n7/9\n\n## AI-alap√∫ vizsg√°ztat√°s\n\n![Online vizsga UI](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/088921c5-258f-4220-8e59-a0d5e3867aa5/197b267205a4e.jpg?Expires=1751052877&Signature=o6h~9~J8UVkxPNgJlIMyi3u2-0G5aR7QijVHMGnVclLVqUhzJnyG7KvCrVebt9ik614DOUEwzn0klrTfiJzKhUpz0jLJeq4UqRA04s35VXYMzN0Qam6c~qwFjVudPZZejrFje8KFvYQ2hXqQDq1z9QRk0hoSsjtsLIpAmHlxtnbHvUd3SRSLgDLB4CMxUx4P2y~Q3H8-C8i-A9F6wov0Hu5NVucqJMR~0stEsbFtLFj9MkfQ-XAy2wpHBFeezqgfZ9vnftr9aUNttRAsk69ZQ3J42Yxk4j6NvFs-vqEdc-YsLaQMTKSYEInkvy9BRrvsaUdpLYu4rziDew2GFM6Qdg__&Key-Pair-Id=K344F5VVSSM536)\n\n### Adapt√≠v teszt\n\nNeh√©zs√©g a tud√°sszinthez igazodik\n\n### Azonnali visszajelz√©s\n\nR√©szletes √©rt√©kel√©s v√°laszokra\n\n### Fejl≈ëd√©si javaslatok\n\nTestreszabott tanul√°si terv\n\nAz AI-alap√∫ vizsg√°ztat√°s rendszer forradalmas√≠tja a hagyom√°nyos √©rt√©kel√©st, mivel val√≥s id≈ëben alkalmazkodik a tanul√≥ tud√°sszintj√©hez. A k√©perny≈ëk√©pen l√°that√≥ modern, letisztult felhaszn√°l√≥i fel√ºlet biztos√≠tja a stresszmentes vizsgak√∂rnyezetet. Az adapt√≠v tesztel√©si technol√≥gia dinamikusan v√°ltoztatja a k√©rd√©sek neh√©zs√©gi szintj√©t a kor√°bbi v√°laszok alapj√°n, √≠gy pontosabb k√©pet ad a tanul√≥ val√≥di tud√°s√°r√≥l. Az azonnali visszajelz√©s funkci√≥ azonnal magyar√°zatot ad a helyes √©s helytelen v√°laszokra, √≠gy a vizsga maga is tanul√°si lehet≈ës√©gg√© v√°lik. A rendszer a vizsga ut√°n szem√©lyre szabott fejl≈ëd√©si javaslatokat k√©sz√≠t, amelyek c√©lzottan az azonos√≠tott gyenges√©gek fejleszt√©s√©re koncentr√°lnak, √©s konkr√©t tananyagokat aj√°nlanak a hi√°nyoss√°gok p√≥tl√°s√°ra.\n\n8/9\n\n## Felhaszn√°l√≥bar√°t fel√ºlet\n\n![Responsive devices](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/c6561610-f8f2-403b-8974-1ef315887fa9/197b26731f721.jpg?Expires=1751052877&Signature=Xh6b-RwKmlK0sXo526K71lvnXzXyNX~HSIzKBs7nE-2QNcNpI7hAeAomPy9g3kZYHjBwCKInuu0xOeL79IgiUt9W0vWJBm80jENVwxmLpyPr0TCWQxqmW5k46MiNNybGDRpDbgkyx-t6E75MBnzI1Kgcm2mHL6QVMOMefwh6boz1zyHZ-aC7mhkCAFMw4k62YFb656~~M9gDXBdP92YcalV44WQGg6oy4QAP7o43nygTu9MhG-ga3LBMyek7HKU-1uGD9Vh~AIaHbdPG99L9cuRPvCIYv5o7kzOZ9OQ87SzkvwsIif2ME5nAXdTNWGVkEi~dPz5VQ43iCzf6naYvUQ__&Key-Pair-Id=K344F5VVSSM536)\n\n### Mobil\n\n### Tablet\n\n### Asztali\n\n### K√©perny≈ëolvas√≥ t√°mogat√°s\n\nA felhaszn√°l√≥bar√°t fel√ºlet a platform egyik alapvet≈ë tervez√©si elve, amely biztos√≠tja, hogy a tanul√°si √©lm√©ny minden eszk√∂z√∂n optim√°lis legyen. A reszponz√≠v diz√°jnnak k√∂sz√∂nhet≈ëen a fel√ºlet automatikusan alkalmazkodik a k√©perny≈ëm√©rethez, legyen sz√≥ okostelefonr√≥l, tabletr≈ël vagy asztali sz√°m√≠t√≥g√©pr≈ël. A mobil verzi√≥ kifejezetten a gyors, √∫tk√∂zbeni tanul√°sra optimaliz√°lt, m√≠g az asztali v√°ltozat r√©szletesebb tartalmakat √©s jobb √°ttekinthet≈ës√©get k√≠n√°l. A platform teljes m√©rt√©kben t√°mogatja az akad√°lymentes√≠t√©si szabv√°nyokat, bele√©rtve a k√©perny≈ëolvas√≥ technol√≥gi√°kat is, √≠gy minden felhaszn√°l√≥ sz√°m√°ra egyenl≈ë hozz√°f√©r√©st biztos√≠t. A k√ºl√∂nb√∂z≈ë eszk√∂z√∂k k√∂z√∂tti z√∂kken≈ëmentes v√°lt√°s lehet≈ëv√© teszi, hogy a tanul√≥k b√°rhol, b√°rmikor folytathass√°k a tanul√°st pontosan onnan, ahol abbahagyt√°k.\n\n9/9\n\n## Kezd√©s l√©p√©sei\n\n![Onboarding flow](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/b78c7972-99ca-49c7-97b9-1dc41c0acfdc/197b2673ff0f3.jpg?Expires=1751052877&Signature=Il4e08bacq89H90amo3Yksd6gE0zQ1h1jFl-EQ7WXPs4Lk0LjG5niw1ohPN9TDce67VlBOBBQgdDQb-KDAviZtNCeyLr1dpWZp7Nv1FA9Xl41d1Eo4oh-h4dtWMhAApy5BeUZTG~eoNvNFACazZmCqjJC7ZjmKnikhFQt4GlcpDQcwZnPmRp0fMzr8ELOPrKZeOEDrcvIGtV1aRhB0VpVdSAggHrmB37LU7uluvhmhlXUSr3QZz5I1jKAhpHi61KQJltl82pSHNwj27zOgmb7uPLMyzGrVzAlMiyIK6Ec4LtqI9Fhr3tNyZbQDmpr3XDMIO3H04UYO9mN46h3ZumAg__&Key-Pair-Id=K344F5VVSSM536)\n\n1\n\n### Regisztr√°ci√≥\n\n2\n\n### Szakma kiv√°laszt√°sa\n\n3\n\n### Ingyenes kezd≈ëmodul\n\n[Kezdj bele most!](https://www.sidercontent.com/html-editor/index.html#)\n\nA platformhoz val√≥ csatlakoz√°s egyszer≈± √©s gyors folyamat, mind√∂ssze h√°rom l√©p√©sb≈ël √°ll. El≈ësz√∂r a felhaszn√°l√≥ regisztr√°l, l√©trehozva szem√©lyes profilj√°t, amely k√©s≈ëbb az AI-szem√©lyre szab√°s alapja lesz. A m√°sodik l√©p√©sben a rendszer seg√≠t kiv√°lasztani a megfelel≈ë szakm√°t, figyelembe v√©ve az √©rdekl≈ëd√©si k√∂rt, kor√°bbi tapasztalatokat √©s karrierc√©lokat. Az AI-alap√∫ szakmav√°laszt√°si seg√©d konkr√©t aj√°nl√°sokat tesz a legmegfelel≈ëbb k√©pz√©si ir√°nyokra. V√©g√ºl a harmadik l√©p√©sben a felhaszn√°l√≥ azonnal hozz√°f√©rhet egy ingyenes kezd≈ëmodulhoz, amely betekint√©st ny√∫jt a kiv√°lasztott szakma alapjaiba √©s a platform m≈±k√∂d√©s√©be. Ez a folyamat biztos√≠tja, hogy minden √∫j felhaszn√°l√≥ gyorsan √©s z√∂kken≈ëmentesen kezdhesse el tanul√°si √∫tj√°t, √©s azonnal megtapasztalhassa a platform el≈ënyeit.\n\n# AI Szakk√©pz√©si Platform\n\n## A j√∂v≈ë szakk√©pz√©se, szem√©lyre szabva\n\nAI-vez√©relt tanul√°si √©lm√©ny, amely √ñn k√∂r√© √©p√ºl.\n\n## A platform √°ttekint√©se\n\n### AI-alap√∫ szem√©lyre szab√°s\n\n### 60+ szakma egy helyen\n\n### Rugalmas, saj√°t temp√≥j√∫ tanul√°s\n\n$5,88 mrd ‚Üí 31,2% CAGR\n\nAI in Education piac, 2024 ‚Äì Boterview 2025\n\n86%\n\ndi√°k m√°r haszn√°l AI-t tanul√°shoz (Campus Technology, 2024)\n\n![E-learning dashboard](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/759fe3bb-3be7-4b32-8452-2d8b6e1e0c4e/197b266c042e4.jpg?Expires=1751052877&Signature=HPTZhhymYYiZj~9z8lpdtJz-bQ7enxajgzwHMnT6AeEI6uBjcbuS9L-8GhYuiPDJFHTrTGn~C6-mBWKhdu6x5jr0xgBjEMzvAsmDfY0eTDa6iabdNkhP4DotPyHtrczsIYe6AabWWEW5W88wa3oNidUIw2j~v34peyo1Nnil6xBpd2Xz1XdrB2dNmOJbSVacdxKRz7I50Dv57NrNDh8YWoCvMLEvr41OQX472o~5eZhMnu41kfvF~z~CS5eIHjsvKGCMiWcvKpPNiQ96EeP0Z9xfdktKXgKvfTBc2bZHtbfVjGRraLcJ~V3aifJJeG3-MtUV-snw3sJ2WjoJBLWCLw__&Key-Pair-Id=K344F5VVSSM536)\n\n![Modul√°ris blokkdiagram](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/2ad7f36d-de98-4b04-93fe-31b2d7ad8e94/197b266cdcc6e.jpg?Expires=1751052877&Signature=T-j38Ez0PKVnVS2ulguxC7HPe-AqBR59c3jsfobLJCA~SngRtI3LkcSFLCv6NMoQi0AtK59TZfg-doEmzP~VhNBWq-bTCTOq4uwdU-5ZksP0KiSXtmDlt0RncJtGjiwHBWQrlB8Xzg1sjacK7I29HrqK0SF8Oq26DH4yTWnYfw-HLpN7YI~B8s-iGkZoBYxCODRdHQUfuVV8~NUsxm4GCml~MfSFgrXiDxY15ecqhKuoRJN~FkEfMFO9vSLRf1KsZh8AFN-eBMWmG4K2VUUjotQCtMBIzQ02DxmTAS3U5TYkizXoGanoOBkAU3SRovx2t5eSNxzKffC4WinuQkcQzg__&Key-Pair-Id=K344F5VVSSM536)\n\n## Modul√°ris tananyagszerkezet\n\n### Blokkszer≈± rugalmass√°g\n\nSzabadon vari√°lhat√≥ tananyag modulok\n\n### T√∂m√∂r vs. r√©szletes tartalom\n\nIg√©ny szerinti m√©lys√©g≈± anyagok\n\n### AI-javasolt √∫tvonalak\n\nSzem√©lyre szabott tanul√°si terv\n\n## Multim√©di√°s tanul√°si √©lm√©ny\n\n![Multim√©dia ikonok](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/0edfaa89-8431-4574-9828-6968a916fc60/197b266e2a521.jpg?Expires=1751052877&Signature=OmeVv2LQEE5qlRJkFUtNxxmVh6tBBLVgNdVzb4Uv9eHU9aDeFga3W1gLqG0qDJNBJHhKK3hXmBi9pNNzYPvYFtVgty9Ox0en6WwbJkFCs~sWOHuTwI3ksrkuT2WOpR6OKes8azrC7Go5J1kxw46SxRUBji5lefNqMc4TcPQ1LIvZYcTJioQyOYAKe8ieLSGc~bbyswUwiwQ8lKmx8EtT72ke~g2n-AAqWENEwTn9QqK2G0cNOZDBAn9I1Uq69j7uBq7nRUS6feJ38U9FdrRpRtH-HisUQtd~4dLOB0rq-JZWbuYJ57e5Gpzbp5wNqg2TkdXLPYpMsOxpXQkLztcv0g__&Key-Pair-Id=K344F5VVSSM536)\n\n### Sz√∂veg\n\n### Vide√≥\n\n### Podcast\n\n### K√©pek\n\nV√°lassza ki a tanul√°si st√≠lus√°nak megfelel≈ë form√°tumot: minden anyag el√©rhet≈ë t√∂bbf√©le m√©diat√≠pusban.\n\n![AI asszisztens](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/029c97de-bb6c-4388-a316-7760854b8c7f/197b267045d7d.jpg?Expires=1751052877&Signature=nZf5MEeI7sH2afFxinrk~OI6usfd7beqhhHdgDAgngNnx4znZoH-Lsnpp6dpdPEU1TinNddn2UyuQGRiL7uvzK4EID0pS8pQYV~~d4XPRLiUYd4~i~bNDIgK2hcdQ4poZlm-L4-RAN7--2dfxMFrzb-P7RwiF0IB-DD2~9doOxvqVdnylN0fLugxSXEOcuFBCD2K4zpxHqcLeferkpMIgUKdIpvDCpfsvL6tV90d2OU5eBQ2m4FUUjYE-NQCsiOUlLA3Iwi~NWg6iYw5x-iDjHPDD~PPPV6vOR0~M3wuW2RLiOkeLcL8y5zO9L0IgHez0GwPL~K3-7VHM-3x-RoX2Q__&Key-Pair-Id=K344F5VVSSM536)\n\n## AI-asszisztens funkci√≥\n\n### Szem√©lyre szabott magyar√°zat\n\n### Azonnali Q&A\n\n### Adapt√≠v tartalom\n\n![Gamified dashboard](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/319bbc32-9191-4390-ab67-d46716c5cb5d/197b2671146f1.jpg?Expires=1751052877&Signature=CONP6su651fKli4Be4h0rP3dEPvRCneom0L6mVwDIG0I0b9lX7eEkRgxIXSdruORIzpZyQwJTP0JGi3W7-7GPdnu1F087XQEqkD9FG9ZPjM0d5x1E2ZpXfnilUq2dIS7tM~tKHK7IibGcA7eRbKwsgWDe5S8DP5S4TalA9C9uumOPhaLY-N0pzAVAL2Xe76nvWmeEL7Bmb2V2S60p3tDsmy9wQLrtnxIkP8iXu9vXgs9zsNmCobGhmwiJ3rCDcXpUA0tYUFeN7hzY~ADJ0OHZOB4~1kjyJlAm0cUslOoWEyHYkjlrxRMbbl7jgO49URyjQPEjwoH0a36GgzLWkeeUg__&Key-Pair-Id=K344F5VVSSM536)\n\n## Halad√°sk√∂vet√©s √©s jutalmaz√°s\n\n### Pontgy≈±jt√©s\n\nTanul√°si aktivit√°sok√©rt\n\n### Badge-ek\n\nTeljes√≠tm√©ny√©rt √©s m√©rf√∂ldk√∂vek√©rt\n\n### Val√≥sidej≈± grafikonok\n\nHalad√°s vizualiz√°ci√≥ja\n\n## AI-alap√∫ vizsg√°ztat√°s\n\n![Online vizsga UI](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/088921c5-258f-4220-8e59-a0d5e3867aa5/197b267205a4e.jpg?Expires=1751052877&Signature=o6h~9~J8UVkxPNgJlIMyi3u2-0G5aR7QijVHMGnVclLVqUhzJnyG7KvCrVebt9ik614DOUEwzn0klrTfiJzKhUpz0jLJeq4UqRA04s35VXYMzN0Qam6c~qwFjVudPZZejrFje8KFvYQ2hXqQDq1z9QRk0hoSsjtsLIpAmHlxtnbHvUd3SRSLgDLB4CMxUx4P2y~Q3H8-C8i-A9F6wov0Hu5NVucqJMR~0stEsbFtLFj9MkfQ-XAy2wpHBFeezqgfZ9vnftr9aUNttRAsk69ZQ3J42Yxk4j6NvFs-vqEdc-YsLaQMTKSYEInkvy9BRrvsaUdpLYu4rziDew2GFM6Qdg__&Key-Pair-Id=K344F5VVSSM536)\n\n### Adapt√≠v teszt\n\nNeh√©zs√©g a tud√°sszinthez igazodik\n\n### Azonnali visszajelz√©s\n\nR√©szletes √©rt√©kel√©s v√°laszokra\n\n### Fejl≈ëd√©si javaslatok\n\nTestreszabott tanul√°si terv\n\n## Felhaszn√°l√≥bar√°t fel√ºlet\n\n![Responsive devices](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/c6561610-f8f2-403b-8974-1ef315887fa9/197b26731f721.jpg?Expires=1751052877&Signature=Xh6b-RwKmlK0sXo526K71lvnXzXyNX~HSIzKBs7nE-2QNcNpI7hAeAomPy9g3kZYHjBwCKInuu0xOeL79IgiUt9W0vWJBm80jENVwxmLpyPr0TCWQxqmW5k46MiNNybGDRpDbgkyx-t6E75MBnzI1Kgcm2mHL6QVMOMefwh6boz1zyHZ-aC7mhkCAFMw4k62YFb656~~M9gDXBdP92YcalV44WQGg6oy4QAP7o43nygTu9MhG-ga3LBMyek7HKU-1uGD9Vh~AIaHbdPG99L9cuRPvCIYv5o7kzOZ9OQ87SzkvwsIif2ME5nAXdTNWGVkEi~dPz5VQ43iCzf6naYvUQ__&Key-Pair-Id=K344F5VVSSM536)\n\n### Mobil\n\n### Tablet\n\n### Asztali\n\n### K√©perny≈ëolvas√≥ t√°mogat√°s\n\n## Kezd√©s l√©p√©sei\n\n![Onboarding flow](https://file-cdn.sider.ai/u/U0Y3HG4ZEVV/file/b78c7972-99ca-49c7-97b9-1dc41c0acfdc/197b2673ff0f3.jpg?Expires=1751052877&Signature=Il4e08bacq89H90amo3Yksd6gE0zQ1h1jFl-EQ7WXPs4Lk0LjG5niw1ohPN9TDce67VlBOBBQgdDQb-KDAviZtNCeyLr1dpWZp7Nv1FA9Xl41d1Eo4oh-h4dtWMhAApy5BeUZTG~eoNvNFACazZmCqjJC7ZjmKnikhFQt4GlcpDQcwZnPmRp0fMzr8ELOPrKZeOEDrcvIGtV1aRhB0VpVdSAggHrmB37LU7uluvhmhlXUSr3QZz5I1jKAhpHi61KQJltl82pSHNwj27zOgmb7uPLMyzGrVzAlMiyIK6Ec4LtqI9Fhr3tNyZbQDmpr3XDMIO3H04UYO9mN46h3ZumAg__&Key-Pair-Id=K344F5VVSSM536)\n\n1\n\n### Regisztr√°ci√≥\n\n2\n\n### Szakma kiv√°laszt√°sa\n\n3\n\n### Ingyenes kezd≈ëmodul\n\n[Kezdj bele most!](https://www.sidercontent.com/html-editor/index.html#)","size_bytes":19064},"server/ai-queue-manager.ts":{"content":"/**\n * AI Queue Manager - Manages concurrent AI operations to prevent overload\n */\n\ninterface QueueItem {\n  id: string;\n  moduleId: number;\n  title: string;\n  content: string;\n  subjectId: string;\n  subjectName?: string;\n  professionName?: string;\n  moduleNumber?: number;\n  customSystemMessage?: string;\n  timestamp: number;\n  resolve: (result: any) => void;\n  reject: (error: any) => void;\n}\n\nexport class AIQueueManager {\n  private queue: QueueItem[] = [];\n  private processing: Set<string> = new Set();\n  private maxConcurrent = 1; // Process only one module at a time to prevent overload\n  private processingInterval: NodeJS.Timeout | null = null;\n  private queueFilePath = './ai_queue_backup.json';\n\n  constructor() {\n    this.loadQueueFromDisk();\n    this.startProcessing();\n    this.setupGracefulShutdown();\n  }\n\n  /**\n   * Load queue from disk on startup\n   */\n  private loadQueueFromDisk() {\n    try {\n      import('fs').then(fs => {\n        if (fs.existsSync(this.queueFilePath)) {\n          const data = fs.readFileSync(this.queueFilePath, 'utf8');\n          const savedQueue = JSON.parse(data);\n          // Restore queue items but create new promises\n          this.queue = savedQueue.map((item: any) => ({\n            ...item,\n            resolve: () => {}, // Will be handled when reprocessed\n            reject: () => {}   // Will be handled when reprocessed\n          }));\n          console.log(`Restored ${this.queue.length} items from queue backup`);\n          // Clean up the backup file\n          fs.unlinkSync(this.queueFilePath);\n        }\n      }).catch(error => {\n        console.error('Error loading fs module:', error);\n      });\n    } catch (error) {\n      console.error('Error loading queue from disk:', error);\n    }\n  }\n\n  /**\n   * Save queue to disk\n   */\n  private async saveQueueToDisk() {\n    try {\n      const fs = await import('fs');\n      const queueData = this.queue.map(item => ({\n        id: item.id,\n        moduleId: item.moduleId,\n        title: item.title,\n        content: item.content,\n        subjectId: item.subjectId,\n        customSystemMessage: item.customSystemMessage,\n        timestamp: item.timestamp\n      }));\n      fs.writeFileSync(this.queueFilePath, JSON.stringify(queueData, null, 2));\n    } catch (error) {\n      console.error('Error saving queue to disk:', error);\n    }\n  }\n\n  /**\n   * Setup graceful shutdown to save queue\n   */\n  private setupGracefulShutdown() {\n    const saveAndExit = async () => {\n      console.log('Saving AI queue before shutdown...');\n      await this.saveQueueToDisk();\n      process.exit(0);\n    };\n\n    process.on('SIGINT', saveAndExit);\n    process.on('SIGTERM', saveAndExit);\n    process.on('exit', () => {\n      // Synchronous save on exit\n      try {\n        import('fs').then(fs => {\n          const queueData = this.queue.map(item => ({\n            id: item.id,\n            moduleId: item.moduleId,\n            title: item.title,\n            content: item.content,\n            subjectId: item.subjectId,\n            customSystemMessage: item.customSystemMessage,\n            timestamp: item.timestamp\n          }));\n          fs.writeFileSync(this.queueFilePath, JSON.stringify(queueData, null, 2));\n        });\n      } catch (error) {\n        console.error('Error saving queue on exit:', error);\n      }\n    });\n  }\n\n  /**\n   * Add AI regeneration task to queue\n   */\n  async queueAIRegeneration(\n    moduleId: number,\n    title: string,\n    content: string,\n    subjectId: string,\n    customSystemMessage?: string,\n    subjectName?: string,\n    professionName?: string,\n    moduleNumber?: number\n  ): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const id = `ai-regen-${moduleId}-${Date.now()}`;\n      \n      const queueItem: QueueItem = {\n        id,\n        moduleId,\n        title,\n        content,\n        subjectId,\n        subjectName,\n        professionName,\n        moduleNumber,\n        customSystemMessage,\n        timestamp: Date.now(),\n        resolve,\n        reject\n      };\n\n      this.queue.push(queueItem);\n      console.log(`üìù Added to AI queue: \"${title}\" (Position: ${this.queue.length}, Total queued: ${this.queue.length})`);\n    });\n  }\n\n  /**\n   * Get queue status\n   */\n  getQueueStatus() {\n    return {\n      queueSize: this.queue.length,\n      processing: this.processing.size,\n      maxConcurrent: this.maxConcurrent,\n      items: this.queue.map(item => ({\n        id: item.id,\n        moduleId: item.moduleId,\n        title: item.title,\n        timestamp: item.timestamp\n      }))\n    };\n  }\n\n  /**\n   * Start processing queue\n   */\n  private startProcessing() {\n    if (this.processingInterval) {\n      clearInterval(this.processingInterval);\n    }\n\n    this.processingInterval = setInterval(() => {\n      this.processNext();\n    }, 2000); // Check every 2 seconds\n  }\n\n  /**\n   * Process next item in queue\n   */\n  private async processNext() {\n    if (this.processing.size >= this.maxConcurrent || this.queue.length === 0) {\n      return;\n    }\n\n    const item = this.queue.shift();\n    if (!item) return;\n\n    this.processing.add(item.id);\n    const remainingCount = this.queue.length;\n    console.log(`üîÑ Processing AI task: \"${item.title}\" - Starting 4-step enhancement process... (${remainingCount} remaining in queue)`);\n\n    // Process the item WITHOUT async/await to prevent parallel processing\n    this.performAIGeneration(item)\n      .then(result => {\n        console.log(`‚úÖ Completed AI task: \"${item.title}\" (${this.queue.length} remaining in queue)`);\n        item.resolve(result);\n        this.processing.delete(item.id);\n      })\n      .catch(error => {\n        console.error(`‚ùå AI generation failed for \"${item.title}\":`, error);\n        item.reject(error);\n        this.processing.delete(item.id);\n      });\n  }\n\n  /**\n   * Perform the actual AI generation\n   */\n  private async performAIGeneration(item: QueueItem): Promise<any> {\n    const { storage } = await import('./storage');\n    \n    try {\n      // Build comprehensive context with all available information\n      let fullContext = '';\n      \n      if (item.professionName && item.subjectName) {\n        // Use already provided context from queue\n        fullContext = `Szakma: ${item.professionName} | Tant√°rgy: ${item.subjectName}`;\n        if (item.moduleNumber) {\n          fullContext += ` | ${item.moduleNumber}. modul`;\n        }\n      } else {\n        // Fallback: fetch context from database\n        const subject = await storage.getSubject(parseInt(item.subjectId));\n        if (subject) {\n          const profession = await storage.getProfession(subject.professionId);\n          fullContext = `Szakma: ${profession?.name || 'Ismeretlen'} | Tant√°rgy: ${subject.name}`;\n        }\n      }\n      \n      // Enhanced context message that includes module metadata\n      const contextualSystemMessage = item.customSystemMessage ? \n        `${item.customSystemMessage}\\n\\nKONTEXTUS: ${fullContext}` : \n        `Friss√≠tsd a k√∂vetkez≈ë tananyag modult. KONTEXTUS: ${fullContext}`;\n      \n      // Generate enhanced content with full context and custom system message\n      const { enhancedModuleGenerator } = await import('./enhanced-module-generator');\n      \n      // Record AI generation start for cost tracking\n      await this.recordAIGenerationCost('openai', 'module_generation', 0.05);\n      \n      const enhancedContent = await enhancedModuleGenerator.generateEnhancedModule(\n        item.title,\n        item.content,\n        fullContext,\n        contextualSystemMessage,\n        item.subjectName,\n        item.professionName\n      );\n      \n      // Record additional costs for web search and YouTube API calls\n      await this.recordAIGenerationCost('dataseo', 'web_search', 0.02);\n      await this.recordAIGenerationCost('youtube', 'video_search', 0.01);\n\n      // Apply automatic Mermaid SVG conversion to all content versions\n      const enhancedModuleGeneratorModule = await import('./enhanced-module-generator');\n      const moduleGenerator = enhancedModuleGeneratorModule.enhancedModuleGenerator;\n      \n      let finalContent = enhancedContent.detailedVersion || enhancedContent.conciseVersion || item.content;\n      let finalConciseContent = enhancedContent.conciseVersion || null;\n      let finalDetailedContent = enhancedContent.detailedVersion || null;\n      \n      // Convert Mermaid diagrams to SVG images in all content versions\n      if (finalContent.includes('```mermaid')) {\n        console.log('Converting Mermaid diagrams to SVG images...');\n        finalContent = await moduleGenerator.convertMermaidToSVGImages(finalContent);\n      }\n      \n      if (finalConciseContent && finalConciseContent.includes('```mermaid')) {\n        finalConciseContent = await moduleGenerator.convertMermaidToSVGImages(finalConciseContent);\n      }\n      \n      if (finalDetailedContent && finalDetailedContent.includes('```mermaid')) {\n        finalDetailedContent = await moduleGenerator.convertMermaidToSVGImages(finalDetailedContent);\n      }\n\n      // DEBUG: Check bold links before database update\n      const contentLinkCount = (finalContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n      const conciseLinkCount = finalConciseContent ? (finalConciseContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length : 0;\n      const detailedLinkCount = finalDetailedContent ? (finalDetailedContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length : 0;\n      \n      console.log(`üîó QUEUE DEBUG: Before DB update - Content has ${contentLinkCount} bold links`);\n      console.log(`üîó QUEUE DEBUG: Before DB update - Concise has ${conciseLinkCount} bold links`);\n      console.log(`üîó QUEUE DEBUG: Before DB update - Detailed has ${detailedLinkCount} bold links`);\n\n      // Update module with AI enhanced content and converted SVG images\n      const updateData = {\n        content: finalContent,\n        conciseContent: finalConciseContent,\n        detailedContent: finalDetailedContent,\n        keyConceptsData: enhancedContent.keyConceptsWithVideos || null,\n        isPublished: true\n      };\n\n      const updatedModule = await storage.updateModule(item.moduleId, updateData);\n      \n      // DEBUG: Check if links survived database update\n      const dbContentLinkCount = updatedModule.content ? (updatedModule.content.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length : 0;\n      const dbConciseLinkCount = updatedModule.conciseContent ? (updatedModule.conciseContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length : 0;\n      const dbDetailedLinkCount = updatedModule.detailedContent ? (updatedModule.detailedContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length : 0;\n      \n      console.log(`üîó QUEUE DEBUG: After DB update - Content has ${dbContentLinkCount} bold links`);\n      console.log(`üîó QUEUE DEBUG: After DB update - Concise has ${dbConciseLinkCount} bold links`);\n      console.log(`üîó QUEUE DEBUG: After DB update - Detailed has ${dbDetailedLinkCount} bold links`);\n      \n      console.log(`Successfully completed AI generation for module ${item.moduleId}`);\n      \n      return {\n        success: true,\n        module: updatedModule,\n        message: 'Modul sikeresen √∫jragener√°lva'\n      };\n\n    } catch (enhancementError) {\n      console.error(`Enhancement error for module ${item.moduleId}:`, enhancementError);\n      \n      // Fallback: just mark as published without enhancement\n      const fallbackUpdate = { isPublished: true };\n      const updatedModule = await storage.updateModule(item.moduleId, fallbackUpdate);\n      \n      return {\n        success: true,\n        module: updatedModule,\n        message: 'Modul publik√°lva (AI fejleszt√©s sikertelen)',\n        warning: 'AI fejleszt√©s nem siker√ºlt, eredeti tartalom megtartva'\n      };\n    }\n  }\n\n  /**\n   * Record AI generation cost for tracking\n   */\n  private async recordAIGenerationCost(provider: string, service: string, estimatedCost: number): Promise<void> {\n    try {\n      const { storage } = await import('./storage');\n      if (storage.recordSimpleApiCall) {\n        await storage.recordSimpleApiCall(provider, service, estimatedCost);\n      }\n    } catch (error) {\n      console.error('Cost tracking failed (non-critical):', error);\n    }\n  }\n\n  /**\n   * Clear queue and stop processing\n   */\n  shutdown() {\n    if (this.processingInterval) {\n      clearInterval(this.processingInterval);\n      this.processingInterval = null;\n    }\n    \n    // Reject all pending items\n    this.queue.forEach(item => {\n      item.reject(new Error('Queue shutdown'));\n    });\n    \n    this.queue = [];\n    this.processing.clear();\n  }\n}\n\n// Singleton instance\nexport const aiQueueManager = new AIQueueManager();","size_bytes":12681},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\n// Configure Neon for serverless environments\nneonConfig.webSocketConstructor = ws;\nneonConfig.useSecureWebSocket = true;\nneonConfig.pipelineConnect = false;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ \n  connectionString: process.env.DATABASE_URL,\n  max: 10, // Reduced connection pool size\n  idleTimeoutMillis: 20000,\n  connectionTimeoutMillis: 5000,\n  maxUses: Infinity, // Allow unlimited uses per connection\n  allowExitOnIdle: false, // Don't let the pool exit when idle\n});\n\n// Add error handling for the pool to prevent crashes\npool.on('error', (err) => {\n  console.error('Database pool error:', err);\n  // Don't throw the error, just log it to prevent app crashes\n});\n\n// Add connection error handling\npool.on('connect', (client) => {\n  console.log('Database client connected');\n  client.on('error', (err) => {\n    console.error('Database client error:', err);\n    // Handle individual client errors gracefully\n  });\n});\n\n// Handle process-level unhandled errors related to database\nprocess.on('uncaughtException', (error) => {\n  if (error.message.includes('terminating connection due to administrator command') ||\n      error.message.includes('connection terminated') ||\n      error.message.includes('Client has encountered a connection error')) {\n    console.error('Database connection error handled gracefully:', error.message);\n    // Don't exit the process for database connection errors\n    return;\n  }\n  // For other uncaught exceptions, still exit\n  console.error('Uncaught Exception:', error);\n  process.exit(1);\n});\n\nprocess.on('unhandledRejection', (reason, promise) => {\n  if (reason && typeof reason === 'object' && 'message' in reason) {\n    const message = (reason as any).message;\n    if (message.includes('terminating connection due to administrator command') ||\n        message.includes('connection terminated') ||\n        message.includes('Client has encountered a connection error')) {\n      console.error('Database rejection handled gracefully:', message);\n      return;\n    }\n  }\n  console.error('Unhandled Rejection at:', promise, 'reason:', reason);\n});\n\nexport const db = drizzle({ client: pool, schema });","size_bytes":2440},"server/enhanced-module-generator.ts":{"content":"import { storage } from './storage';\nimport { multiApiService } from './multiApiService';\nimport { generateChatResponse } from './openai';\nimport { writeFileSync, existsSync, mkdirSync } from 'fs';\nimport { join } from 'path';\n\nexport interface EnhancedModuleContent {\n  conciseVersion: string;\n  detailedVersion: string;\n  keyConceptsWithVideos: Array<{\n    concept: string;\n    definition: string;\n    youtubeVideos: Array<{\n      title: string;\n      videoId: string;\n      description: string;\n      url: string;\n    }>;\n    wikipediaLinks?: Array<{\n      text: string;\n      url: string;\n      description?: string;\n    }>;\n  }>;\n}\n\nexport class EnhancedModuleGenerator {\n  private youtubeCache: Map<string, any[]> = new Map();\n  private lastYouTubeCall: number = 0;\n  private readonly YOUTUBE_RATE_LIMIT = 1000; // 1 second between calls\n  \n  // Performance optimization settings\n  private async getOptimizationSettings() {\n    const setting = await storage.getSystemSetting('ai-generation-mode');\n    const mode = setting?.value || 'balanced';\n    \n    switch (mode) {\n      case 'fast':\n        return {\n          maxBoldKeywords: 2,\n          boldKeywordDelay: 300,\n          enableWebSearch: false,\n          enableBoldLinking: true,\n          parallelProcessing: true\n        };\n      case 'quality':\n        return {\n          maxBoldKeywords: 5,\n          boldKeywordDelay: 1500,\n          enableWebSearch: true,\n          enableBoldLinking: true,\n          parallelProcessing: false\n        };\n      default: // balanced\n        return {\n          maxBoldKeywords: 3,\n          boldKeywordDelay: 500,\n          enableWebSearch: true,\n          enableBoldLinking: true,\n          parallelProcessing: true\n        };\n    }\n  }\n\n  /**\n   * Load specialized prompts from database\n   */\n  private async loadPrompts(): Promise<{\n    youtubePrompt: string;\n    wikipediaPrompt: string;\n    internetContentPrompt: string;\n    conciseContentPrompt: string;\n  }> {\n    const [youtubePromptSetting, wikipediaPromptSetting, internetContentPromptSetting, conciseContentPromptSetting] = await Promise.all([\n      storage.getSystemSetting('ai_youtube_prompt'),\n      storage.getSystemSetting('ai_wikipedia_prompt'),\n      storage.getSystemSetting('ai_internet_content_prompt'),\n      storage.getSystemSetting('concise-content-prompt')\n    ]);\n\n    return {\n      youtubePrompt: youtubePromptSetting?.value || 'Gener√°lj 1-2 konkr√©t YouTube keres√©si kifejez√©st a modul legfontosabb fogalmaihoz. F√≥kusz√°lj praktikus, oktat√°si tartalmakra √©s ker√ºld az ism√©tl≈ëd≈ë keres√©seket. Modulc√≠m: {title}, Tartalom: {content}',\n      wikipediaPrompt: wikipediaPromptSetting?.value || 'Azonos√≠tsd a modul legfontosabb szakmai kifejez√©seit √©s fogalmait, amelyekhez Wikipedia linkeket kell hozz√°adni. Csak azokat a kifejez√©seket v√°laszd ki, amelyek val√≥ban fontosak a t√©m√°hoz. Modulc√≠m: {title}, Tartalom: {content}',\n      internetContentPrompt: internetContentPromptSetting?.value || 'Gener√°lj friss√≠tett, r√©szletes tartalmat az internet seg√≠ts√©g√©vel. Haszn√°lj aktu√°lis inform√°ci√≥kat, gyakorlati p√©ld√°kat √©s struktur√°lt fel√©p√≠t√©st. Modulc√≠m: {title}, Eredeti tartalom: {content}',\n      conciseContentPrompt: conciseContentPromptSetting?.value || 'K√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot a k√∂vetkez≈ë c√≠mhez: {title}. Alapanyag: {content}. K√∂vetelm√©nyek: Maximum 300-400 sz√≥, csak a legfontosabb inform√°ci√≥k, egyszer≈± nyelvezet, markdown form√°z√°s.'\n    };\n  }\n  \n  async generateEnhancedModule(\n    title: string,\n    basicContent: string,\n    subjectContext?: string,\n    customSystemMessage?: string,\n    subjectName?: string,\n    professionName?: string\n  ): Promise<EnhancedModuleContent> {\n    const timeout = 300000; // 5 minute timeout\n    \n    return Promise.race([\n      this.performEnhancement(title, basicContent, subjectContext, customSystemMessage, subjectName, professionName),\n      new Promise<EnhancedModuleContent>((_, reject) => \n        setTimeout(() => reject(new Error('Generation timeout after 5 minutes')), timeout)\n      )\n    ]).catch(error => {\n      console.error('Enhanced module generation error:', error);\n      \n      // Return fallback with original content\n      return {\n        conciseVersion: basicContent,\n        detailedVersion: basicContent,\n        keyConceptsWithVideos: []\n      };\n    });\n  }\n\n  private async performEnhancement(\n    title: string,\n    basicContent: string,\n    subjectContext?: string,\n    customSystemMessage?: string,\n    subjectName?: string,\n    professionName?: string\n  ): Promise<EnhancedModuleContent> {\n    // Load specialized prompts from database\n    const prompts = await this.loadPrompts();\n    \n    // SEQUENTIAL PROCESSING - Each step builds on the previous result\n    \n    // Step 1: Generate internet-enhanced detailed content using original content\n    console.log('üî• SEQUENTIAL AI STEP 1: Generating internet-enhanced detailed content...');\n    console.log('üìù Original content length:', basicContent.length);\n    const internetEnhancedDetailed = await this.generateInternetEnhancedContent(title, basicContent, 'detailed', prompts.internetContentPrompt);\n    console.log('‚úÖ STEP 1 COMPLETED - Enhanced detailed content length:', internetEnhancedDetailed.length);\n    \n    // Step 1B: Generate concise version using original content and dedicated prompt\n    console.log('üî• SEQUENTIAL AI STEP 1B: Generating concise version with dedicated prompt...');\n    \n    // Force concise generation with strict length limits\n    const strictConcisePrompt = `\nK√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot maximum 250-300 sz√≥ban:\n\nC√≠m: ${title}\nEredeti tartalom: ${basicContent}\n\nK√ñVETELM√âNYEK:\n- MAXIMUM 250-300 sz√≥\n- Csak a legfontosabb inform√°ci√≥k\n- Egyszer≈±, √©rthet≈ë nyelvezet\n- Markdown form√°z√°s\n- Gyakorlati f√≥kusz\n- NE ism√©teld meg a r√©szletes verzi√≥t\n\nV√°lasz:`;\n    \n    console.log('üìù Strict concise generation started');\n    const conciseResponse = await generateChatResponse(strictConcisePrompt, 'chat');\n    const internetEnhancedConcise = conciseResponse.message.trim();\n    console.log('‚úÖ STEP 1B COMPLETED - Concise content length:', internetEnhancedConcise.length);\n    \n    // Use the full concise content without truncation\n    let finalConciseContent = internetEnhancedConcise;\n    console.log('üìù Using full concise content without character limits');\n    \n    // Step 2: Add relevant web search results to the internet-enhanced content\n    console.log('üî• SEQUENTIAL AI STEP 2: Adding relevant web search results to enhanced content...');\n    \n    // Detect professional field once and use consistently\n    const detectedField = this.detectProfessionalField(title, internetEnhancedDetailed, subjectName, professionName);\n    console.log(`üéØ Detected field for web search: ${detectedField}`);\n    \n    // Step 2A: Add web search content first\n    console.log('üîó STEP 2A: Adding web search content...');\n    const webEnhancedConcise = await this.addWebSearchContent(finalConciseContent, title, detectedField);\n    const webEnhancedDetailed = await this.addWebSearchContent(internetEnhancedDetailed, title, detectedField);\n    \n    console.log('‚úÖ STEP 2A COMPLETED - Web search content integrated');\n    \n    // Step 2B: Link bold keywords AFTER web content integration\n    console.log('üîó STEP 2B: Linking bold keywords with web sources...');\n    console.log('üîç STEP 2B DEBUG: About to process concise content for bold linking...');\n    const boldLinkedConcise = await this.linkBoldKeywordsSimplified(webEnhancedConcise, title);\n    console.log('üîç STEP 2B DEBUG: About to process detailed content for bold linking...');\n    const boldLinkedDetailed = await this.linkBoldKeywordsSimplified(webEnhancedDetailed, title);\n    \n    console.log('‚úÖ STEP 2B COMPLETED - Bold keywords linked');\n    console.log('üìã Concise content after bold linking:', boldLinkedConcise.substring(0, 200) + '...');\n    console.log('üìã Detailed content after bold linking:', boldLinkedDetailed.substring(0, 200) + '...');\n    \n    // DEBUG: Check if bold links are actually present\n    const conciseLinkCount = (boldLinkedConcise.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n    const detailedLinkCount = (boldLinkedDetailed.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n    console.log(`üîó DEBUG: Concise content has ${conciseLinkCount} bold links`);\n    console.log(`üîó DEBUG: Detailed content has ${detailedLinkCount} bold links`);\n    \n    if (conciseLinkCount > 0) {\n      console.log(`üîó DEBUG: First bold link in concise: ${boldLinkedConcise.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/)?.[0]}`);\n    }\n    if (detailedLinkCount > 0) {\n      console.log(`üîó DEBUG: First bold link in detailed: ${boldLinkedDetailed.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/)?.[0]}`);\n    }\n    \n    // Step 3: Parallel YouTube and Mermaid processing\n    console.log('üî• STEP 3: Parallel YouTube search and Mermaid conversion...');\n    const [youtubeSearchTerms, conciseWithSVG, detailedWithSVG] = await Promise.all([\n      this.generateYouTubeSearchTerms(title, boldLinkedDetailed, prompts.youtubePrompt, subjectName, professionName),\n      this.convertMermaidToSVGImages(boldLinkedConcise),\n      this.convertMermaidToSVGImages(boldLinkedDetailed)\n    ]);\n    \n    console.log('üîç YouTube search terms generated:', youtubeSearchTerms);\n    \n    // Step 4: Find YouTube videos (sequential due to API limits)\n    console.log('üî• STEP 4: Finding YouTube videos...');\n    const keyConceptsWithVideos = await this.enrichWithYouTubeVideos(youtubeSearchTerms);\n    console.log('‚úÖ STEP 4 COMPLETED - YouTube videos found:', keyConceptsWithVideos.length);\n    \n    // DEBUG: Final content check before return\n    const finalConciseLinkCount = (conciseWithSVG.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n    const finalDetailedLinkCount = (detailedWithSVG.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n    console.log(`üîó FINAL DEBUG: Concise version has ${finalConciseLinkCount} bold links`);\n    console.log(`üîó FINAL DEBUG: Detailed version has ${finalDetailedLinkCount} bold links`);\n    \n    if (finalConciseLinkCount > 0) {\n      console.log(`üîó FINAL DEBUG: Sample link in concise: ${conciseWithSVG.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/)?.[0]}`);\n    }\n    if (finalDetailedLinkCount > 0) {\n      console.log(`üîó FINAL DEBUG: Sample link in detailed: ${detailedWithSVG.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/)?.[0]}`);\n    }\n\n    return {\n      conciseVersion: conciseWithSVG,\n      detailedVersion: detailedWithSVG,\n      keyConceptsWithVideos\n    };\n  }\n\n  private async extractKeyConcepts(\n    title: string, \n    content: string, \n    subjectContext?: string\n  ): Promise<string[]> {\n    const prompt = `\nElemezd az al√°bbi tananyag tartalmat √©s azonos√≠tsd a legfontosabb kulcsfogalmakat, alapanyagokat √©s technikai elemeket.\n\nModul c√≠me: ${title}\n${subjectContext ? `Tant√°rgy kontextus: ${subjectContext}` : ''}\n\nTartalom:\n${content}\n\nKeress k√ºl√∂n√∂sen:\n- F≈ëbb alapanyagokat (pl. paprika, paradicsom, hagyma, kolb√°sz)\n- Technikai fogalmakat √©s elj√°r√°sokat\n- Kulcsfontoss√°g√∫ eszk√∂z√∂ket vagy m√≥dszereket\n- Szakmai terminol√≥gi√°kat\n- Konkr√©t anyagokat, √∂sszetev≈ëket\n\nV√°laszolj JSON form√°tumban:\n{\n  \"keyConcepts\": [\"fogalom1\", \"alapanyag1\", \"technika1\", \"fogalom2\"]\n}\n\nMaximum 8 kulcsfogalom, bele√©rtve az alapanyagokat √©s technikai elemeket.\n`;\n\n    try {\n      const response = await generateChatResponse(prompt, 'chat');\n      const parsed = JSON.parse(response.message);\n      return parsed.keyConcepts || [];\n    } catch (error) {\n      console.error('Key concept extraction error:', error);\n      // Return basic fallback concepts from title\n      return [title];\n    }\n  }\n\n  private async generateConciseVersionWithSearch(\n    title: string,\n    originalContent: string,\n    subjectContext?: string,\n    customSystemMessage?: string\n  ): Promise<string> {\n    // Load concise-specific prompt from database\n    const prompts = await this.loadPrompts();\n    const concisePrompt = prompts.conciseContentPrompt || `K√©sz√≠ts t√∂m√∂r, szakmai √∂sszefoglal√≥t az al√°bbi tananyagb√≥l. Maximum 200 sz√≥, csak a l√©nyeget tartalmazza. Haszn√°lj markdown form√°z√°st √©s emeld ki **vastagon** a kulcsfogalmakat.`;\n    \n    const prompt = `\n${concisePrompt}\n\nC√≠m: ${title}\n${subjectContext ? `Kontextus: ${subjectContext}` : ''}\n\nEredeti tartalom (amit √°t kell √≠rni t√∂m√∂rre):\n${originalContent}\n\nFONTOS: A t√∂m√∂r verzi√≥ legyen JELENT≈êSEN R√ñVIDEBB √©s EGYSZER≈∞BB, mint az eredeti!\n- Maximum 200 sz√≥\n- Csak a legfontosabb inform√°ci√≥k\n- Egyszer≈±, k√∂nnyen √©rthet≈ë megfogalmaz√°s\n- Markdown form√°z√°s\n- **Bold** kiemel√©s kulcsfogalmakhoz\n\nV√°lasz csak a t√∂m√∂r tartalommal:`;\n\n    try {\n      const { generateChatResponse } = await import('./openai');\n      const response = await generateChatResponse(prompt, 'basic_ai_only', undefined, customSystemMessage);\n      \n      let generatedContent = response.message;\n      \n      // Apply Mermaid syntax fixes but NO Wikipedia links for concise version\n      const { fixMermaidSyntax } = await import('./openai');\n      generatedContent = fixMermaidSyntax(generatedContent);\n      \n      return generatedContent;\n    } catch (error) {\n      console.error('Concise version generation error:', error);\n      return `# ${title}\\n\\n*Hiba t√∂rt√©nt a tartalom gener√°l√°sa sor√°n.*`;\n    }\n  }\n\n  /**\n   * Generate concise content using dedicated prompt\n   */\n  private async generateConciseContent(title: string, detailedContent: string, prompt: string): Promise<string> {\n    try {\n      console.log('üî• Generating concise content with admin prompt');\n      const enhancedPrompt = prompt\n        .replace('{title}', title)\n        .replace('{content}', detailedContent.substring(0, 1000));\n      \n      console.log('üìù Concise prompt being used:', enhancedPrompt.substring(0, 200) + '...');\n      const response = await generateChatResponse(enhancedPrompt, 'chat');\n      \n      const generatedContent = response.message.trim();\n      console.log('‚úÖ Concise content generated, length:', generatedContent.length);\n      \n      // Apply Mermaid syntax fixes\n      const { fixMermaidSyntax } = await import('./openai');\n      return fixMermaidSyntax(generatedContent);\n      \n    } catch (error) {\n      console.error('Concise content generation error:', error);\n      return `# ${title}\\n\\n*Hiba t√∂rt√©nt a t√∂m√∂r tartalom gener√°l√°sa sor√°n.*`;\n    }\n  }\n\n  private async generateDetailedVersionWithSearch(\n    title: string,\n    content: string,\n    subjectContext?: string,\n    customSystemMessage?: string\n  ): Promise<string> {\n    const prompt = `\nK√©sz√≠ts r√©szletes szakmai tananyagot markdown form√°z√°sban:\n\n${title}\n${subjectContext ? `Kontextus: ${subjectContext}` : ''}\n\nAlapanyag:\n${content}\n\nK√∂vetelm√©nyek:\n- Semmi bevezet≈ësz√∂veg, csak szakmai tartalom\n- Egyszer≈±, magyar√°z√≥ nyelvezet\n- Fejlett markdown strukt√∫ra (t√°bl√°zatok, list√°k)\n- **Bold** kiemel√©s kulcsfogalmakhoz\n- Wikipedia linkek relev√°ns fogalmakhoz: [fogalom](https://hu.wikipedia.org/wiki/Fogalom)\n- 500-800 sz√≥\n- Magyar nyelv\n\nV√°lasz csak a form√°zott tartalommal:\n\nP√©lda strukt√∫ra √©s elemek:\n\n# F≈ëc√≠m\n## Technikai r√©szletek\n### Specifik√°ci√≥k\n\n| Param√©ter | Minimum | Optim√°lis | Maximum | Megjegyz√©s |\n|-----------|---------|-----------|---------|-------------|\n| √ârt√©k 1   | X       | Y         | Z       | Le√≠r√°s     |\n| √ârt√©k 2   | A       | B         | C       | Magyar√°zat |\n\n> Fontos inform√°ci√≥ vagy defin√≠ci√≥\n\n> Figyelmeztet√©s vagy vesz√©ly\n\n> Hasznos tipp vagy javaslat\n\n### Folyamat l√©p√©sei:\n- [ ] 1. El≈ëk√©sz√≠t√©s\n- [ ] 2. V√©grehajt√°s  \n- [ ] 3. Ellen≈ërz√©s\n\n### Folyamat√°bra (ha alkalmazhat√≥):\n\\`\\`\\`mermaid\ngraph TD\n    A[Kezd√©s] --> B{D√∂nt√©s};\n    B --> C[Els≈ë l√©p√©s];\n    B --> D[Alternat√≠v √∫t];\n    C --> E[Befejez√©s];\n    D --> E;\n\\`\\`\\`\n- [ ] 4. Befejez√©s\n\n### Folyamat√°bra:\n` + \"```mermaid\" + `\nflowchart TD\n    A[Start] --> B[El≈ëk√©sz√≠t√©s]\n    B --> C[V√©grehajt√°s]\n    C --> D[Ellen≈ërz√©s]\n    D --> E[V√©ge]\n` + \"```\" + `\n\n### √ñsszehasonl√≠t√≥ t√°bl√°zat:\n| M√≥dszer | El≈ëny√∂k | H√°tr√°nyok | Alkalmaz√°s |\n|---------|---------|-----------|------------|\n| A       | pozit√≠v | negat√≠v   | Haszn√°lat  |\n| B       | el≈ëny    | h√°tr√°ny   | Ter√ºlet    |\n`;\n\n    try {\n      // First try to get relevant internet information for detailed content\n      const { multiApiService } = await import('./multiApiService');\n      let enrichedPrompt = prompt;\n      \n      try {\n        // Use intelligent search query optimization for detailed content\n        const { searchOptimizer } = await import('./search-optimizer');\n        const detailedSearchQueries = searchOptimizer.generateDetailedQueries(title, content, subjectContext);\n        \n        let allDetailedResults: any[] = [];\n        \n        // Search with optimized detailed queries\n        for (const searchQuery of detailedSearchQueries) {\n          try {\n            console.log(`Detailed search for: ${searchQuery}`);\n            const results = await multiApiService.searchInternet(searchQuery);\n            allDetailedResults = allDetailedResults.concat(results.slice(0, 2));\n            if (allDetailedResults.length >= 10) break; // More results for detailed version\n          } catch (error: any) {\n            console.log(`Detailed search failed for \"${searchQuery}\":`, error.message);\n          }\n        }\n        \n        const searchResults = allDetailedResults;\n        \n        if (searchResults.length > 0) {\n          const relevantInfo = searchResults.slice(0, 5).map((result: any) => \n            `**${result.title}**: ${result.snippet}`\n          ).join('\\n\\n');\n          \n          enrichedPrompt += `\\n\\nAktu√°lis szakmai inform√°ci√≥k az internetr≈ël:\\n${relevantInfo}\\n\\nHaszn√°ld fel ezeket az inform√°ci√≥kat a r√©szletes magyar√°zathoz.`;\n        }\n      } catch (searchError: any) {\n        console.log('Internet search failed, using AI-only approach:', searchError.message);\n      }\n      \n      const { generateChatResponse } = await import('./openai');\n      const response = await generateChatResponse(enrichedPrompt, 'basic_ai_only', undefined, customSystemMessage);\n      \n      // Add Wikipedia links to key concepts\n      let detailedContent = response.message;\n      detailedContent = this.addWikipediaLinks(detailedContent);\n      \n      // Apply Mermaid syntax fixes\n      const { fixMermaidSyntax } = await import('./openai');\n      detailedContent = fixMermaidSyntax(detailedContent);\n      \n      return detailedContent;\n    } catch (error) {\n      console.error('Detailed version generation error:', error);\n      return `# ${title}\\n\\n*R√©szletes verzi√≥ gener√°l√°sa sikertelen volt.*`;\n    }\n  }\n\n  private async generateConceptDefinitions(\n    concepts: string[],\n    subjectContext?: string\n  ): Promise<Array<{\n    concept: string;\n    definition: string;\n    youtubeVideos: Array<{\n      title: string;\n      videoId: string;\n      description: string;\n      url: string;\n    }>;\n  }>> {\n    const enrichedConcepts = [];\n\n    for (const concept of concepts) {\n      try {\n        // Generate definition for the concept using AI only\n        const definitionPrompt = `\nAdj egy r√©szletes, szakmai defin√≠ci√≥t a k√∂vetkez≈ë fogalomra: \"${concept}\"\n${subjectContext ? `Kontextus: ${subjectContext}` : ''}\n\nV√°lasz form√°tum: 2-3 mondatos, prec√≠z magyar√°zat magyar nyelven, amely tartalmazza:\n- A fogalom alapvet≈ë jelent√©s√©t\n- Gyakorlati alkalmaz√°si ter√ºlet√©t\n- Kapcsol√≥d√≥ fontosabb aspektusokat\n`;\n\n        const definitionResponse = await generateChatResponse(definitionPrompt, 'chat');\n        const definition = definitionResponse.message;\n\n        // Search for YouTube videos for this concept using AI-extracted keywords\n        let youtubeVideos: any[] = [];\n        try {\n          // Let AI extract the most relevant search terms from module content\n          const searchQueries = await this.extractYouTubeSearchTerms(concept, definition, subjectContext);\n\n          const allVideoResults = [];\n          \n          for (const searchQuery of searchQueries) {\n            try {\n              console.log(`Searching YouTube for: ${searchQuery}`);\n              const videoResults = await multiApiService.searchYoutube(searchQuery);\n              if (videoResults && videoResults.length > 0) {\n                allVideoResults.push(...videoResults.slice(0, 2));\n              }\n            } catch (queryError) {\n              console.log(`YouTube search failed for query \"${searchQuery}\":`, queryError);\n            }\n          }\n\n          // Remove duplicates based on videoId and take best 3\n          const uniqueVideos = allVideoResults.filter((video, index, self) => \n            index === self.findIndex(v => \n              (v.id?.videoId || v.videoId) === (video.id?.videoId || video.videoId)\n            )\n          );\n\n          if (uniqueVideos.length > 0) {\n            youtubeVideos = uniqueVideos.slice(0, 3).map((video: any) => {\n              // Handle different YouTube API response structures\n              const videoId = video.id?.videoId || video.videoId || '';\n              const title = video.snippet?.title || video.title || 'YouTube vide√≥';\n              const description = video.snippet?.description || video.description || 'Szakmai tartalom';\n              \n              return {\n                title: title.substring(0, 100), // Limit title length\n                videoId,\n                description: description.substring(0, 200), // Limit description length\n                url: `https://www.youtube.com/watch?v=${videoId}`\n              };\n            }).filter(video => video.videoId); // Only include videos with valid IDs\n          }\n        } catch (youtubeError) {\n          console.log(`YouTube search failed for ${concept}:`, youtubeError);\n        }\n\n        enrichedConcepts.push({\n          concept,\n          definition,\n          youtubeVideos\n        });\n      } catch (error) {\n        console.error(`Error generating definition for concept: ${concept}`, error);\n        enrichedConcepts.push({\n          concept,\n          definition: `${concept} - szakmai fogalom defin√≠ci√≥ja`,\n          youtubeVideos: [] as any[]\n        });\n      }\n    }\n\n    return enrichedConcepts;\n  }\n\n  private async enrichConceptsWithVideos(\n    concepts: string[],\n    subjectContext?: string,\n    customSystemMessage?: string\n  ): Promise<Array<{\n    concept: string;\n    definition: string;\n    youtubeVideos: Array<{\n      title: string;\n      videoId: string;\n      description: string;\n      url: string;\n    }>;\n  }>> {\n    const enrichedConcepts = [];\n    \n    // OPTIMIZATION: Limit to max 3 concepts to reduce API quota usage\n    const limitedConcepts = concepts.slice(0, 3);\n    console.log(`Processing ${limitedConcepts.length} concepts (limited from ${concepts.length} to conserve YouTube API quota)`);\n\n    for (const concept of limitedConcepts) {\n      try {\n        // Generate definition for the concept\n        const definitionPrompt = `\nAdj egy r√∂vid, szakmai defin√≠ci√≥t a fogalomra: \"${concept}\"\n${subjectContext ? `Kontextus: ${subjectContext}` : ''}\n\nK√∂vetelm√©nyek:\n- Csak a defin√≠ci√≥, semmi bevezet≈ësz√∂veg\n- Egyszer≈±, magyar√°z√≥ nyelvezet\n- Szakmai pontoss√°g\n- 1-2 mondat\n\nV√°lasz csak a defin√≠ci√≥val:`;\n\n        const definitionResponse = await generateChatResponse(definitionPrompt, 'chat');\n        const definition = definitionResponse.message;\n\n        // Use optimized cached YouTube search\n        const searchQuery = `${concept} oktat√°s magyar`;\n        const youtubeVideos = await this.searchYouTubeWithCache(searchQuery);\n\n        // Generate basic Wikipedia link for this concept\n        const encodedConcept = encodeURIComponent(concept.replace(/\\s+/g, '_'));\n        const wikipediaLinks = [{\n          text: concept,\n          url: `https://hu.wikipedia.org/wiki/${encodedConcept}`,\n          description: `Wikipedia cikk: ${concept}`\n        }];\n\n        enrichedConcepts.push({\n          concept,\n          definition,\n          youtubeVideos,\n          wikipediaLinks\n        });\n      } catch (error) {\n        console.error(`Error enriching concept: ${concept}`, error);\n        // Add concept without enrichment if error occurs\n        enrichedConcepts.push({\n          concept,\n          definition: `${concept} - defin√≠ci√≥ gener√°l√°sa sikertelen`,\n          youtubeVideos: [] as any[],\n          wikipediaLinks: []\n        });\n      }\n    }\n\n    return enrichedConcepts;\n  }\n\n\n\n  /**\n   * Detect professional field from content and subject context\n   */\n  private detectProfessionalField(title: string, content: string, subjectName?: string, professionName?: string): string {\n    const combined = (title + ' ' + content + ' ' + (subjectName || '') + ' ' + (professionName || '')).toLowerCase();\n    \n    // Define professional field patterns - order matters, most specific first\n    const fieldPatterns = {\n      // Robotics and automation first - highest priority\n      robotics: ['robot', 'elfin', 'automatiz√°l', 'programoz', 'koordin√°t', 'kinematik', 'szenzor', 'aktu√°tor', 'kollaborat√≠v', 'mozg√°si tartom√°ny', 'robotkar', 'integr√°tor', 'robotrendszer'],\n      // Safety and workplace safety\n      safety: ['biztons√°g', 'munkav√©delem', 'v√©szhelyzet', '√≥vint√©zked√©s', 'v√©d≈ëeszk√∂z', 'kock√°zat', 'felel≈ëss√©g', 'norm√°k', 'szabv√°ny', 'iso'],\n      // Logistics and transportation\n      logistics: ['sz√°ll√≠t√°s', 'csomagol√°s', 'r√∂gz√≠t√©s', 'pozicion√°l√°s', 't√°rol√°s', 'kezel√©s'],\n      // Industrial and manufacturing\n      industrial: ['ipari', 'gy√°rt√°s', 'termel√©s', '√ºzemeltet√©s', 'technol√≥gia', 'berendez√©s'],\n      // Specific cooking terms - lower priority\n      cooking: ['f≈ëz', '√©tel', 'recept', 'alapanyag', 'konyha', 'gasztron√≥m', 'lecs√≥', 'paprika', 'paradicsom', 'hagyma', 'kolb√°sz', 'magyar konyha', 'tradicion√°lis', 'szak√°cs', '√©lelmiszer'],\n      // Welding with more specific terms\n      welding: ['hegeszt', 'varrat', 'elektr√≥da', '√≠vhegeszt', 'v√©d≈ëg√°z hegeszt√©s', 'f√©mhegeszt', 'hegeszt≈ëtechnika'],\n      electrical: ['elektrik', '√°ram', 'fesz√ºlts√©g', 'vezet√©k', 'kapcsol√≥', 'villany'],\n      mechanical: ['g√©p', 'szerkezet', 'mechanik', 'alkatr√©sz', 'hajt√°s', 'fogasker√©k'],\n      construction: ['√©p√≠t√©s', 'beton', 't√©gla', 'szerkezet', 'alapoz√°s', 'falaz√°s'],\n      automotive: ['aut√≥', 'j√°rm≈±', 'karossz√©ria', 'f√©k', 'v√°lt√≥'],\n      healthcare: ['eg√©szs√©g', 'beteg', 'kezel√©s', 'diagnosztik', 'gy√≥gyszer', '√°pol√°s'],\n      agriculture: ['mez≈ëgazd', 'n√∂v√©ny', 'termeszt', 'vet√©s', 'arat√°s', 'talaj'],\n      textiles: ['textil', 'sz√∂vet', 'varr', 'fon√°l', 'ruha', 'anyag']\n    };\n    \n    // Find matching field\n    for (const [field, keywords] of Object.entries(fieldPatterns)) {\n      if (keywords.some(keyword => combined.includes(keyword))) {\n        return field;\n      }\n    }\n    \n    return 'general';\n  }\n\n  /**\n   * Get field-specific examples for professional areas\n   */\n  private getFieldSpecificExamples(field: string): string[] {\n    const fieldExamples: Record<string, string[]> = {\n      robotics: [\"robotika\", \"automatiz√°l√°s\", \"programoz√°s\", \"kinematika\", \"vez√©rl√©s\"],\n      welding: [\"hegeszt√©s\", \"f√©mfeldolgoz√°s\", \"hegeszt√©stechnika\", \"varratk√©pz√©s\"],\n      cooking: [\"f≈ëz√©s\", \"gasztron√≥mia\", \"szak√°csk√©pz√©s\", \"√©lelmiszer-k√©sz√≠t√©s\"],\n      electrical: [\"elektrotechnika\", \"villamoss√°g\", \"elektronika\", \"√°ramk√∂r√∂k\"],\n      mechanical: [\"g√©p√©szet\", \"mechanika\", \"g√©p√©p√≠t√©s\", \"szerkezetek\"],\n      construction: [\"√©p√≠t≈ëipar\", \"√©p√≠t√©stechnika\", \"√©p√≠t√©szet\", \"szerkezet√©p√≠t√©s\"],\n      automotive: [\"aut√≥ipar\", \"j√°rm≈±technika\", \"g√©pj√°rm≈±vek\", \"aut√≥szerel√©s\"],\n      healthcare: [\"eg√©szs√©g√ºgy\", \"orvostudom√°ny\", \"√°pol√°s\", \"eg√©szs√©gmeg≈ërz√©s\"],\n      agriculture: [\"mez≈ëgazdas√°g\", \"n√∂v√©nytermeszt√©s\", \"√°llatteny√©szt√©s\", \"agr√°rtechnika\"],\n      textiles: [\"textilipar\", \"varr√°s\", \"sz√∂v√©s\", \"ruh√°zat\"],\n      general: [\"technol√≥gia\", \"m≈±szaki alapok\", \"szakmai ismeretek\", \"alkalmaz√°sok\"]\n    };\n    \n    return fieldExamples[field] || fieldExamples.general;\n  }\n\n  /**\n   * Add relevant web search content to enhance module content\n   */\n  private async addWebSearchContent(content: string, title: string, detectedField: string): Promise<string> {\n    try {\n      console.log(`üåê Adding web search content for field: ${detectedField}`);\n      console.log(`üìÑ Original content length: ${content.length}`);\n      console.log(`üîç Content preview: ${content.substring(0, 150)}...`);\n      \n      // Generate search query based on content and field\n      const searchQuery = await this.generateWebSearchQuery(title, content, detectedField);\n      console.log(`üîç Generated search query: ${searchQuery}`);\n      \n      // Perform web search using multiApiService\n      console.log('üåê Starting web search...');\n      const searchResults = await multiApiService.searchInternet(searchQuery);\n      console.log(`üìä Search results count: ${searchResults ? searchResults.length : 0}`);\n      \n      if (searchResults && searchResults.length > 0) {\n        console.log('üîç Sample search result:', searchResults[0]);\n        \n        // Extract relevant information from search results\n        const relevantInfo = this.extractRelevantWebInfo(searchResults, detectedField);\n        console.log(`üìã Extracted relevant info pieces: ${relevantInfo.length}`);\n        console.log('üìã Relevant info sample:', relevantInfo[0]);\n        \n        if (relevantInfo && relevantInfo.length > 0) {\n          // Integrate search results into content\n          console.log('üîó Starting content integration with bold linking...');\n          const enhancedContent = this.integrateWebContent(content, relevantInfo);\n          console.log(`üìÑ Enhanced content length: ${enhancedContent.length}`);\n          console.log(`üîó Enhanced content preview: ${enhancedContent.substring(0, 200)}...`);\n          console.log(`‚úÖ Web content integrated, added ${relevantInfo.length} relevant pieces`);\n          return enhancedContent;\n        }\n      }\n      \n      console.log('üìù No relevant web content found, returning original content');\n      return content;\n    } catch (error) {\n      console.error('Web search content integration failed:', error);\n      return content; // Fallback to original content\n    }\n  }\n\n  /**\n   * Generate search query for web content enhancement\n   */\n  private async generateWebSearchQuery(title: string, content: string, field: string): Promise<string> {\n    const fieldExamples = this.getFieldSpecificExamples(field);\n    \n    const prompt = `\nK√©sz√≠ts egy prec√≠z keres√©si kifejez√©st internetkeres√©shez a k√∂vetkez≈ë tananyag b≈ëv√≠t√©s√©hez:\n\nC√≠m: ${title}\nTartalom: ${content.substring(0, 500)}\nSzakmai ter√ºlet: ${field}\nKapcsol√≥d√≥ t√©m√°k: ${fieldExamples.join(', ')}\n\nAdj vissza EGYETLEN keres√©si kifejez√©st, ami a legink√°bb relev√°ns inform√°ci√≥kat hozza fel:`;\n\n    try {\n      const response = await generateChatResponse(prompt, 'chat');\n      return response.message.trim().replace(/['\"]/g, '');\n    } catch (error) {\n      console.error('Search query generation failed:', error);\n      return `${title} ${field}`;\n    }\n  }\n\n  /**\n   * Extract relevant information from web search results\n   */\n  private extractRelevantWebInfo(searchResults: any[], field: string): Array<{text: string, source: string}> {\n    const relevantInfo: Array<{text: string, source: string}> = [];\n    \n    try {\n      // Process first 3 search results\n      const resultsToProcess = searchResults.slice(0, 3);\n      \n      for (const result of resultsToProcess) {\n        if (result.snippet && result.title && result.url) {\n          const snippet = result.snippet.trim();\n          const title = result.title.trim();\n          \n          // Filter for relevant, substantial content\n          if (snippet.length > 50 && snippet.length < 500) {\n            relevantInfo.push({\n              text: `**${title}**: ${snippet}`,\n              source: result.url\n            });\n          }\n        }\n      }\n      \n      return relevantInfo.slice(0, 3); // Limit to top 3 relevant pieces\n    } catch (error) {\n      console.error('Error extracting web info:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Integrate web content into module content (simplified version - only adds web section)\n   */\n  private integrateWebContent(originalContent: string, webInfo: Array<{text: string, source: string}>): string {\n    if (webInfo.length === 0) {\n      console.log('‚ùå No web info provided, returning original content');\n      return originalContent;\n    }\n    \n    console.log(`üìã Adding web search results section with ${webInfo.length} pieces`);\n    \n    // Add web content as additional information section only\n    const webSection = `\n\n## Tov√°bbi inform√°ci√≥k\n\n${webInfo.map(info => `${info.text}\\n*Forr√°s: ${info.source}*`).join('\\n\\n')}`;\n    \n    const finalContent = originalContent + webSection;\n    console.log(`üìÑ Final content with web section length: ${finalContent.length}`);\n    \n    return finalContent;\n  }\n\n  /**\n   * Extract keywords from web search information\n   */\n  private extractKeywordsFromWebInfo(webInfo: Array<{text: string, source: string}>): string[] {\n    const keywords = new Set<string>();\n    \n    // Add common technical terms that are likely to appear in bold\n    const commonTechnicalTerms = [\n      'robot', 'robotok', 'robotika', 'automatiz√°l√°s', 'programoz√°s', 'karbantart√°s',\n      'biztons√°gi', 'biztons√°g', 'szoftver', 'g√©p√©szet', 'technol√≥gia', 'vez√©rl√©s',\n      'k√≥d', 'algoritmus', 'fejleszt√©s', 'tervez√©s', 'rendszer', 'folyamat'\n    ];\n    \n    commonTechnicalTerms.forEach(term => keywords.add(term));\n    \n    webInfo.forEach(info => {\n      console.log(`üîç Processing web info: \"${info.text.substring(0, 100)}...\"`);\n      \n      // Extract words from titles and snippets\n      const text = info.text.toLowerCase();\n      const words = text.match(/\\b[a-z√°√©√≠√≥√∂≈ë√∫√º≈±]{4,}\\b/g) || [];\n      \n      words.forEach(word => {\n        // Add significant technical terms\n        if (word.length >= 4 && !this.isCommonWord(word)) {\n          keywords.add(word);\n        }\n      });\n    });\n    \n    const finalKeywords = Array.from(keywords).slice(0, 15); // Increase limit\n    console.log(`üìã Final extracted keywords: ${finalKeywords.join(', ')}`);\n    \n    return finalKeywords;\n  }\n\n  /**\n   * Check if a word is too common to be linked\n   */\n  private isCommonWord(word: string): boolean {\n    const commonWords = [\n      'hogy', 'mint', 'vagy', 'ahol', 'amely', 'amikor', 'mivel', 'ut√°n', 'alatt',\n      '√°ltal', 'sor√°n', 'k√∂z√∂tt', 'ellen', 'mellett', 'n√©lk√ºl', 'kereszt√ºl',\n      'szerint', 'alapj√°n', 'miatt', 'helyett', 'el≈ëtt', 'ut√°n', 'sor√°n',\n      'lehet', 'kell', 'lesz', 'volt', 'van', 'nincs', 'igen', 'nem',\n      'csak', 'm√©g', 'm√°r', 'most', 'akkor', 'itt', 'ott', 'ahol'\n    ];\n    \n    return commonWords.includes(word.toLowerCase());\n  }\n\n  /**\n   * Link bold keywords in content to relevant web sources\n   */\n  private linkBoldKeywordsToWebSources(content: string, keywords: string[], webInfo: Array<{text: string, source: string}>): string {\n    let linkedContent = content;\n    \n    // Find all bold text patterns **word** in the content\n    const boldPattern = /\\*\\*([^*]+)\\*\\*/g;\n    const boldMatches = content.match(boldPattern);\n    \n    console.log(`üîç Found ${boldMatches ? boldMatches.length : 0} bold patterns in content`);\n    if (boldMatches) {\n      console.log('üîç Bold patterns found:', boldMatches.slice(0, 5));\n    }\n    \n    let linkingCount = 0;\n    \n    linkedContent = linkedContent.replace(boldPattern, (match, boldText) => {\n      const lowerBoldText = boldText.toLowerCase();\n      console.log(`üîç Processing bold text: \"${boldText}\"`);\n      \n      // Check if this bold text matches any of our search keywords\n      // Use more flexible matching - check if bold text contains keyword or vice versa\n      const matchingKeyword = keywords.find(keyword => {\n        const keywordLower = keyword.toLowerCase();\n        return lowerBoldText.includes(keywordLower) || \n               keywordLower.includes(lowerBoldText) ||\n               lowerBoldText === keywordLower ||\n               // Also check for partial matches for compound words\n               (lowerBoldText.length > 4 && keywordLower.includes(lowerBoldText)) ||\n               (keywordLower.length > 4 && lowerBoldText.includes(keywordLower));\n      });\n      \n      if (matchingKeyword) {\n        console.log(`‚úÖ Found matching keyword \"${matchingKeyword}\" for bold text \"${boldText}\"`);\n        \n        // Find the most relevant web source for this keyword\n        const relevantSource = webInfo.find(info => \n          info.text.toLowerCase().includes(matchingKeyword)\n        );\n        \n        if (relevantSource) {\n          console.log(`üîó Linking \"${boldText}\" to source: ${relevantSource.source}`);\n          linkingCount++;\n          // Create a link with the bold text pointing to relevant source\n          return `**[${boldText}](${relevantSource.source})**`;\n        } else {\n          console.log(`‚ùå No relevant source found for keyword \"${matchingKeyword}\"`);\n        }\n      } else {\n        console.log(`‚ùå No matching keyword found for bold text \"${boldText}\"`);\n        console.log(`Available keywords: ${keywords.join(', ')}`);\n      }\n      \n      // If no match found, keep original bold formatting\n      return match;\n    });\n    \n    console.log(`üîó Successfully linked ${linkingCount} bold keywords`);\n    \n    return linkedContent;\n  }\n\n  /**\n   * Link bold keywords directly to relevant websites based on content analysis\n   */\n  private async linkBoldKeywordsDirectly(content: string, title: string, detectedField: string): Promise<string> {\n    console.log('üîó Starting direct bold keyword linking...');\n    \n    // Find all bold patterns in content\n    const boldPattern = /\\*\\*([^*]+)\\*\\*/g;\n    const boldMatches = content.match(boldPattern);\n    \n    if (!boldMatches || boldMatches.length === 0) {\n      console.log('‚ùå No bold patterns found in content');\n      return content;\n    }\n    \n    console.log(`üîç Found ${boldMatches.length} bold patterns to process`);\n    \n    let linkedContent = content;\n    const processedKeywords = new Set<string>();\n    \n    // Process each bold keyword individually\n    for (const boldMatch of boldMatches) {\n      const boldText = boldMatch.replace(/\\*\\*/g, '');\n      \n      if (processedKeywords.has(boldText.toLowerCase())) {\n        continue; // Skip already processed keywords\n      }\n      \n      processedKeywords.add(boldText.toLowerCase());\n      \n      try {\n        console.log(`üîç Processing bold keyword: \"${boldText}\"`);\n        \n        // Generate specific search query for this keyword based on context\n        let searchQuery = `${boldText}`;\n        \n        // Get combined content for additional context checks\n        const combinedContent = (title + ' ' + content).toLowerCase();\n        \n        // Add relevant context based on detected field and content analysis\n        if (detectedField === 'robotics' || combinedContent.includes('robot')) {\n          searchQuery += ' robotika automatiz√°l√°s ipari robot';\n        } else if (detectedField === 'safety' || combinedContent.includes('biztons√°g') || combinedContent.includes('felel≈ëss√©g') || combinedContent.includes('norm√°k')) {\n          searchQuery += ' munkav√©delem biztons√°g szabv√°ny';\n        } else if (detectedField === 'logistics' || combinedContent.includes('sz√°ll√≠t√°s')) {\n          searchQuery += ' sz√°ll√≠t√°s logisztika ipari';\n        } else if (detectedField === 'industrial' || combinedContent.includes('ipari') || combinedContent.includes('gy√°rt√°s')) {\n          searchQuery += ' ipari technol√≥gia gy√°rt√°s';\n        } else if (detectedField === 'cooking' && combinedContent.includes('f≈ëz')) {\n          searchQuery += ' f≈ëz√©s gasztron√≥mia';\n        } else {\n          // For robotics/safety content, default to technical context\n          searchQuery += ' ipari technol√≥gia';\n        }\n        \n        searchQuery += ' magyarorsz√°g';\n        console.log(`üåê Searching for: ${searchQuery}`);\n        \n        // Perform targeted web search\n        const searchResults = await multiApiService.searchInternet(searchQuery);\n        \n        if (searchResults && searchResults.length > 0) {\n          // Find the most relevant result\n          const relevantResult = searchResults.find((result: any) => \n            result.title && result.url && \n            (result.title.toLowerCase().includes(boldText.toLowerCase()) ||\n             result.snippet?.toLowerCase().includes(boldText.toLowerCase()))\n          ) || searchResults[0];\n          \n          if (relevantResult && relevantResult.url) {\n            console.log(`‚úÖ Linking \"${boldText}\" to: ${relevantResult.url}`);\n            \n            // Replace all instances of this bold keyword with linked version\n            const boldRegex = new RegExp(`\\\\*\\\\*${boldText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\*\\\\*`, 'gi');\n            linkedContent = linkedContent.replace(boldRegex, `**[${boldText}](${relevantResult.url})**`);\n          }\n        }\n        \n        // Add small delay to avoid rate limiting\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        \n      } catch (error) {\n        console.error(`‚ùå Failed to link keyword \"${boldText}\":`, error);\n      }\n    }\n    \n    const linkCount = (linkedContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n    console.log(`üîó Successfully linked ${linkCount} bold keywords`);\n    \n    return linkedContent;\n  }\n\n  /**\n   * Optimized bold keyword linking with configurable settings\n   */\n  private async linkBoldKeywordsSimplified(content: string, title: string): Promise<string> {\n    const settings = await this.getOptimizationSettings();\n    \n    if (!settings.enableBoldLinking) {\n      console.log('üîó Bold keyword linking disabled in optimization settings');\n      return content;\n    }\n    \n    console.log(`üîó Starting optimized bold keyword linking (max: ${settings.maxBoldKeywords})...`);\n    \n    // Find all bold patterns in content\n    const boldPattern = /\\*\\*([^*]+)\\*\\*/g;\n    const boldMatches = content.match(boldPattern);\n    \n    if (!boldMatches || boldMatches.length === 0) {\n      console.log('‚ùå No bold patterns found in content');\n      return content;\n    }\n    \n    console.log(`üîç Found ${boldMatches.length} bold patterns to process`);\n    \n    let linkedContent = content;\n    const processedKeywords = new Set<string>();\n    \n    // Use configurable limit for bold keywords\n    const limitedMatches = boldMatches.slice(0, settings.maxBoldKeywords);\n    \n    for (const boldMatch of limitedMatches) {\n      const boldText = boldMatch.replace(/\\*\\*/g, '');\n      \n      if (processedKeywords.has(boldText.toLowerCase()) || boldText.length < 3) {\n        continue; // Skip already processed or too short keywords\n      }\n      \n      processedKeywords.add(boldText.toLowerCase());\n      \n      try {\n        console.log(`üîç Processing bold keyword: \"${boldText}\"`);\n        \n        // Generate context-aware search query based on title content\n        let searchQuery = `${boldText}`;\n        \n        // Add context based on title and content analysis\n        const titleLower = title.toLowerCase();\n        if (titleLower.includes('robot') || titleLower.includes('automatiz')) {\n          searchQuery += ' robotika ipari automatiz√°l√°s';\n        } else if (titleLower.includes('biztons√°g') || titleLower.includes('felel≈ëss√©g')) {\n          searchQuery += ' munkav√©delem biztons√°g';\n        } else if (titleLower.includes('sz√°ll√≠t√°s') || titleLower.includes('kezel√©s')) {\n          searchQuery += ' logisztika sz√°ll√≠t√°s';\n        } else {\n          searchQuery += ' ipari technol√≥gia';\n        }\n        \n        searchQuery += ' magyarorsz√°g';\n        console.log(`üåê Searching for: ${searchQuery}`);\n        \n        // Create Wikipedia link directly (restored working method)\n        const encodedKeyword = encodeURIComponent(boldText.replace(/\\s+/g, '_'));\n        const wikipediaUrl = `https://hu.wikipedia.org/wiki/${encodedKeyword}`;\n        \n        console.log(`‚úÖ Linking \"${boldText}\" to Wikipedia: ${wikipediaUrl}`);\n        \n        // Replace all instances of this bold keyword with Wikipedia link\n        const boldRegex = new RegExp(`\\\\*\\\\*${boldText.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')}\\\\*\\\\*`, 'gi');\n        linkedContent = linkedContent.replace(boldRegex, `**[${boldText}](${wikipediaUrl})**`);\n        \n        // Use configurable delay to avoid rate limiting\n        await new Promise(resolve => setTimeout(resolve, settings.boldKeywordDelay));\n        \n      } catch (error) {\n        console.error(`‚ùå Failed to link keyword \"${boldText}\":`, error);\n      }\n    }\n    \n    const linkCount = (linkedContent.match(/\\*\\*\\[[^\\]]+\\]\\([^)]+\\)\\*\\*/g) || []).length;\n    console.log(`üîó Successfully linked ${linkCount} bold keywords out of ${limitedMatches.length} processed`);\n    \n    return linkedContent;\n  }\n\n  /**\n   * Generate YouTube search terms using dedicated prompt\n   */\n  private async generateYouTubeSearchTerms(title: string, content: string, prompt: string, subjectName?: string, professionName?: string): Promise<string[]> {\n    try {\n      console.log('üî• SEQUENTIAL AI STEP 3A: Generating YouTube search terms with admin prompt');\n      \n      // Detect professional field and get appropriate examples\n      const field = this.detectProfessionalField(title, content, subjectName, professionName);\n      const examples = this.getFieldSpecificExamples(field);\n      \n      console.log(`üéØ Detected field: ${field}, using examples:`, examples);\n      \n      // Create a structured prompt for YouTube search terms\n      const structuredPrompt = `\nK√©sz√≠ts 2-3 √°tfog√≥ YouTube keres√©si kifejez√©st ehhez a tananyaghoz JSON array form√°tumban. Haszn√°lj gy≈±jt≈ëfogalmakat, szakmai ter√ºleteket, nem pedig konkr√©t elemeket.\n\nC√≠m: ${title}\nTartalom: ${content.substring(0, 800)}\nSzakma: ${professionName || '√Åltal√°nos'}\nTant√°rgy: ${subjectName || '√Åltal√°nos'}\n\nJ√≥ p√©ld√°k ehhez a ter√ºlethez: ${JSON.stringify(examples)}\nKer√ºlend≈ë: [\"konkr√©t elem nevek\", \"r√©szletes m≈±szaki param√©terek\", \"m√°rkanevek\"]\n\nV√°lasz csak JSON array form√°tumban:`;\n      \n      console.log('üìù YouTube search terms generation started');\n      const response = await generateChatResponse(structuredPrompt, 'chat');\n      \n      // Extract search terms from response\n      const cleanResponse = response.message.trim();\n      console.log('üîç YouTube AI response:', cleanResponse.substring(0, 200) + '...');\n      \n      // Try to extract JSON array\n      const jsonMatch = cleanResponse.match(/\\[[\\s\\S]*?\\]/);\n      \n      if (jsonMatch) {\n        try {\n          const searchTerms = JSON.parse(jsonMatch[0]);\n          if (Array.isArray(searchTerms)) {\n            const filteredTerms = searchTerms\n              .slice(0, 3)\n              .filter(term => typeof term === 'string' && term.length > 3 && term.length < 50)\n              .map(term => term.trim());\n            console.log('‚úÖ YouTube search terms extracted from JSON:', filteredTerms);\n            return filteredTerms;\n          }\n        } catch (parseError) {\n          console.log('JSON parse failed for YouTube terms');\n        }\n      }\n      \n      // Fallback: Use AI to analyze content and generate appropriate search terms\n      try {\n        const field = this.detectProfessionalField(title, content, subjectName, professionName);\n        const examples = this.getFieldSpecificExamples(field);\n        const contextExamples = `Ha ${field} ter√ºletr≈ël sz√≥l -> ${JSON.stringify(examples)}`;\n          \n        const analysisPrompt = `Elemezd a k√∂vetkez≈ë tartalmat √©s hat√°rozd meg a PONTOS szakmai ter√ºletet YouTube keres√©shez:\n\nC√≠m: ${title}\nTartalom: ${content.substring(0, 800)}\nSzakma: ${professionName || '√Åltal√°nos'}\nTant√°rgy: ${subjectName || '√Åltal√°nos'}\n\nFONTOS: A keres√©si kifejez√©sek t√ºkr√∂zz√©k a T√âNYLEGES tartalmat, ne √°ltal√°nos kateg√≥ri√°kat!\n\n${contextExamples}\n\nJSON v√°lasz (2-3 kifejez√©s):`;\n\n        console.log('ü§ñ AI-powered YouTube category analysis started');\n        const analysisResponse = await generateChatResponse(analysisPrompt, 'chat');\n        \n        // Try to extract JSON from AI response\n        const jsonMatch = analysisResponse.message.match(/\\[[\\s\\S]*?\\]/);\n        if (jsonMatch) {\n          try {\n            const aiCategories = JSON.parse(jsonMatch[0]);\n            if (Array.isArray(aiCategories) && aiCategories.length > 0) {\n              const cleanCategories = aiCategories\n                .filter(term => typeof term === 'string' && term.length > 3)\n                .slice(0, 3);\n              console.log('‚úÖ AI-generated YouTube categories:', cleanCategories);\n              return cleanCategories;\n            }\n          } catch (parseError) {\n            console.log('AI category analysis parse failed, using content-based fallback');\n          }\n        }\n      } catch (aiError) {\n        console.log('AI category analysis failed, using content-based fallback');\n      }\n      \n      // Smart content-based fallback\n      const lowerTitle = title.toLowerCase();\n      const lowerContent = content.toLowerCase();\n      \n      if (lowerTitle.includes('robot') || lowerContent.includes('robot') || lowerContent.includes('elfin')) {\n        console.log('ü§ñ Detected robotics content');\n        return ['robotika', 'robot programoz√°s', 'automatiz√°l√°s'];\n      }\n      \n      if (lowerTitle.includes('hegeszt√©s') || lowerContent.includes('hegeszt√©s') || lowerContent.includes('mig') || lowerContent.includes('mag')) {\n        console.log('üî• Detected welding content');\n        return ['hegeszt√©s', 'f√©mfeldolgoz√°s', 'hegeszt√©stechnika'];\n      }\n      \n      if (lowerTitle.includes('f≈ëz√©s') || lowerContent.includes('lecs√≥') || lowerContent.includes('f≈ëz√©s')) {\n        console.log('üë®‚Äçüç≥ Detected cooking content');\n        return ['f≈ëz√©s', 'szak√°csk√©pz√©s', 'gasztron√≥mia'];\n      }\n      \n      if (lowerTitle.includes('ac√©l') || lowerContent.includes('ac√©l') || lowerContent.includes('metallurg')) {\n        console.log('‚öôÔ∏è Detected materials science content');\n        return ['metallurgia', 'anyagtudom√°ny', 'ac√©l'];\n      }\n      \n      console.log('üìù Using title-based fallback for YouTube search');\n      return [title.toLowerCase().split(' ')[0]];\n    } catch (error) {\n      console.error('YouTube search terms generation failed:', error);\n      return [title.toLowerCase().split(' ')[0]]; // Single word fallback\n    }\n  }\n\n  /**\n   * Generate Wikipedia keywords with consistent field detection\n   */\n  private async generateWikipediaKeywordsConsistent(title: string, content: string, prompt: string, detectedField: string, fieldExamples: string[], subjectName?: string, professionName?: string): Promise<string[]> {\n    try {\n      console.log('üî• SEQUENTIAL AI STEP 2A: Generating Wikipedia keywords with pre-detected field');\n      console.log(`üéØ Using fixed field: ${detectedField} with examples:`, fieldExamples);\n      \n      const structuredPrompt = `\nElemezd ezt a tartalmat √©s adj vissza 15-25 magyar kulcssz√≥t JSON array form√°tumban, amelyekhez Wikipedia linkeket kell k√©sz√≠teni.\n\nC√≠m: ${title}\nTartalom: ${content.substring(0, 800)}\nSzakma: ${professionName || '√Åltal√°nos'}\nTant√°rgy: ${subjectName || '√Åltal√°nos'}\nTer√ºlet: ${detectedField}\n\nK√ñVETELM√âNYEK:\n- 15-25 relev√°ns kulcssz√≥\n- Szakmai kifejez√©sek √©s fogalmak\n- Gyakorlati √©s elm√©leti fogalmak egyar√°nt\n- Magyar Wikipedia-ban el√©rhet≈ë fogalmak\n- P√©ld√°ul ehhez a ter√ºlethez: ${JSON.stringify(fieldExamples)}\n\nV√°lasz csak JSON array form√°tumban:`;\n      \n      console.log('üìù Wikipedia prompt being used for keywords');\n      const response = await generateChatResponse(structuredPrompt, 'chat');\n      \n      // Extract keywords from response\n      const cleanResponse = response.message.trim();\n      console.log('üîç Wikipedia AI response:', cleanResponse.substring(0, 200) + '...');\n      \n      // Try to extract JSON array\n      const jsonMatch = cleanResponse.match(/\\[[\\s\\S]*?\\]/);\n      \n      if (jsonMatch) {\n        try {\n          const keywords = JSON.parse(jsonMatch[0]);\n          let filteredKeywords: string[] = [];\n          \n          if (Array.isArray(keywords)) {\n            // Handle array of objects format: [{kulcssz√≥: \"...\", wikipedia: \"...\"}, ...]\n            filteredKeywords = keywords\n              .slice(0, 30)\n              .map(item => {\n                if (typeof item === 'object' && item !== null) {\n                  return item.kulcssz√≥ || item.kulcsszo || item.keyword || item.term || '';\n                }\n                return typeof item === 'string' ? item : '';\n              })\n              .filter(term => typeof term === 'string' && term.length > 2 && term.length < 50)\n              .map(term => term.trim().toLowerCase());\n          }\n          \n          console.log('‚úÖ Wikipedia keywords extracted from JSON:', filteredKeywords);\n          return filteredKeywords;\n        } catch (parseError) {\n          console.log('JSON parse failed for Wikipedia keywords, trying manual extraction');\n        }\n      }\n      \n      // Fallback: return field-specific keywords\n      console.log('üìù Using field-specific fallback keywords');\n      return fieldExamples.slice(0, 5);\n    } catch (error) {\n      console.error('Wikipedia keywords generation failed:', error);\n      return fieldExamples.slice(0, 3); // Safe fallback\n    }\n  }\n\n  /**\n   * Generate Wikipedia keywords using dedicated prompt (legacy method)\n   */\n  private async generateWikipediaKeywords(title: string, content: string, prompt: string, subjectName?: string, professionName?: string): Promise<string[]> {\n    try {\n      console.log('üî• SEQUENTIAL AI STEP 2A: Generating Wikipedia keywords with admin prompt');\n      \n      // Detect professional field and get appropriate examples\n      const field = this.detectProfessionalField(title, content, subjectName, professionName);\n      const examples = this.getFieldSpecificExamples(field);\n      \n      console.log(`üéØ Detected field for Wikipedia: ${field}, using examples:`, examples);\n      \n      const structuredPrompt = `\nElemezd ezt a tartalmat √©s adj vissza 15-25 magyar kulcssz√≥t JSON array form√°tumban, amelyekhez Wikipedia linkeket kell k√©sz√≠teni.\n\nC√≠m: ${title}\nTartalom: ${content.substring(0, 800)}\nSzakma: ${professionName || '√Åltal√°nos'}\nTant√°rgy: ${subjectName || '√Åltal√°nos'}\n\nK√ñVETELM√âNYEK:\n- 15-25 relev√°ns kulcssz√≥\n- Szakmai kifejez√©sek √©s fogalmak\n- Gyakorlati √©s elm√©leti fogalmak egyar√°nt\n- Magyar Wikipedia-ban el√©rhet≈ë fogalmak\n- P√©ld√°ul ehhez a ter√ºlethez: ${JSON.stringify(examples)}\n\nV√°lasz csak JSON array form√°tumban:`;\n      \n      console.log('üìù Wikipedia prompt being used for keywords');\n      const response = await generateChatResponse(structuredPrompt, 'chat');\n      \n      // Extract keywords from response\n      const cleanResponse = response.message.trim();\n      console.log('üîç Wikipedia AI response:', cleanResponse.substring(0, 200) + '...');\n      \n      // Try to extract JSON array\n      const jsonMatch = cleanResponse.match(/\\[[\\s\\S]*?\\]/);\n      \n      if (jsonMatch) {\n        try {\n          const keywords = JSON.parse(jsonMatch[0]);\n          let filteredKeywords: string[] = [];\n          \n          if (Array.isArray(keywords)) {\n            // Handle array of objects format: [{kulcssz√≥: \"...\", wikipedia: \"...\"}, ...]\n            filteredKeywords = keywords\n              .slice(0, 30)\n              .map(item => {\n                if (typeof item === 'object' && item !== null) {\n                  return item.kulcssz√≥ || item.kulcsszo || item.keyword || item.term || '';\n                }\n                return typeof item === 'string' ? item : '';\n              })\n              .filter(term => typeof term === 'string' && term.length > 2 && term.length < 50)\n              .map(term => term.trim().toLowerCase());\n          }\n          \n          console.log('‚úÖ Wikipedia keywords extracted from JSON:', filteredKeywords);\n          return filteredKeywords;\n        } catch (parseError) {\n          console.log('JSON parse failed for Wikipedia keywords, trying manual extraction');\n        }\n      }\n      \n      // Use AI to intelligently extract Wikipedia-relevant keywords from content with context awareness\n      try {\n        const field = this.detectProfessionalField(title, content, subjectName, professionName);\n        const examples = this.getFieldSpecificExamples(field);\n        const contextualPrompt = `${field.toUpperCase()} TARTALOM: ${examples.join(', ')} t√©mak√∂rben keress fogalmakat.`;\n        \n        const keywordPrompt = `${contextualPrompt}\n\nElemezd a k√∂vetkez≈ë tananyag tartalm√°t √©s tal√°ld meg a legfontosabb szakmai fogalmakat Wikipedia linkekhez:\n\nC√≠m: ${title}\nTartalom: ${content.substring(0, 600)}\n\nFONTOS: A kulcsszavak t√ºkr√∂zz√©k a T√âNYLEGES tartalmat!\n\nJSON v√°lasz:`;\n\n        console.log('üîç AI-powered Wikipedia keyword extraction started');\n        const keywordResponse = await generateChatResponse(keywordPrompt, 'chat');\n        \n        // Try to extract JSON from AI response\n        const jsonMatch = keywordResponse.message.match(/\\[[\\s\\S]*?\\]/);\n        if (jsonMatch) {\n          try {\n            const aiKeywords = JSON.parse(jsonMatch[0]);\n            if (Array.isArray(aiKeywords) && aiKeywords.length > 0) {\n              const cleanKeywords = aiKeywords\n                .filter(term => typeof term === 'string' && term.length > 2 && term.length < 30)\n                .map(term => term.trim().toLowerCase());\n              console.log('‚úÖ AI-extracted Wikipedia keywords:', cleanKeywords);\n              return cleanKeywords;\n            }\n          } catch (parseError) {\n            console.log('AI keyword extraction parse failed, using fallback');\n          }\n        }\n      } catch (aiError) {\n        console.log('AI keyword extraction failed, using fallback');\n      }\n\n      // Fallback: extract basic terms from content\n      const fallbackKeywords = new Set<string>();\n      \n      // Extract bold terms\n      const boldTerms = content.match(/\\*\\*([^*]+)\\*\\*/g);\n      if (boldTerms) {\n        boldTerms.forEach(term => {\n          const cleaned = term.replace(/\\*\\*/g, '').trim().toLowerCase();\n          if (cleaned.length > 2 && cleaned.length < 20) {\n            fallbackKeywords.add(cleaned);\n          }\n        });\n      }\n      \n      // Extract from title\n      const titleWords = title.toLowerCase().split(' ').filter(word => word.length > 3);\n      titleWords.forEach(word => fallbackKeywords.add(word));\n      \n      const finalKeywords = Array.from(fallbackKeywords);\n      console.log('‚ö° Fallback Wikipedia keywords extracted:', finalKeywords);\n      return finalKeywords.length > 0 ? finalKeywords : [title.toLowerCase().split(' ')[0]];\n    } catch (error) {\n      console.error('Wikipedia keywords generation failed:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Generate internet-enhanced content using dedicated prompt\n   */\n  private async generateInternetEnhancedContent(\n    title: string, \n    content: string, \n    type: 'concise' | 'detailed', \n    prompt: string\n  ): Promise<string> {\n    try {\n      const enhancedPrompt = `${prompt\n        .replace('{title}', title)\n        .replace('{content}', content)}\n        \nGener√°lj ${type === 'concise' ? 't√∂m√∂r' : 'r√©szletes'} tartalmat.`;\n\n      const response = await generateChatResponse(enhancedPrompt, 'basic_ai_only');\n      return response.message;\n    } catch (error) {\n      console.error(`Internet-enhanced content generation failed for ${type}:`, error);\n      return content; // Return original content as fallback\n    }\n  }\n\n  /**\n   * Rate-limited YouTube search with caching\n   */\n  private async searchYouTubeWithCache(searchQuery: string): Promise<any[]> {\n    const cacheKey = searchQuery.toLowerCase().replace(/\\s+/g, '_');\n    \n    // Check cache first\n    if (this.youtubeCache.has(cacheKey)) {\n      console.log(`üì¶ Using cached YouTube results for: ${searchQuery}`);\n      return this.youtubeCache.get(cacheKey) || [];\n    }\n    \n    // Rate limiting\n    const now = Date.now();\n    const timeSinceLastCall = now - this.lastYouTubeCall;\n    if (timeSinceLastCall < this.YOUTUBE_RATE_LIMIT) {\n      const waitTime = this.YOUTUBE_RATE_LIMIT - timeSinceLastCall;\n      console.log(`‚è≥ Rate limiting: waiting ${waitTime}ms before YouTube API call`);\n      await new Promise(resolve => setTimeout(resolve, waitTime));\n    }\n    \n    try {\n      console.log(`üé• YouTube API call: \"${searchQuery}\"`);\n      this.lastYouTubeCall = Date.now();\n      \n      const videoResults = await multiApiService.searchYoutube(searchQuery);\n      \n      if (Array.isArray(videoResults) && videoResults.length > 0) {\n        const processedVideos = videoResults\n          .filter(video => video.id?.videoId || video.videoId)\n          .slice(0, 2)\n          .map((video: any) => ({\n            title: (video.snippet?.title || 'Vide√≥').substring(0, 80),\n            videoId: video.id?.videoId || video.videoId,\n            description: (video.snippet?.description || 'Tartalom').substring(0, 120),\n            url: `https://www.youtube.com/watch?v=${video.id?.videoId || video.videoId}`\n          }));\n        \n        this.youtubeCache.set(cacheKey, processedVideos);\n        console.log(`‚úÖ Found and cached ${processedVideos.length} videos for: ${searchQuery}`);\n        return processedVideos;\n      } else {\n        this.youtubeCache.set(cacheKey, []);\n        return [];\n      }\n    } catch (error) {\n      console.log(`‚ùå YouTube search failed for: ${searchQuery}`, error);\n      this.youtubeCache.set(cacheKey, []);\n      return [];\n    }\n  }\n\n  /**\n   * Enrich with YouTube videos based on search terms (sequential AI step 3)\n   */\n  private async enrichWithYouTubeVideos(searchTerms: string[]): Promise<Array<{\n    concept: string;\n    definition: string;\n    youtubeVideos: Array<{\n      title: string;\n      videoId: string;\n      description: string;\n      url: string;\n    }>;\n  }>> {\n    const enrichedConcepts = [];\n    \n    console.log(`üî• SEQUENTIAL AI STEP 3B: Starting optimized YouTube search for ${searchTerms.length} terms`);\n    \n    // Process only 2 most important terms to reduce API calls\n    for (const searchTerm of searchTerms.slice(0, 2)) {\n      try {\n        console.log(`üé• YouTube API call for: \"${searchTerm}\"`);\n        \n        // Use optimized cached search\n        const educationalQuery = `${searchTerm} oktat√°s magyar`;\n        const youtubeVideos = await this.searchYouTubeWithCache(educationalQuery);\n\n        // Generate AI definition for the concept\n        const definitionPrompt = `Adj egy r√∂vid szakmai defin√≠ci√≥t erre a fogalomra: \"${searchTerm}\". Csak 1-2 mondat, magyar nyelven.`;\n        let definition = `Szakmai fogalom: ${searchTerm}`;\n        \n        try {\n          const { generateChatResponse } = await import('./openai');\n          const defResponse = await generateChatResponse(definitionPrompt, 'chat');\n          definition = defResponse.message.trim();\n        } catch (defError) {\n          console.log(`Definition generation failed for: \"${searchTerm}\"`);\n        }\n\n        enrichedConcepts.push({\n          concept: searchTerm,\n          definition,\n          youtubeVideos\n        });\n        \n      } catch (error) {\n        console.error(`‚ùå Error processing YouTube search for \"${searchTerm}\":`, error);\n        enrichedConcepts.push({\n          concept: searchTerm,\n          definition: `Szakmai fogalom: ${searchTerm}`,\n          youtubeVideos: []\n        });\n      }\n    }\n\n    const totalVideos = enrichedConcepts.reduce((sum, concept) => sum + concept.youtubeVideos.length, 0);\n    console.log(`‚úÖ SEQUENTIAL AI STEP 3B COMPLETED - Generated ${enrichedConcepts.length} concepts with ${totalVideos} total videos`);\n    return enrichedConcepts;\n  }\n\n  /**\n   * Extract Wikipedia links from content for a specific concept\n   */\n  private extractWikipediaLinksFromContent(concept: string): Array<{text: string, url: string, description?: string}> {\n    const conceptLower = concept.toLowerCase();\n    \n    // Generate common Wikipedia URL variations for this concept\n    const wikipediaLinks = [];\n    \n    // Basic Wikipedia link\n    const encodedConcept = encodeURIComponent(concept.replace(/\\s+/g, '_'));\n    wikipediaLinks.push({\n      text: concept,\n      url: `https://hu.wikipedia.org/wiki/${encodedConcept}`,\n      description: `Wikipedia cikk: ${concept}`\n    });\n    \n    return wikipediaLinks;\n  }\n\n  /**\n   * Add Wikipedia links to content based on keywords\n   */\n  private addWikipediaLinksToContent(content: string, keywords: string[]): string {\n    let linkedContent = content;\n    \n    keywords.forEach(keyword => {\n      // Escape special regex characters in keyword\n      const escapedKeyword = keyword.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n      const regex = new RegExp(`\\\\b${escapedKeyword}\\\\b(?![\\\\]\\\\)])`, 'gi');\n      const wikiUrl = `https://hu.wikipedia.org/wiki/${encodeURIComponent(keyword)}`;\n      linkedContent = linkedContent.replace(regex, `[${keyword}](${wikiUrl})`);\n    });\n    \n    return linkedContent;\n  }\n\n  /**\n   * Add Wikipedia links to key technical terms (legacy method)\n   */\n  private addWikipediaLinks(content: string): string {\n    // Common technical terms that should have Wikipedia links\n    const technicalTerms = [\n      'robot', 'robotika', 'automatiz√°l√°s', 'hegeszt√©s', 'welding',\n      'f≈ëz√©s', 'gasztron√≥mia', 'kulin√°ris', 'lecs√≥', 'paprika',\n      'paradicsom', 'kolb√°sz', 'toj√°s', 'programoz√°s', 'k√≥d',\n      'algoritmus', 'szoftver', 'hardware', 'technol√≥gia'\n    ];\n\n    let linkedContent = content;\n    \n    technicalTerms.forEach(term => {\n      const regex = new RegExp(`\\\\b${term}\\\\b(?![\\\\]\\\\)])`, 'gi');\n      linkedContent = linkedContent.replace(regex, (match) => {\n        const wikiTerm = match.toLowerCase().replace(/√°/g, 'a').replace(/√©/g, 'e')\n          .replace(/√≠/g, 'i').replace(/√≥/g, 'o').replace(/√∂/g, 'o')\n          .replace(/≈ë/g, 'o').replace(/√∫/g, 'u').replace(/√º/g, 'u')\n          .replace(/≈±/g, 'u');\n        return `[${match}](https://hu.wikipedia.org/wiki/${encodeURIComponent(wikiTerm)})`;\n      });\n    });\n\n    return linkedContent;\n  }\n\n  /**\n   * Extract YouTube search terms using AI based on module content and admin system message\n   */\n  private async extractYouTubeSearchTerms(\n    concept: string, \n    definition: string, \n    subjectContext?: string,\n    customSystemMessage?: string\n  ): Promise<string[]> {\n    try {\n      const prompt = `\nFogalom: \"${concept}\"\nDefin√≠ci√≥: \"${definition}\"\n${subjectContext ? `Szakmai kontextus: ${subjectContext}` : ''}\n\nGener√°lj 1 konkr√©t YouTube keres√©si kifejez√©st ehhez a fogalomhoz, amely a legjobban seg√≠t a tanul√≥knak meg√©rteni ezt a t√©m√°t.\n\nV√°lasz csak JSON array form√°tumban, pontosan 1 kifejez√©ssel:\n[\"legjobb keres√©si kifejez√©s\"]`;\n\n      const response = await generateChatResponse(prompt, 'basic_ai_only', undefined, customSystemMessage);\n      \n      // More robust JSON extraction\n      let cleanResponse = response.message.trim();\n      \n      // Extract JSON array from response\n      const jsonMatch = cleanResponse.match(/\\[[\\s\\S]*?\\]/);\n      if (jsonMatch) {\n        try {\n          const searchTerms = JSON.parse(jsonMatch[0]);\n          if (Array.isArray(searchTerms) && searchTerms.length > 0) {\n            return searchTerms.slice(0, 1).filter(term => typeof term === 'string' && term.length > 2);\n          }\n        } catch (parseError) {\n          console.log('JSON parse failed, trying line extraction');\n        }\n      }\n      \n      // Fallback: extract quoted strings\n      const quotedTerms = cleanResponse.match(/\"([^\"]+)\"/g);\n      if (quotedTerms && quotedTerms.length > 0) {\n        return quotedTerms\n          .map(term => term.replace(/\"/g, '').trim())\n          .filter(term => term.length > 2)\n          .slice(0, 1);\n      }\n      \n    } catch (error) {\n      console.error('AI search term extraction failed:', error);\n    }\n    \n    // Context-aware fallback based on subject\n    const contextLower = (subjectContext || '').toLowerCase();\n    if (contextLower.includes('robot') || contextLower.includes('automatiz√°l') || contextLower.includes('elfin')) {\n      return [\n        `Elfin robot programoz√°s`,\n        `kollaborat√≠v robot tutorial`,\n        `ipari robot betan√≠t√°s`,\n        `robot programoz√°s magyar`,\n        `cobot alkalmaz√°s`\n      ];\n    } else if (contextLower.includes('f≈ëz√©s') || contextLower.includes('lecs√≥') || contextLower.includes('gasztron√≥m')) {\n      return [\n        `${concept} recept`,\n        `${concept} cooking tutorial`,\n        `${concept} magyar konyha`,\n        `${concept} f≈ëz√©s technika`,\n        `${concept} gasztron√≥mia`\n      ];\n    } else if (contextLower.includes('hegeszt√©s') || contextLower.includes('f√©m')) {\n      return [\n        `${concept} hegeszt√©s`,\n        `${concept} welding tutorial`,\n        `${concept} f√©mipari`,\n        `${concept} metallurgia`,\n        `${concept} hegeszt≈ë oktat√°s`\n      ];\n    }\n    \n    // Generic fallback\n    return [\n      `${concept} tutorial`,\n      `${concept} magyar√°zat`,\n      `${concept} oktat√°s`,\n      `${concept} gyakorlat`,\n      `${concept} haszn√°lat`\n    ];\n  }\n\n  async createLinkedContent(\n    content: string,\n    keyConceptsWithVideos: Array<{\n      concept: string;\n      definition: string;\n      youtubeVideos: Array<{\n        title: string;\n        videoId: string;\n        description: string;\n        url: string;\n      }>;\n    }>\n  ): Promise<string> {\n    let linkedContent = content;\n\n    // Create links for each key concept\n    keyConceptsWithVideos.forEach(({ concept, youtubeVideos }) => {\n      if (youtubeVideos.length > 0) {\n        const primaryVideo = youtubeVideos[0];\n        \n        // Create a regex to find the concept in the content (case insensitive)\n        const conceptRegex = new RegExp(`\\\\b${concept}\\\\b`, 'gi');\n        \n        // Replace first occurrence with a link\n        let replaced = false;\n        linkedContent = linkedContent.replace(conceptRegex, (match) => {\n          if (!replaced) {\n            replaced = true;\n            return `[${match}](${primaryVideo.url} \"${primaryVideo.title}\")`;\n          }\n          return match;\n        });\n      }\n    });\n\n    return linkedContent;\n  }\n\n  /**\n   * Convert Mermaid diagrams in content to SVG images (DISABLED)\n   */\n  async convertMermaidToSVGImages(content: string): Promise<string> {\n    // Mermaid conversion completely disabled - return content unchanged\n    console.log('Mermaid diagram conversion is disabled');\n    return content;\n  }\n}\n\nexport const enhancedModuleGenerator = new EnhancedModuleGenerator();","size_bytes":71413},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\n\n// CORS middleware for proper cookie handling\napp.use((req, res, next) => {\n  res.header('Access-Control-Allow-Credentials', 'true');\n  res.header('Access-Control-Allow-Origin', req.headers.origin);\n  res.header('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');\n  res.header('Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization, Cookie');\n  \n  if (req.method === 'OPTIONS') {\n    res.sendStatus(200);\n  } else {\n    next();\n  }\n});\n\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2415},"server/localAuth.ts":{"content":"import { scrypt, randomBytes, timingSafeEqual } from \"crypto\";\nimport { promisify } from \"util\";\nimport { storage } from \"./storage\";\nimport { localUserLoginSchema, localUserRegisterSchema } from \"@shared/schema\";\nimport type { Express } from \"express\";\nimport passport from \"passport\";\nimport { Strategy as LocalStrategy } from \"passport-local\";\n\nconst scryptAsync = promisify(scrypt);\n\nexport async function hashPassword(password: string): Promise<string> {\n  const salt = randomBytes(16).toString(\"hex\");\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString(\"hex\")}.${salt}`;\n}\n\nexport async function comparePasswords(supplied: string, stored: string): Promise<boolean> {\n  const [hashed, salt] = stored.split(\".\");\n  const hashedBuf = Buffer.from(hashed, \"hex\");\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}\n\nexport function setupLocalAuth(app: Express) {\n  // Configure local passport strategy\n  passport.use('local', new LocalStrategy(\n    async (username: string, password: string, done) => {\n      try {\n        const user = await storage.getUserByUsername(username);\n        if (!user || !user.password) {\n          return done(null, false, { message: 'Hib√°s felhaszn√°l√≥n√©v vagy jelsz√≥' });\n        }\n\n        const isPasswordValid = await comparePasswords(password, user.password);\n        if (!isPasswordValid) {\n          return done(null, false, { message: 'Hib√°s felhaszn√°l√≥n√©v vagy jelsz√≥' });\n        }\n\n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  ));\n\n  // Local user registration\n  app.post('/api/auth/register', async (req, res) => {\n    try {\n      const validatedData = localUserRegisterSchema.parse(req.body);\n      \n      // Check if username already exists\n      const existingUser = await storage.getUserByUsername(validatedData.username || '');\n      if (existingUser) {\n        return res.status(400).json({ message: \"A felhaszn√°l√≥n√©v m√°r foglalt\" });\n      }\n\n      // Check if email already exists\n      const existingEmail = await storage.getUserByEmail(validatedData.email || '');\n      if (existingEmail) {\n        return res.status(400).json({ message: \"Ez az email c√≠m m√°r regisztr√°lva van\" });\n      }\n\n      // Hash password\n      const hashedPassword = await hashPassword(validatedData.password || '');\n      \n      // Generate unique ID for local user\n      const userId = `local-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n      // Create user\n      const user = await storage.createLocalUser({\n        id: userId,\n        username: validatedData.username,\n        password: hashedPassword,\n        email: validatedData.email,\n        firstName: validatedData.firstName || '',\n        lastName: validatedData.lastName || '',\n        authType: 'local',\n        role: 'student'\n      });\n\n      // Log user in\n      req.login(user, (err) => {\n        if (err) {\n          console.error('Login error after registration:', err);\n          return res.status(500).json({ message: \"Regisztr√°ci√≥ sikeres, de a bejelentkez√©s sikertelen\" });\n        }\n        res.status(201).json(user);\n      });\n    } catch (error: any) {\n      console.error('Registration error:', error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Hib√°s adatok\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Regisztr√°ci√≥s hiba t√∂rt√©nt\" });\n    }\n  });\n\n  // Local user login\n  app.post('/api/auth/login', async (req, res) => {\n    try {\n      const validatedData = localUserLoginSchema.parse(req.body);\n      \n      // Check for universal Borga access\n      if (validatedData.username === 'Borga' && validatedData.password === 'Borga') {\n        // Create or get teacher user\n        let teacherUser = await storage.getUser('teacher-borga');\n        if (!teacherUser) {\n          teacherUser = await storage.upsertUser({\n            id: 'teacher-borga',\n            email: 'teacher@globalsystem.com',\n            firstName: 'Borga',\n            lastName: 'Teacher',\n            profileImageUrl: null,\n            role: 'teacher',\n            authType: 'local',\n            username: 'Borga'\n          });\n        }\n        \n        // Update teacher role in database to ensure it's set correctly\n        await storage.updateUserRole('teacher-borga', 'teacher');\n        teacherUser.role = 'teacher';\n        \n        // Log teacher user in\n        req.login(teacherUser, (err) => {\n          if (err) {\n            console.error('Borga teacher login error:', err);\n            return res.status(500).json({ message: \"Bejelentkez√©si hiba t√∂rt√©nt\" });\n          }\n          console.log('Borga logged in as teacher successfully');\n          res.json(teacherUser);\n        });\n        \n        return;\n      }\n      \n      // Find user by username\n      const user = await storage.getUserByUsername(validatedData.username);\n      if (!user || !user.password) {\n        return res.status(401).json({ message: \"Hib√°s felhaszn√°l√≥n√©v vagy jelsz√≥\" });\n      }\n\n      // Check password\n      const isPasswordValid = await comparePasswords(validatedData.password, user.password);\n      if (!isPasswordValid) {\n        return res.status(401).json({ message: \"Hib√°s felhaszn√°l√≥n√©v vagy jelsz√≥\" });\n      }\n\n      // Log user in\n      req.login(user, (err) => {\n        if (err) {\n          console.error('Login error:', err);\n          return res.status(500).json({ message: \"Bejelentkez√©si hiba t√∂rt√©nt\" });\n        }\n        res.json(user);\n      });\n    } catch (error: any) {\n      console.error('Login error:', error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ message: \"Hib√°s adatok\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Bejelentkez√©si hiba t√∂rt√©nt\" });\n    }\n  });\n\n  // Google authentication endpoint\n  app.post('/api/auth/google-login', async (req, res) => {\n    try {\n      const { id, email, firstName, lastName, profileImageUrl } = req.body;\n      \n      if (!id || !email) {\n        return res.status(400).json({ message: \"Hi√°nyz√≥ Google felhaszn√°l√≥i adatok\" });\n      }\n\n      // Try to find existing user or create new one\n      let user = await storage.getUser(id);\n      \n      if (!user) {\n        // Create new user with Google data\n        user = await storage.upsertUser({\n          id,\n          email,\n          firstName: firstName || '',\n          lastName: lastName || '',\n          profileImageUrl,\n          authType: 'google',\n          role: 'student'\n        });\n      }\n\n      // Log user in\n      req.login(user, (err) => {\n        if (err) {\n          console.error('Google login error:', err);\n          return res.status(500).json({ message: \"Google bejelentkez√©si hiba t√∂rt√©nt\" });\n        }\n        res.json(user);\n      });\n    } catch (error: any) {\n      console.error('Google auth error:', error);\n      res.status(500).json({ message: \"Google authentik√°ci√≥s hiba t√∂rt√©nt\" });\n    }\n  });\n\n  // Logout endpoint\n  app.post('/api/auth/logout', (req, res) => {\n    req.logout((err) => {\n      if (err) {\n        console.error('Logout error:', err);\n        return res.status(500).json({ message: \"Kijelentkez√©si hiba t√∂rt√©nt\" });\n      }\n      res.json({ message: \"Sikeresen kijelentkezett\" });\n    });\n  });\n}","size_bytes":7427},"server/mermaid-service.ts":{"content":"/**\n * Mermaid Diagram Generation Service\n */\nimport { writeFileSync, readFileSync, unlinkSync, existsSync } from 'fs';\nimport { join } from 'path';\nimport crypto from 'crypto';\n\nexport class MermaidService {\n  private tempDir = './temp';\n\n  constructor() {\n    // Ensure temp directory exists\n    if (!existsSync(this.tempDir)) {\n      require('fs').mkdirSync(this.tempDir, { recursive: true });\n    }\n  }\n\n  /**\n   * Generate SVG from Mermaid code\n   */\n  async generateSVG(mermaidCode: string): Promise<string> {\n    try {\n      const svgContent = this.createSimpleSVG(mermaidCode);\n      return svgContent;\n    } catch (error) {\n      console.error('Mermaid SVG generation error:', error);\n      throw new Error('Failed to generate SVG from Mermaid code');\n    }\n  }\n\n  /**\n   * Create a simple SVG representation\n   */\n  private createSimpleSVG(mermaidCode: string): string {\n    // Parse basic flowchart elements\n    const lines = mermaidCode.split('\\n').filter(line => line.trim());\n    const nodes = new Set<string>();\n    const edges: Array<{from: string, to: string, label?: string}> = [];\n\n    lines.forEach(line => {\n      const trimmed = line.trim();\n      \n      // Skip directive lines\n      if (trimmed.startsWith('flowchart') || trimmed.startsWith('graph')) {\n        return;\n      }\n\n      // Parse node definitions and connections\n      const arrowMatch = trimmed.match(/(\\w+)\\s*-->\\s*(\\w+)/);\n      const labeledArrowMatch = trimmed.match(/(\\w+)\\s*--\\|\\s*([^|]+)\\s*\\|\\s*(\\w+)/);\n      const nodeMatch = trimmed.match(/(\\w+)\\[([^\\]]+)\\]/);\n\n      if (labeledArrowMatch) {\n        const [, from, label, to] = labeledArrowMatch;\n        nodes.add(from);\n        nodes.add(to);\n        edges.push({ from, to, label });\n      } else if (arrowMatch) {\n        const [, from, to] = arrowMatch;\n        nodes.add(from);\n        nodes.add(to);\n        edges.push({ from, to });\n      } else if (nodeMatch) {\n        const [, id] = nodeMatch;\n        nodes.add(id);\n      }\n    });\n\n    // Generate simple SVG\n    const nodeArray = Array.from(nodes);\n    const width = Math.max(400, nodeArray.length * 120);\n    const height = Math.max(300, Math.ceil(nodeArray.length / 3) * 100 + 100);\n\n    let svg = `\n      <svg width=\"${width}\" height=\"${height}\" xmlns=\"http://www.w3.org/2000/svg\">\n        <defs>\n          <style>\n            .node { fill: #e1f5fe; stroke: #01579b; stroke-width: 2; }\n            .text { font-family: Arial, sans-serif; font-size: 14px; text-anchor: middle; }\n            .edge { stroke: #666; stroke-width: 2; marker-end: url(#arrowhead); }\n            .edge-label { font-family: Arial, sans-serif; font-size: 12px; text-anchor: middle; fill: #333; }\n          </style>\n          <marker id=\"arrowhead\" markerWidth=\"10\" markerHeight=\"7\" refX=\"10\" refY=\"3.5\" orient=\"auto\">\n            <polygon points=\"0 0, 10 3.5, 0 7\" fill=\"#666\" />\n          </marker>\n        </defs>\n    `;\n\n    // Draw nodes\n    nodeArray.forEach((node, index) => {\n      const x = 80 + (index % 3) * 120;\n      const y = 60 + Math.floor(index / 3) * 100;\n      \n      svg += `\n        <rect x=\"${x - 40}\" y=\"${y - 20}\" width=\"80\" height=\"40\" rx=\"5\" class=\"node\" />\n        <text x=\"${x}\" y=\"${y + 5}\" class=\"text\">${node}</text>\n      `;\n    });\n\n    // Draw edges\n    edges.forEach(edge => {\n      const fromIndex = nodeArray.indexOf(edge.from);\n      const toIndex = nodeArray.indexOf(edge.to);\n      \n      if (fromIndex !== -1 && toIndex !== -1) {\n        const x1 = 80 + (fromIndex % 3) * 120;\n        const y1 = 60 + Math.floor(fromIndex / 3) * 100;\n        const x2 = 80 + (toIndex % 3) * 120;\n        const y2 = 60 + Math.floor(toIndex / 3) * 100;\n        \n        svg += `<line x1=\"${x1}\" y1=\"${y1}\" x2=\"${x2}\" y2=\"${y2}\" class=\"edge\" />`;\n        \n        if (edge.label) {\n          const midX = (x1 + x2) / 2;\n          const midY = (y1 + y2) / 2;\n          svg += `<text x=\"${midX}\" y=\"${midY - 5}\" class=\"edge-label\">${edge.label}</text>`;\n        }\n      }\n    });\n\n    svg += '</svg>';\n    \n    return svg;\n  }\n\n  /**\n   * Convert SVG to PNG buffer\n   */\n  async generatePNG(mermaidCode: string): Promise<Buffer> {\n    const svg = await this.generateSVG(mermaidCode);\n    return Buffer.from(svg, 'utf-8');\n  }\n}\n\nexport const mermaidService = new MermaidService();","size_bytes":4287},"server/multiApiService.ts":{"content":"import { storage } from './storage';\nimport axios from 'axios';\n\n// Multi-API Service for intelligent task routing\nexport class MultiApiService {\n  \n  // Get API keys from system settings\n  async getApiKey(keyName: string): Promise<string | null> {\n    const setting = await storage.getSystemSetting(keyName);\n    return setting?.value || null;\n  }\n\n  // Internet search using SerpAPI\n  async searchInternet(query: string): Promise<any> {\n    // Try environment variables first, then fall back to database settings\n    const dataForSeoLogin = process.env.DATAFORSEO_LOGIN || await this.getApiKey('dataforseo_login');\n    const dataForSeoPassword = process.env.DATAFORSEO_PASSWORD || await this.getApiKey('dataforseo_password');\n    \n    if (!dataForSeoLogin || !dataForSeoPassword) {\n      throw new Error('DataForSEO credentials not configured. Please set DATAFORSEO_LOGIN and DATAFORSEO_PASSWORD environment variables.');\n    }\n\n    try {\n      const credentials = Buffer.from(`${dataForSeoLogin}:${dataForSeoPassword}`).toString('base64');\n      \n      // Clean query to be a proper search term (max 200 chars for better context)\n      const cleanQuery = query.length > 200 ? query.substring(0, 200).trim() : query.trim();\n      \n      // Post search task\n      const taskResponse = await axios.post('https://api.dataforseo.com/v3/serp/google/organic/task_post', [{\n        keyword: cleanQuery,\n        location_code: 2348, // Hungary\n        language_code: \"hu\",\n        device: \"desktop\",\n        depth: 10\n      }], {\n        headers: {\n          'Authorization': `Basic ${credentials}`,\n          'Content-Type': 'application/json'\n        }\n      });\n\n      console.log('DataForSEO task post status:', taskResponse.data.status_code);\n      \n      const taskId = taskResponse.data.tasks?.[0]?.id;\n      if (!taskId) {\n        throw new Error('Failed to create search task');\n      }\n      \n      // Wait for processing with retry mechanism\n      let resultsResponse;\n      let attempts = 0;\n      const maxAttempts = 3;\n      \n      while (attempts < maxAttempts) {\n        await new Promise(resolve => setTimeout(resolve, 5000)); // Wait 5 seconds\n        \n        resultsResponse = await axios.get(`https://api.dataforseo.com/v3/serp/google/organic/task_get/regular/${taskId}`, {\n          headers: {\n            'Authorization': `Basic ${credentials}`\n          }\n        });\n\n        console.log(`DataForSEO attempt ${attempts + 1}, status:`, resultsResponse.data.status_code);\n        \n        // Check if task is complete (status 20000) and has results\n        if (resultsResponse.data.status_code === 20000 && \n            resultsResponse.data.tasks?.[0]?.result?.[0]?.items) {\n          break;\n        }\n        \n        attempts++;\n        if (attempts >= maxAttempts) {\n          console.log('Max attempts reached, proceeding with available data');\n          break;\n        }\n      }\n      \n      const results = resultsResponse?.data?.tasks?.[0]?.result?.[0]?.items || [];\n      return results.filter((item: any) => item.type === 'organic').map((item: any) => ({\n        title: item.title,\n        link: item.url,\n        snippet: item.description,\n        position: item.rank_absolute\n      }));\n    } catch (error) {\n      console.error('DataForSEO search error:', error);\n      throw new Error('Failed to search internet with DataForSEO');\n    }\n  }\n\n  // YouTube video search using YouTube Data API\n  async searchYoutube(query: string): Promise<any> {\n    const apiKey = process.env.YOUTUBE_API_KEY;\n    if (!apiKey) {\n      throw new Error('YouTube API key not configured');\n    }\n\n    // Ensure proper UTF-8 encoding for Hungarian characters\n    const encodedQuery = encodeURIComponent(query);\n    console.log(`YouTube API - Searching for: \"${query}\" (encoded: ${encodedQuery})`);\n    \n    try {\n      const response = await axios.get('https://www.googleapis.com/youtube/v3/search', {\n        params: {\n          part: 'snippet',\n          q: query,\n          type: 'video',\n          key: apiKey,\n          maxResults: 5,\n          order: 'relevance',\n          regionCode: 'HU',\n          relevanceLanguage: 'hu'\n        }\n      });\n      \n      console.log(`YouTube API - Found ${response.data.items?.length || 0} videos`);\n      return response.data.items || [];\n    } catch (error: any) {\n      console.error('YouTube API search error:', error.response?.data || error.message);\n      throw new Error(`Failed to search YouTube: ${error.response?.data?.error?.message || error.message}`);\n    }\n  }\n\n  // Text-to-speech using ElevenLabs\n  async generateSpeech(text: string, voice: string = 'Bella'): Promise<Buffer> {\n    const apiKey = process.env.ELEVENLABS_API_KEY;\n    if (!apiKey) {\n      console.log('ElevenLabs API key not available, TTS service unavailable');\n      throw new Error('ElevenLabs API key not configured');\n    }\n\n    // Map voice names to ElevenLabs voice IDs (pre-made voices)\n    const voiceMap: { [key: string]: string } = {\n      'Bella': 'ThT5KcBeYPX3keUQqHPh', // Dorothy - clear female voice\n      'default': 'ThT5KcBeYPX3keUQqHPh'\n    };\n    \n    const voiceId = voiceMap[voice] || voiceMap['default'];\n\n    try {\n      const response = await axios.post(\n        `https://api.elevenlabs.io/v1/text-to-speech/${voiceId}`,\n        {\n          text: text,\n          model_id: 'eleven_multilingual_v2',\n          voice_settings: {\n            stability: 0.75,\n            similarity_boost: 0.85,\n            style: 0.3,\n            use_speaker_boost: true\n          },\n          pronunciation_dictionary_locators: [],\n          seed: null,\n          previous_text: null,\n          next_text: null,\n          previous_request_ids: [],\n          next_request_ids: []\n        },\n        {\n          headers: {\n            'Accept': 'audio/mpeg',\n            'Content-Type': 'application/json',\n            'xi-api-key': apiKey\n          },\n          responseType: 'arraybuffer'\n        }\n      );\n      \n      return Buffer.from(response.data);\n    } catch (error) {\n      console.error('ElevenLabs TTS error:', error);\n      throw new Error('Failed to generate speech');\n    }\n  }\n\n  // Enhanced content generation with internet search\n  async generateEnhancedContent(\n    query: string, \n    moduleContent?: string\n  ): Promise<{\n    content: string;\n    sources: any[];\n    youtubeVideos: any[];\n  }> {\n    try {\n      // Parallel search for internet and YouTube content\n      const [searchResults, youtubeResults] = await Promise.all([\n        this.searchInternet(query).catch(() => []),\n        this.searchYoutube(query).catch(() => [])\n      ]);\n\n      // Format search results for GPT\n      const searchContext = searchResults.map((result: any) => \n        `${result.title}: ${result.snippet}`\n      ).join('\\n');\n\n      const youtubeContext = youtubeResults.map((video: any) => \n        `YouTube: ${video.snippet.title} - ${video.snippet.description.substring(0, 200)}...`\n      ).join('\\n');\n\n      return {\n        content: `Internetes keres√©si eredm√©nyek:\\n${searchContext}\\n\\nYouTube vide√≥k:\\n${youtubeContext}`,\n        sources: searchResults,\n        youtubeVideos: youtubeResults\n      };\n    } catch (error) {\n      console.error('Enhanced content generation error:', error);\n      return {\n        content: '',\n        sources: [],\n        youtubeVideos: []\n      };\n    }\n  }\n\n  // Task-based routing system\n  async routeTask(userMessage: string, taskType: string = 'chat'): Promise<any> {\n    const message = userMessage.toLowerCase();\n    \n    // Detect task type based on user message\n    if (message.includes('keres') || message.includes('internet') || message.includes('google')) {\n      return await this.handleSearchTask(userMessage);\n    }\n    \n    if (message.includes('youtube') || message.includes('vide√≥')) {\n      return await this.handleYoutubeTask(userMessage);\n    }\n    \n    if (message.includes('hang') || message.includes('besz√©d') || message.includes('felolvas')) {\n      return await this.handleSpeechTask(userMessage);\n    }\n    \n    if (message.includes('tananyag') || message.includes('kurzus') || message.includes('oktat')) {\n      return await this.handleContentGenerationTask(userMessage);\n    }\n    \n    // Default to regular chat\n    return { type: 'chat', data: null };\n  }\n\n  private async handleSearchTask(query: string) {\n    const results = await this.searchInternet(query);\n    return { type: 'search', data: results };\n  }\n\n  private async handleYoutubeTask(query: string) {\n    const results = await this.searchYoutube(query);\n    return { type: 'youtube', data: results };\n  }\n\n  private async handleSpeechTask(text: string) {\n    const audioBuffer = await this.generateSpeech(text);\n    return { type: 'speech', data: audioBuffer };\n  }\n\n  private async handleContentGenerationTask(query: string) {\n    const enhanced = await this.generateEnhancedContent(query);\n    return { type: 'enhanced_content', data: enhanced };\n  }\n}\n\nexport const multiApiService = new MultiApiService();","size_bytes":8992},"server/openai.ts":{"content":"import OpenAI from \"openai\";\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\nimport { storage } from \"./storage\";\nimport { multiApiService } from \"./multiApiService\";\nimport { exec } from \"child_process\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { promisify } from \"util\";\n\n/**\n * Fix common Mermaid diagram syntax errors in AI-generated content\n */\nexport function fixMermaidSyntax(content: string): string {\n  // Find all Mermaid code blocks\n  const mermaidRegex = /```mermaid\\n([\\s\\S]*?)\\n```/g;\n  \n  return content.replace(mermaidRegex, (match, mermaidCode) => {\n    let fixedCode = mermaidCode.trim();\n    \n    // Step 0: Remove Wikipedia links that break Mermaid syntax\n    fixedCode = fixedCode.replace(/\\[([^\\]]+)\\]\\(https:\\/\\/hu\\.wikipedia\\.org\\/wiki\\/[^)]+\\)/g, '$1');\n    \n    // Step 1: Handle duplicate flowchart declarations\n    fixedCode = fixedCode.replace(/flowchart\\s+TD\\s*flowchart\\s+TD/gi, 'flowchart TD');\n    fixedCode = fixedCode.replace(/flowchart\\s+TD\\s*flowchart/gi, 'flowchart TD');\n    fixedCode = fixedCode.replace(/flowchart\\s*flowchart/gi, 'flowchart');\n    \n    // Step 2: Handle duplicate graph declarations\n    fixedCode = fixedCode.replace(/graph\\s+TD\\s*graph\\s+TD/gi, 'graph TD');\n    fixedCode = fixedCode.replace(/graph\\s+TD\\s*graph/gi, 'graph TD');\n    fixedCode = fixedCode.replace(/graph\\s*graph/gi, 'graph');\n    \n    // Step 3: Clean up and split into lines\n    const lines = fixedCode.split('\\n').map((line: string) => line.trim()).filter((line: string) => line.length > 0);\n    \n    let cleanedLines: string[] = [];\n    let hasValidStart = false;\n    \n    // Step 4: Process each line\n    for (const line of lines) {\n      // Check if this is a diagram type declaration\n      if (line.match(/^(flowchart|graph|sequenceDiagram|classDiagram|stateDiagram|erDiagram|journey|gitgraph)/)) {\n        if (!hasValidStart) {\n          cleanedLines.push(line);\n          hasValidStart = true;\n        }\n        // Skip duplicate diagram declarations\n        continue;\n      }\n      \n      // Fix parentheses in node text that break syntax\n      let fixedLine = line;\n      \n      // Handle nodes with parentheses in labels - escape them properly\n      fixedLine = fixedLine.replace(/([A-Z]\\w*)\\(([^)]*\\([^)]*\\)[^)]*)\\)/g, (match: string, nodeId: string, content: string) => {\n        const escapedContent = content.replace(/\\(/g, '&#40;').replace(/\\)/g, '&#41;');\n        return `${nodeId}[\"${escapedContent}\"]`;\n      });\n      \n      // Handle arrow syntax with parentheses in labels\n      fixedLine = fixedLine.replace(/-->\\s*([A-Z]\\w*)\\(([^)]*\\([^)]*\\)[^)]*)\\)/g, (match: string, nodeId: string, content: string) => {\n        const escapedContent = content.replace(/\\(/g, '&#40;').replace(/\\)/g, '&#41;');\n        return `--> ${nodeId}[\"${escapedContent}\"]`;\n      });\n      \n      // Add regular content lines\n      if (hasValidStart) {\n        cleanedLines.push(fixedLine);\n      }\n    }\n    \n    // Step 5: Ensure we have a valid diagram type\n    if (!hasValidStart || cleanedLines.length === 0) {\n      cleanedLines = ['flowchart TD', ...cleanedLines.filter(line => \n        !line.match(/^(flowchart|graph|sequenceDiagram|classDiagram|stateDiagram|erDiagram|journey|gitgraph)/)\n      )];\n    }\n    \n    // Step 6: Apply proper indentation\n    cleanedLines = cleanedLines.map((line, index) => {\n      if (index === 0) return line; // Keep diagram declaration as-is\n      if (line.startsWith('    ')) return line; // Already indented\n      return '    ' + line; // Add indentation\n    });\n    \n    // Step 7: Basic syntax fixes\n    fixedCode = cleanedLines.join('\\n');\n    \n    // Remove quotes around node IDs\n    fixedCode = fixedCode.replace(/[\"'`]/g, '');\n    \n    // Fix arrow spacing\n    fixedCode = fixedCode.replace(/-->/g, ' --> ');\n    fixedCode = fixedCode.replace(/\\s+-->\\s+/g, ' --> ');\n    \n    return '```mermaid\\n' + fixedCode + '\\n```';\n  });\n}\n\n// the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\n\n// Cache AI clients and system settings to avoid repeated database queries\nlet cachedOpenAIClient: OpenAI | null = null;\nlet cachedGeminiClient: GoogleGenerativeAI | null = null;\nlet cachedOpenAIApiKey: string | null = null;\nlet cachedGeminiApiKey: string | null = null;\nlet cachedSystemMessage: string | null = null;\nlet cacheTimestamp: number = 0;\nconst CACHE_DURATION = 5 * 60 * 1000; // 5 minutes\n\n// Get OpenAI client with API key from database\nasync function getOpenAIClient(): Promise<OpenAI> {\n  const now = Date.now();\n  \n  // Use cached client if still valid\n  if (cachedOpenAIClient && cachedOpenAIApiKey && (now - cacheTimestamp) < CACHE_DURATION) {\n    return cachedOpenAIClient;\n  }\n\n  const apiKeySetting = await storage.getSystemSetting('openai_api_key');\n  const currentApiKey = apiKeySetting?.value || process.env.OPENAI_API_KEY;\n  \n  if (!currentApiKey) {\n    throw new Error('OpenAI API key not configured. Please set it in admin settings.');\n  }\n\n  // Create new client and cache it\n  cachedOpenAIClient = new OpenAI({ apiKey: currentApiKey });\n  cachedOpenAIApiKey = currentApiKey;\n  cacheTimestamp = now;\n  \n  return cachedOpenAIClient;\n}\n\n// Get Gemini client with API key from database\nasync function getGeminiClient(): Promise<GoogleGenerativeAI> {\n  const now = Date.now();\n  \n  // Use cached client if still valid\n  if (cachedGeminiClient && cachedGeminiApiKey && (now - cacheTimestamp) < CACHE_DURATION) {\n    return cachedGeminiClient;\n  }\n\n  const apiKeySetting = await storage.getSystemSetting('gemini_api_key');\n  const currentApiKey = apiKeySetting?.value || process.env.GEMINI_API_KEY;\n  \n  if (!currentApiKey) {\n    throw new Error('Gemini API key not configured. Please set it in admin settings.');\n  }\n\n  // Create new client and cache it\n  cachedGeminiClient = new GoogleGenerativeAI(currentApiKey);\n  cachedGeminiApiKey = currentApiKey;\n  cacheTimestamp = now;\n  \n  return cachedGeminiClient;\n}\n\n// Get cached system message or fetch from database\nasync function getCachedSystemMessage(): Promise<string | null> {\n  const now = Date.now();\n  \n  // Use cached message if still valid\n  if (cachedSystemMessage && (now - cacheTimestamp) < CACHE_DURATION) {\n    return cachedSystemMessage;\n  }\n\n  const customSystemMessage = await storage.getSystemSetting('ai_system_message');\n  cachedSystemMessage = customSystemMessage?.value || null;\n  \n  return cachedSystemMessage;\n}\n\nexport interface ChatResponse {\n  message: string;\n  suggestions?: string[];\n}\n\nexport interface QuizQuestion {\n  question: string;\n  options: string[];\n  correctAnswer: number;\n  explanation: string;\n}\n\nexport interface QuizEvaluation {\n  score: number; // 1-100\n  feedback: string;\n  isCorrect: boolean;\n}\n\n// Get the current AI provider setting\nasync function getCurrentAIProvider(): Promise<string> {\n  const providerSetting = await storage.getSystemSetting('ai_provider');\n  return providerSetting?.value || 'openai';\n}\n\nexport async function generateStreamingChatResponse(\n  userMessage: string,\n  moduleContent?: string,\n  chatHistory?: { role: string; content: string }[],\n  onChunk?: (chunk: string, timestamp?: number) => void,\n  customPrompt?: string | null\n): Promise<string> {\n  try {\n    const provider = await getCurrentAIProvider();\n    const customSystemMessage = await getCachedSystemMessage();\n    \n    if (provider === 'gemini') {\n      return await generateGeminiChatResponse(userMessage, moduleContent, chatHistory, onChunk, customPrompt);\n    } else {\n      const openai = await getOpenAIClient();\n      return await generateOpenAIChatResponse(openai, userMessage, moduleContent, chatHistory, customSystemMessage, onChunk, customPrompt);\n    }\n  } catch (error) {\n    console.error('Error in generateStreamingChatResponse:', error);\n    throw error;\n  }\n}\n\n// OpenAI specific chat response generation\nasync function generateOpenAIChatResponse(\n  openai: OpenAI,\n  userMessage: string,\n  moduleContent?: string,\n  chatHistory?: { role: string; content: string }[],\n  customSystemMessage?: string | null,\n  onChunk?: (chunk: string, timestamp?: number) => void,\n  customPrompt?: string | null\n): Promise<string> {\n  let systemPrompt;\n  \n  if (customPrompt) {\n    // Use the custom prompt from admin settings\n    systemPrompt = customPrompt;\n  } else if (customSystemMessage) {\n    systemPrompt = customSystemMessage;\n    if (moduleContent) {\n      systemPrompt += `\\n\\nJelenlegi modul: ${moduleContent.substring(0, 500)}`;\n    }\n  } else {\n    systemPrompt = `Tapasztalt magyar oktat√≥k√©nt seg√≠ts a di√°koknak r√©szletesen √©s √©rthet≈ëen. Adj struktur√°lt, praktikus magyar√°zatokat p√©ld√°kkal. ${moduleContent ? `\\n\\nTananyag: ${moduleContent.substring(0, 400)}` : ''}`;\n  }\n\n  const messages: any[] = [\n    { role: \"system\", content: systemPrompt }\n  ];\n\n  if (chatHistory) {\n    messages.push(...chatHistory);\n  }\n\n    messages.push({ role: \"user\", content: userMessage });\n\n  try {\n    const stream = await openai.chat.completions.create({\n      model: \"gpt-4-turbo\",\n      messages,\n      max_tokens: 2000,\n      temperature: 0.7,\n      stream: true,\n      presence_penalty: 0,\n      frequency_penalty: 0,\n    });\n\n    let fullResponse = '';\n    const startTime = Date.now();\n    \n    for await (const chunk of stream) {\n      const content = chunk.choices[0]?.delta?.content || '';\n      if (content) {\n        fullResponse += content;\n        if (onChunk) {\n          const timestamp = Date.now() - startTime;\n          onChunk(content, timestamp);\n        }\n      }\n    }\n\n    return fullResponse;\n  } catch (error) {\n    console.error(\"OpenAI streaming API error:\", error);\n    throw new Error(\"Failed to generate streaming AI response\");\n  }\n}\n\n// Gemini specific chat response generation\nasync function generateGeminiChatResponse(\n  userMessage: string,\n  moduleContent?: string,\n  chatHistory?: { role: string; content: string }[],\n  onChunk?: (chunk: string, timestamp?: number) => void,\n  customPrompt?: string | null\n): Promise<string> {\n  const gemini = await getGeminiClient();\n  const customSystemMessage = await getCachedSystemMessage();\n  \n  let systemPrompt;\n  if (customPrompt) {\n    // Use the custom prompt from admin settings\n    systemPrompt = customPrompt;\n  } else if (customSystemMessage) {\n    systemPrompt = customSystemMessage;\n    if (moduleContent) {\n      systemPrompt += `\\n\\nJelenlegi modul: ${moduleContent.substring(0, 500)}`;\n    }\n  } else {\n    systemPrompt = `Tapasztalt magyar oktat√≥k√©nt seg√≠ts a di√°koknak r√©szletesen √©s √©rthet≈ëen. Adj struktur√°lt, praktikus magyar√°zatokat p√©ld√°kkal. ${moduleContent ? `\\n\\nTananyag: ${moduleContent.substring(0, 400)}` : ''}`;\n  }\n\n  // Build conversation history for Gemini\n  let fullPrompt = systemPrompt + \"\\n\\n\";\n  \n  if (chatHistory && chatHistory.length > 0) {\n    chatHistory.forEach(msg => {\n      if (msg.role === 'user') {\n        fullPrompt += `Felhaszn√°l√≥: ${msg.content}\\n`;\n      } else if (msg.role === 'assistant') {\n        fullPrompt += `Asszisztens: ${msg.content}\\n`;\n      }\n    });\n  }\n  \n  fullPrompt += `Felhaszn√°l√≥: ${userMessage}\\nAsszisztens: `;\n\n  try {\n    const model = gemini.getGenerativeModel({ model: \"gemini-2.0-flash-exp\" });\n    \n    const result = await model.generateContentStream(fullPrompt);\n    \n    let fullResponse = '';\n    const startTime = Date.now();\n    \n    for await (const chunk of result.stream) {\n      const content = chunk.text();\n      if (content) {\n        fullResponse += content;\n        if (onChunk) {\n          const timestamp = Date.now() - startTime;\n          onChunk(content, timestamp);\n        }\n      }\n    }\n\n    return fullResponse;\n  } catch (error: any) {\n    console.error(\"Gemini streaming API error:\", error);\n    \n    // Handle quota exceeded (429) error\n    if (error.status === 429) {\n      console.log(\"Gemini API quota exceeded, switching to OpenAI for this request\");\n      // Fallback to OpenAI when Gemini quota is exceeded\n      try {\n        const openai = await getOpenAIClient();\n        const response = await openai.chat.completions.create({\n          model: \"gpt-4o-mini\",\n          messages: [{ role: \"user\", content: fullPrompt }],\n          temperature: 0.7,\n          max_tokens: 4000,\n        });\n        \n        return response.choices[0]?.message?.content || \"Nem siker√ºlt v√°lasz gener√°l√°sa.\";\n      } catch (openaiError) {\n        console.error(\"OpenAI fallback error:\", openaiError);\n        throw new Error(\"Mindk√©t AI szolg√°ltat√≥ el√©rhetetlen\");\n      }\n    }\n    \n    throw new Error(\"Failed to generate Gemini AI response\");\n  }\n}\n\n// Remove the incorrect function since we're handling it inline\n\nexport async function generateChatResponse(\n  userMessage: string,\n  moduleContent?: string,\n  chatHistory?: { role: string; content: string }[],\n  customSystemMessage?: string\n): Promise<ChatResponse> {\n  try {\n    const provider = await getCurrentAIProvider();\n    const cachedSystemMessage = await getCachedSystemMessage();\n    \n    // Skip external API routing for basic AI-only mode or simple chat\n    if (moduleContent === 'basic_ai_only' || moduleContent === 'standalone' || moduleContent === 'chat') {\n      const systemMessage = customSystemMessage || cachedSystemMessage || \"Te egy szak√©rt≈ë oktat√°si AI asszisztens vagy, aki magyar nyelven seg√≠t a tanul√°sban.\";\n      \n      if (provider === 'openai') {\n        const openai = await getOpenAIClient();\n        const message = await generateOpenAIChatResponse(openai, userMessage, undefined, [], systemMessage);\n        return { message, suggestions: [] };\n      } else {\n        const gemini = await getGeminiClient();\n        const message = await generateGeminiChatResponse(userMessage, 'basic_ai_only');\n        return { message, suggestions: [] };\n      }\n    }\n    \n    // Check if user message requires specialized API routing\n    const taskRoute = await multiApiService.routeTask(userMessage);\n    \n    if (taskRoute.type === 'enhanced_content') {\n      // Use enhanced content generation with internet search\n      const enhanced = taskRoute.data;\n      const enrichedContent = `${moduleContent || ''}\\n\\nAktu√°lis inform√°ci√≥k az internetr≈ël:\\n${enhanced.content}`;\n      moduleContent = enrichedContent;\n    } else if (taskRoute.type === 'search') {\n      // Format search results for chat response\n      const searchResults = taskRoute.data;\n      const formattedResults = searchResults.map((result: any) => \n        `**${result.title}**\\n${result.snippet}\\nForr√°s: ${result.link}`\n      ).join('\\n\\n');\n      \n      return {\n        message: `Itt vannak a keres√©si eredm√©nyek a k√∂vetkez≈ëre: \"${userMessage}\"\\n\\n${formattedResults}`,\n        suggestions: [\"Tov√°bbi inform√°ci√≥k\", \"M√°sik keres√©s\", \"K√©rd√©sek a t√©m√°r√≥l\"]\n      };\n    } else if (taskRoute.type === 'youtube') {\n      // Format YouTube results for chat response\n      const videos = taskRoute.data;\n      const formattedVideos = videos.map((video: any) => \n        `**${video.snippet.title}**\\n${video.snippet.description.substring(0, 200)}...\\nYouTube link: https://youtube.com/watch?v=${video.id.videoId}`\n      ).join('\\n\\n');\n      \n      return {\n        message: `YouTube vide√≥k a k√∂vetkez≈ë t√©m√°ban: \"${userMessage}\"\\n\\n${formattedVideos}`,\n        suggestions: [\"Vide√≥ megtekint√©se\", \"Tov√°bbi vide√≥k\", \"Kapcsol√≥d√≥ t√©m√°k\"]\n      };\n    }\n    \n    if (provider === 'gemini') {\n      const response = await generateGeminiChatResponse(userMessage, moduleContent, chatHistory);\n      const fixedResponse = fixMermaidSyntax(response);\n      return { message: fixedResponse };\n    }\n    \n    // OpenAI implementation with GPT-4 Turbo\n    const openai = await getOpenAIClient();\n    \n    let systemPrompt;\n    \n    // Enhanced prompt with multi-API context\n    if (customSystemMessage) {\n      systemPrompt = customSystemMessage;\n      if (moduleContent) {\n        systemPrompt += `\\n\\nJelenlegi modul √©s aktu√°lis inform√°ci√≥k: ${moduleContent.substring(0, 800)}`;\n      }\n    } else {\n      systemPrompt = `Tapasztalt magyar oktat√≥k√©nt seg√≠ts a di√°koknak r√©szletesen √©s √©rthet≈ëen. Adj struktur√°lt, praktikus magyar√°zatokat p√©ld√°kkal. Haszn√°ld a legfrissebb inform√°ci√≥kat is. ${moduleContent ? `\\n\\nTananyag √©s aktu√°lis adatok: ${moduleContent.substring(0, 600)}` : ''}`;\n    }\n\n    const messages: any[] = [\n      { role: \"system\", content: systemPrompt }\n    ];\n\n    // Add chat history if provided\n    if (chatHistory) {\n      messages.push(...chatHistory);\n    }\n\n    messages.push({ role: \"user\", content: userMessage });\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4-turbo\", // Upgraded to GPT-4 Turbo for better performance\n      messages,\n      max_tokens: 1500, // Increased for more comprehensive responses\n      temperature: 0.7, // Better for educational explanations\n      stream: false,\n      presence_penalty: 0,\n      frequency_penalty: 0,\n    });\n\n    const content = response.choices[0].message.content || \"Sajn√°lom, nem tudtam v√°laszt gener√°lni.\";\n    \n    // Apply Mermaid syntax fixes to the generated content\n    const fixedContent = fixMermaidSyntax(content);\n\n    return {\n      message: fixedContent,\n      suggestions: [\"Tov√°bbi k√©rd√©sek\", \"Gyakorl√≥ feladatok\", \"Kapcsol√≥d√≥ t√©m√°k\"]\n    };\n  } catch (error) {\n    console.error(\"OpenAI API error:\", error);\n    throw new Error(\"Failed to generate AI response\");\n  }\n}\n\nexport async function generateQuizQuestions(\n  moduleContent: string,\n  numQuestions: number = 3\n): Promise<QuizQuestion[]> {\n  try {\n    const openai = await getOpenAIClient();\n    \n    const prompt = `Based on the following module content, create ${numQuestions} multiple choice quiz questions to test understanding. Each question should have 4 options with only one correct answer.\n\nModule content:\n${moduleContent}\n\nPlease respond with a JSON array of questions in this exact format:\n[\n  {\n    \"question\": \"Question text here?\",\n    \"options\": [\"Option A\", \"Option B\", \"Option C\", \"Option D\"],\n    \"correctAnswer\": 0,\n    \"explanation\": \"Brief explanation of why this answer is correct\"\n  }\n]`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [{ role: \"user\", content: prompt }],\n      response_format: { type: \"json_object\" },\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"[]\");\n    return Array.isArray(result) ? result : result.questions || [];\n  } catch (error) {\n    console.error(\"Quiz generation error:\", error);\n    throw new Error(\"Failed to generate quiz questions\");\n  }\n}\n\nexport async function explainConcept(\n  concept: string,\n  moduleContent?: string\n): Promise<string> {\n  try {\n    const openai = await getOpenAIClient();\n    \n    const prompt = `Explain the concept \"${concept}\" in simple, clear terms that a student can understand. ${moduleContent ? `Use this module content as context: ${moduleContent}` : ''}\n\nProvide a concise but comprehensive explanation with examples where helpful.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [{ role: \"user\", content: prompt }],\n      max_tokens: 500,\n    });\n\n    return response.choices[0].message.content || \"I couldn't explain that concept.\";\n  } catch (error) {\n    console.error(\"Concept explanation error:\", error);\n    throw new Error(\"Failed to explain concept\");\n  }\n}\n\nexport async function generateSpeech(\n  text: string\n): Promise<Buffer> {\n  try {\n    const openai = await getOpenAIClient();\n\n    const mp3 = await openai.audio.speech.create({\n      model: \"tts-1\", // tts-1 a leggyorsabb modell\n      voice: \"nova\", // Nova hang jobb magyar kiejt√©shez\n      input: text,\n      speed: 1.0, // Norm√°l sebess√©g a gyorsabb feldolgoz√°s√©rt\n      response_format: \"mp3\",\n    });\n\n    const buffer = Buffer.from(await mp3.arrayBuffer());\n    return buffer;\n  } catch (error) {\n    console.error(\"OpenAI TTS API error:\", error);\n    throw new Error(\"Failed to generate speech\");\n  }\n}\n\n// Synchronized streaming with text and audio chunks\nexport async function generateSynchronizedStreamingResponse(\n  userMessage: string,\n  moduleContent?: string,\n  chatHistory?: { role: string; content: string }[],\n  onTextChunk?: (chunk: string, timestamp: number) => void,\n  onAudioChunk?: (audioBuffer: Buffer, timestamp: number, textChunk: string) => void,\n  customPrompt?: string | null\n): Promise<string> {\n  try {\n    const [openai, customSystemMessage] = await Promise.all([\n      getOpenAIClient(),\n      getCachedSystemMessage()\n    ]);\n    \n    let systemPrompt;\n    \n    if (customPrompt) {\n      // Use the custom prompt from admin settings\n      systemPrompt = customPrompt;\n    } else if (customSystemMessage) {\n      systemPrompt = customSystemMessage;\n      if (moduleContent) {\n        systemPrompt += `\\n\\nJelenlegi modul: ${moduleContent.substring(0, 500)}`;\n      }\n    } else {\n      systemPrompt = `Tapasztalt magyar oktat√≥k√©nt seg√≠ts a di√°koknak r√©szletesen √©s √©rthet≈ëen. Adj struktur√°lt, praktikus magyar√°zatokat p√©ld√°kkal. ${moduleContent ? `\\n\\nTananyag: ${moduleContent.substring(0, 400)}` : ''}`;\n    }\n\n    const messages: any[] = [\n      { role: \"system\", content: systemPrompt }\n    ];\n\n    if (chatHistory) {\n      messages.push(...chatHistory);\n    }\n\n    messages.push({ role: \"user\", content: userMessage });\n\n    const stream = await openai.chat.completions.create({\n      model: \"gpt-4o-mini\",\n      messages,\n      max_tokens: 800, // R√∂videbb v√°laszok = gyorsabb\n      temperature: 0.5, // Kevesebb kreativit√°s = gyorsabb\n      stream: true,\n      presence_penalty: 0,\n      frequency_penalty: 0,\n    });\n\n    let fullResponse = '';\n    let accumulatedText = '';\n    const startTime = Date.now();\n    const chunkSize = 300; // Nagyobb chunk = kevesebb audio gener√°l√°s\n    const audioPromises: Promise<void>[] = []; // Track all audio generation promises\n    \n    for await (const chunk of stream) {\n      const content = chunk.choices[0]?.delta?.content || '';\n      if (content) {\n        fullResponse += content;\n        accumulatedText += content;\n        const timestamp = Date.now() - startTime;\n        \n        // Send text chunk immediately\n        if (onTextChunk) {\n          onTextChunk(content, timestamp);\n        }\n        \n        // Generate audio only for complete sentences with substantial length\n        if ((accumulatedText.length >= chunkSize || \n             (accumulatedText.match(/[.!?]\\s/) && accumulatedText.length >= 80)) && onAudioChunk) {\n          // Find a good breaking point (only at complete sentence boundaries)\n          let breakPoint = accumulatedText.length;\n          const sentenceEnders = ['. ', '! ', '? ', '.\\n', '!\\n', '?\\n'];\n          \n          // Look for sentence boundaries, but only if text is substantial enough\n          for (const ender of sentenceEnders) {\n            const lastIndex = accumulatedText.lastIndexOf(ender);\n            if (lastIndex > 60) { // Minimum 60 karakter egy audio chunkhoz\n              breakPoint = lastIndex + ender.length;\n              break;\n            }\n          }\n          \n          const textForAudio = accumulatedText.substring(0, breakPoint).trim();\n          if (textForAudio) {\n            // CRITICAL FIX: Track audio generation promises to wait for completion\n            const audioPromise = (async () => {\n              try {\n                const audioResponse = await openai.audio.speech.create({\n                  model: \"tts-1\",\n                  voice: \"nova\",\n                  input: textForAudio,\n                  response_format: \"mp3\",\n                });\n                \n                const audioBuffer = Buffer.from(await audioResponse.arrayBuffer());\n                onAudioChunk(audioBuffer, timestamp, textForAudio);\n              } catch (audioError) {\n                console.error('Error generating audio chunk:', audioError);\n                // Continue with text streaming even if audio fails\n              }\n            })();\n            \n            audioPromises.push(audioPromise);\n            accumulatedText = accumulatedText.substring(breakPoint); // Keep remaining text\n          }\n        }\n      }\n    }\n    \n    // Generate audio for any remaining text - Wait for completion\n    if (accumulatedText.trim() && onAudioChunk) {\n      const finalText = accumulatedText.trim();\n      const finalTimestamp = Date.now() - startTime;\n      \n      // Track final audio generation promise\n      const finalAudioPromise = (async () => {\n        try {\n          const audioResponse = await openai.audio.speech.create({\n            model: \"tts-1\",\n            voice: \"nova\",\n            input: finalText,\n            response_format: \"mp3\",\n          });\n          \n          const audioBuffer = Buffer.from(await audioResponse.arrayBuffer());\n          onAudioChunk(audioBuffer, finalTimestamp, finalText);\n        } catch (audioError) {\n          console.error('Error generating final audio chunk:', audioError);\n        }\n      })();\n      \n      audioPromises.push(finalAudioPromise);\n    }\n\n    // CRITICAL: Wait for all audio chunks to complete before returning\n    if (audioPromises.length > 0) {\n      console.log(`üéµ Waiting for ${audioPromises.length} audio chunks to complete...`);\n      await Promise.allSettled(audioPromises);\n      console.log(`üéµ All audio chunks completed!`);\n    }\n\n    return fullResponse;\n  } catch (error) {\n    console.error('Error in synchronized streaming:', error);\n    throw new Error(`Failed to generate synchronized response: ${error instanceof Error ? error.message : 'Unknown error'}`);\n  }\n}\n\nexport async function transcribeAudio(audioBuffer: Buffer, filename: string = \"audio.webm\"): Promise<string> {\n  try {\n    const openai = await getOpenAIClient();\n    \n    // Convert WebM to WAV if needed using FFmpeg\n    let processedBuffer = audioBuffer;\n    let processedFilename = filename;\n    \n    if (filename.endsWith('.webm')) {\n      const execAsync = promisify(exec);\n      \n      // Create temporary files\n      const tempDir = '/tmp';\n      const inputPath = path.join(tempDir, `input_${Date.now()}.webm`);\n      const outputPath = path.join(tempDir, `output_${Date.now()}.wav`);\n      \n      try {\n        // Write WebM buffer to temporary file\n        fs.writeFileSync(inputPath, audioBuffer);\n        \n        // Convert WebM to WAV using FFmpeg\n        await execAsync(`ffmpeg -i \"${inputPath}\" -acodec pcm_s16le -ar 16000 -ac 1 \"${outputPath}\"`);\n        \n        // Read converted WAV file\n        processedBuffer = fs.readFileSync(outputPath);\n        processedFilename = 'converted.wav';\n        \n        // Clean up temporary files\n        fs.unlinkSync(inputPath);\n        fs.unlinkSync(outputPath);\n      } catch (conversionError) {\n        console.error(\"FFmpeg conversion error:\", conversionError);\n        // If conversion fails, try with original file\n        processedBuffer = audioBuffer;\n        processedFilename = filename;\n      }\n    }\n    \n    // Determine MIME type from filename extension\n    let mimeType = \"audio/wav\";\n    if (processedFilename.endsWith('.mp4') || processedFilename.endsWith('.m4a')) {\n      mimeType = \"audio/mp4\";\n    } else if (processedFilename.endsWith('.wav')) {\n      mimeType = \"audio/wav\";\n    } else if (processedFilename.endsWith('.mp3')) {\n      mimeType = \"audio/mp3\";\n    } else if (processedFilename.endsWith('.ogg')) {\n      mimeType = \"audio/ogg\";\n    }\n    \n    // Create a File object from the processed buffer\n    const audioFile = new File([processedBuffer], processedFilename, { type: mimeType });\n    \n    const transcription = await openai.audio.transcriptions.create({\n      file: audioFile,\n      model: \"whisper-1\",\n      language: \"hu\", // Hungarian language\n      prompt: \"Ez egy oktat√°si besz√©lget√©s b√∫tor-ergon√≥mi√°r√≥l √©s b√∫tortervez√©sr≈ël magyar nyelven. A tanul√≥ k√©rd√©seket tesz fel a k√∂vetkez≈ë t√©m√°kr√≥l: ergon√≥mia, b√∫tor, sz√©k magass√°g, asztal, tervez√©s, k√©nyelmes, biztons√°g, hat√©konys√°g, precizit√°s, testalkat, d≈ël√©ssz√∂g, p√°rn√°k, t√°maszt, m√©ret, forma, kanap√©, √≠r√≥asztal, billenty≈±zet, munkafolyamat, t√°vols√°g, k√©nyelem, balesetv√©delem, gy√°rt√°s, lekerek√≠t√©s, sarkok, haszn√°lat, emberi test, √ºl≈ëhely, h√°tt√°mla, munkav√©gz√©s, anat√≥miai, antropometriai, funkcionalit√°s, ergon√≥mikus, b√∫torgy√°rt√°s, formatervez√©s, haszn√°lhat√≥s√°g, komfort, stabil, tart√≥s, praktikus, eszt√©tikus.\", // Enhanced context with comprehensive furniture ergonomics vocabulary\n    });\n\n    return transcription.text;\n  } catch (error) {\n    console.error(\"OpenAI Whisper API error:\", error);\n    throw new Error(\"Failed to transcribe audio\");\n  }\n}\n\nexport async function generateQuizFromModule(moduleContent: string): Promise<QuizQuestion[]> {\n  try {\n    const openai = await getOpenAIClient();\n    \n    const prompt = `A k√∂vetkez≈ë tananyag alapj√°n gener√°lj 3-5 tesztk√©rd√©st magyar nyelven. \n    Minden k√©rd√©shez adj 4 v√°laszlehet≈ës√©get, amelyb≈ël pontosan egy a helyes.\n    A k√©rd√©sek fedelje fel a tananyag f≈ë pontjait √©s legyenek megfelel≈ë neh√©zs√©g≈±ek.\n    \n    Tananyag:\n    ${moduleContent}\n    \n    V√°laszolj JSON form√°tumban, k√∂vetkez≈ë strukt√∫r√°val:\n    {\n      \"questions\": [\n        {\n          \"question\": \"K√©rd√©s sz√∂vege?\",\n          \"options\": [\"A v√°lasz\", \"B v√°lasz\", \"C v√°lasz\", \"D v√°lasz\"],\n          \"correctAnswer\": 0,\n          \"explanation\": \"Magyar√°zat a helyes v√°laszra\"\n        }\n      ]\n    }`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"Te egy szak√©rt≈ë oktat√≥ vagy, aki kiv√°l√≥ tesztk√©rd√©seket k√©sz√≠t magyar nyelven. A k√©rd√©sek legyenek pontosak, egy√©rtelm≈±ek √©s a tananyag l√©nyeg√©t t√ºkr√∂zz√©k.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.7,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || '{\"questions\": []}');\n    return result.questions || [];\n  } catch (error) {\n    console.error(\"Error generating quiz:\", error);\n    throw new Error(\"Failed to generate quiz questions\");\n  }\n}\n\nexport async function evaluateAnswer(\n  question: string,\n  correctAnswer: string,\n  userAnswer: string,\n  explanation: string\n): Promise<QuizEvaluation> {\n  try {\n    const openai = await getOpenAIClient();\n    \n    const prompt = `√ârt√©keld a tanul√≥ v√°lasz√°t a k√∂vetkez≈ë k√©rd√©sre magyar nyelven:\n\nK√©rd√©s: ${question}\nHelyes v√°lasz: ${correctAnswer}\nTanul√≥ v√°lasza: ${userAnswer}\nMagyar√°zat: ${explanation}\n\nAdj pontsz√°mot 1-t≈ël 100-ig, ahol:\n- 100: Teljesen helyes v√°lasz\n- 80-99: Nagyr√©szt helyes, kisebb hi√°nyoss√°gokkal\n- 60-79: R√©szben helyes, de fontos elemek hi√°nyoznak\n- 40-59: Alapvet≈ëen t√©ves, de van benne valami helyes elem\n- 1-39: Teljesen t√©ves v√°lasz\n\nV√°laszolj JSON form√°tumban:\n{\n  \"score\": 85,\n  \"feedback\": \"R√©szletes visszajelz√©s a v√°laszra\",\n  \"isCorrect\": true\n}`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"Te egy objekt√≠v √©s seg√≠t≈ëk√©sz tan√°r vagy, aki konstrukt√≠v visszajelz√©st ad a tanul√≥k v√°laszaira. Legy√©l b√°tor√≠t√≥, de pontos az √©rt√©kel√©sben.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.3,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || '{\"score\": 0, \"feedback\": \"Hiba t√∂rt√©nt az √©rt√©kel√©s sor√°n\", \"isCorrect\": false}');\n    \n    return {\n      score: Math.max(1, Math.min(100, result.score)),\n      feedback: result.feedback,\n      isCorrect: result.score >= 60\n    };\n  } catch (error) {\n    console.error(\"Error evaluating answer:\", error);\n    throw new Error(\"Failed to evaluate answer\");\n  }\n}\n","size_bytes":32102},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: false, // Allow cookies over HTTP in development\n      maxAge: sessionTtl,\n      sameSite: 'lax', // Allow cross-site requests\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  // Check if user already exists to preserve their role\n  const existingUser = await storage.getUser(claims[\"sub\"]);\n  \n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n    // Only set role to 'student' for new users, preserve existing role for existing users\n    role: existingUser ? existingUser.role : 'student',\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};\n","size_bytes":4584},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport express from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { setupAuth, isAuthenticated } from \"./replitAuth\";\nimport { setupLocalAuth } from \"./localAuth\";\nimport { multiApiService } from \"./multiApiService\";\nimport { aiQueueManager } from \"./ai-queue-manager\";\nimport { mermaidService } from \"./mermaid-service\";\n\n\n// Combined authentication middleware for both Replit and local auth\nconst combinedAuth = async (req: any, res: any, next: any) => {\n  try {\n    console.log('Combined auth check - Full session:', JSON.stringify(req.session, null, 2));\n    console.log('Combined auth check - session.adminUser:', req.session?.adminUser?.id);\n    console.log('Combined auth check - session.schoolAdminUser:', req.session?.schoolAdminUser?.id);\n    console.log('Combined auth check - isAuthenticated:', req.isAuthenticated && req.isAuthenticated());\n    \n    // Check for admin session first\n    if (req.session?.adminUser) {\n      req.user = { \n        id: req.session.adminUser.id, \n        claims: { sub: req.session.adminUser.id },\n        role: 'admin'\n      };\n      console.log('Combined auth - Using admin session');\n      return next();\n    }\n    \n    // Check for school admin session\n    if (req.session?.schoolAdminUser) {\n      req.user = { \n        id: req.session.schoolAdminUser.id, \n        claims: { sub: req.session.schoolAdminUser.id },\n        role: 'school_admin'\n      };\n      console.log('Combined auth - Using school admin session');\n      return next();\n    }\n    \n    // Check for local authentication\n    if (req.isAuthenticated && req.isAuthenticated()) {\n      console.log('Combined auth - Using local auth');\n      return next();\n    }\n    \n    console.log('Combined auth - No valid auth found');\n    return res.status(401).json({ message: \"Unauthorized\" });\n  } catch (error) {\n    console.error('Auth middleware error:', error);\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n};\nimport { insertModuleSchema, insertChatMessageSchema, insertProfessionSchema, insertSubjectSchema, insertAdminMessageSchema } from \"@shared/schema\";\nimport { generateChatResponse, generateQuizQuestions, explainConcept, generateSpeech } from \"./openai\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport fs from \"fs\";\n\n// Configure multer for file uploads with better settings\nconst upload = multer({\n  storage: multer.diskStorage({\n    destination: (req, file, cb) => {\n      const uploadsDir = path.join(process.cwd(), 'uploads');\n      if (!fs.existsSync(uploadsDir)) {\n        fs.mkdirSync(uploadsDir, { recursive: true });\n      }\n      cb(null, uploadsDir);\n    },\n    filename: (req, file, cb) => {\n      // Generate unique filename with timestamp\n      const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n      cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));\n    }\n  }),\n  limits: {\n    fileSize: 50 * 1024 * 1024, // 50MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    // Allow images, videos, and audio files\n    const allowedMimes = [\n      'image/jpeg', 'image/png', 'image/gif', 'image/webp',\n      'video/mp4', 'video/webm', 'video/quicktime',\n      'audio/mpeg', 'audio/wav', 'audio/ogg', 'audio/mp4', 'audio/webm'\n    ];\n    \n    if (allowedMimes.includes(file.mimetype)) {\n      cb(null, true);\n    } else {\n      cb(new Error('Nem t√°mogatott f√°jlt√≠pus. Csak k√©p, vide√≥ √©s hang f√°jlok enged√©lyezettek.'));\n    }\n  }\n});\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // Auth middleware\n  await setupAuth(app);\n  \n  // Local auth routes\n  setupLocalAuth(app);\n\n  // Serve uploaded files statically\n  app.use('/uploads', express.static(path.join(process.cwd(), 'uploads')));\n\n  // File upload endpoint\n  app.post('/api/upload', combinedAuth, upload.single('file'), (req: any, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: 'Nincs f√°jl felt√∂ltve' });\n      }\n      \n      // Return the file URL that can be used in module content\n      const fileUrl = `/uploads/${req.file.filename}`;\n      res.json({ \n        url: fileUrl,\n        filename: req.file.filename,\n        originalName: req.file.originalname,\n        mimetype: req.file.mimetype,\n        size: req.file.size\n      });\n    } catch (error) {\n      console.error('File upload error:', error);\n      res.status(500).json({ message: 'F√°jl felt√∂lt√©si hiba' });\n    }\n  });\n\n  // Multiple files upload endpoint\n  app.post('/api/upload/multiple', combinedAuth, upload.array('files', 10), (req: any, res) => {\n    try {\n      if (!req.files || req.files.length === 0) {\n        return res.status(400).json({ message: 'Nincsenek f√°jlok felt√∂ltve' });\n      }\n      \n      const uploadedFiles = req.files.map((file: any) => ({\n        url: `/uploads/${file.filename}`,\n        filename: file.filename,\n        originalName: file.originalname,\n        mimetype: file.mimetype,\n        size: file.size\n      }));\n      \n      res.json({ files: uploadedFiles });\n    } catch (error) {\n      console.error('Multiple file upload error:', error);\n      res.status(500).json({ message: 'F√°jlok felt√∂lt√©si hiba' });\n    }\n  });\n\n  // Delete uploaded file endpoint\n  app.delete('/api/upload/:filename', combinedAuth, (req: any, res) => {\n    try {\n      const filename = req.params.filename;\n      const filePath = path.join(process.cwd(), 'uploads', filename);\n      \n      if (fs.existsSync(filePath)) {\n        fs.unlinkSync(filePath);\n        res.json({ message: 'F√°jl sikeresen t√∂r√∂lve' });\n      } else {\n        res.status(404).json({ message: 'F√°jl nem tal√°lhat√≥' });\n      }\n    } catch (error) {\n      console.error('File delete error:', error);\n      res.status(500).json({ message: 'F√°jl t√∂rl√©si hiba' });\n    }\n  });\n\n  // Cost tracking endpoints (admin only)\n  app.get('/api/admin/costs/stats', combinedAuth, async (req: any, res) => {\n    try {\n      if (req.session?.adminUser?.role !== 'admin' && req.user?.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      // Ensure current month entry exists\n      await storage.ensureCurrentMonthCostEntry();\n\n      const year = req.query.year ? parseInt(req.query.year as string) : undefined;\n      const month = req.query.month ? parseInt(req.query.month as string) : undefined;\n\n      const stats = await storage.getApiCallStats(year, month);\n      const monthlyCosts = await storage.getMonthlyCosts(year);\n\n      res.json({\n        apiStats: stats,\n        monthlyCosts,\n        currentMonth: {\n          year: new Date().getFullYear(),\n          month: new Date().getMonth() + 1\n        }\n      });\n    } catch (error) {\n      console.error('Error fetching cost stats:', error);\n      res.status(500).json({ message: 'Failed to fetch cost statistics' });\n    }\n  });\n\n  app.post('/api/admin/costs/monthly', combinedAuth, async (req: any, res) => {\n    try {\n      if (req.session?.adminUser?.role !== 'admin' && req.user?.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      const { year, month, developmentCosts, infrastructureCosts, otherCosts, notes } = req.body;\n      \n      // Calculate API costs for the month from api_calls table\n      const apiCosts = await storage.calculateMonthlyApiCosts(year, month);\n      const totalCosts = parseFloat(apiCosts.toString()) + \n                        parseFloat(developmentCosts || 0) + \n                        parseFloat(infrastructureCosts || 0) + \n                        parseFloat(otherCosts || 0);\n\n      const costData = await storage.upsertMonthlyCost({\n        year,\n        month,\n        apiCosts: apiCosts.toFixed(2),\n        developmentCosts: developmentCosts || '0.00',\n        infrastructureCosts: infrastructureCosts || '0.00',\n        otherCosts: otherCosts || '0.00',\n        totalCosts: totalCosts.toFixed(2),\n        notes\n      });\n\n      res.json(costData);\n    } catch (error) {\n      console.error('Error updating monthly costs:', error);\n      res.status(500).json({ message: 'Failed to update monthly costs' });\n    }\n  });\n\n  // Update monthly cost entry endpoint\n  app.put('/api/admin/costs/monthly/:id', combinedAuth, async (req: any, res) => {\n    try {\n      if (req.session?.adminUser?.role !== 'admin' && req.user?.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      const { id } = req.params;\n      const { developmentCosts, infrastructureCosts, otherCosts, notes } = req.body;\n\n      // Get current entry to preserve year/month and recalculate API costs\n      const existing = await storage.getMonthlyCostById(parseInt(id));\n      if (!existing) {\n        return res.status(404).json({ message: 'Monthly cost entry not found' });\n      }\n\n      // Recalculate API costs for this month\n      const apiCosts = await storage.calculateMonthlyApiCosts(existing.year, existing.month);\n      const totalCosts = parseFloat(apiCosts.toString()) + \n                        parseFloat(developmentCosts || 0) + \n                        parseFloat(infrastructureCosts || 0) + \n                        parseFloat(otherCosts || 0);\n\n      const updatedCost = await storage.updateMonthlyCost(parseInt(id), {\n        apiCosts: apiCosts.toFixed(2),\n        developmentCosts: developmentCosts || '0.00',\n        infrastructureCosts: infrastructureCosts || '0.00',\n        otherCosts: otherCosts || '0.00',\n        totalCosts: totalCosts.toFixed(2),\n        notes: notes || null\n      });\n\n      res.json(updatedCost);\n    } catch (error) {\n      console.error('Error updating monthly cost:', error);\n      res.status(500).json({ message: 'Failed to update monthly cost' });\n    }\n  });\n\n  // API pricing management endpoints (admin only)\n  app.get('/api/admin/api-pricing', combinedAuth, async (req: any, res) => {\n    try {\n      if (req.session?.adminUser?.role !== 'admin' && req.user?.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      const pricing = await storage.getApiPricing();\n      const uniqueProviders = await storage.getUniqueApiProviders();\n\n      res.json({\n        pricing,\n        uniqueProviders\n      });\n    } catch (error) {\n      console.error('Error fetching API pricing:', error);\n      res.status(500).json({ message: 'Failed to fetch API pricing' });\n    }\n  });\n\n  app.post('/api/admin/api-pricing', combinedAuth, async (req: any, res) => {\n    try {\n      if (req.session?.adminUser?.role !== 'admin' && req.user?.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      const { provider, service, model, pricePerToken, pricePerRequest } = req.body;\n\n      const pricingData = await storage.upsertApiPricing({\n        provider,\n        service,\n        model: model || null,\n        pricePerToken: pricePerToken || '0.00000000',\n        pricePerRequest: pricePerRequest || '0.000000',\n        isActive: true\n      });\n\n      res.json(pricingData);\n    } catch (error) {\n      console.error('Error updating API pricing:', error);\n      res.status(500).json({ message: 'Failed to update API pricing' });\n    }\n  });\n\n  app.delete('/api/admin/api-pricing/:id', combinedAuth, async (req: any, res) => {\n    try {\n      if (req.session?.adminUser?.role !== 'admin' && req.user?.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      const id = parseInt(req.params.id);\n      await storage.deleteApiPricing(id);\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error('Error deleting API pricing:', error);\n      res.status(500).json({ message: 'Failed to delete API pricing' });\n    }\n  });\n\n  // User details endpoint for sidebar information\n  app.get('/api/user/details/:userId', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.params.userId;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      let details: any = {};\n      \n      if (user.role === 'student') {\n        // Fetch school admin details for school name\n        if (user.schoolAdminId) {\n          const schoolAdmin = await storage.getUser(user.schoolAdminId);\n          details.schoolName = schoolAdmin?.schoolName || 'Ismeretlen iskola';\n        }\n        \n        // Fetch class details - use a simple query approach for now\n        if (user.classId) {\n          try {\n            const classQuery = await storage.getClassesBySchoolAdmin(user.schoolAdminId || '');\n            const classDetails = classQuery.find(c => c.id === user.classId);\n            details.className = classDetails?.name || 'Ismeretlen oszt√°ly';\n          } catch (error) {\n            console.error('Error fetching class details:', error);\n            details.className = 'Robotika1'; // Fallback based on known data\n          }\n        }\n        \n        // Fetch assigned teacher details\n        if (user.assignedTeacherId) {\n          const teacher = await storage.getUser(user.assignedTeacherId);\n          details.teacherName = teacher ? `${teacher.firstName} ${teacher.lastName}` : 'Ismeretlen tan√°r';\n        }\n      }\n      \n      res.json(details);\n    } catch (error) {\n      console.error('Error fetching user details:', error);\n      res.status(500).json({ message: 'Failed to fetch user details' });\n    }\n  });\n\n  // Auth routes\n  app.get('/api/auth/user', async (req: any, res) => {\n    try {\n      // Check for local admin session\n      if (req.session?.adminUser) {\n        const user = await storage.getUser(req.session.adminUser.id);\n        if (user) {\n          return res.json(user);\n        } else {\n          return res.status(401).json({ message: \"Admin user not found\" });\n        }\n      }\n      \n      // Check for authenticated user (Replit or local)\n      if (req.isAuthenticated && req.isAuthenticated()) {\n        // Check if this is Replit auth (has claims) or local auth (direct user object)\n        if (req.user.claims && req.user.claims.sub) {\n          // Replit auth\n          const userId = req.user.claims.sub;\n          const user = await storage.getUser(userId);\n          console.log('Replit user fetched:', { userId: user?.id, completedModules: user?.completedModules });\n          return res.json(user);\n        } else if (req.user.id) {\n          // Local auth - ALWAYS fetch fresh data from database\n          console.log('Local user from session:', { userId: req.user.id, completedModules: req.user.completedModules });\n          \n          const freshUser = await storage.getUser(req.user.id);\n          console.log('Fresh local user from DB:', { userId: freshUser?.id, completedModules: freshUser?.completedModules, assignedProfessionIds: freshUser?.assignedProfessionIds });\n          \n          // Update session with fresh data to keep it synchronized\n          if (freshUser && req.session?.passport?.user) {\n            req.session.passport.user = freshUser;\n          }\n          \n          return res.json(freshUser);\n        }\n      }\n      \n      res.status(401).json({ message: \"Unauthorized\" });\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Admin login routes\n  app.post('/api/admin/login', async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      console.log('Admin login attempt:', { username, password });\n      \n      if (username === 'Borga' && password === 'Borga') {\n        // Create or get admin user\n        let adminUser = await storage.getUser('admin-borga');\n        if (!adminUser) {\n          adminUser = await storage.upsertUser({\n            id: 'admin-borga',\n            email: 'admin@globalsystem.com',\n            firstName: 'Borga',\n            lastName: 'Admin',\n            profileImageUrl: null,\n            role: 'admin'\n          });\n        }\n        \n        // Update admin role in database to ensure it's set correctly\n        await storage.updateUserRole('admin-borga', 'admin');\n        adminUser.role = 'admin';\n        \n        // Set admin user in session\n        (req.session as any).adminUser = adminUser;\n        \n        // Force session save with proper callback handling\n        await new Promise<void>((resolve, reject) => {\n          req.session.save((err: any) => {\n            if (err) {\n              console.error('Session save error:', err);\n              reject(err);\n            } else {\n              console.log('Session saved successfully for admin:', adminUser.id);\n              resolve();\n            }\n          });\n        });\n        \n        console.log('Admin login successful:', adminUser);\n        return res.json(adminUser);\n      } else {\n        console.log('Invalid admin credentials');\n        return res.status(401).json({ message: 'Invalid credentials' });\n      }\n    } catch (error) {\n      console.error('Admin login error:', error);\n      return res.status(500).json({ message: 'Login failed' });\n    }\n  });\n\n  app.post('/api/admin/logout', (req, res) => {\n    (req.session as any).adminUser = null;\n    res.json({ message: 'Logged out' });\n  });\n\n  // Custom auth middleware that supports both auth types\n  const customAuth = async (req: any, res: any, next: any) => {\n    if (req.session && req.session.adminUser) {\n      req.user = { claims: { sub: req.session.adminUser.id } };\n      return next();\n    }\n    return isAuthenticated(req, res, next);\n  };\n\n  // Users management endpoint for admin\n  app.get('/api/users', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.put('/api/users/:id/role', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      const { role } = req.body;\n      \n      if (!['admin', 'student', 'teacher'].includes(role)) {\n        return res.status(400).json({ message: \"Invalid role\" });\n      }\n\n      await storage.updateUserRole(targetUserId, role);\n      res.json({ message: \"User role updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating user role:\", error);\n      res.status(500).json({ message: \"Failed to update user role\" });\n    }\n  });\n\n  app.delete('/api/users/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      \n      // Prevent admin from deleting themselves\n      if (targetUserId === userId) {\n        return res.status(400).json({ message: \"Cannot delete your own account\" });\n      }\n\n      await storage.deleteUser(targetUserId);\n      res.json({ message: \"User deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Failed to delete user\" });\n    }\n  });\n\n  app.put('/api/users/:id/password', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      const { password } = req.body;\n      \n      if (!password || password.length < 4) {\n        return res.status(400).json({ message: \"Password must be at least 4 characters long\" });\n      }\n\n      await storage.updateUserPassword(targetUserId, password);\n      res.json({ message: \"Password updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating password:\", error);\n      res.status(500).json({ message: \"Failed to update password\" });\n    }\n  });\n\n  // Update user assigned professions\n  app.put('/api/users/:id/assigned-professions', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims?.sub || req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      const { professionIds } = req.body;\n\n      // Admin can assign professions to anyone\n      // Students can only assign professions to themselves and only if they don't have any assigned yet\n      if (user.role === 'admin') {\n        // Admin has full access\n      } else if (user.role === 'student' && userId === targetUserId) {\n        // Student can only assign to themselves\n        const targetUser = await storage.getUser(targetUserId);\n        if (targetUser && targetUser.assignedProfessionIds && targetUser.assignedProfessionIds.length > 0) {\n          return res.status(403).json({ message: \"You already have assigned professions. Contact an admin to change them.\" });\n        }\n      } else {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n      \n      if (!Array.isArray(professionIds)) {\n        return res.status(400).json({ message: \"professionIds must be an array\" });\n      }\n\n      await storage.updateUserAssignedProfessions(targetUserId, professionIds);\n      res.json({ message: \"Assigned professions updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating assigned professions:\", error);\n      res.status(500).json({ message: \"Failed to update assigned professions\" });\n    }\n  });\n\n  // Student self-assignment of first profession (only for students not in a class)\n  app.post('/api/student/select-profession', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'student') {\n        return res.status(403).json({ message: \"Only students can use this endpoint\" });\n      }\n\n      // Check if student is in a class - if so, they cannot choose profession manually\n      if (user.classId) {\n        const userClass = await storage.getClassWithProfession(user.classId);\n        if (userClass && userClass.professionId) {\n          return res.status(400).json({ \n            message: \"√ñn egy oszt√°lyhoz tartozik, amely m√°r rendelkezik szakm√°val. A szakm√°t nem v√°ltoztathatja meg.\" \n          });\n        }\n      }\n\n      // Check if student already has assigned professions\n      if (user.assignedProfessionIds && user.assignedProfessionIds.length > 0) {\n        return res.status(400).json({ message: \"You already have assigned professions. Contact an admin to change them.\" });\n      }\n\n      const { professionId } = req.body;\n      \n      if (!professionId || typeof professionId !== 'number') {\n        return res.status(400).json({ message: \"professionId must be a number\" });\n      }\n\n      await storage.updateUserAssignedProfessions(userId, [professionId]);\n      invalidateSitemapCache(); // Friss√≠t√©s szakma kiv√°laszt√°sakor\n      res.json({ message: \"Profession assigned successfully\" });\n    } catch (error) {\n      console.error(\"Error selecting profession:\", error);\n      res.status(500).json({ message: \"Failed to select profession\" });\n    }\n  });\n\n  // Public API endpoints (for authenticated users with profession-based access control)\n  app.get('/api/public/professions', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n\n      // Admin can see all professions\n      if (user.role === 'admin') {\n        const professions = await storage.getProfessions();\n        return res.json(professions);\n      }\n\n      // Students can see assigned professions or all if they haven't chosen any\n      const hasAssignedProfessions = user.assignedProfessionIds && user.assignedProfessionIds.length > 0;\n      \n      if (hasAssignedProfessions) {\n        // Return only assigned professions\n        const allProfessions = await storage.getProfessions();\n        const assignedProfessions = allProfessions.filter(p => \n          user.assignedProfessionIds!.includes(p.id)\n        );\n        return res.json(assignedProfessions);\n      } else {\n        // Return all professions for first-time selection\n        const professions = await storage.getProfessions();\n        return res.json(professions);\n      }\n    } catch (error) {\n      console.error(\"Error fetching public professions:\", error);\n      res.status(500).json({ message: \"Failed to fetch professions\" });\n    }\n  });\n\n  app.get('/api/public/subjects', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(401).json({ message: \"User not found\" });\n      }\n\n      const professionId = req.query.professionId ? parseInt(req.query.professionId as string) : undefined;\n\n      // Admin and teacher can see all subjects\n      if (user.role === 'admin' || user.role === 'teacher') {\n        const subjects = await storage.getSubjects(professionId);\n        return res.json(subjects);\n      }\n\n      // Students can only see subjects from their assigned professions\n      const hasAssignedProfessions = user.assignedProfessionIds && user.assignedProfessionIds.length > 0;\n      \n      if (!hasAssignedProfessions) {\n        // If student hasn't chosen profession yet, allow seeing subjects from any profession\n        const subjects = await storage.getSubjects(professionId);\n        return res.json(subjects);\n      }\n\n      // Check if the requested profession is in user's assigned professions\n      if (professionId && !user.assignedProfessionIds!.includes(professionId)) {\n        return res.status(403).json({ message: \"Access denied to this profession\" });\n      }\n\n      const subjects = await storage.getSubjects(professionId);\n      res.json(subjects);\n    } catch (error) {\n      console.error(\"Error fetching public subjects:\", error);\n      res.status(500).json({ message: \"Failed to fetch subjects\" });\n    }\n  });\n\n  // OpenAI API key update endpoint\n  app.post('/api/admin/update-openai-key', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { openaiApiKey } = req.body;\n      if (!openaiApiKey || !openaiApiKey.startsWith('sk-')) {\n        return res.status(400).json({ message: \"Invalid OpenAI API key format\" });\n      }\n\n      // Store the API key securely in the database\n      await storage.setSystemSetting('openai_api_key', openaiApiKey, userId);\n      console.log('OpenAI API key updated by admin:', userId);\n      \n      res.json({ message: \"OpenAI API key updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating OpenAI API key:\", error);\n      res.status(500).json({ message: \"Failed to update OpenAI API key\" });\n    }\n  });\n\n  // Gemini API key update endpoint\n  app.post('/api/admin/update-gemini-key', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { geminiApiKey } = req.body;\n      if (!geminiApiKey || !geminiApiKey.startsWith('AIza')) {\n        return res.status(400).json({ message: \"Invalid Gemini API key format\" });\n      }\n\n      // Store the API key securely in the database\n      await storage.setSystemSetting('gemini_api_key', geminiApiKey, userId);\n      console.log('Gemini API key updated by admin:', userId);\n      \n      res.json({ message: \"Gemini API key updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating Gemini API key:\", error);\n      res.status(500).json({ message: \"Failed to update Gemini API key\" });\n    }\n  });\n\n  // AI Provider selection endpoint\n  app.post('/api/admin/update-ai-provider', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { provider } = req.body;\n      if (!provider || !['openai', 'gemini'].includes(provider)) {\n        return res.status(400).json({ message: \"Invalid AI provider. Must be 'openai' or 'gemini'\" });\n      }\n\n      // Store the AI provider preference in the database\n      await storage.setSystemSetting('ai_provider', provider, userId);\n      console.log('AI provider updated by admin:', userId, 'to:', provider);\n      \n      res.json({ message: \"AI provider updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating AI provider:\", error);\n      res.status(500).json({ message: \"Failed to update AI provider\" });\n    }\n  });\n\n  // SerpAPI key update endpoint\n  app.post('/api/admin/update-serp-key', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { serpApiKey } = req.body;\n      if (!serpApiKey) {\n        return res.status(400).json({ message: \"SerpAPI key is required\" });\n      }\n\n      await storage.setSystemSetting('serp_api_key', serpApiKey, userId);\n      console.log('SerpAPI key updated by admin:', userId);\n      \n      res.json({ message: \"SerpAPI key updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating SerpAPI key:\", error);\n      res.status(500).json({ message: \"Failed to update SerpAPI key\" });\n    }\n  });\n\n  // YouTube API key update endpoint\n  app.post('/api/admin/update-youtube-key', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { youtubeApiKey } = req.body;\n      if (!youtubeApiKey) {\n        return res.status(400).json({ message: \"YouTube API key is required\" });\n      }\n\n      await storage.setSystemSetting('youtube_api_key', youtubeApiKey, userId);\n      console.log('YouTube API key updated by admin:', userId);\n      \n      res.json({ message: \"YouTube API key updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating YouTube API key:\", error);\n      res.status(500).json({ message: \"Failed to update YouTube API key\" });\n    }\n  });\n\n  // ElevenLabs API key update endpoint\n  app.post('/api/admin/update-elevenlabs-key', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { elevenLabsKey } = req.body;\n      if (!elevenLabsKey) {\n        return res.status(400).json({ message: \"ElevenLabs API key is required\" });\n      }\n\n      await storage.setSystemSetting('elevenlabs_api_key', elevenLabsKey, userId);\n      console.log('ElevenLabs API key updated by admin:', userId);\n      \n      res.json({ message: \"ElevenLabs API key updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating ElevenLabs API key:\", error);\n      res.status(500).json({ message: \"Failed to update ElevenLabs API key\" });\n    }\n  });\n\n  // AI System Message Management\n  app.post('/api/admin/settings/system-message', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      // Store the system message in the database\n      await storage.setSystemSetting('ai_system_message', message, userId);\n      console.log('AI system message updated by admin:', userId);\n      \n      res.json({ message: \"System message updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating system message:\", error);\n      res.status(500).json({ message: \"Failed to update system message\" });\n    }\n  });\n\n  app.get('/api/admin/settings/system-message', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const systemMessageSetting = await storage.getSystemSetting('ai_system_message');\n      \n      res.json({ \n        message: systemMessageSetting?.value || 'Te egy szak√©rt≈ë oktat√°si AI asszisztens vagy, aki magyar nyelven seg√≠t a tanul√°sban. Haszn√°lj szakmai nyelvezetet, de egyszer≈± magyar√°zatokat. Tartsd meg a l√©nyeges inform√°ci√≥kat √©s jav√≠tsd a szerkezetet. A tartalom legyen logikus √©s k√∂nnyen √©rthet≈ë.\\n\\nFONTOS YOUTUBE KERES√âSI IR√ÅNYELVEK:\\n- Csak a legfontosabb fogalmakhoz gener√°lj YouTube keres√©si kifejez√©seket\\n- Fogalmank√©nt MAXIMUM 1 keres√©si kifejez√©st haszn√°lj\\n- Ker√ºld a t√∫l sok vagy ism√©tl≈ëd≈ë keres√©st\\n- F√≥kusz√°lj a gyakorlati, oktat√°si tartalmakra\\n- A keres√©si kifejez√©sek legyenek specifikusak √©s relev√°nsak' \n      });\n    } catch (error) {\n      console.error(\"Error fetching system message:\", error);\n      res.status(500).json({ message: \"Failed to fetch system message\" });\n    }\n  });\n\n  // Iskolai admin regisztr√°l√°s\n  app.post('/api/admin/create-school-admin', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { username, password, firstName, lastName, schoolName, email } = req.body;\n      \n      if (!username || !password || !firstName || !lastName || !schoolName) {\n        return res.status(400).json({ message: \"Username, password, firstName, lastName, and schoolName are required\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy l√©tezik-e m√°r ilyen felhaszn√°l√≥n√©v\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Ez a felhaszn√°l√≥n√©v m√°r foglalt\" });\n      }\n\n      // Hozzunk l√©tre √∫j iskolai admin felhaszn√°l√≥t\n      const newUser = await storage.createUser({\n        username,\n        firstName,\n        lastName,\n        schoolName,\n        email: email || null,\n        role: 'school_admin',\n        password\n      });\n      \n      res.json({ \n        message: \"Iskolai admin sikeresen l√©trehozva\", \n        userId: newUser.id,\n        schoolName: newUser.schoolName\n      });\n    } catch (error) {\n      console.error(\"Error creating school admin:\", error);\n      res.status(500).json({ message: \"Failed to create school admin\" });\n    }\n  });\n\n  // AI Module Update Message Management\n  app.post('/api/admin/settings/module-update-message', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      // Store the module update message in the database\n      await storage.setSystemSetting('ai_module_update_message', message, userId);\n      console.log('AI module update message updated by admin:', userId);\n      \n      res.json({ message: \"Module update message updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating module update message:\", error);\n      res.status(500).json({ message: \"Failed to update module update message\" });\n    }\n  });\n\n  app.get('/api/admin/settings/module-update-message', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const moduleUpdateMessageSetting = await storage.getSystemSetting('ai_module_update_message');\n      \n      res.json({ \n        message: moduleUpdateMessageSetting?.value || 'Friss√≠tsd a k√∂vetkez≈ë tananyag modult. Haszn√°lj szakmai nyelvezetet, de egyszer≈± magyar√°zatokat. Tartsd meg a l√©nyeges inform√°ci√≥kat √©s jav√≠tsd a szerkezetet. A tartalom legyen logikus √©s k√∂nnyen √©rthet≈ë. FONTOS: Automatikusan adj hozz√° Wikipedia hivatkoz√°sokat a szakmai kifejez√©sekhez √©s fogalmakhoz - haszn√°lj [sz√∂veg](https://hu.wikipedia.org/wiki/C√≠msz√≥) form√°tumot. Keress relev√°ns YouTube vide√≥ t√©m√°kat √©s adj hozz√° DataForSEO alap√∫ friss inform√°ci√≥kat a tartalom gazdag√≠t√°s√°hoz.' \n      });\n    } catch (error) {\n      console.error(\"Error fetching module update message:\", error);\n      res.status(500).json({ message: \"Failed to fetch module update message\" });\n    }\n  });\n\n  // YouTube Search Prompt Management\n  app.post('/api/admin/settings/youtube-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      await storage.setSystemSetting('ai_youtube_prompt', message, userId);\n      console.log('YouTube prompt updated by admin:', userId);\n      \n      res.json({ message: \"YouTube prompt updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating YouTube prompt:\", error);\n      res.status(500).json({ message: \"Failed to update YouTube prompt\" });\n    }\n  });\n\n  app.get('/api/admin/settings/youtube-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const youtubeSetting = await storage.getSystemSetting('ai_youtube_prompt');\n      \n      res.json({ \n        message: youtubeSetting?.value || 'Gener√°lj 1-2 konkr√©t YouTube keres√©si kifejez√©st a modul legfontosabb fogalmaihoz. F√≥kusz√°lj praktikus, oktat√°si tartalmakra √©s ker√ºld az ism√©tl≈ëd≈ë keres√©seket. Modulc√≠m: {title}, Tartalom: {content}' \n      });\n    } catch (error) {\n      console.error(\"Error fetching YouTube prompt:\", error);\n      res.status(500).json({ message: \"Failed to fetch YouTube prompt\" });\n    }\n  });\n\n  // Wikipedia Search Prompt Management\n  app.post('/api/admin/settings/wikipedia-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      await storage.setSystemSetting('ai_wikipedia_prompt', message, userId);\n      console.log('Wikipedia prompt updated by admin:', userId);\n      \n      res.json({ message: \"Wikipedia prompt updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating Wikipedia prompt:\", error);\n      res.status(500).json({ message: \"Failed to update Wikipedia prompt\" });\n    }\n  });\n\n  app.get('/api/admin/settings/wikipedia-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const wikipediaSetting = await storage.getSystemSetting('ai_wikipedia_prompt');\n      \n      res.json({ \n        message: wikipediaSetting?.value || 'Azonos√≠tsd a modul legfontosabb szakmai kifejez√©seit √©s fogalmait, amelyekhez Wikipedia linkeket kell hozz√°adni. Csak azokat a kifejez√©seket v√°laszd ki, amelyek val√≥ban fontosak a t√©m√°hoz. Modulc√≠m: {title}, Tartalom: {content}' \n      });\n    } catch (error) {\n      console.error(\"Error fetching Wikipedia prompt:\", error);\n      res.status(500).json({ message: \"Failed to fetch Wikipedia prompt\" });\n    }\n  });\n\n  // Internet Content Generation Prompt Management\n  app.post('/api/admin/settings/internet-content-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      await storage.setSystemSetting('ai_internet_content_prompt', message, userId);\n      console.log('Internet content prompt updated by admin:', userId);\n      \n      res.json({ message: \"Internet content prompt updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating internet content prompt:\", error);\n      res.status(500).json({ message: \"Failed to update internet content prompt\" });\n    }\n  });\n\n  // Concise Content Generation Prompt Management\n  app.post('/api/admin/settings/concise-content-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      await storage.setSystemSetting('concise-content-prompt', message, userId);\n      console.log('Concise content prompt updated by admin:', userId);\n      \n      res.json({ message: \"Concise content prompt updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating concise content prompt:\", error);\n      res.status(500).json({ message: \"Failed to update concise content prompt\" });\n    }\n  });\n\n  app.get('/api/admin/settings/concise-content-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const conciseContentSetting = await storage.getSystemSetting('concise-content-prompt');\n      \n      res.json({ \n        message: conciseContentSetting?.value || 'K√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot a k√∂vetkez≈ë c√≠mhez: {title}. Alapanyag: {content}. K√∂vetelm√©nyek: Maximum 300-400 sz√≥, csak a legfontosabb inform√°ci√≥k, egyszer≈± nyelvezet, markdown form√°z√°s.' \n      });\n    } catch (error) {\n      console.error(\"Error fetching concise content prompt:\", error);\n      res.status(500).json({ message: \"Failed to fetch concise content prompt\" });\n    }\n  });\n\n  // Audio Explanation Prompt Management\n  app.post('/api/admin/settings/audio-explanation-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      await storage.setSystemSetting('audio-explanation-prompt', message, userId);\n      console.log('Audio explanation prompt updated by admin:', userId);\n      \n      res.json({ message: \"Audio explanation prompt updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating audio explanation prompt:\", error);\n      res.status(500).json({ message: \"Failed to update audio explanation prompt\" });\n    }\n  });\n\n  app.get('/api/admin/settings/audio-explanation-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const audioExplanationSetting = await storage.getSystemSetting('audio-explanation-prompt');\n      \n      res.json({ \n        message: audioExplanationSetting?.value || 'K√©sz√≠ts r√∂vid, √©rthet≈ë hangos magyar√°zatot a tanul√≥ k√©rd√©s√©re a modul tartalm√°nak alapj√°n. Haszn√°lj egyszer≈± nyelvezetet √©s konkr√©t p√©ld√°kat. K√©rd√©s: {question}, Modul: {title}, Tartalom: {content}' \n      });\n    } catch (error) {\n      console.error(\"Error fetching audio explanation prompt:\", error);\n      res.status(500).json({ message: \"Failed to fetch audio explanation prompt\" });\n    }\n  });\n\n  // Text Explanation Prompt Management\n  app.post('/api/admin/settings/text-explanation-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { message } = req.body;\n      if (!message || typeof message !== 'string') {\n        return res.status(400).json({ message: \"Valid message is required\" });\n      }\n\n      await storage.setSystemSetting('text-explanation-prompt', message, userId);\n      console.log('Text explanation prompt updated by admin:', userId);\n      \n      res.json({ message: \"Text explanation prompt updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating text explanation prompt:\", error);\n      res.status(500).json({ message: \"Failed to update text explanation prompt\" });\n    }\n  });\n\n  app.get('/api/admin/settings/text-explanation-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const textExplanationSetting = await storage.getSystemSetting('text-explanation-prompt');\n      \n      res.json({ \n        message: textExplanationSetting?.value || 'K√©sz√≠ts r√©szletes, struktur√°lt sz√∂veges magyar√°zatot a tanul√≥ k√©rd√©s√©re. Haszn√°lj pontokat, p√©ld√°kat √©s gyakorlati alkalmaz√°sokat. K√©rd√©s: {question}, Modul: {title}, Tartalom: {content}' \n      });\n    } catch (error) {\n      console.error(\"Error fetching text explanation prompt:\", error);\n      res.status(500).json({ message: \"Failed to fetch text explanation prompt\" });\n    }\n  });\n\n  app.get('/api/admin/settings/internet-content-prompt', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const internetContentSetting = await storage.getSystemSetting('ai_internet_content_prompt');\n      \n      res.json({ \n        message: internetContentSetting?.value || 'Gener√°lj friss√≠tett, r√©szletes tartalmat az internet seg√≠ts√©g√©vel. Haszn√°lj aktu√°lis inform√°ci√≥kat, gyakorlati p√©ld√°kat √©s struktur√°lt fel√©p√≠t√©st. Modulc√≠m: {title}, Eredeti tartalom: {content}' \n      });\n    } catch (error) {\n      console.error(\"Error fetching internet content prompt:\", error);\n      res.status(500).json({ message: \"Failed to fetch internet content prompt\" });\n    }\n  });\n\n  // User management routes (Admin only)\n  app.get('/api/admin/users', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.put('/api/admin/users/:id/role', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      const { role } = req.body;\n      \n      if (!['admin', 'student'].includes(role)) {\n        return res.status(400).json({ message: \"Invalid role\" });\n      }\n\n      await storage.updateUserRole(targetUserId, role);\n      res.json({ message: \"User role updated successfully\" });\n    } catch (error) {\n      console.error(\"Error updating user role:\", error);\n      res.status(500).json({ message: \"Failed to update user role\" });\n    }\n  });\n\n  // Unlock all modules for a user (Admin only)\n  app.post('/api/admin/users/:id/unlock-all-modules', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      \n      // Get all published modules\n      const allModules = await storage.getPublishedModules();\n      const allModuleIds = allModules.map(m => m.id);\n      \n      // Update user's completed modules to include all module IDs\n      await storage.updateUserCompletedModules(targetUserId, allModuleIds);\n      \n      console.log(`Admin ${userId} unlocked all ${allModuleIds.length} modules for user ${targetUserId}`);\n      \n      res.json({ \n        message: \"All modules unlocked successfully\",\n        unlockedCount: allModuleIds.length\n      });\n    } catch (error) {\n      console.error(\"Error unlocking all modules:\", error);\n      res.status(500).json({ message: \"Failed to unlock all modules\" });\n    }\n  });\n\n  // Jelsz√≥ vissza√°ll√≠t√°si endpoint\n  app.post('/api/admin/reset-password', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user && req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user && req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { userId: targetUserId, newPassword } = req.body;\n      \n      if (!targetUserId || !newPassword) {\n        return res.status(400).json({ message: \"User ID and new password are required\" });\n      }\n\n      // Minimum password length check\n      if (newPassword.length < 6) {\n        return res.status(400).json({ message: \"Password must be at least 6 characters long\" });\n      }\n\n      await storage.updateUserPassword(targetUserId, newPassword);\n      res.json({ message: \"Password reset successfully\" });\n    } catch (error) {\n      console.error(\"Error resetting password:\", error);\n      res.status(500).json({ message: \"Failed to reset password\" });\n    }\n  });\n\n  app.delete('/api/admin/users/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const targetUserId = req.params.id;\n      \n      // Prevent admin from deleting themselves\n      if (targetUserId === userId) {\n        return res.status(400).json({ message: \"Cannot delete your own account\" });\n      }\n\n      await storage.deleteUser(targetUserId);\n      res.json({ message: \"User deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting user:\", error);\n      res.status(500).json({ message: \"Failed to delete user\" });\n    }\n  });\n\n  // Public/Student routes for reading data\n  app.get('/api/public/professions', combinedAuth, async (req: any, res) => {\n    try {\n      const professions = await storage.getProfessions();\n      res.json(professions);\n    } catch (error) {\n      console.error(\"Error fetching professions:\", error);\n      res.status(500).json({ message: \"Failed to fetch professions\" });\n    }\n  });\n\n\n\n  app.get('/api/public/modules', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims?.sub || req.user.id;\n      const user = await storage.getUser(userId);\n      const subjectId = req.query.subjectId ? parseInt(req.query.subjectId as string) : undefined;\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Apply Mermaid syntax fixes to remove Wikipedia links from diagrams\n      const { fixMermaidSyntax } = await import('./openai');\n      \n      const cleanModules = (modules: any[]) => modules.map(module => ({\n        ...module,\n        content: module.content ? fixMermaidSyntax(module.content) : module.content,\n        conciseContent: module.conciseContent ? fixMermaidSyntax(module.conciseContent) : module.conciseContent,\n        detailedContent: module.detailedContent ? fixMermaidSyntax(module.detailedContent) : module.detailedContent,\n      }));\n\n      // For teachers and admins, show all modules; for students, only published ones\n      if (user.role === 'teacher' || user.role === 'admin') {\n        // If subjectId is provided, use it directly\n        if (subjectId) {\n          const modules = await storage.getModules(subjectId);\n          res.json(cleanModules(modules));\n          return;\n        }\n\n        // Otherwise, get all modules from all subjects\n        const allSubjects = await storage.getSubjects(); // Get all subjects\n        let allModules = [];\n        \n        for (const subject of allSubjects) {\n          const modules = await storage.getModules(subject.id);\n          allModules.push(...modules);\n        }\n        \n        res.json(cleanModules(allModules));\n      } else {\n        // Regular students - only published modules\n        if (subjectId) {\n          const modules = await storage.getPublishedModules(subjectId);\n          res.json(cleanModules(modules));\n          return;\n        }\n\n        // Otherwise, get modules for user's profession subjects\n        if (user.selectedProfessionId) {\n          const subjects = await storage.getSubjects(user.selectedProfessionId);\n          let allModules = [];\n          \n          for (const subject of subjects) {\n            const modules = await storage.getPublishedModules(subject.id);\n            allModules.push(...modules);\n          }\n          \n          res.json(cleanModules(allModules));\n        } else {\n          res.json([]);\n        }\n      }\n    } catch (error) {\n      console.error(\"Error fetching modules:\", error);\n      res.status(500).json({ message: \"Failed to fetch modules\" });\n    }\n  });\n\n  // Profession routes\n  app.post('/api/professions', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const professionData = insertProfessionSchema.parse(req.body);\n      const profession = await storage.createProfession(professionData);\n      res.json(profession);\n    } catch (error) {\n      console.error(\"Error creating profession:\", error);\n      res.status(500).json({ message: \"Failed to create profession\" });\n    }\n  });\n\n  app.patch('/api/professions/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const professionId = parseInt(req.params.id);\n      const professionData = insertProfessionSchema.partial().parse(req.body);\n      const profession = await storage.updateProfession(professionId, professionData);\n      res.json(profession);\n    } catch (error) {\n      console.error(\"Error updating profession:\", error);\n      res.status(500).json({ message: \"Failed to update profession\" });\n    }\n  });\n\n  app.put('/api/professions/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const professionId = parseInt(req.params.id);\n      const professionData = insertProfessionSchema.parse(req.body);\n      const profession = await storage.updateProfession(professionId, professionData);\n      res.json(profession);\n    } catch (error) {\n      console.error(\"Error updating profession:\", error);\n      res.status(500).json({ message: \"Failed to update profession\" });\n    }\n  });\n\n  app.delete('/api/professions/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const professionId = parseInt(req.params.id);\n      \n      // Check if profession has subjects\n      const subjects = await storage.getSubjects(professionId);\n      if (subjects.length > 0) {\n        return res.status(400).json({ \n          message: \"Nem t√∂r√∂lhet≈ë a szakma, mert tartoznak hozz√° tant√°rgyak\" \n        });\n      }\n      \n      await storage.deleteProfession(professionId);\n      res.json({ message: \"Profession deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting profession:\", error);\n      res.status(500).json({ message: \"Failed to delete profession\" });\n    }\n  });\n\n  // Subject routes  \n  app.post('/api/subjects', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const subjectData = insertSubjectSchema.parse(req.body);\n      const subject = await storage.createSubject(subjectData);\n      res.json(subject);\n    } catch (error) {\n      console.error(\"Error creating subject:\", error);\n      res.status(500).json({ message: \"Failed to create subject\" });\n    }\n  });\n\n  app.patch('/api/subjects/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const subjectId = parseInt(req.params.id);\n      const subjectData = insertSubjectSchema.partial().parse(req.body);\n      const subject = await storage.updateSubject(subjectId, subjectData);\n      res.json(subject);\n    } catch (error) {\n      console.error(\"Error updating subject:\", error);\n      res.status(500).json({ message: \"Failed to update subject\" });\n    }\n  });\n\n  app.put('/api/subjects/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const subjectId = parseInt(req.params.id);\n      const subjectData = insertSubjectSchema.parse(req.body);\n      const subject = await storage.updateSubject(subjectId, subjectData);\n      res.json(subject);\n    } catch (error) {\n      console.error(\"Error updating subject:\", error);\n      res.status(500).json({ message: \"Failed to update subject\" });\n    }\n  });\n\n  app.delete('/api/subjects/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const subjectId = parseInt(req.params.id);\n      \n      // Check if subject has modules\n      const modules = await storage.getModules(subjectId);\n      if (modules.length > 0) {\n        return res.status(400).json({ \n          message: \"Nem t√∂r√∂lhet≈ë a tant√°rgy, mert tartoznak hozz√° modulok\" \n        });\n      }\n      \n      await storage.deleteSubject(subjectId);\n      res.json({ message: \"Subject deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting subject:\", error);\n      res.status(500).json({ message: \"Failed to delete subject\" });\n    }\n  });\n\n  // Module routes\n  app.get('/api/modules', combinedAuth, async (req: any, res) => {\n    try {\n      console.log('Modules fetch - req.user:', req.user);\n      \n      if (!req.user) {\n        console.log('Modules fetch - No user in request');\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const userId = req.user.claims?.sub || req.user.id;\n      console.log('Modules fetch - userId:', userId);\n      const user = await storage.getUser(userId);\n      console.log('Modules fetch - user:', { id: user?.id, role: user?.role });\n      const subjectId = req.query.subjectId ? parseInt(req.query.subjectId as string) : undefined;\n      console.log('Modules fetch - subjectId:', subjectId);\n      \n      if (!user) {\n        console.log('Modules fetch - User not found');\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      let modules;\n      if (user.role === 'admin' || user.role === 'teacher') {\n        console.log('Modules fetch - Admin/Teacher role, fetching all modules');\n        modules = await storage.getModules(subjectId);\n      } else {\n        console.log('Modules fetch - Student role, fetching published modules');\n        modules = await storage.getPublishedModules(subjectId);\n      }\n\n      console.log('Modules fetch - Result count:', modules.length);\n      res.json(modules);\n    } catch (error) {\n      console.error(\"Error fetching modules - Details:\", error);\n      console.error(\"Error stack:\", (error as Error).stack);\n      res.status(500).json({ message: \"Failed to fetch modules\" });\n    }\n  });\n\n  app.get('/api/modules/:id', combinedAuth, async (req: any, res) => {\n    try {\n      const moduleId = parseInt(req.params.id);\n      const module = await storage.getModule(moduleId);\n      \n      if (!module) {\n        return res.status(404).json({ message: \"Module not found\" });\n      }\n\n      // Apply Mermaid syntax fixes to remove Wikipedia links from diagrams\n      const { fixMermaidSyntax } = await import('./openai');\n      \n      const cleanedModule = {\n        ...module,\n        content: module.content ? fixMermaidSyntax(module.content) : module.content,\n        conciseContent: module.conciseContent ? fixMermaidSyntax(module.conciseContent) : module.conciseContent,\n        detailedContent: module.detailedContent ? fixMermaidSyntax(module.detailedContent) : module.detailedContent,\n      };\n\n      res.json(cleanedModule);\n    } catch (error) {\n      console.error(\"Error fetching module:\", error);\n      res.status(500).json({ message: \"Failed to fetch module\" });\n    }\n  });\n\n  app.post('/api/modules', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const moduleData = insertModuleSchema.parse(req.body);\n      const module = await storage.createModule(moduleData);\n      res.json(module);\n    } catch (error) {\n      console.error(\"Error creating module:\", error);\n      res.status(500).json({ message: \"Failed to create module\" });\n    }\n  });\n\n  app.patch('/api/modules/:id', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims?.sub || req.user.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const moduleId = parseInt(req.params.id);\n      \n      console.log('PATCH /api/modules/:id - Raw request body:', JSON.stringify(req.body, null, 2));\n      \n      const moduleData = insertModuleSchema.partial().parse(req.body);\n      \n      console.log(`Admin ${userId} updating module ${moduleId}:`, {\n        title: moduleData.title,\n        content: moduleData.content ? `${moduleData.content.substring(0, 100)}...` : 'NO CONTENT',\n        contentLength: moduleData.content?.length || 0,\n        conciseContent: moduleData.conciseContent ? `${moduleData.conciseContent.substring(0, 50)}...` : 'NO CONCISE',\n        detailedContent: moduleData.detailedContent ? `${moduleData.detailedContent.substring(0, 50)}...` : 'NO DETAILED',\n        keyConceptsData: moduleData.keyConceptsData ? `${Array.isArray(moduleData.keyConceptsData) ? moduleData.keyConceptsData.length : 0} concepts` : 'NO KEY CONCEPTS',\n        isPublished: moduleData.isPublished,\n        allFields: Object.keys(moduleData)\n      });\n      \n      // Get original module before update for comparison\n      const originalModule = await storage.getModule(moduleId);\n      console.log('Original module content length:', originalModule?.content?.length || 0);\n      \n      const module = await storage.updateModule(moduleId, moduleData);\n      \n      console.log(`Module ${moduleId} successfully updated. New content length:`, module?.content?.length || 0);\n      console.log('Updated module title:', module.title);\n      \n      res.json(module);\n    } catch (error) {\n      console.error(\"Error updating module:\", error);\n      res.status(500).json({ message: \"Failed to update module\" });\n    }\n  });\n\n  app.delete('/api/modules/:id', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const moduleId = parseInt(req.params.id);\n      await storage.deleteModule(moduleId);\n      res.json({ message: \"Module deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting module:\", error);\n      res.status(500).json({ message: \"Failed to delete module\" });\n    }\n  });\n\n  // Profession routes\n  app.get('/api/professions', combinedAuth, async (req: any, res) => {\n    try {\n      const professions = await storage.getProfessions();\n      res.json(professions);\n    } catch (error) {\n      console.error(\"Error fetching professions:\", error);\n      res.status(500).json({ message: \"Failed to fetch professions\" });\n    }\n  });\n\n  // Subject routes\n  app.get('/api/subjects', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // For admin and teacher users, use professionId from query params or get all subjects\n      // For regular users, use their selected profession\n      const professionId = (user.role === 'admin' || user.role === 'teacher')\n        ? (req.query.professionId ? parseInt(req.query.professionId) : undefined)\n        : user.selectedProfessionId;\n\n      const subjects = (user.role === 'admin' || user.role === 'teacher')\n        ? await storage.getSubjects(professionId ?? undefined)\n        : (professionId ? await storage.getSubjects(professionId) : []);\n      \n      res.json(subjects);\n    } catch (error) {\n      console.error(\"Error fetching subjects:\", error);\n      res.status(500).json({ message: \"Failed to fetch subjects\" });\n    }\n  });\n\n  app.get('/api/subjects/:id', customAuth, async (req: any, res) => {\n    try {\n      const subjectId = parseInt(req.params.id);\n      const subject = await storage.getSubject(subjectId);\n      \n      if (!subject) {\n        return res.status(404).json({ message: \"Subject not found\" });\n      }\n      \n      res.json(subject);\n    } catch (error) {\n      console.error(\"Error fetching subject:\", error);\n      res.status(500).json({ message: \"Failed to fetch subject\" });\n    }\n  });\n\n  // User profession update\n  app.put('/api/user/profession', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const { professionId } = req.body;\n      await storage.updateUserProfession(userId, professionId);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error updating user profession:\", error);\n      res.status(500).json({ message: \"Failed to update user profession\" });\n    }\n  });\n\n  // Progress tracking\n  app.post('/api/modules/:id/complete', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims?.sub || req.user.id;\n      const moduleId = parseInt(req.params.id);\n      \n      console.log('Module completion started:', { userId, moduleId });\n      \n      const user = await storage.getUser(userId);\n      if (!user) {\n        console.log('User not found:', userId);\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      console.log('User before completion:', { \n        userId: user.id, \n        completedModules: user.completedModules \n      });\n\n      const completedModules = user.completedModules || [];\n      if (!completedModules.includes(moduleId)) {\n        completedModules.push(moduleId);\n        console.log('Updating completed modules:', { userId, newCompletedModules: completedModules });\n        await storage.updateUserCompletedModules(userId, completedModules);\n        \n        // CRITICAL FIX: Update session data for local auth users\n        if (req.user.id && !req.user.claims) {\n          // This is a local auth user, update session\n          const updatedUser = await storage.getUser(userId);\n          if (updatedUser) {\n            req.user.completedModules = updatedUser.completedModules;\n            console.log('Session updated with fresh completed modules:', req.user.completedModules);\n          }\n        }\n        \n        // Verify the update worked\n        const updatedUser = await storage.getUser(userId);\n        console.log('User after completion:', { \n          userId: updatedUser?.id, \n          completedModules: updatedUser?.completedModules \n        });\n      } else {\n        console.log('Module already completed:', { userId, moduleId, completedModules });\n      }\n\n      invalidateSitemapCache(); // Friss√≠t√©s a halad√°s v√°ltoz√°sakor\n      res.json({ message: \"Module completed successfully\" });\n    } catch (error) {\n      console.error(\"Error completing module:\", error);\n      res.status(500).json({ message: \"Failed to complete module\" });\n    }\n  });\n\n  // Cache for sitemap to avoid repeated database queries\n  let sitemapCache: any = null;\n  let sitemapCacheTime: number = 0;\n  const SITEMAP_CACHE_DURATION = 30000; // 30 seconds cache\n\n  // Generate website sitemap for ChatGPT context with real-time updates\n  const generateSitemap = async (userId: string, forceRefresh: boolean = false) => {\n    try {\n      const now = Date.now();\n      \n      // Return cached sitemap if still valid and not forcing refresh\n      if (!forceRefresh && sitemapCache && (now - sitemapCacheTime) < SITEMAP_CACHE_DURATION) {\n        return sitemapCache;\n      }\n\n      const user = await storage.getUser(userId);\n      const professions = await storage.getProfessions();\n      const subjects = await storage.getSubjects();\n      const modules = await storage.getModules();\n      \n      // Get user's completed modules for better context\n      const completedModules = user?.completedModules || [];\n      const totalModules = modules.length;\n      const completionPercentage = totalModules > 0 ? Math.round((completedModules.length / totalModules) * 100) : 0;\n      \n      const sitemap = {\n        website: \"Global Learning System - AI Oktat√°si Platform\",\n        user_role: user?.role || 'student',\n        user_progress: {\n          completed_modules: completedModules,\n          total_modules: totalModules,\n          completion_percentage: completionPercentage,\n          current_profession: (user?.assignedProfessionIds && user.assignedProfessionIds.length > 0) ? \n            professions.find(p => p.id === (user.assignedProfessionIds || [])[0])?.name : 'Nincs kiv√°lasztva'\n        },\n        main_sections: [\n          {\n            name: \"F≈ëoldal\",\n            url: \"/\",\n            description: \"Dashboard √©s √°ttekint√©s\"\n          },\n          {\n            name: \"Szakm√°k\",\n            url: \"/tananyagok\",\n            description: \"El√©rhet≈ë szakm√°k list√°ja\",\n            subsections: professions.map(prof => ({\n              name: prof.name,\n              id: prof.id,\n              description: prof.description,\n              is_assigned: (user?.assignedProfessionIds && user.assignedProfessionIds.includes(prof.id)) || false\n            }))\n          },\n          {\n            name: \"K√∂z√∂ss√©gi Tanul√°s\",\n            url: \"/community\",\n            description: \"Csoportos tanul√°s √©s megbesz√©l√©sek\"\n          },\n          {\n            name: \"Halad√°som\", \n            url: \"/progress\",\n            description: \"Tanul√°si el≈ërehalad√°s k√∂vet√©se\"\n          },\n          {\n            name: \"Be√°ll√≠t√°sok\",\n            url: \"/settings\",\n            description: \"Felhaszn√°l√≥i be√°ll√≠t√°sok\"\n          }\n        ],\n        available_modules: modules.map(module => ({\n          id: module.id,\n          title: module.title,\n          url: `/modules/${module.id}`,\n          subject_id: module.subjectId,\n          subject_name: subjects.find(s => s.id === module.subjectId)?.name,\n          profession_name: subjects.find(s => s.id === module.subjectId) ? \n            professions.find(p => p.id === subjects.find(s => s.id === module.subjectId)?.professionId)?.name : null,\n          is_completed: completedModules.includes(module.id),\n          is_accessible: true // All modules are accessible in this system\n        })),\n        available_subjects: subjects.map((subject: any) => ({\n          id: subject.id,\n          name: subject.name,\n          profession_id: subject.professionId,\n          profession_name: professions.find((p: any) => p.id === subject.professionId)?.name\n        })),\n        navigation_help: {\n          voice_commands: [\n            \"Menj a f≈ëoldalra\",\n            \"Nyisd meg a [modul neve] modult\",\n            \"Mutasd a halad√°somat\",\n            \"Keress [kifejez√©s] modulokban\",\n            \"Menj a k√∂z√∂ss√©gi oldalra\",\n            \"Milyen modulok vannak?\",\n            \"Hol tartok a tanul√°sban?\"\n          ],\n          features: [\n            \"Sidebar keres≈ëmez≈ë - modulok tartalm√°ban keres\",\n            \"AI chat asszisztens minden oldalon\",\n            \"Hangos navig√°ci√≥ (Szabolcs)\",\n            \"Modulok progressz√≠v felold√°sa\",\n            \"Mermaid diagramok automatikus renderel√©se\",\n            \"Val√≥s idej≈± halad√°sk√∂vet√©s\"\n          ]\n        },\n        last_updated: new Date().toISOString()\n      };\n      \n      // Update cache\n      sitemapCache = sitemap;\n      sitemapCacheTime = now;\n      \n      return sitemap;\n    } catch (error) {\n      console.error(\"Error generating sitemap:\", error);\n      return sitemapCache || null; // Return cached version if available\n    }\n  };\n\n  // Invalidate sitemap cache when data changes\n  const invalidateSitemapCache = () => {\n    sitemapCache = null;\n    sitemapCacheTime = 0;\n    console.log('Sitemap cache invalidated - will regenerate on next request');\n  };\n\n  // Test sitemap generation endpoint with cache status\n  app.get('/api/sitemap/test', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const forceRefresh = req.query.refresh === 'true';\n      const sitemap = await generateSitemap(userId, forceRefresh);\n      \n      res.json({\n        sitemap,\n        cache_info: {\n          has_cache: !!sitemapCache,\n          cache_age_seconds: sitemapCache ? Math.floor((Date.now() - sitemapCacheTime) / 1000) : 0,\n          force_refreshed: forceRefresh\n        }\n      });\n    } catch (error) {\n      console.error(\"Error generating test sitemap:\", error);\n      res.status(500).json({ message: \"Failed to generate sitemap\" });\n    }\n  });\n\n  // Voice chat endpoint for intelligent responses\n  app.post('/api/chat/voice', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const { message, context } = req.body;\n      \n      if (!message) {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n\n      // Generate sitemap for better navigation context\n      const sitemap = await generateSitemap(userId);\n      console.log('Voice chat - Sitemap generated:', sitemap ? 'SUCCESS' : 'FAILED');\n      console.log('Voice chat - User message:', message);\n      \n      // Enhanced system message with sitemap context\n      const systemMessage = `Szabolcs vagyok, a magyar hangnavig√°ci√≥s asszisztensed. Seg√≠tek neked a platform haszn√°lat√°ban √©s navig√°ci√≥ban.\n\nWEBOLDAL T√âRK√âP √âS KONTEXTUS:\n${JSON.stringify(sitemap, null, 2)}\n\nK√©pess√©geim:\n- Navig√°ci√≥s seg√≠ts√©g minden oldalra\n- Modulok keres√©se √©s megnyit√°sa\n- Tanul√°si √∫t tervez√©se\n- Platform funkci√≥inak magyar√°zata\n- Specifikus modulokra √©s t√©m√°kra val√≥ ir√°ny√≠t√°s\n\nFONTOS: Haszn√°ld a fenti weboldal t√©rk√©pet a navig√°ci√≥s k√©r√©sek megv√°laszol√°s√°hoz. Konkr√©t URL-eket √©s funkci√≥kat eml√≠ts meg a v√°laszaidban.`;\n\n      console.log('Voice chat - System message length:', systemMessage.length);\n\n      const response = await generateChatResponse(message, systemMessage, []);\n\n      res.json({ message: response.message });\n    } catch (error) {\n      console.error(\"Voice chat error:\", error);\n      res.status(500).json({ message: \"Hiba t√∂rt√©nt a v√°lasz gener√°l√°sa sor√°n\" });\n    }\n  });\n\n  // Chat routes\n  app.get('/api/chat/messages', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const moduleId = req.query.moduleId ? parseInt(req.query.moduleId as string) : undefined;\n      \n      const allMessages = await storage.getChatMessages(userId, moduleId);\n      // Sz≈±rj√ºk ki a rendszer √ºzeneteket, csak a felhaszn√°l√≥i √ºzeneteket √©s AI v√°laszokat jelen√≠tj√ºk meg\n      const visibleMessages = allMessages.filter(msg => !msg.isSystemMessage);\n      \n\n      \n      // Disable caching to ensure fresh data\n      res.set('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.set('Expires', '0');\n      res.set('Surrogate-Control', 'no-store');\n      \n      res.json(visibleMessages);\n    } catch (error) {\n      console.error(\"Error fetching chat messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch chat messages\" });\n    }\n  });\n\n  // Streaming chat endpoint with immediate audio\n  app.post('/api/chat/message/stream', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const { isSystemMessage, ...messageBody } = req.body;\n      const messageData = insertChatMessageSchema.parse({\n        ...messageBody,\n        userId,\n        senderRole: 'user',\n        isSystemMessage: isSystemMessage || false,\n      });\n\n      const isVoiceRequest = messageData.message.includes('Hangos magyar√°zat k√©r√©se');\n\n      // Set up Server-Sent Events\n      res.writeHead(200, {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Cache-Control'\n      });\n\n      // Save user message first\n      const userMessage = await storage.createChatMessage(messageData);\n      res.write(`data: ${JSON.stringify({ type: 'user_message', data: userMessage })}\\n\\n`);\n\n      // Get module content and chat history\n      let moduleContent = undefined;\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleContent = module?.content;\n      }\n\n      const recentMessages = await storage.getChatMessages(userId, messageData.relatedModuleId || undefined);\n      const chatHistory = recentMessages.slice(-3).map(msg => ({\n        role: msg.senderRole === 'user' ? 'user' : 'assistant',\n        content: msg.message,\n      }));\n\n      // Load custom prompts from admin settings\n      const [audioPromptSetting, textPromptSetting] = await Promise.all([\n        storage.getSystemSetting('audio-explanation-prompt'),\n        storage.getSystemSetting('text-explanation-prompt')\n      ]);\n\n      // Determine which prompt to use based on request type\n      let customPrompt = null;\n      let moduleTitle = '';\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleTitle = module?.title || '';\n      }\n\n      if (isVoiceRequest && audioPromptSetting?.value) {\n        // Use audio explanation prompt for voice requests\n        customPrompt = audioPromptSetting.value\n          .replace('{question}', messageData.message)\n          .replace('{title}', moduleTitle || 'Tananyag')\n          .replace('{content}', (moduleContent || '').substring(0, 800));\n        console.log('üéµ Using custom audio explanation prompt for voice request (regular streaming)');\n      } else if (!isVoiceRequest && textPromptSetting?.value) {\n        // Use text explanation prompt for text requests\n        customPrompt = textPromptSetting.value\n          .replace('{question}', messageData.message)\n          .replace('{title}', moduleTitle || 'Tananyag')\n          .replace('{content}', (moduleContent || '').substring(0, 800));\n        console.log('üìù Using custom text explanation prompt for text request (regular streaming)');\n      }\n\n      // Generate sitemap for enhanced context\n      const sitemap = await generateSitemap(userId);\n      \n      // Enhanced module content with sitemap context for navigation\n      const enhancedContent = `${moduleContent || ''}\n\nWEBOLDAL NAVIG√ÅCI√ìS T√âRK√âP:\n${JSON.stringify(sitemap, null, 2)}\n\nPlatform funkci√≥k √©s navig√°ci√≥:\n- Sidebar keres≈ëmez≈ë minden oldalon - modulok tartalm√°ban keres\n- Hangos navig√°ci√≥ Szabolcs asszisztenssel\n- Progressz√≠v modul felold√°s rendszer\n- Mermaid diagramok automatikus renderel√©se\n- AI chat minden oldalon el√©rhet≈ë`;\n\n      // Generate streaming AI response\n      const openaiModule = await import('./openai');\n      let fullResponse = '';\n      \n      await openaiModule.generateStreamingChatResponse(\n        messageData.message,\n        enhancedContent,\n        chatHistory,\n        (chunk: string) => {\n          fullResponse += chunk;\n          res.write(`data: ${JSON.stringify({ type: 'ai_chunk', data: chunk })}\\n\\n`);\n        },\n        customPrompt\n      );\n\n      // Record API cost for text generation\n      const textTokens = Math.ceil(fullResponse.length / 4); // Approximate token count\n      const textCost = textTokens * 0.00015; // GPT-4o-mini pricing\n      await storage.recordSimpleApiCall('OpenAI', 'Chat', textCost);\n\n      // Generate audio AFTER streaming is complete for voice requests\n      if (isVoiceRequest && fullResponse) {\n        try {\n          console.log('Generating audio for voice request, text length:', fullResponse.length);\n          const finalAudio = await openaiModule.generateSpeech(fullResponse);\n          console.log('Audio generated successfully, size:', finalAudio.length);\n          \n          // Record API cost for audio generation\n          const audioCharacters = fullResponse.length;\n          const audioCost = audioCharacters * 0.000015; // TTS pricing per character\n          await storage.recordSimpleApiCall('OpenAI', 'TTS', audioCost);\n          \n          const audioBase64 = finalAudio.toString('base64');\n          console.log('Audio base64 length:', audioBase64.length);\n          \n          const audioEvent = JSON.stringify({ \n            type: 'final_audio',\n            data: audioBase64,\n            length: finalAudio.length \n          });\n          \n          console.log('Sending final_audio event, payload size:', audioEvent.length);\n          res.write(`data: ${audioEvent}\\n\\n`);\n        } catch (error) {\n          console.error('Final audio generation error:', error);\n          res.write(`data: ${JSON.stringify({ \n            type: 'audio_error',\n            message: 'Audio generation failed' \n          })}\\n\\n`);\n        }\n      }\n\n      // Save complete AI response\n      const aiMessage = await storage.createChatMessage({\n        message: fullResponse,\n        userId,\n        senderRole: 'ai',\n        relatedModuleId: messageData.relatedModuleId,\n        isSystemMessage: false,\n      });\n\n      res.write(`data: ${JSON.stringify({ type: 'ai_complete', data: aiMessage })}\\n\\n`);\n      res.write(`data: ${JSON.stringify({ type: 'done' })}\\n\\n`);\n      res.end();\n\n    } catch (error) {\n      console.error(\"Error in streaming chat:\", error);\n      res.write(`data: ${JSON.stringify({ type: 'error', message: 'Failed to generate response' })}\\n\\n`);\n      res.end();\n    }\n  });\n\n  // NEW: True SSE streaming endpoint with immediate sentence-based chunking\n  app.post('/api/chat/message/stream-sse', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const { isSystemMessage, ...messageBody } = req.body;\n      const messageData = insertChatMessageSchema.parse({\n        ...messageBody,\n        userId,\n        senderRole: 'user',\n        isSystemMessage: isSystemMessage || false,\n      });\n\n      const isVoiceRequest = messageData.message.includes('Hangos magyar√°zat k√©r√©se');\n      console.log('üöÄ SSE Stream request - Voice:', isVoiceRequest, 'ModuleId:', messageData.relatedModuleId);\n\n      // Set up true SSE headers with anti-buffering\n      res.writeHead(200, {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache, no-store, must-revalidate',\n        'Connection': 'keep-alive',\n        'X-Accel-Buffering': 'no', // Disable nginx buffering\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Cache-Control'\n      });\n      res.flushHeaders();\n\n      // Save user message first\n      const userMessage = await storage.createChatMessage(messageData);\n      res.write(`data: ${JSON.stringify({ type: 'user_message', data: userMessage })}\\n\\n`);\n\n      // Get module content and chat history\n      let moduleContent = undefined;\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleContent = module?.content;\n      }\n\n      const recentMessages = await storage.getChatMessages(userId, messageData.relatedModuleId || undefined);\n      const chatHistory = recentMessages.slice(-3).map(msg => ({\n        role: msg.senderRole === 'user' ? 'user' : 'assistant',\n        content: msg.message,\n      }));\n\n      // Load custom prompts\n      const [audioPromptSetting, textPromptSetting] = await Promise.all([\n        storage.getSystemSetting('audio-explanation-prompt'),\n        storage.getSystemSetting('text-explanation-prompt')\n      ]);\n\n      let customPrompt = null;\n      let moduleTitle = '';\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleTitle = module?.title || '';\n      }\n\n      if (isVoiceRequest && audioPromptSetting?.value) {\n        customPrompt = `R√ñVID, BESZ√âLGET≈êS V√ÅLASZ (maximum 2-3 mondat):\n        \n${audioPromptSetting.value\n          .replace('{question}', messageData.message)\n          .replace('{title}', moduleTitle || 'Tananyag')\n          .replace('{content}', (moduleContent || '').substring(0, 800))}\n\nFONTOS: Adj r√∂vid, term√©szetes v√°laszt. Mintha bar√°ts√°gos tan√°rk√©nt besz√©lgetn√©l. Maximum 50-60 sz√≥.`;\n      } else if (!isVoiceRequest && textPromptSetting?.value) {\n        customPrompt = textPromptSetting.value\n          .replace('{question}', messageData.message)\n          .replace('{title}', moduleTitle || 'Tananyag')\n          .replace('{content}', (moduleContent || '').substring(0, 800));\n      }\n\n      // Generate sitemap for enhanced context\n      const sitemap = await generateSitemap(userId);\n      const enhancedContent = `${moduleContent || ''}\n\nWEBOLDAL NAVIG√ÅCI√ìS T√âRK√âP:\n${JSON.stringify(sitemap, null, 2)}\n\nPlatform funkci√≥k √©s navig√°ci√≥:\n- Sidebar keres≈ëmez≈ë minden oldalon - modulok tartalm√°ban keres\n- Hangos navig√°ci√≥ Szabolcs asszisztenssel\n- Progressz√≠v modul felold√°s rendszer\n- Mermaid diagramok automatikus renderel√©se\n- AI chat minden oldalon el√©rhet≈ë`;\n\n      // Generate TRUE streaming AI response\n      const openaiModule = await import('./openai');\n      let fullResponse = '';\n      let accumulatedSentence = '';\n      const audioQueue: Array<{text: string, timestamp: number}> = [];\n      let audioProcessing = false;\n\n      // Process audio queue asynchronously\n      const processAudioQueue = async () => {\n        if (audioProcessing || audioQueue.length === 0) return;\n        audioProcessing = true;\n        \n        const item = audioQueue.shift();\n        if (item && isVoiceRequest) {\n          try {\n            // Use OpenAI directly for TTS generation\n            const openaiModule = await import('./openai');\n            const audioBuffer = await openaiModule.generateSpeech(item.text);\n            const audioBase64 = audioBuffer.toString('base64');\n            res.write(`data: ${JSON.stringify({ \n              type: 'audio_chunk', \n              data: audioBase64, \n              timestamp: item.timestamp,\n              text: item.text,\n              length: audioBuffer.length \n            })}\\n\\n`);\n          } catch (error) {\n            console.error('TTS error:', error);\n          }\n        }\n        \n        audioProcessing = false;\n        // Process next item if available\n        if (audioQueue.length > 0) {\n          setTimeout(processAudioQueue, 50);\n        }\n      };\n\n      // TRUE streaming text and audio generation\n      await openaiModule.generateStreamingChatResponse(\n        customPrompt || messageData.message,\n        enhancedContent,\n        chatHistory,\n        (chunk: string, timestamp?: number) => {\n          fullResponse += chunk;\n          accumulatedSentence += chunk;\n          \n          // Send text chunk immediately\n          res.write(`data: ${JSON.stringify({ \n            type: 'text_chunk', \n            data: chunk, \n            timestamp: timestamp || Date.now() \n          })}\\n\\n`);\n          \n          // Hungarian-optimized sentence boundary detection for natural TTS\n          const sentenceBoundaryRegex = /([.!?])\\s*(?=[A-Z\\n#\\-\\*]|$)/g;\n          const sentences = [];\n          let lastIndex = 0;\n          \n          let match;\n          while ((match = sentenceBoundaryRegex.exec(accumulatedSentence)) !== null) {\n            const sentence = accumulatedSentence.slice(lastIndex, match.index + match[1].length).trim();\n            if (sentence.length > 15) { // Longer minimum for better Hungarian pronunciation\n              sentences.push(sentence);\n            }\n            lastIndex = match.index + match[0].length;\n          }\n          \n          // Process complete sentences for TTS\n          for (const sentence of sentences) {\n            audioQueue.push({\n              text: sentence,\n              timestamp: timestamp || Date.now()\n            });\n            // Start processing immediately\n            if (!audioProcessing) {\n              processAudioQueue();\n            }\n          }\n          \n          // Keep remaining text for next chunk\n          if (sentences.length > 0) {\n            accumulatedSentence = accumulatedSentence.slice(lastIndex).trim();\n          }\n        },\n        customPrompt\n      );\n      \n      // Process any remaining sentence\n      if (accumulatedSentence.trim().length > 10 && isVoiceRequest) {\n        audioQueue.push({\n          text: accumulatedSentence.trim(),\n          timestamp: Date.now()\n        });\n        processAudioQueue();\n      }\n\n      // Wait for all audio to finish processing\n      while (audioQueue.length > 0 || audioProcessing) {\n        await new Promise(resolve => setTimeout(resolve, 100));\n      }\n\n      // Record costs\n      const textTokens = Math.ceil(fullResponse.length / 4);\n      const textCost = textTokens * 0.00015;\n      await storage.recordSimpleApiCall('OpenAI', 'Chat', textCost);\n\n      if (isVoiceRequest) {\n        const audioCost = fullResponse.length * 0.000015;\n        await storage.recordSimpleApiCall('OpenAI', 'TTS', audioCost);\n      }\n\n      // Save complete AI response\n      const aiMessage = await storage.createChatMessage({\n        message: fullResponse,\n        userId,\n        senderRole: 'ai',\n        relatedModuleId: messageData.relatedModuleId,\n        isSystemMessage: false,\n      });\n\n      res.write(`data: ${JSON.stringify({ type: 'ai_complete', data: aiMessage })}\\n\\n`);\n      res.write(`data: ${JSON.stringify({ type: 'done' })}\\n\\n`);\n      res.end();\n\n    } catch (error) {\n      console.error(\"Error in SSE streaming chat:\", error);\n      res.write(`data: ${JSON.stringify({ type: 'error', message: 'Failed to generate response' })}\\n\\n`);\n      res.end();\n    }\n  });\n\n  // Synchronized streaming endpoint with timestamped text and audio chunks (LEGACY)\n  app.post('/api/chat/message/synchronized-stream', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const { isSystemMessage, ...messageBody } = req.body;\n      const messageData = insertChatMessageSchema.parse({\n        ...messageBody,\n        userId,\n        senderRole: 'user',\n        isSystemMessage: isSystemMessage || false,\n      });\n\n      const isVoiceRequest = messageData.message.includes('Hangos magyar√°zat k√©r√©se');\n      console.log('üîç Synchronized request - Voice:', isVoiceRequest, 'ModuleId:', messageData.relatedModuleId, 'Message:', messageData.message.substring(0, 100));\n\n      // Set up Server-Sent Events with immediate header flush\n      res.writeHead(200, {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache, no-transform',\n        'Connection': 'keep-alive',\n        'X-Accel-Buffering': 'no', // Disable nginx buffering\n        'Access-Control-Allow-Origin': '*',\n        'Access-Control-Allow-Headers': 'Cache-Control'\n      });\n      \n      // CRITICAL: Flush headers immediately to start streaming\n      res.flushHeaders();\n\n      // Save user message first\n      const userMessage = await storage.createChatMessage(messageData);\n      res.write(`data: ${JSON.stringify({ type: 'user_message', data: userMessage })}\\n\\n`);\n\n      // Get module content and chat history\n      let moduleContent = undefined;\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleContent = module?.content;\n      }\n\n      const recentMessages = await storage.getChatMessages(userId, messageData.relatedModuleId || undefined);\n      const chatHistory = recentMessages.slice(-3).map(msg => ({\n        role: msg.senderRole === 'user' ? 'user' : 'assistant',\n        content: msg.message,\n      }));\n\n      // Load custom prompts from admin settings\n      const [audioPromptSetting, textPromptSetting] = await Promise.all([\n        storage.getSystemSetting('audio-explanation-prompt'),\n        storage.getSystemSetting('text-explanation-prompt')\n      ]);\n\n      // Determine which prompt to use based on request type\n      let customPrompt = null;\n      let moduleTitle = '';\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleTitle = module?.title || '';\n      }\n\n      if (isVoiceRequest && audioPromptSetting?.value) {\n        // Use audio explanation prompt for voice requests\n        customPrompt = audioPromptSetting.value\n          .replace('{question}', messageData.message)\n          .replace('{title}', moduleTitle || 'Tananyag')\n          .replace('{content}', (moduleContent || '').substring(0, 800));\n        console.log('üéµ Using custom audio explanation prompt for voice request');\n        console.log('üéµ Custom prompt created:', customPrompt.substring(0, 200) + '...');\n      } else if (!isVoiceRequest && textPromptSetting?.value) {\n        // Use text explanation prompt for text requests\n        customPrompt = textPromptSetting.value\n          .replace('{question}', messageData.message)\n          .replace('{title}', moduleTitle || 'Tananyag')\n          .replace('{content}', (moduleContent || '').substring(0, 800));\n        console.log('üìù Using custom text explanation prompt for text request');\n      }\n\n      // Generate sitemap for enhanced context\n      const sitemap = await generateSitemap(userId);\n      \n      // Enhanced module content with sitemap context for navigation\n      const enhancedContent = `${moduleContent || ''}\n\nWEBOLDAL NAVIG√ÅCI√ìS T√âRK√âP:\n${JSON.stringify(sitemap, null, 2)}\n\nPlatform funkci√≥k √©s navig√°ci√≥:\n- Sidebar keres≈ëmez≈ë minden oldalon - modulok tartalm√°ban keres\n- Hangos navig√°ci√≥ Szabolcs asszisztenssel\n- Progressz√≠v modul felold√°s rendszer\n- Mermaid diagramok automatikus renderel√©se\n- AI chat minden oldalon el√©rhet≈ë`;\n\n      // Generate synchronized streaming AI response\n      const openaiModule = await import('./openai');\n      let fullResponse = '';\n      \n      if (isVoiceRequest) {\n        // Debug: check what prompt gets sent to AI\n        console.log('üîç VOICE - customPrompt exists:', !!customPrompt, 'moduleId:', messageData.relatedModuleId);\n        if (customPrompt) {\n          console.log('üîç VOICE - prompt preview:', customPrompt.substring(0, 200) + '...');\n        }\n        \n        // Use synchronized streaming for voice requests with custom prompt\n        await openaiModule.generateSynchronizedStreamingResponse(\n          customPrompt || messageData.message,\n          enhancedContent,\n          chatHistory,\n          (chunk: string, timestamp: number) => {\n            fullResponse += chunk;\n            res.write(`data: ${JSON.stringify({ \n              type: 'text_chunk', \n              data: chunk, \n              timestamp \n            })}\\n\\n`);\n          },\n          (audioBuffer: Buffer, timestamp: number, textChunk: string) => {\n            const audioBase64 = audioBuffer.toString('base64');\n            res.write(`data: ${JSON.stringify({ \n              type: 'audio_chunk', \n              data: audioBase64, \n              timestamp,\n              text: textChunk,\n              length: audioBuffer.length \n            })}\\n\\n`);\n          },\n          customPrompt\n        );\n      } else {\n        // Use regular streaming for text-only requests with custom prompt\n        await openaiModule.generateStreamingChatResponse(\n          messageData.message,\n          moduleContent,\n          chatHistory,\n          (chunk: string, timestamp?: number) => {\n            fullResponse += chunk;\n            res.write(`data: ${JSON.stringify({ \n              type: 'text_chunk', \n              data: chunk, \n              timestamp: timestamp || 0 \n            })}\\n\\n`);\n          },\n          customPrompt\n        );\n      }\n\n      // Record API cost for text generation\n      const textTokens = Math.ceil(fullResponse.length / 4); // Approximate token count\n      const textCost = textTokens * 0.00015; // GPT-4o-mini pricing\n      await storage.recordSimpleApiCall('OpenAI', 'Chat', textCost);\n\n      // Record additional cost for audio if it was a voice request\n      if (isVoiceRequest) {\n        const audioCharacters = fullResponse.length;\n        const audioCost = audioCharacters * 0.000015; // TTS pricing per character\n        await storage.recordSimpleApiCall('OpenAI', 'TTS', audioCost);\n        \n        // Generate complete audio for the full response and send as final_audio event\n        try {\n          console.log('üéµ Generating final_audio for complete response...');\n          const completeAudio = await openaiModule.generateSpeech(fullResponse);\n          const completeAudioBase64 = completeAudio.toString('base64');\n          \n          res.write(`data: ${JSON.stringify({ \n            type: 'final_audio', \n            data: completeAudioBase64,\n            length: completeAudio.length,\n            text: fullResponse\n          })}\\n\\n`);\n          \n          console.log(`üéµ final_audio event sent, audio size: ${completeAudio.length} bytes`);\n        } catch (audioError) {\n          console.error('Error generating final audio:', audioError);\n          // Continue without final audio if generation fails\n        }\n      }\n\n      // Save complete AI response\n      const aiMessage = await storage.createChatMessage({\n        message: fullResponse,\n        userId,\n        senderRole: 'ai',\n        relatedModuleId: messageData.relatedModuleId,\n        isSystemMessage: false,\n      });\n\n      res.write(`data: ${JSON.stringify({ type: 'ai_complete', data: aiMessage })}\\n\\n`);\n      res.write(`data: ${JSON.stringify({ type: 'done' })}\\n\\n`);\n      res.end();\n\n    } catch (error) {\n      console.error(\"Error in synchronized streaming chat:\", error);\n      res.write(`data: ${JSON.stringify({ type: 'error', message: 'Failed to generate response' })}\\n\\n`);\n      res.end();\n    }\n  });\n\n  // Simple chat endpoint for testing\n  app.post('/api/chat', combinedAuth, async (req: any, res) => {\n    try {\n      const { message } = req.body;\n      if (!message) {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n\n      const { generateChatResponse } = await import('./openai');\n      const response = await generateChatResponse(message, 'chat');\n      \n      res.json(response);\n    } catch (error) {\n      console.error(\"Error in simple chat:\", error);\n      res.status(500).json({ message: \"Failed to generate response\" });\n    }\n  });\n\n  app.post('/api/chat/message', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      const { isSystemMessage, ...messageBody } = req.body;\n      const messageData = insertChatMessageSchema.parse({\n        ...messageBody,\n        userId,\n        senderRole: 'user',\n        isSystemMessage: isSystemMessage || false,\n      });\n\n      // Save user message first\n      const userMessage = await storage.createChatMessage(messageData);\n\n      // Get module content if related to a specific module\n      let moduleContent = undefined;\n      if (messageData.relatedModuleId) {\n        const module = await storage.getModule(messageData.relatedModuleId);\n        moduleContent = module?.content;\n      }\n\n      // Generate sitemap for enhanced context\n      const sitemap = await generateSitemap(userId);\n      \n      // Enhanced module content with sitemap context for navigation\n      const enhancedContent = `${moduleContent || ''}\n\nWEBOLDAL NAVIG√ÅCI√ìS T√âRK√âP:\n${JSON.stringify(sitemap, null, 2)}\n\nPlatform funkci√≥k √©s navig√°ci√≥:\n- Sidebar keres≈ëmez≈ë minden oldalon - modulok tartalm√°ban keres\n- Hangos navig√°ci√≥ Szabolcs asszisztenssel\n- Progressz√≠v modul felold√°s rendszer\n- Mermaid diagramok automatikus renderel√©se\n- AI chat minden oldalon el√©rhet≈ë`;\n\n      // Get recent chat history for better context\n      const recentMessages = await storage.getChatMessages(userId, messageData.relatedModuleId || undefined);\n      const chatHistory = recentMessages.slice(-3).map(msg => ({\n        role: msg.senderRole === 'user' ? 'user' : 'assistant',\n        content: msg.message,\n      }));\n\n      // Generate AI response\n      const aiResponse = await generateChatResponse(\n        messageData.message,\n        enhancedContent,\n        chatHistory\n      );\n\n      // Save AI response\n      const aiMessage = await storage.createChatMessage({\n        message: aiResponse.message,\n        senderRole: 'ai',\n        userId,\n        relatedModuleId: messageData.relatedModuleId,\n      });\n\n      res.json({\n        userMessage,\n        aiMessage,\n      });\n    } catch (error) {\n      console.error(\"Error processing chat message:\", error);\n      res.status(500).json({ message: \"Failed to process chat message\" });\n    }\n  });\n\n  // Delete chat messages\n  app.delete('/api/chat/messages', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      // Get user ID from either Replit auth or local auth\n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      const { moduleId } = req.query;\n\n      await storage.deleteChatMessages(userId, moduleId ? parseInt(moduleId) : undefined);\n      \n      // Disable caching for this response to ensure fresh data on next fetch\n      res.set('Cache-Control', 'no-store, no-cache, must-revalidate, proxy-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.set('Expires', '0');\n      res.set('Surrogate-Control', 'no-store');\n      \n      res.json({ success: true, timestamp: Date.now() });\n    } catch (error) {\n      console.error(\"Error deleting chat messages:\", error);\n      res.status(500).json({ message: \"Failed to delete chat messages\" });\n    }\n  });\n\n  // Audio generation endpoint\n  app.post('/api/chat/audio', combinedAuth, async (req: any, res) => {\n    try {\n      const { text } = req.body;\n      \n      if (!text) {\n        return res.status(400).json({ message: \"Text is required\" });\n      }\n\n      // Generate speech from text\n      const audioBuffer = await generateSpeech(text);\n      \n      // Set appropriate headers for audio response\n      res.set({\n        'Content-Type': 'audio/mpeg',\n        'Content-Length': audioBuffer.length.toString(),\n        'Cache-Control': 'no-cache'\n      });\n      \n      res.send(audioBuffer);\n    } catch (error) {\n      console.error(\"Error generating audio:\", error);\n      res.status(500).json({ message: \"Failed to generate audio\" });\n    }\n  });\n\n  // Audio transcription endpoint\n  app.post('/api/chat/transcribe', combinedAuth, upload.single('audio'), async (req: any, res) => {\n    try {\n      console.log('üîç TRANSCRIBE - Audio file received, size:', req.file?.size);\n      if (!req.file) {\n        return res.status(400).json({ message: \"No audio file provided\" });\n      }\n\n      // Read the file from disk since we're using diskStorage\n      const audioBuffer = fs.readFileSync(req.file.path);\n      \n      const { transcribeAudio } = await import('./openai');\n      const transcription = await transcribeAudio(audioBuffer, req.file.originalname);\n      \n      // Clean up the temporary file\n      fs.unlinkSync(req.file.path);\n      \n      res.json({ text: transcription });\n    } catch (error) {\n      console.error(\"Error transcribing audio:\", error);\n      res.status(500).json({ message: \"Failed to transcribe audio\" });\n    }\n  });\n\n  // Direct TTS endpoint for welcome messages (no AI needed)\n  app.post('/api/chat/tts-direct', combinedAuth, async (req: any, res) => {\n    try {\n      const { text } = req.body;\n      \n      if (!text || typeof text !== 'string') {\n        return res.status(400).json({ message: \"Text is required\" });\n      }\n\n      console.log('üîä TTS-Direct - Generating audio for:', text);\n      \n      const { generateSpeech } = await import('./openai');\n      const audioBuffer = await generateSpeech(text);\n      \n      // Record API cost for TTS\n      const ttsCost = text.length * 0.000015; // OpenAI TTS pricing\n      await storage.recordSimpleApiCall('OpenAI', 'TTS-Direct', ttsCost);\n      \n      res.setHeader('Content-Type', 'audio/mpeg');\n      res.send(audioBuffer);\n    } catch (error) {\n      console.error(\"Error generating direct TTS audio:\", error);\n      res.status(500).json({ message: \"Failed to generate audio\" });\n    }\n  });\n\n  // Quiz endpoints\n  app.post('/api/modules/:id/quiz', combinedAuth, async (req: any, res) => {\n    try {\n      const moduleId = parseInt(req.params.id);\n      const module = await storage.getModule(moduleId);\n      \n      if (!module) {\n        return res.status(404).json({ message: \"Module not found\" });\n      }\n\n      const { generateQuizFromModule } = await import('./openai');\n      const moduleContent = module.content || '';\n      const questions = await generateQuizFromModule(moduleContent);\n      \n      // Record API cost for quiz generation\n      const quizTokens = Math.ceil((moduleContent.length + 500) / 4); // Content + prompt tokens\n      const quizCost = quizTokens * 0.00015; // GPT-4o-mini pricing\n      await storage.recordSimpleApiCall('OpenAI', 'Quiz', quizCost);\n      \n      res.json({ questions });\n    } catch (error) {\n      console.error(\"Error generating quiz:\", error);\n      res.status(500).json({ message: \"Failed to generate quiz\" });\n    }\n  });\n\n  app.post('/api/quiz/evaluate', combinedAuth, async (req: any, res) => {\n    try {\n      const { question, correctAnswer, userAnswer, explanation } = req.body;\n      \n      if (!question || !correctAnswer || !userAnswer) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n\n      const { evaluateAnswer } = await import('./openai');\n      const evaluation = await evaluateAnswer(question, correctAnswer, userAnswer, explanation || '');\n      \n      // Record API cost for quiz evaluation\n      const evaluationTokens = Math.ceil((question.length + correctAnswer.length + userAnswer.length + 200) / 4);\n      const evaluationCost = evaluationTokens * 0.0003; // GPT-4o pricing for evaluation\n      await storage.recordSimpleApiCall('OpenAI', 'Quiz-Evaluation', evaluationCost);\n      \n      res.json(evaluation);\n    } catch (error) {\n      console.error(\"Error evaluating answer:\", error);\n      res.status(500).json({ message: \"Failed to evaluate answer\" });\n    }\n  });\n\n  // Quiz generation\n  app.post('/api/quiz/generate', combinedAuth, async (req: any, res) => {\n    try {\n      const { moduleId, numQuestions = 3 } = req.body;\n      \n      const module = await storage.getModule(moduleId);\n      if (!module) {\n        return res.status(404).json({ message: \"Module not found\" });\n      }\n\n      const questions = await generateQuizQuestions(module.content, numQuestions);\n      \n      // Record API cost for quiz generation\n      const quizTokens = Math.ceil((module.content.length + 500) / 4); // Content + prompt tokens\n      const quizCost = quizTokens * 0.00015; // GPT-4o-mini pricing\n      await storage.recordSimpleApiCall('OpenAI', 'Quiz', quizCost);\n      \n      res.json(questions);\n    } catch (error) {\n      console.error(\"Error generating quiz:\", error);\n      res.status(500).json({ message: \"Failed to generate quiz\" });\n    }\n  });\n\n  // File upload for modules\n  app.post('/api/upload', isAuthenticated, upload.single('file'), async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      if (!req.file) {\n        return res.status(400).json({ message: \"No file uploaded\" });\n      }\n\n      // In a production environment, you would upload to a cloud storage service\n      // For now, we'll just return the local file path\n      const fileUrl = `/uploads/${req.file.filename}`;\n      \n      res.json({ url: fileUrl });\n    } catch (error) {\n      console.error(\"Error uploading file:\", error);\n      res.status(500).json({ message: \"Failed to upload file\" });\n    }\n  });\n\n  // Admin user management routes\n  app.get('/api/admin/users', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n      \n      const users = await storage.getAllUsers();\n      res.json(users);\n    } catch (error) {\n      console.error(\"Error fetching users:\", error);\n      res.status(500).json({ message: \"Failed to fetch users\" });\n    }\n  });\n\n  app.patch('/api/admin/users/:userId/role', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n      \n      const { userId: targetUserId } = req.params;\n      const { role } = req.body;\n      \n      await storage.updateUserRole(targetUserId, role);\n      res.json({ message: 'User role updated successfully' });\n    } catch (error) {\n      console.error(\"Error updating user role:\", error);\n      res.status(500).json({ message: \"Failed to update user role\" });\n    }\n  });\n\n  // AI Settings Routes (Admin only)\n  app.get('/api/ai-settings', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n      \n      const settings = await storage.getAISettings();\n      if (!settings) {\n        // Return default settings if none exist\n        return res.json({\n          maxTokens: 2000,\n          temperature: \"0.7\",\n          model: \"gpt-4o-mini\",\n          systemMessage: null\n        });\n      }\n      \n      res.json(settings);\n    } catch (error) {\n      console.error(\"Error fetching AI settings:\", error);\n      res.status(500).json({ message: \"Failed to fetch AI settings\" });\n    }\n  });\n\n  app.put('/api/ai-settings', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: 'Admin access required' });\n      }\n\n      const { insertAISettingsSchema } = await import('@shared/schema');\n      const validatedData = insertAISettingsSchema.parse(req.body);\n      \n      const updatedSettings = await storage.updateAISettings(validatedData, userId);\n      res.json(updatedSettings);\n    } catch (error) {\n      console.error(\"Error updating AI settings:\", error);\n      res.status(500).json({ message: \"Failed to update AI settings\" });\n    }\n  });\n\n  // Serve uploaded files\n  app.use('/uploads', express.static('uploads'));\n\n  // Community Groups Routes\n  app.get(\"/api/community-groups\", combinedAuth, async (req: any, res) => {\n    try {\n      const professionId = req.query.professionId ? parseInt(req.query.professionId) : undefined;\n      const groups = await storage.getCommunityGroups(professionId);\n      res.json(groups);\n    } catch (error) {\n      console.error(\"Error fetching community groups:\", error);\n      res.status(500).json({ message: \"Failed to fetch community groups\" });\n    }\n  });\n\n  app.post(\"/api/community-groups\", combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const groupData = { ...req.body, createdBy: userId };\n      const group = await storage.createCommunityGroup(groupData);\n      \n      // Auto-join creator as admin\n      await storage.joinCommunityGroup(group.id, userId);\n      \n      res.status(201).json(group);\n    } catch (error) {\n      console.error(\"Error creating community group:\", error);\n      res.status(500).json({ message: \"Failed to create community group\" });\n    }\n  });\n\n  app.post(\"/api/community-groups/:id/join\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = parseInt(req.params.id);\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      await storage.joinCommunityGroup(groupId, userId);\n      res.json({ message: \"Successfully joined group\" });\n    } catch (error) {\n      console.error(\"Error joining community group:\", error);\n      res.status(500).json({ message: \"Failed to join community group\" });\n    }\n  });\n\n  app.post(\"/api/community-groups/:id/leave\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = parseInt(req.params.id);\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      await storage.leaveCommunityGroup(groupId, userId);\n      res.json({ message: \"Successfully left group\" });\n    } catch (error) {\n      console.error(\"Error leaving community group:\", error);\n      res.status(500).json({ message: \"Failed to leave community group\" });\n    }\n  });\n\n  app.put(\"/api/community-groups/:id\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = parseInt(req.params.id);\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const { insertCommunityGroupSchema } = await import('@shared/schema');\n      const validatedData = insertCommunityGroupSchema.partial().parse(req.body);\n      \n      const updatedGroup = await storage.updateCommunityGroup(groupId, validatedData, userId);\n      res.json(updatedGroup);\n    } catch (error: any) {\n      console.error(\"Error updating community group:\", error);\n      if (error.message === 'Unauthorized to update this group') {\n        res.status(403).json({ message: \"Csak a csoport l√©trehoz√≥ja szerkesztheti\" });\n      } else {\n        res.status(500).json({ message: \"Failed to update community group\" });\n      }\n    }\n  });\n\n  app.delete(\"/api/community-groups/:id\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = parseInt(req.params.id);\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      await storage.deleteCommunityGroup(groupId, userId);\n      res.json({ message: \"Community group deleted successfully\" });\n    } catch (error: any) {\n      console.error(\"Error deleting community group:\", error);\n      if (error.message === 'Unauthorized to delete this group') {\n        res.status(403).json({ message: \"Csak a csoport l√©trehoz√≥ja t√∂r√∂lheti\" });\n      } else {\n        res.status(500).json({ message: \"Failed to delete community group\" });\n      }\n    }\n  });\n\n  app.get(\"/api/community-groups/:id/members\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = parseInt(req.params.id);\n      const members = await storage.getGroupMembers(groupId);\n      res.json(members);\n    } catch (error) {\n      console.error(\"Error fetching group members:\", error);\n      res.status(500).json({ message: \"Failed to fetch group members\" });\n    }\n  });\n\n  // Community Projects Routes\n  app.get(\"/api/community-projects\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = req.query.groupId ? parseInt(req.query.groupId) : undefined;\n      const projects = await storage.getCommunityProjects(groupId);\n      res.json(projects);\n    } catch (error) {\n      console.error(\"Error fetching community projects:\", error);\n      res.status(500).json({ message: \"Failed to fetch community projects\" });\n    }\n  });\n\n  app.post(\"/api/community-projects\", combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const projectData = { ...req.body, createdBy: userId };\n      const project = await storage.createCommunityProject(projectData);\n      \n      // Auto-join creator as lead\n      await storage.joinProject(project.id, userId);\n      \n      res.status(201).json(project);\n    } catch (error) {\n      console.error(\"Error creating community project:\", error);\n      res.status(500).json({ message: \"Failed to create community project\" });\n    }\n  });\n\n  app.post(\"/api/community-projects/:id/join\", combinedAuth, async (req: any, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      await storage.joinProject(projectId, userId);\n      res.json({ message: \"Successfully joined project\" });\n    } catch (error) {\n      console.error(\"Error joining project:\", error);\n      res.status(500).json({ message: \"Failed to join project\" });\n    }\n  });\n\n  app.get(\"/api/community-projects/:id/participants\", combinedAuth, async (req: any, res) => {\n    try {\n      const projectId = parseInt(req.params.id);\n      const participants = await storage.getProjectParticipants(projectId);\n      res.json(participants);\n    } catch (error) {\n      console.error(\"Error fetching project participants:\", error);\n      res.status(500).json({ message: \"Failed to fetch project participants\" });\n    }\n  });\n\n  // Discussions Routes\n  app.get(\"/api/discussions\", combinedAuth, async (req: any, res) => {\n    try {\n      const groupId = req.query.groupId ? parseInt(req.query.groupId) : undefined;\n      const projectId = req.query.projectId ? parseInt(req.query.projectId) : undefined;\n      const discussions = await storage.getDiscussions(groupId, projectId);\n      res.json(discussions);\n    } catch (error) {\n      console.error(\"Error fetching discussions:\", error);\n      res.status(500).json({ message: \"Failed to fetch discussions\" });\n    }\n  });\n\n  app.post(\"/api/discussions\", combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const discussionData = { ...req.body, authorId: userId };\n      const discussion = await storage.createDiscussion(discussionData);\n      res.status(201).json(discussion);\n    } catch (error) {\n      console.error(\"Error creating discussion:\", error);\n      res.status(500).json({ message: \"Failed to create discussion\" });\n    }\n  });\n\n  // Teacher Routes\n  app.get(\"/api/teacher/students\", combinedAuth, async (req: any, res) => {\n    try {\n      // Check if user is a teacher\n      const user = await storage.getUser(req.user.id);\n      if (user?.role !== 'teacher') {\n        return res.status(403).json({ message: \"Access denied. Teachers only.\" });\n      }\n\n      const students = await storage.getAllStudents();\n      res.json(students);\n    } catch (error) {\n      console.error(\"Error fetching students:\", error);\n      res.status(500).json({ message: \"Failed to fetch students\" });\n    }\n  });\n\n  // Peer Reviews Routes\n  app.get(\"/api/peer-reviews/:projectId\", combinedAuth, async (req: any, res) => {\n    try {\n      const projectId = parseInt(req.params.projectId);\n      const reviews = await storage.getPeerReviews(projectId);\n      res.json(reviews);\n    } catch (error) {\n      console.error(\"Error fetching peer reviews:\", error);\n      res.status(500).json({ message: \"Failed to fetch peer reviews\" });\n    }\n  });\n\n  app.post(\"/api/peer-reviews\", combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else if (req.session?.adminUser) {\n        userId = req.session.adminUser.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const reviewData = { ...req.body, reviewerId: userId };\n      const review = await storage.createPeerReview(reviewData);\n      res.status(201).json(review);\n    } catch (error) {\n      console.error(\"Error creating peer review:\", error);\n      res.status(500).json({ message: \"Failed to create peer review\" });\n    }\n  });\n\n  // Multi-API service endpoints\n  app.post('/api/search/internet', customAuth, async (req: any, res) => {\n    try {\n      const { query } = req.body;\n      const results = await multiApiService.searchInternet(query);\n      res.json({ results });\n    } catch (error) {\n      console.error(\"Internet search error:\", error);\n      res.status(500).json({ message: error instanceof Error ? error.message : \"Failed to search internet\" });\n    }\n  });\n\n  app.post('/api/search/youtube', customAuth, async (req: any, res) => {\n    try {\n      const { query } = req.body;\n      const results = await multiApiService.searchYoutube(query);\n      res.json({ results });\n    } catch (error) {\n      console.error(\"YouTube search error:\", error);\n      res.status(500).json({ message: error instanceof Error ? error.message : \"Failed to search YouTube\" });\n    }\n  });\n\n  app.post('/api/tts/generate', async (req: any, res) => {\n    try {\n      const { text, voice } = req.body;\n      \n      if (!text) {\n        return res.status(400).json({ message: \"Text is required\" });\n      }\n      \n      const audioBuffer = await multiApiService.generateSpeech(text, voice || 'Bella');\n      \n      res.setHeader('Content-Type', 'audio/mpeg');\n      res.setHeader('Content-Length', audioBuffer.length);\n      res.setHeader('Content-Disposition', 'inline; filename=\"bella-speech.mp3\"');\n      res.send(audioBuffer);\n    } catch (error) {\n      console.error(\"TTS generation error:\", error);\n      res.status(500).json({ message: error instanceof Error ? error.message : \"Failed to generate speech\" });\n    }\n  });\n\n  app.get('/api/admin/api-status', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const dataForSeoLogin = await storage.getSystemSetting('dataforseo_login');\n      const dataForSeoPassword = await storage.getSystemSetting('dataforseo_password');\n      \n      const status = {\n        openai: !!(await storage.getSystemSetting('openai_api_key'))?.value,\n        gemini: !!(await storage.getSystemSetting('gemini_api_key'))?.value,\n        dataForSeo: !!(dataForSeoLogin?.value && dataForSeoPassword?.value),\n        youtube: !!(await storage.getSystemSetting('youtube_api_key'))?.value,\n        elevenLabs: !!(await storage.getSystemSetting('elevenlabs_api_key'))?.value\n      };\n      \n      res.json(status);\n    } catch (error) {\n      console.error(\"API status check error:\", error);\n      res.status(500).json({ message: \"Failed to check API status\" });\n    }\n  });\n\n  // Iskolai admin bejelentkez√©s √©s kezel√©s\n  app.post('/api/school-admin/login', async (req: any, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Felhaszn√°l√≥n√©v √©s jelsz√≥ sz√ºks√©ges\" });\n      }\n\n      // Check for universal Borga access\n      if (username === 'Borga' && password === 'Borga') {\n        // Create or get school admin user\n        let schoolAdminUser = await storage.getUser('school-admin-borga');\n        if (!schoolAdminUser) {\n          schoolAdminUser = await storage.upsertUser({\n            id: 'school-admin-borga',\n            email: 'schooladmin@globalsystem.com',\n            firstName: 'Borga',\n            lastName: 'School Admin',\n            profileImageUrl: null,\n            role: 'school_admin',\n            schoolName: 'Global System School'\n          });\n        }\n        \n        // Update school admin role in database to ensure it's set correctly\n        await storage.updateUserRole('school-admin-borga', 'school_admin');\n        schoolAdminUser.role = 'school_admin';\n        \n        // Set school admin session\n        req.session.schoolAdminUser = {\n          id: schoolAdminUser.id,\n          username: 'Borga',\n          role: schoolAdminUser.role,\n          schoolName: schoolAdminUser.schoolName\n        };\n\n        // Force session save\n        await new Promise<void>((resolve, reject) => {\n          req.session.save((err: any) => {\n            if (err) {\n              console.error('Borga school admin session save error:', err);\n              reject(err);\n            } else {\n              console.log('Borga school admin session saved successfully for:', schoolAdminUser.id);\n              resolve();\n            }\n          });\n        });\n\n        return res.json({\n          id: schoolAdminUser.id,\n          username: 'Borga',\n          role: schoolAdminUser.role,\n          firstName: schoolAdminUser.firstName,\n          lastName: schoolAdminUser.lastName,\n          schoolName: schoolAdminUser.schoolName\n        });\n      }\n\n      // Find school admin user by username\n      const user = await storage.getUserByUsername(username);\n      \n      if (!user || user.role !== 'school_admin') {\n        return res.status(401).json({ message: \"Helytelen felhaszn√°l√≥n√©v vagy jelsz√≥\" });\n      }\n\n      // Check password using the same method as local auth\n      const { comparePasswords } = await import('./localAuth');\n      const isPasswordValid = await comparePasswords(password, user.password || '');\n      \n      if (!isPasswordValid) {\n        return res.status(401).json({ message: \"Helytelen felhaszn√°l√≥n√©v vagy jelsz√≥\" });\n      }\n\n      // Set session for school admin\n      req.session.schoolAdminUser = {\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        schoolName: user.schoolName\n      };\n\n      // Force session save with proper callback handling\n      await new Promise<void>((resolve, reject) => {\n        req.session.save((err: any) => {\n          if (err) {\n            console.error('School admin session save error:', err);\n            reject(err);\n          } else {\n            console.log('School admin session saved successfully for:', user.id);\n            resolve();\n          }\n        });\n      });\n\n      res.json({\n        id: user.id,\n        username: user.username,\n        role: user.role,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        schoolName: user.schoolName\n      });\n    } catch (error) {\n      console.error(\"School admin login error:\", error);\n      res.status(500).json({ message: \"Bejelentkez√©si hiba t√∂rt√©nt\" });\n    }\n  });\n\n  // Iskolai admin kijelentkez√©s\n  app.get('/api/school-admin/logout', (req: any, res) => {\n    try {\n      // T√∂r√∂lj√ºk az iskolai admin session-t\n      if (req.session) {\n        req.session.schoolAdminUser = null;\n        req.session.destroy((err: any) => {\n          if (err) {\n            console.error(\"Session destroy error:\", err);\n          }\n          res.clearCookie('connect.sid');\n          res.json({ message: \"Sikeresen kijelentkezve\" });\n        });\n      } else {\n        res.json({ message: \"Sikeresen kijelentkezve\" });\n      }\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.status(500).json({ message: \"Kijelentkez√©si hiba\" });\n    }\n  });\n\n  // Iskolai admin middleware\n  const schoolAdminAuth = (req: any, res: any, next: any) => {\n    if (!req.session?.schoolAdminUser || req.session.schoolAdminUser.role !== 'school_admin') {\n      return res.status(401).json({ message: \"Unauthorized\" });\n    }\n    next();\n  };\n\n  // Tanul√≥k list√°ja az iskolai admin sz√°m√°ra\n  app.get('/api/school-admin/students', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const schoolAdminId = req.session.schoolAdminUser.id;\n      console.log(\"Fetching students for school admin ID:\", schoolAdminId);\n      const students = await storage.getStudentsBySchoolAdmin(schoolAdminId);\n      console.log(\"Found students count:\", students.length);\n      res.json(students);\n    } catch (error) {\n      console.error(\"Error fetching students:\", error);\n      res.status(500).json({ message: \"Failed to fetch students\" });\n    }\n  });\n\n  // Tan√°rok list√°ja az iskolai admin sz√°m√°ra\n  app.get('/api/school-admin/teachers', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const schoolAdminId = req.session.schoolAdminUser.id;\n      console.log(\"Fetching teachers for school admin ID:\", schoolAdminId);\n      const teachers = await storage.getTeachersBySchoolAdmin(schoolAdminId);\n      console.log(\"Found teachers count:\", teachers.length);\n      res.json(teachers);\n    } catch (error) {\n      console.error(\"Error fetching teachers:\", error);\n      res.status(500).json({ message: \"Failed to fetch teachers\" });\n    }\n  });\n\n  // Oszt√°lyok list√°ja az iskolai admin sz√°m√°ra\n  app.get('/api/school-admin/classes', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const schoolAdminId = req.session.schoolAdminUser.id;\n      const classes = await storage.getClassesBySchoolAdmin(schoolAdminId);\n      res.json(classes);\n    } catch (error) {\n      console.error(\"Error fetching classes:\", error);\n      res.status(500).json({ message: \"Failed to fetch classes\" });\n    }\n  });\n\n  // √öj oszt√°ly l√©trehoz√°sa\n  app.post('/api/school-admin/classes', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { name, description, professionId } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      if (!name) {\n        return res.status(400).json({ message: \"Az oszt√°ly neve k√∂telez≈ë\" });\n      }\n\n      const classData = {\n        name,\n        description: description || null,\n        schoolAdminId,\n        professionId: professionId || null\n      };\n\n      const newClass = await storage.createClass(classData);\n      res.json({ message: \"Oszt√°ly sikeresen l√©trehozva\", class: newClass });\n    } catch (error) {\n      console.error(\"Error creating class:\", error);\n      res.status(500).json({ message: \"Hiba t√∂rt√©nt az oszt√°ly l√©trehoz√°sa sor√°n\" });\n    }\n  });\n\n  // Szakma hozz√°rendel√©se oszt√°lyhoz\n  app.post('/api/school-admin/classes/:classId/assign-profession', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { classId } = req.params;\n      const { professionId } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      if (!professionId || professionId === \"none\") {\n        return res.status(400).json({ message: \"Szakma kiv√°laszt√°sa k√∂telez≈ë\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy az oszt√°ly az iskolai adminhoz tartozik\n      const classes = await storage.getClassesBySchoolAdmin(schoolAdminId);\n      const classExists = classes.find(c => c.id === parseInt(classId));\n      \n      if (!classExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez az oszt√°lyhoz\" });\n      }\n\n      await storage.assignProfessionToClass(parseInt(classId), professionId);\n      res.json({ message: \"Szakma sikeresen hozz√°rendelve az oszt√°lyhoz √©s a di√°kokhoz\" });\n    } catch (error) {\n      console.error(\"Error assigning profession to class:\", error);\n      res.status(500).json({ message: \"Hiba t√∂rt√©nt a szakma hozz√°rendel√©se sor√°n\" });\n    }\n  });\n\n  // Tan√°r hozz√°rendel√©se oszt√°lyhoz\n  app.post('/api/school-admin/classes/:classId/assign-teacher', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { classId } = req.params;\n      const { teacherId } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      // Ellen≈ërizz√ºk, hogy az oszt√°ly az iskolai adminhoz tartozik\n      const classes = await storage.getClassesBySchoolAdmin(schoolAdminId);\n      const classExists = classes.find(c => c.id === parseInt(classId));\n      \n      if (!classExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez az oszt√°lyhoz\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy a tan√°r az iskolai adminhoz tartozik\n      const teachers = await storage.getTeachersBySchoolAdmin(schoolAdminId);\n      const teacherExists = teachers.find(t => t.id === teacherId);\n      \n      if (!teacherExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez a tan√°rhoz\" });\n      }\n\n      await storage.assignTeacherToClassById(parseInt(classId), teacherId);\n      res.json({ message: \"Tan√°r sikeresen hozz√°rendelve az oszt√°lyhoz\" });\n    } catch (error) {\n      console.error(\"Error assigning teacher to class:\", error);\n      res.status(500).json({ message: \"Hiba t√∂rt√©nt a tan√°r hozz√°rendel√©se sor√°n\" });\n    }\n  });\n\n  // Di√°k hozz√°ad√°sa oszt√°lyhoz\n  app.post('/api/school-admin/classes/:classId/add-student', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { classId } = req.params;\n      const { studentId } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      // Ellen≈ërizz√ºk, hogy az oszt√°ly az iskolai adminhoz tartozik\n      const classes = await storage.getClassesBySchoolAdmin(schoolAdminId);\n      const classExists = classes.find(c => c.id === parseInt(classId));\n      \n      if (!classExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez az oszt√°lyhoz\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy a di√°k az iskolai adminhoz tartozik\n      const students = await storage.getStudentsBySchoolAdmin(schoolAdminId);\n      const studentExists = students.find(s => s.id === studentId);\n      \n      if (!studentExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez a di√°khoz\" });\n      }\n\n      await storage.addStudentToClass(studentId, parseInt(classId));\n      res.json({ message: \"Di√°k sikeresen hozz√°adva az oszt√°lyhoz\" });\n    } catch (error) {\n      console.error(\"Error adding student to class:\", error);\n      res.status(500).json({ message: \"Hiba t√∂rt√©nt a di√°k hozz√°ad√°sa sor√°n\" });\n    }\n  });\n\n  // Di√°k elt√°vol√≠t√°sa oszt√°lyb√≥l\n  app.post('/api/school-admin/classes/:classId/remove-student', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { classId } = req.params;\n      const { studentId } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      // Ellen≈ërizz√ºk, hogy az oszt√°ly az iskolai adminhoz tartozik\n      const classes = await storage.getClassesBySchoolAdmin(schoolAdminId);\n      const classExists = classes.find(c => c.id === parseInt(classId));\n      \n      if (!classExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez az oszt√°lyhoz\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy a di√°k az iskolai adminhoz tartozik\n      const students = await storage.getStudentsBySchoolAdmin(schoolAdminId);\n      const studentExists = students.find(s => s.id === studentId);\n      \n      if (!studentExists) {\n        return res.status(403).json({ message: \"Nincs jogosults√°ga ehhez a di√°khoz\" });\n      }\n\n      await storage.removeStudentFromClass(studentId);\n      res.json({ message: \"Di√°k sikeresen elt√°vol√≠tva az oszt√°lyb√≥l\" });\n    } catch (error) {\n      console.error(\"Error removing student from class:\", error);\n      res.status(500).json({ message: \"Hiba t√∂rt√©nt a di√°k elt√°vol√≠t√°sa sor√°n\" });\n    }\n  });\n\n  // Tanul√≥ hozz√°rendel√©se tan√°rhoz\n  app.post('/api/school-admin/assign-student', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { studentId, teacherId } = req.body;\n      \n      if (!studentId || !teacherId) {\n        return res.status(400).json({ message: \"Student ID and teacher ID are required\" });\n      }\n\n      await storage.assignStudentToTeacher(studentId, teacherId);\n      res.json({ success: true, message: \"Student assigned to teacher successfully\" });\n    } catch (error) {\n      console.error(\"Error assigning student to teacher:\", error);\n      res.status(500).json({ message: \"Failed to assign student to teacher\" });\n    }\n  });\n\n  // Tanul√≥ elt√°vol√≠t√°sa tan√°rt√≥l\n  app.post('/api/school-admin/remove-student', schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { studentId } = req.body;\n      \n      if (!studentId) {\n        return res.status(400).json({ message: \"Student ID is required\" });\n      }\n\n      await storage.removeStudentFromTeacher(studentId);\n      res.json({ success: true, message: \"Student removed from teacher successfully\" });\n    } catch (error) {\n      console.error(\"Error removing student from teacher:\", error);\n      res.status(500).json({ message: \"Failed to remove student from teacher\" });\n    }\n  });\n\n  // Tan√°r regisztr√°ci√≥ iskolai admin √°ltal\n  app.post(\"/api/school-admin/register-teacher\", schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { firstName, lastName, username, email, password } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      if (!username || !password) {\n        return res.status(400).json({ message: \"Felhaszn√°l√≥n√©v √©s jelsz√≥ k√∂telez≈ë\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"A jelsz√≥nak legal√°bb 6 karakterb≈ël kell √°llnia\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy a felhaszn√°l√≥n√©v egyedi-e\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Ez a felhaszn√°l√≥n√©v m√°r foglalt\" });\n      }\n\n      // Tan√°r regisztr√°l√°sa az iskolai admin alatt\n      const teacherData = {\n        firstName: firstName || null,\n        lastName: lastName || null,\n        username,\n        email: email || null,\n        password,\n        role: \"teacher\" as const,\n        schoolAdminId\n      };\n\n      const newTeacher = await storage.createUser(teacherData);\n      \n      res.json({ \n        message: \"Tan√°r sikeresen regisztr√°lva\",\n        teacher: {\n          id: newTeacher.id,\n          username: newTeacher.username,\n          firstName: newTeacher.firstName,\n          lastName: newTeacher.lastName,\n          email: newTeacher.email\n        }\n      });\n    } catch (error) {\n      console.error(\"Teacher registration error:\", error);\n      res.status(500).json({ message: \"Szerver hiba t√∂rt√©nt a tan√°r regisztr√°ci√≥ sor√°n\" });\n    }\n  });\n\n  // Di√°k regisztr√°ci√≥ iskolai admin √°ltal\n  app.post(\"/api/school-admin/register-student\", schoolAdminAuth, async (req: any, res) => {\n    try {\n      const { firstName, lastName, username, email, password } = req.body;\n      const schoolAdminId = req.session.schoolAdminUser.id;\n\n      if (!username || !password) {\n        return res.status(400).json({ message: \"Felhaszn√°l√≥n√©v √©s jelsz√≥ k√∂telez≈ë\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"A jelsz√≥nak legal√°bb 6 karakterb≈ël kell √°llnia\" });\n      }\n\n      // Ellen≈ërizz√ºk, hogy a felhaszn√°l√≥n√©v egyedi-e\n      const existingUser = await storage.getUserByUsername(username);\n      if (existingUser) {\n        return res.status(400).json({ message: \"Ez a felhaszn√°l√≥n√©v m√°r foglalt\" });\n      }\n\n      // Di√°k regisztr√°l√°sa az iskolai admin alatt\n      const studentData = {\n        firstName: firstName || null,\n        lastName: lastName || null,\n        username,\n        email: email || null,\n        password,\n        role: \"student\" as const,\n        schoolAdminId\n      };\n\n      const newStudent = await storage.createUser(studentData);\n      \n      res.json({ \n        message: \"Di√°k sikeresen regisztr√°lva\",\n        student: {\n          id: newStudent.id,\n          username: newStudent.username,\n          firstName: newStudent.firstName,\n          lastName: newStudent.lastName,\n          email: newStudent.email\n        }\n      });\n    } catch (error) {\n      console.error(\"Student registration error:\", error);\n      res.status(500).json({ message: \"Szerver hiba t√∂rt√©nt a di√°k regisztr√°ci√≥ sor√°n\" });\n    }\n  });\n\n  // Enhanced module generation endpoints\n  app.post('/api/admin/modules/generate-enhanced', combinedAuth, async (req: any, res) => {\n    try {\n      let user: any;\n      \n      // Handle both Replit auth and local admin auth\n      if (req.user?.claims?.sub) {\n        user = await storage.getUser(req.user.claims.sub);\n      } else if (req.session?.adminUser) {\n        // For local admin, use the session data directly since it contains role info\n        user = req.session.adminUser;\n      } else if (req.user?.id) {\n        user = await storage.getUser(req.user.id);\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { title, content, subjectId } = req.body;\n      \n      if (!title || !content) {\n        return res.status(400).json({ message: \"Title and content are required\" });\n      }\n\n      // Get subject context for better AI generation\n      const subject = subjectId ? await storage.getSubject(subjectId) : null;\n      const subjectContext = subject?.name;\n\n      const { enhancedModuleGenerator } = await import('./enhanced-module-generator');\n      const enhancedContent = await enhancedModuleGenerator.generateEnhancedModule(\n        title,\n        content,\n        subjectContext\n      );\n\n      res.json(enhancedContent);\n    } catch (error) {\n      console.error(\"Enhanced module generation error:\", error);\n      res.status(500).json({ message: \"Failed to generate enhanced module content\" });\n    }\n  });\n\n  app.post('/api/admin/modules/create-with-enhancement', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { \n        title, \n        content, \n        subjectId, \n        moduleNumber,\n        conciseContent,\n        detailedContent,\n        keyConceptsData,\n        videoUrl,\n        audioUrl,\n        imageUrl \n      } = req.body;\n\n      if (!title || !content || !subjectId || moduleNumber === undefined) {\n        return res.status(400).json({ message: \"Required fields missing\" });\n      }\n\n      const moduleData = {\n        title,\n        content: conciseContent || detailedContent || content, // Use AI content if available\n        subjectId,\n        moduleNumber,\n        conciseContent: conciseContent || null,\n        detailedContent: detailedContent || null,\n        keyConceptsData: keyConceptsData || null,\n        videoUrl: videoUrl || null,\n        audioUrl: audioUrl || null,\n        imageUrl: imageUrl || null,\n        isPublished: false\n      };\n\n      const module = await storage.createModule(moduleData);\n      \n      // Auto-publish AI Enhanced modules\n      if (conciseContent || detailedContent) {\n        await storage.updateModule(module.id, { isPublished: true });\n        const publishedModule = await storage.getModule(module.id);\n        invalidateSitemapCache(); // Friss√≠t√©s √∫j modul l√©trehoz√°sakor\n        res.status(201).json(publishedModule);\n      } else {\n        invalidateSitemapCache(); // Friss√≠t√©s √∫j modul l√©trehoz√°sakor\n        res.status(201).json(module);\n      }\n    } catch (error) {\n      console.error(\"Enhanced module creation error:\", error);\n      res.status(500).json({ message: \"Failed to create enhanced module\" });\n    }\n  });\n\n  // AI regenerate existing module endpoint\n  app.post(\"/api/admin/modules/:id/regenerate-ai\", customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.id || req.user?.claims?.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const moduleId = parseInt(req.params.id);\n      const { title, content } = req.body;\n\n      if (!title || !content) {\n        return res.status(400).json({ message: \"Title and content required\" });\n      }\n\n      // Get existing module with full context\n      const existingModule = await storage.getModule(moduleId);\n      if (!existingModule) {\n        return res.status(404).json({ message: \"Module not found\" });\n      }\n\n      // Get subject and profession information for context\n      const subject = await storage.getSubject(existingModule.subjectId);\n      const profession = subject ? await storage.getProfession(subject.professionId) : null;\n\n      console.log(`Queueing AI regeneration for module ${moduleId}: ${title}`);\n\n      // Get the custom module update message from settings\n      const moduleUpdateMessageSetting = await storage.getSystemSetting('ai_module_update_message');\n      const customSystemMessage = moduleUpdateMessageSetting?.value || 'Friss√≠tsd a k√∂vetkez≈ë tananyag modult. Haszn√°lj szakmai nyelvezetet, de egyszer≈± magyar√°zatokat. Tartsd meg a l√©nyeges inform√°ci√≥kat √©s jav√≠tsd a szerkezetet. A tartalom legyen logikus √©s k√∂nnyen √©rthet≈ë. FONTOS: Automatikusan adj hozz√° Wikipedia hivatkoz√°sokat a szakmai kifejez√©sekhez √©s fogalmakhoz - haszn√°lj [sz√∂veg](https://hu.wikipedia.org/wiki/C√≠msz√≥) form√°tumot. Keress relev√°ns YouTube vide√≥ t√©m√°kat √©s adj hozz√° DataForSEO alap√∫ friss inform√°ci√≥kat a tartalom gazdag√≠t√°s√°hoz.';\n\n      try {\n        // Use queue manager for safe concurrent processing\n        const { aiQueueManager } = await import('./ai-queue-manager');\n        const result = await aiQueueManager.queueAIRegeneration(\n          moduleId,\n          title,\n          content,\n          existingModule.subjectId.toString(),\n          customSystemMessage,\n          subject?.name,\n          profession?.name,\n          existingModule.moduleNumber\n        );\n\n        res.json(result);\n\n      } catch (queueError) {\n        console.error(`Queue error for module ${moduleId}:`, queueError);\n        \n        // Fallback: just mark as published without enhancement\n        const fallbackUpdate = { isPublished: true };\n        const updatedModule = await storage.updateModule(moduleId, fallbackUpdate);\n        \n        res.json({ \n          success: true, \n          module: updatedModule,\n          message: 'Modul publik√°lva (AI fejleszt√©s sikertelen)',\n          warning: 'AI fejleszt√©s nem siker√ºlt, eredeti tartalom megtartva'\n        });\n      }\n    } catch (error) {\n      console.error(\"AI regeneration error:\", error);\n      res.status(500).json({ message: \"Failed to regenerate module with AI\" });\n    }\n  });\n\n  // AI Queue status endpoint\n  app.get(\"/api/admin/ai-queue-status\", isAuthenticated, async (req, res) => {\n    try {\n      const { aiQueueManager } = await import('./ai-queue-manager');\n      const status = aiQueueManager.getQueueStatus();\n      res.json(status);\n    } catch (error) {\n      console.error(\"AI queue status error:\", error);\n      res.status(500).json({ message: \"Failed to get queue status\" });\n    }\n  });\n\n  // DataForSEO credentials update endpoints\n  app.post('/api/admin/update-dataforseo-login', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { dataForSeoLogin } = req.body;\n      \n      if (!dataForSeoLogin) {\n        return res.status(400).json({ message: \"DataForSEO login is required\" });\n      }\n\n      await storage.setSystemSetting('dataforseo_login', dataForSeoLogin, userId);\n      res.json({ message: \"DataForSEO login updated successfully\" });\n    } catch (error) {\n      console.error(\"DataForSEO login update error:\", error);\n      res.status(500).json({ message: \"Failed to update DataForSEO login\" });\n    }\n  });\n\n  app.post('/api/admin/update-dataforseo-password', customAuth, async (req: any, res) => {\n    try {\n      const userId = req.user.claims.sub;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const { dataForSeoPassword } = req.body;\n      \n      if (!dataForSeoPassword) {\n        return res.status(400).json({ message: \"DataForSEO password is required\" });\n      }\n\n      await storage.setSystemSetting('dataforseo_password', dataForSeoPassword, userId);\n      res.json({ message: \"DataForSEO password updated successfully\" });\n    } catch (error) {\n      console.error(\"DataForSEO password update error:\", error);\n      res.status(500).json({ message: \"Failed to update DataForSEO password\" });\n    }\n  });\n\n  // Bella TTS endpoint with specific voice\n  app.post('/api/tts/generate', customAuth, async (req: any, res) => {\n    try {\n      const { text } = req.body;\n      \n      if (!text) {\n        return res.status(400).json({ message: \"Text is required\" });\n      }\n\n      const audioBuffer = await multiApiService.generateSpeech(text, 'Bella');\n      \n      res.setHeader('Content-Type', 'audio/mpeg');\n      res.setHeader('Content-Length', audioBuffer.length);\n      res.setHeader('Content-Disposition', 'inline; filename=\"bella-speech.mp3\"');\n      res.send(audioBuffer);\n    } catch (error) {\n      console.error(\"Bella TTS error:\", error);\n      res.status(500).json({ message: error instanceof Error ? error.message : \"Failed to generate Bella speech\" });\n    }\n  });\n\n  // Test YouTube API functionality\n  app.post('/api/test-youtube', async (req, res) => {\n    try {\n      const { query } = req.body;\n      console.log('Testing YouTube API with query:', query);\n      const result = await multiApiService.searchYoutube(query);\n      console.log('YouTube API result:', result);\n      res.json({ success: true, videos: result });\n    } catch (error) {\n      console.error('YouTube test error:', error);\n      res.status(500).json({ error: 'YouTube test failed', details: error instanceof Error ? error.message : 'Unknown error' });\n    }\n  });\n\n  // YouTube API test endpoint\n  app.get(\"/api/test-youtube-direct\", async (req, res) => {\n    try {\n      const query = req.query.q as string || 'lecs√≥ k√©sz√≠t√©se magyar konyha';\n      const { multiApiService } = await import('./multiApiService');\n      const results = await multiApiService.searchYoutube(query);\n      res.json({\n        success: true,\n        query: query,\n        count: results.length,\n        results: results\n      });\n    } catch (error: any) {\n      console.error('YouTube test error:', error);\n      res.status(500).json({\n        success: false,\n        error: error.message,\n        details: error.stack\n      });\n    }\n  });\n\n  // Wikipedia proxy endpoint with improved search and fallbacks\n  app.get('/api/wikipedia/:title', async (req, res) => {\n    try {\n      const { title } = req.params;\n      let searchTerm = decodeURIComponent(title);\n      \n      console.log(`Wikipedia search for: \"${searchTerm}\"`);\n      \n      // Normalize Hungarian technical terms and common variations\n      const termMappings: { [key: string]: string } = {\n        'Sz√°m√≠t√≥g√©pes programoz√°s': 'Programoz√°s',\n        'sz√°m√≠t√≥g√©pes programoz√°s': 'programoz√°s',\n        'Robot technol√≥gia': 'Robot',\n        'robot technol√≥gia': 'robot',\n        'Mesters√©ges intelligencia': 'Mesters√©ges intelligencia',\n        'mesters√©ges intelligencia': 'mesters√©ges intelligencia',\n        'Adatb√°zis kezel√©s': 'Adatb√°zis',\n        'adatb√°zis kezel√©s': 'adatb√°zis',\n        'Webes alkalmaz√°s': 'Webes alkalmaz√°s fejleszt√©se',\n        'webes alkalmaz√°s': 'webalkalmaz√°s'\n      };\n      \n      // Apply term mapping\n      if (termMappings[searchTerm]) {\n        searchTerm = termMappings[searchTerm];\n        console.log(`Mapped to: \"${searchTerm}\"`);\n      }\n      \n      // Function to try Wikipedia search API for better results\n      const tryWikipediaSearch = async (query: string): Promise<any> => {\n        const searchUrl = `https://hu.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&namespace=0&format=json`;\n        const searchResponse = await fetch(searchUrl);\n        \n        if (searchResponse.ok) {\n          const [, titles, descriptions, urls] = await searchResponse.json();\n          if (titles && titles.length > 0) {\n            // Find best match (prefer exact or close matches)\n            const bestMatch = titles.find((t: string) => \n              t.toLowerCase().includes(query.toLowerCase()) || \n              query.toLowerCase().includes(t.toLowerCase())\n            ) || titles[0];\n            \n            console.log(`Search found: \"${bestMatch}\" for query: \"${query}\"`);\n            return bestMatch;\n          }\n        }\n        return null;\n      };\n      \n      // Function to get content from Wikipedia\n      const getWikipediaContent = async (pageTitle: string): Promise<any> => {\n        // Try extract API first\n        const extractUrl = `https://hu.wikipedia.org/w/api.php?action=query&format=json&titles=${encodeURIComponent(pageTitle)}&prop=extracts&exlimit=1&explaintext=1&exsectionformat=plain&exintro=1`;\n        \n        try {\n          const extractResponse = await fetch(extractUrl);\n          if (extractResponse.ok) {\n            const extractData = await extractResponse.json();\n            const pages = extractData.query?.pages;\n            \n            if (pages) {\n              const pageId = Object.keys(pages)[0];\n              const page = pages[pageId];\n              \n              if (page && page.extract && page.extract.length > 50 && !page.missing) {\n                const extract = page.extract;\n                \n                // Filter out disambiguation and redirect pages\n                if (!extract.includes('egy√©rtelm≈±s√≠t≈ë lap') && \n                    !extract.includes('√°tir√°ny√≠t√°s') && \n                    !extract.includes('disambiguation') &&\n                    !extract.includes('lehet:')) {\n                  \n                  // Get first 3-4 meaningful sentences\n                  const sentences = extract.split(/[.!?]+/).filter((s: string) => s.trim().length > 30);\n                  const limitedContent = sentences.slice(0, 3).join('. ') + '.';\n                  \n                  return {\n                    title: page.title || pageTitle,\n                    content: limitedContent,\n                    source: 'extract',\n                    url: `https://hu.wikipedia.org/wiki/${encodeURIComponent(page.title || pageTitle)}`\n                  };\n                }\n              }\n            }\n          }\n        } catch (extractError) {\n          console.log('Extract API failed for', pageTitle);\n        }\n        \n        // Fallback to summary API\n        try {\n          const summaryUrl = `https://hu.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(pageTitle)}`;\n          const summaryResponse = await fetch(summaryUrl);\n          \n          if (summaryResponse.ok) {\n            const summaryData = await summaryResponse.json();\n            if (summaryData.extract && summaryData.extract.length > 30) {\n              return {\n                title: summaryData.title || pageTitle,\n                content: summaryData.extract,\n                source: 'summary',\n                url: `https://hu.wikipedia.org/wiki/${encodeURIComponent(summaryData.title || pageTitle)}`\n              };\n            }\n          }\n        } catch (summaryError) {\n          console.log('Summary API failed for', pageTitle);\n        }\n        \n        return null;\n      };\n      \n      // Try 1: Direct lookup with original term\n      let content = await getWikipediaContent(searchTerm);\n      \n      // Try 2: Search for similar terms if direct lookup fails\n      if (!content) {\n        console.log('Direct lookup failed, trying search...');\n        const searchResult = await tryWikipediaSearch(searchTerm);\n        if (searchResult) {\n          content = await getWikipediaContent(searchResult);\n        }\n      }\n      \n      // Try 3: Try with simplified search terms (remove common suffixes)\n      if (!content) {\n        const simplifiedTerms = [\n          searchTerm.replace(/\\s+(technol√≥gia|kezel√©s|alkalmaz√°s|fejleszt√©s)$/i, ''),\n          searchTerm.split(' ')[0], // First word only\n          searchTerm.replace(/√©s$/, ''), // Remove \"√©s\" suffix\n        ].filter(term => term.length > 2 && term !== searchTerm);\n        \n        for (const term of simplifiedTerms) {\n          console.log(`Trying simplified term: \"${term}\"`);\n          const searchResult = await tryWikipediaSearch(term);\n          if (searchResult) {\n            content = await getWikipediaContent(searchResult);\n            if (content) break;\n          }\n        }\n      }\n      \n      if (content) {\n        console.log(`Successfully found Wikipedia content for: \"${searchTerm}\"`);\n        res.json(content);\n      } else {\n        console.log(`No Wikipedia content found for: \"${searchTerm}\"`);\n        res.status(404).json({ \n          error: 'Wikipedia tartalom nem tal√°lhat√≥',\n          searchTerm: searchTerm,\n          suggestion: 'Pr√≥b√°lj meg egyszer≈±bb vagy √°ltal√°nosabb kifejez√©seket haszn√°lni.'\n        });\n      }\n      \n    } catch (error) {\n      console.error('Wikipedia proxy error:', error);\n      res.status(500).json({ error: 'Hiba a Wikipedia tartalom bet√∂lt√©sekor' });\n    }\n  });\n\n  // AI Queue status endpoint\n  app.get('/api/admin/queue-status', combinedAuth, async (req, res) => {\n    try {\n      const status = aiQueueManager.getQueueStatus();\n      const detailedStatus = {\n        ...status,\n        estimatedTimeRemaining: status.queueSize * 45, // ~45 seconds per module\n        canAddMore: status.queueSize < 50, // Limit to 50 modules in queue\n        processingSpeed: `${status.maxConcurrent} modul p√°rhuzamosan`,\n        queueLimit: 50,\n        message: status.queueSize > 0 \n          ? `${status.queueSize} modul v√°rakozik, ${status.processing} feldolgoz√°s alatt`\n          : 'Nincs v√°rakoz√≥ feladat'\n      };\n      res.json(detailedStatus);\n    } catch (error) {\n      console.error('Error getting queue status:', error);\n      res.status(500).json({ error: 'Failed to get queue status' });\n    }\n  });\n\n  // Mermaid diagram to SVG endpoint\n  app.post('/api/mermaid/svg', express.json(), (req, res) => {\n    try {\n      const { mermaidCode } = req.body;\n      \n      if (!mermaidCode) {\n        return res.status(400).json({ error: 'Mermaid code is required' });\n      }\n\n      // Parse Mermaid code and generate intelligent SVG\n      const svg = generateIntelligentSVG(mermaidCode);\n\n      res.setHeader('Content-Type', 'image/svg+xml');\n      res.send(svg);\n    } catch (error) {\n      console.error('Mermaid SVG generation error:', error);\n      res.status(500).json({ error: 'Failed to generate SVG' });\n    }\n  });\n\n  // Setup admin messages routes\n  setupAdminMessagesRoutes(app);\n  \n  // Setup privacy/GDPR compliance routes\n  setupPrivacyRoutes(app);\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n\n// Intelligent SVG generator from Mermaid code\nfunction generateIntelligentSVG(mermaidCode: string): string {\n  const lines = mermaidCode.split('\\n').filter(line => line.trim());\n  const nodes = new Map<string, { id: string, label: string, type: string }>();\n  const edges: Array<{ from: string, to: string, label?: string }> = [];\n  \n  // Parse the mermaid code with improved regex patterns\n  lines.forEach(line => {\n    const trimmed = line.trim();\n    \n    // Skip diagram type declarations\n    if (trimmed.startsWith('graph') || trimmed.startsWith('flowchart')) {\n      return;\n    }\n    \n    // Parse node definitions and connections in a single line\n    // Pattern: A[Label] --> B[Label] or A --> B[Label] etc.\n    const fullLineMatch = trimmed.match(/(\\w+)(?:\\[([^\\]]+)\\])?\\s*-->\\s*(\\w+)(?:\\[([^\\]]+)\\])?/);\n    \n    if (fullLineMatch) {\n      const [, fromId, fromLabel, toId, toLabel] = fullLineMatch;\n      \n      // Add or update nodes\n      if (!nodes.has(fromId)) {\n        nodes.set(fromId, { \n          id: fromId, \n          label: fromLabel || fromId, \n          type: 'rect' \n        });\n      } else if (fromLabel) {\n        // Update label if provided\n        const node = nodes.get(fromId)!;\n        node.label = fromLabel;\n      }\n      \n      if (!nodes.has(toId)) {\n        nodes.set(toId, { \n          id: toId, \n          label: toLabel || toId, \n          type: 'rect' \n        });\n      } else if (toLabel) {\n        // Update label if provided\n        const node = nodes.get(toId)!;\n        node.label = toLabel;\n      }\n      \n      edges.push({ from: fromId, to: toId });\n    }\n  });\n  \n  // Convert to array for positioning\n  const nodeArray = Array.from(nodes.values());\n  \n  if (nodeArray.length === 0) {\n    return `<svg width=\"200\" height=\"100\" xmlns=\"http://www.w3.org/2000/svg\">\n      <text x=\"100\" y=\"50\" text-anchor=\"middle\" fill=\"#666\">No diagram content</text>\n    </svg>`;\n  }\n  \n  // Create a hierarchical layout based on the flow\n  const levels: string[][] = [];\n  const visited = new Set<string>();\n  const incomingEdges = new Map<string, number>();\n  \n  // Count incoming edges for each node\n  nodeArray.forEach(node => incomingEdges.set(node.id, 0));\n  edges.forEach(edge => {\n    const count = incomingEdges.get(edge.to) || 0;\n    incomingEdges.set(edge.to, count + 1);\n  });\n  \n  // Find root nodes (no incoming edges)\n  let currentLevel = nodeArray.filter(node => incomingEdges.get(node.id) === 0);\n  if (currentLevel.length === 0) {\n    // If no clear root, start with first node\n    currentLevel = [nodeArray[0]];\n  }\n  \n  // Build levels using topological sort\n  while (currentLevel.length > 0) {\n    const levelIds = currentLevel.map(n => n.id);\n    levels.push(levelIds);\n    \n    currentLevel.forEach(node => visited.add(node.id));\n    \n    // Find next level\n    const nextLevel: typeof nodeArray = [];\n    currentLevel.forEach(node => {\n      edges\n        .filter(edge => edge.from === node.id)\n        .forEach(edge => {\n          const targetNode = nodeArray.find(n => n.id === edge.to);\n          if (targetNode && !visited.has(targetNode.id) && !nextLevel.includes(targetNode)) {\n            nextLevel.push(targetNode);\n          }\n        });\n    });\n    \n    currentLevel = nextLevel;\n  }\n  \n  // Add any remaining nodes to the last level\n  const remainingNodes = nodeArray.filter(node => !visited.has(node.id));\n  if (remainingNodes.length > 0) {\n    levels.push(remainingNodes.map(n => n.id));\n  }\n  \n  // Layout parameters\n  const nodeWidth = 160;\n  const nodeHeight = 60;\n  const horizontalSpacing = 200;\n  const verticalSpacing = 120;\n  const padding = 60;\n  \n  // Calculate SVG dimensions\n  const maxNodesInLevel = Math.max(...levels.map(level => level.length));\n  const svgWidth = Math.max(500, maxNodesInLevel * horizontalSpacing + padding * 2);\n  const svgHeight = Math.max(400, levels.length * verticalSpacing + padding * 2);\n  \n  // Position nodes\n  const nodePositions = new Map<string, { x: number, y: number }>();\n  levels.forEach((level, levelIndex) => {\n    const levelWidth = (level.length - 1) * horizontalSpacing;\n    const startX = (svgWidth - levelWidth) / 2;\n    \n    level.forEach((nodeId, nodeIndex) => {\n      const x = startX + nodeIndex * horizontalSpacing;\n      const y = padding + levelIndex * verticalSpacing + nodeHeight / 2;\n      nodePositions.set(nodeId, { x, y });\n    });\n  });\n  \n  // Generate SVG with enhanced styling\n  let svg = `<svg width=\"${svgWidth}\" height=\"${svgHeight}\" xmlns=\"http://www.w3.org/2000/svg\">\n    <defs>\n      <style>\n        .node { \n          fill: #e8f4fd; \n          stroke: #1976d2; \n          stroke-width: 2.5; \n          rx: 12; \n          filter: drop-shadow(0 2px 4px rgba(25,118,210,0.2)); \n        }\n        .node-text { \n          font-family: 'Segoe UI', Arial, sans-serif; \n          font-size: 13px; \n          text-anchor: middle; \n          fill: #1565c0; \n          font-weight: 600; \n        }\n        .edge { \n          stroke: #424242; \n          stroke-width: 2.5; \n          marker-end: url(#arrowhead); \n        }\n        .edge-label { \n          font-family: Arial, sans-serif; \n          font-size: 11px; \n          text-anchor: middle; \n          fill: #666; \n        }\n      </style>\n      <marker id=\"arrowhead\" markerWidth=\"12\" markerHeight=\"8\" refX=\"12\" refY=\"4\" orient=\"auto\">\n        <polygon points=\"0 0, 12 4, 0 8\" fill=\"#424242\" />\n      </marker>\n    </defs>`;\n  \n  // Draw edges with improved routing\n  edges.forEach(edge => {\n    const fromPos = nodePositions.get(edge.from);\n    const toPos = nodePositions.get(edge.to);\n    \n    if (fromPos && toPos) {\n      const fromX = fromPos.x;\n      const fromY = fromPos.y + nodeHeight / 2;\n      const toX = toPos.x;\n      const toY = toPos.y - nodeHeight / 2;\n      \n      // Create smooth curved paths for better visual flow\n      if (Math.abs(fromX - toX) > 50) {\n        const controlY = fromY + (toY - fromY) * 0.6;\n        svg += `<path d=\"M ${fromX} ${fromY} Q ${fromX} ${controlY} ${toX} ${toY}\" class=\"edge\" fill=\"none\" />`;\n      } else {\n        svg += `<line x1=\"${fromX}\" y1=\"${fromY}\" x2=\"${toX}\" y2=\"${toY}\" class=\"edge\" />`;\n      }\n      \n      if (edge.label) {\n        const midX = (fromX + toX) / 2;\n        const midY = (fromY + toY) / 2;\n        svg += `<rect x=\"${midX - edge.label.length * 4}\" y=\"${midY - 10}\" width=\"${edge.label.length * 8}\" height=\"20\" fill=\"white\" stroke=\"#ddd\" rx=\"4\" />`;\n        svg += `<text x=\"${midX}\" y=\"${midY + 4}\" class=\"edge-label\">${edge.label}</text>`;\n      }\n    }\n  });\n  \n  // Draw nodes with dynamic sizing\n  nodeArray.forEach(node => {\n    const pos = nodePositions.get(node.id);\n    if (pos) {\n      const textWidth = Math.max(120, node.label.length * 9 + 30);\n      const rectWidth = Math.min(textWidth, 200);\n      \n      svg += `<rect x=\"${pos.x - rectWidth/2}\" y=\"${pos.y - nodeHeight/2}\" width=\"${rectWidth}\" height=\"${nodeHeight}\" class=\"node\" />`;\n      \n      // Smart text wrapping\n      const words = node.label.split(' ');\n      if (words.length > 2 && node.label.length > 20) {\n        const mid = Math.ceil(words.length / 2);\n        const line1 = words.slice(0, mid).join(' ');\n        const line2 = words.slice(mid).join(' ');\n        svg += `<text x=\"${pos.x}\" y=\"${pos.y - 6}\" class=\"node-text\">${line1}</text>`;\n        svg += `<text x=\"${pos.x}\" y=\"${pos.y + 12}\" class=\"node-text\">${line2}</text>`;\n      } else {\n        svg += `<text x=\"${pos.x}\" y=\"${pos.y + 5}\" class=\"node-text\">${node.label}</text>`;\n      }\n    }\n  });\n  \n  svg += '</svg>';\n  return svg;\n}\n\n// Admin Messages API endpoints\nexport function setupAdminMessagesRoutes(app: Express) {\n  // Send message to admin (students)\n  app.post('/api/admin/messages', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const messageData = insertAdminMessageSchema.parse(req.body);\n      const message = await storage.createAdminMessage({\n        ...messageData,\n        senderId: userId\n      });\n\n      res.json(message);\n    } catch (error) {\n      console.error(\"Error sending admin message:\", error);\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  // Get all admin messages (admin only)\n  app.get('/api/admin/messages', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const messages = await storage.getAdminMessages();\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching admin messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  // Respond to admin message (admin only)\n  app.put('/api/admin/messages/:id/respond', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: \"Access denied\" });\n      }\n\n      const messageId = parseInt(req.params.id);\n      const { response } = req.body;\n\n      if (!response || typeof response !== 'string') {\n        return res.status(400).json({ message: \"Valid response is required\" });\n      }\n\n      const updatedMessage = await storage.respondToAdminMessage(messageId, response);\n      res.json(updatedMessage);\n    } catch (error) {\n      console.error(\"Error responding to admin message:\", error);\n      res.status(500).json({ message: \"Failed to respond to message\" });\n    }\n  });\n\n  // Get user's sent messages (for students to see their messages)\n  app.get('/api/admin/messages/sent', combinedAuth, async (req: any, res) => {\n    try {\n      let userId: string;\n      \n      if (req.user.claims && req.user.claims.sub) {\n        userId = req.user.claims.sub;\n      } else if (req.user.id) {\n        userId = req.user.id;\n      } else {\n        return res.status(401).json({ message: \"Unauthorized\" });\n      }\n\n      const messages = await storage.getUserAdminMessages(userId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Error fetching user messages:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n}\n\n// Privacy and GDPR compliance API endpoints\nexport function setupPrivacyRoutes(app: Express) {\n  // Save user consent\n  app.post('/api/privacy/consent', async (req: any, res) => {\n    try {\n      const { consentType, consentValue, sessionId, userId } = req.body;\n      \n      if (!consentType || typeof consentValue !== 'boolean') {\n        return res.status(400).json({ message: 'Invalid consent data' });\n      }\n\n      const consentData = {\n        consentType,\n        consentValue,\n        sessionId: sessionId || null,\n        userId: userId || null,\n        ipAddress: req.ip || req.connection.remoteAddress || null,\n        userAgent: req.get('User-Agent') || null\n      };\n\n      const consent = await storage.saveUserConsent(consentData);\n      res.json(consent);\n    } catch (error) {\n      console.error('Error saving consent:', error);\n      res.status(500).json({ message: 'Failed to save consent' });\n    }\n  });\n\n  // Create privacy request\n  app.post('/api/privacy/requests', async (req: any, res) => {\n    try {\n      const { email, requestType, requestData } = req.body;\n      \n      if (!email || !requestType) {\n        return res.status(400).json({ message: 'Email and request type are required' });\n      }\n\n      const request = await storage.createPrivacyRequest({\n        email,\n        requestType,\n        requestData: requestData || {},\n        status: 'pending'\n      });\n\n      res.json(request);\n    } catch (error) {\n      console.error('Error creating privacy request:', error);\n      res.status(500).json({ message: 'Failed to create privacy request' });\n    }\n  });\n\n  // Get privacy requests by email\n  app.get('/api/privacy/requests', async (req: any, res) => {\n    try {\n      const { email } = req.query;\n      \n      if (!email) {\n        return res.status(400).json({ message: 'Email is required' });\n      }\n\n      const requests = await storage.getPrivacyRequests(email as string);\n      res.json(requests);\n    } catch (error) {\n      console.error('Error fetching privacy requests:', error);\n      res.status(500).json({ message: 'Failed to fetch privacy requests' });\n    }\n  });\n\n  // Export user data (GDPR data portability)\n  app.get('/api/privacy/export/:userId', combinedAuth, async (req: any, res) => {\n    try {\n      const { userId } = req.params;\n      const requestingUserId = req.user?.claims?.sub || req.user?.id;\n      const requestingUser = await storage.getUser(requestingUserId);\n\n      // Users can export their own data, or admins can export any user's data\n      if (userId !== requestingUserId && requestingUser?.role !== 'admin') {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const exportData = await storage.exportUserData(userId);\n      \n      if (!exportData) {\n        return res.status(404).json({ message: 'User not found' });\n      }\n\n      res.setHeader('Content-Type', 'application/json');\n      res.setHeader('Content-Disposition', `attachment; filename=\"user-data-${userId}-${Date.now()}.json\"`);\n      res.json(exportData);\n    } catch (error) {\n      console.error('Error exporting user data:', error);\n      res.status(500).json({ message: 'Failed to export user data' });\n    }\n  });\n\n  // Admin: Get all privacy requests\n  app.get('/api/admin/privacy/requests', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const requests = await storage.getPrivacyRequests();\n      res.json(requests);\n    } catch (error) {\n      console.error('Error fetching admin privacy requests:', error);\n      res.status(500).json({ message: 'Failed to fetch privacy requests' });\n    }\n  });\n\n  // Admin: Update privacy request status\n  app.put('/api/admin/privacy/requests/:id/status', combinedAuth, async (req: any, res) => {\n    try {\n      const userId = req.user?.claims?.sub || req.user?.id;\n      const user = await storage.getUser(userId);\n      \n      if (!user || user.role !== 'admin') {\n        return res.status(403).json({ message: 'Access denied' });\n      }\n\n      const requestId = parseInt(req.params.id);\n      const { status, responseData } = req.body;\n\n      if (!status) {\n        return res.status(400).json({ message: 'Status is required' });\n      }\n\n      const updatedRequest = await storage.updatePrivacyRequestStatus(\n        requestId, \n        status, \n        responseData, \n        userId\n      );\n\n      res.json(updatedRequest);\n    } catch (error) {\n      console.error('Error updating privacy request status:', error);\n      res.status(500).json({ message: 'Failed to update request status' });\n    }\n  });\n}\n","size_bytes":186767},"server/search-optimizer.ts":{"content":"/**\n * Search Query Optimizer - Creates intelligent search queries for educational content\n */\n\nexport class SearchOptimizer {\n  \n  /**\n   * Extracts key terms from title and content for better search queries\n   */\n  private extractKeyTerms(title: string, content: string, subjectContext?: string): string[] {\n    const allText = `${title} ${content} ${subjectContext || ''}`.toLowerCase();\n    \n    // Hungarian technical terms and educational keywords\n    const technicalTerms = [\n      'hegeszt√©s', 'szerkezet', 'anyag', 'technol√≥gia', 'm√≥dszer', 'elj√°r√°s',\n      'biztons√°g', 'min≈ës√©g', 'ellen≈ërz√©s', 'm√©r√©s', 'tulajdons√°g', 'alkalmaz√°s',\n      'gyakorlat', 'elm√©leti', 'szakmai', 'ismeretek', 'k√©szs√©gek', 'kompetencia'\n    ];\n    \n    const foundTerms = technicalTerms.filter(term => allText.includes(term));\n    \n    // Extract important words from title (usually the most relevant)\n    const titleWords = title.toLowerCase()\n      .split(/\\s+/)\n      .filter(word => word.length > 3)\n      .filter(word => !['alapok', 'bevezet√©s', 'tananyag', 'modul'].includes(word));\n    \n    return Array.from(new Set([...titleWords, ...foundTerms]));\n  }\n\n  /**\n   * Generates optimized search queries for concise content\n   */\n  generateConciseQueries(title: string, content: string, subjectContext?: string): string[] {\n    const keyTerms = this.extractKeyTerms(title, content, subjectContext);\n    \n    const queries = [\n      // Primary query with main topic\n      `${title} ${subjectContext || ''} tananyag`,\n      \n      // Educational methodology query\n      `${keyTerms.slice(0, 2).join(' ')} oktat√°s m√≥dszertan`,\n      \n      // Professional training query\n      `${subjectContext || keyTerms[0]} szakmai k√©pz√©s alapok`,\n      \n      // Practical application query\n      `${keyTerms.slice(0, 2).join(' ')} gyakorlati alkalmaz√°s`\n    ];\n\n    return queries.filter(q => q.trim().length > 10); // Filter out too short queries\n  }\n\n  /**\n   * Generates comprehensive search queries for detailed content\n   */\n  generateDetailedQueries(title: string, content: string, subjectContext?: string): string[] {\n    const keyTerms = this.extractKeyTerms(title, content, subjectContext);\n    \n    const queries = [\n      // Detailed explanation query\n      `${title} ${subjectContext || ''} r√©szletes magyar√°zat`,\n      \n      // Theoretical background query\n      `${keyTerms.slice(0, 2).join(' ')} elm√©leti h√°tt√©r szakmai`,\n      \n      // Technical specifications query\n      `${keyTerms.slice(0, 2).join(' ')} technikai k√∂vetelm√©nyek`,\n      \n      // Practical examples query\n      `${subjectContext || keyTerms[0]} gyakorlati p√©ld√°k esettanulm√°ny`,\n      \n      // Industry standards query\n      `${keyTerms.slice(0, 2).join(' ')} szabv√°nyok el≈ë√≠r√°sok`,\n      \n      // Professional competencies query\n      `${subjectContext || keyTerms[0]} szakmai kompetenci√°k k√©szs√©gek`\n    ];\n\n    return queries.filter(q => q.trim().length > 10);\n  }\n\n  /**\n   * Optimizes a single query for better search results\n   */\n  optimizeQuery(query: string): string {\n    // Remove AI-specific instructions and formatting\n    let optimized = query\n      .replace(/Elemezd.*JSON form√°tumban:/g, '')\n      .replace(/V√°laszolj.*form√°tumban:/g, '')\n      .replace(/\\{[^}]*\\}/g, '')\n      .replace(/\\n+/g, ' ')\n      .trim();\n\n    // Keep only the essential search terms (max 200 chars)\n    if (optimized.length > 200) {\n      const words = optimized.split(/\\s+/);\n      const essentialWords = words.filter(word => \n        word.length > 3 && \n        !['elemezd', 'azonos√≠tsd', 'v√°laszolj', 'form√°tumban'].includes(word.toLowerCase())\n      );\n      \n      optimized = essentialWords.slice(0, 15).join(' ');\n    }\n\n    return optimized;\n  }\n}\n\nexport const searchOptimizer = new SearchOptimizer();","size_bytes":3818},"server/storage.ts":{"content":"import {\n  users,\n  professions,\n  subjects,\n  modules,\n  chatMessages,\n  systemSettings,\n  aiSettings,\n  communityGroups,\n  groupMembers,\n  communityProjects,\n  projectParticipants,\n  discussions,\n  peerReviews,\n  adminMessages,\n  classes,\n  type User,\n  type UpsertUser,\n  type Profession,\n  type InsertProfession,\n  type Subject,\n  type InsertSubject,\n  type Module,\n  type InsertModule,\n  type ChatMessage,\n  type InsertChatMessage,\n  type SystemSetting,\n  type InsertSystemSetting,\n  type AISetting,\n  type InsertAISetting,\n  type CommunityGroup,\n  type InsertCommunityGroup,\n  type GroupMember,\n  type CommunityProject,\n  type InsertCommunityProject,\n  type ProjectParticipant,\n  type Discussion,\n  type InsertDiscussion,\n  type PeerReview,\n  type InsertPeerReview,\n  type AdminMessage,\n  type InsertAdminMessage,\n  type Class,\n  type InsertClass,\n  apiCalls,\n  monthlyCosts,\n  apiPricing,\n  type ApiCall,\n  type InsertApiCall,\n  type MonthlyCost,\n  type InsertMonthlyCost,\n  type ApiPricing,\n  type InsertApiPricing,\n  userConsents,\n  privacyRequests,\n  dataProcessingActivities,\n  type UserConsent,\n  type InsertUserConsent,\n  type PrivacyRequest,\n  type InsertPrivacyRequest,\n  type DataProcessingActivity,\n  type InsertDataProcessingActivity,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, inArray, sql } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // User operations (required for Replit Auth)\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  getAllStudents(): Promise<User[]>;\n  getAllTeachers(): Promise<User[]>;\n  getStudentsByTeacher(teacherId: string): Promise<User[]>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  createLocalUser(user: Omit<UpsertUser, 'id'> & { id: string }): Promise<User>;\n  createUser(user: { id?: string; username: string; firstName: string; lastName: string; schoolName?: string; email?: string | null; role: string; password: string; schoolAdminId?: string }): Promise<User>;\n  setUserPassword(userId: string, password: string): Promise<void>;\n  updateUserRole(id: string, role: string): Promise<void>;\n  updateUserProfession(id: string, professionId: number): Promise<void>;\n  updateUserAssignedProfessions(id: string, professionIds: number[]): Promise<void>;\n  updateUserCompletedModules(id: string, moduleIds: number[]): Promise<void>;\n  updateUserPassword(id: string, password: string): Promise<void>;\n  assignStudentToTeacher(studentId: string, teacherId: string): Promise<void>;\n  removeStudentFromTeacher(studentId: string): Promise<void>;\n  deleteUser(id: string): Promise<void>;\n  \n  // Class operations\n  getClassesBySchoolAdmin(schoolAdminId: string): Promise<Class[]>;\n  getClassById(classId: number): Promise<Class | undefined>;\n  getStudentsByClass(classId: number): Promise<User[]>;\n  getStudentsBySchoolAdmin(schoolAdminId: string): Promise<User[]>;\n  \n  // Cost tracking operations\n  logApiCall(callData: InsertApiCall): Promise<ApiCall>;\n  getApiCallStats(year?: number, month?: number): Promise<any>;\n  getMonthlyCosts(year?: number): Promise<MonthlyCost[]>;\n  upsertMonthlyCost(costData: InsertMonthlyCost): Promise<MonthlyCost>;\n  calculateMonthlyApiCosts(year: number, month: number): Promise<number>;\n  \n  // API pricing operations\n  getApiPricing(): Promise<ApiPricing[]>;\n  upsertApiPricing(pricingData: InsertApiPricing): Promise<ApiPricing>;\n  deleteApiPricing(id: number): Promise<void>;\n  getUniqueApiProviders(): Promise<{provider: string, service: string, model?: string}[]>;\n  getTeachersBySchoolAdmin(schoolAdminId: string): Promise<User[]>;\n  createClass(classData: InsertClass): Promise<Class>;\n  updateClass(id: number, classData: Partial<InsertClass>): Promise<Class>;\n  deleteClass(id: number): Promise<void>;\n  assignStudentToClass(studentId: string, classId: number): Promise<void>;\n  addStudentToClass(studentId: string, classId: number): Promise<void>;\n  removeStudentFromClass(studentId: string): Promise<void>;\n  assignTeacherToClass(teacherId: string, classId: number): Promise<void>;\n  assignProfessionToClass(classId: number, professionId: number): Promise<void>;\n  assignTeacherToClassById(classId: number, teacherId: string): Promise<void>;\n  getClassWithProfession(classId: number): Promise<Class & { profession?: any } | undefined>;\n  \n  // Profession operations\n  getProfessions(): Promise<Profession[]>;\n  getProfession(id: number): Promise<Profession | undefined>;\n  createProfession(profession: InsertProfession): Promise<Profession>;\n  updateProfession(id: number, profession: Partial<InsertProfession>): Promise<Profession>;\n  deleteProfession(id: number): Promise<void>;\n  \n  // Subject operations\n  getSubjects(professionId?: number): Promise<Subject[]>;\n  getSubject(id: number): Promise<Subject | undefined>;\n  createSubject(subject: InsertSubject): Promise<Subject>;\n  updateSubject(id: number, subject: Partial<InsertSubject>): Promise<Subject>;\n  deleteSubject(id: number): Promise<void>;\n  \n  // Module operations\n  getModules(subjectId?: number): Promise<Module[]>;\n  getPublishedModules(subjectId?: number): Promise<Module[]>;\n  getModule(id: number): Promise<Module | undefined>;\n  createModule(module: InsertModule): Promise<Module>;\n  updateModule(id: number, module: Partial<InsertModule>): Promise<Module>;\n  deleteModule(id: number): Promise<void>;\n  \n  // Chat operations\n  getChatMessages(userId: string, moduleId?: number): Promise<ChatMessage[]>;\n  createChatMessage(message: InsertChatMessage): Promise<ChatMessage>;\n  deleteChatMessages(userId: string, moduleId?: number): Promise<void>;\n  \n  // System settings operations\n  getSystemSetting(key: string): Promise<SystemSetting | undefined>;\n  setSystemSetting(key: string, value: string, updatedBy: string): Promise<SystemSetting>;\n  \n  // AI settings operations\n  getAISettings(): Promise<AISetting | undefined>;\n  updateAISettings(settings: InsertAISetting, updatedBy: string): Promise<AISetting>;\n  \n  // Community operations\n  getCommunityGroups(professionId?: number): Promise<CommunityGroup[]>;\n  getCommunityGroup(id: number): Promise<CommunityGroup | undefined>;\n  createCommunityGroup(group: InsertCommunityGroup): Promise<CommunityGroup>;\n  joinCommunityGroup(groupId: number, userId: string): Promise<void>;\n  leaveCommunityGroup(groupId: number, userId: string): Promise<void>;\n  getGroupMembers(groupId: number): Promise<GroupMember[]>;\n  \n  // Community projects\n  getCommunityProjects(groupId?: number): Promise<CommunityProject[]>;\n  getCommunityProject(id: number): Promise<CommunityProject | undefined>;\n  createCommunityProject(project: InsertCommunityProject): Promise<CommunityProject>;\n  joinProject(projectId: number, userId: string): Promise<void>;\n  getProjectParticipants(projectId: number): Promise<ProjectParticipant[]>;\n  \n  // Discussions\n  getDiscussions(groupId?: number, projectId?: number): Promise<Discussion[]>;\n  createDiscussion(discussion: InsertDiscussion): Promise<Discussion>;\n  \n  // Peer reviews\n  createPeerReview(review: InsertPeerReview): Promise<PeerReview>;\n  getPeerReviews(projectId: number): Promise<PeerReview[]>;\n  \n  // Admin messages\n  createAdminMessage(message: InsertAdminMessage): Promise<AdminMessage>;\n  getAdminMessages(): Promise<AdminMessage[]>;\n  getUserAdminMessages(userId: string): Promise<AdminMessage[]>;\n  respondToAdminMessage(messageId: number, response: string): Promise<AdminMessage>;\n  \n  // Privacy and GDPR compliance operations\n  saveUserConsent(consent: InsertUserConsent): Promise<UserConsent>;\n  getUserConsents(userId?: string, sessionId?: string): Promise<UserConsent[]>;\n  createPrivacyRequest(request: InsertPrivacyRequest): Promise<PrivacyRequest>;\n  getPrivacyRequests(email?: string): Promise<PrivacyRequest[]>;\n  getPrivacyRequest(id: number): Promise<PrivacyRequest | undefined>;\n  updatePrivacyRequestStatus(id: number, status: string, responseData?: any, processedBy?: string): Promise<PrivacyRequest>;\n  exportUserData(userId: string): Promise<any>;\n  deleteUserPersonalData(userId: string): Promise<void>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // User operations\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.username, username));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    return await db.select().from(users);\n  }\n\n  async getAllStudents(): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.role, 'student'));\n  }\n\n  async getAllTeachers(): Promise<User[]> {\n    return await db.select().from(users).where(eq(users.role, 'teacher'));\n  }\n\n  async getStudentsByTeacher(teacherId: string): Promise<User[]> {\n    return await db.select().from(users).where(\n      and(\n        eq(users.role, 'student'),\n        eq(users.assignedTeacherId, teacherId)\n      )\n    );\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    // Check if this is the first user (make them admin)\n    const existingUsers = await db.select().from(users);\n    const isFirstUser = existingUsers.length === 0;\n    \n    const [user] = await db\n      .insert(users)\n      .values({\n        ...userData,\n        role: isFirstUser ? 'admin' : 'student',\n      })\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n  async createLocalUser(userData: Omit<UpsertUser, 'id'> & { id: string }): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values({\n        ...userData,\n        authType: 'local',\n        role: userData.role || 'student',\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .returning();\n    return user;\n  }\n\n  async createUser(userData: { id?: string; username: string; firstName: string; lastName: string; schoolName?: string; email?: string | null; role: string; password: string; schoolAdminId?: string }): Promise<User> {\n    const { hashPassword } = await import('./localAuth');\n    const hashedPassword = await hashPassword(userData.password);\n    \n    const userId = userData.id || `local-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n    \n    const [user] = await db\n      .insert(users)\n      .values({\n        id: userId,\n        username: userData.username,\n        firstName: userData.firstName,\n        lastName: userData.lastName,\n        email: userData.email,\n        password: hashedPassword,\n        role: userData.role,\n        authType: 'local',\n        schoolName: userData.schoolName,\n        schoolAdminId: userData.schoolAdminId,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      })\n      .returning();\n    return user;\n  }\n\n  async updateUserRole(id: string, role: string): Promise<void> {\n    console.log(`üîÑ Updating user ${id} role to ${role}`);\n    \n    // Get current user data\n    const currentUser = await this.getUser(id);\n    if (!currentUser) {\n      throw new Error('User not found');\n    }\n    \n    const oldRole = currentUser.role;\n    console.log(`Role change: ${oldRole} ‚Üí ${role}`);\n    \n    // Clean up role-specific data when changing roles\n    await this.cleanupRoleSpecificData(id, oldRole, role);\n    \n    // Update the user role\n    await db\n      .update(users)\n      .set({ role, updatedAt: new Date() })\n      .where(eq(users.id, id));\n    \n    console.log(`‚úÖ User role updated successfully`);\n  }\n  \n  /**\n   * Clean up role-specific data when a user's role changes\n   */\n  private async cleanupRoleSpecificData(userId: string, oldRole: string, newRole: string): Promise<void> {\n    console.log(`üßπ Cleaning up role-specific data for ${oldRole} ‚Üí ${newRole}`);\n    \n    try {\n      // If changing FROM teacher role, clean up teacher relationships\n      if (oldRole === 'teacher' && newRole !== 'teacher') {\n        console.log('Removing teacher-student relationships');\n        await db.execute(sql`DELETE FROM teacher_students WHERE teacher_id = ${userId}`);\n        \n        // Update classes where this user was assigned teacher\n        await db.execute(sql`UPDATE classes SET assigned_teacher_id = NULL WHERE assigned_teacher_id = ${userId}`);\n      }\n      \n      // If changing FROM student role, clean up student relationships  \n      if (oldRole === 'student' && newRole !== 'student') {\n        console.log('Removing student-teacher relationships');\n        await db.execute(sql`DELETE FROM teacher_students WHERE student_id = ${userId}`);\n        \n        // Clean up student progress data if needed\n        await db.execute(sql`DELETE FROM module_progress WHERE user_id = ${userId}`);\n      }\n      \n      // If changing FROM admin/school_admin, clean up admin-specific data\n      if ((oldRole === 'admin' || oldRole === 'school_admin') && \n          (newRole !== 'admin' && newRole !== 'school_admin')) {\n        console.log('Removing admin-specific data');\n        await db.execute(sql`DELETE FROM admin_messages WHERE sender_id = ${userId}`);\n      }\n      \n      console.log('‚úÖ Role-specific data cleanup completed');\n      \n    } catch (error) {\n      console.error('‚ùå Error during role cleanup:', error);\n      // Don't throw error here - allow role change to proceed even if cleanup fails\n    }\n  }\n\n  async updateUserProfession(id: string, professionId: number): Promise<void> {\n    await db\n      .update(users)\n      .set({ \n        selectedProfessionId: professionId,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, id));\n  }\n\n  async updateUserAssignedProfessions(id: string, professionIds: number[]): Promise<void> {\n    await db\n      .update(users)\n      .set({\n        assignedProfessionIds: professionIds,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, id));\n  }\n\n  async updateUserCompletedModules(id: string, moduleIds: number[]): Promise<void> {\n    await db\n      .update(users)\n      .set({\n        completedModules: moduleIds,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, id));\n  }\n\n  async updateUserPassword(id: string, password: string): Promise<void> {\n    const { hashPassword } = await import('./localAuth');\n    const hashedPassword = await hashPassword(password);\n    await db\n      .update(users)\n      .set({ password: hashedPassword, updatedAt: new Date() })\n      .where(eq(users.id, id));\n  }\n\n\n\n  async setUserPassword(userId: string, password: string): Promise<void> {\n    const { hashPassword } = await import('./localAuth');\n    const hashedPassword = await hashPassword(password);\n    await db\n      .update(users)\n      .set({ password: hashedPassword, updatedAt: new Date() })\n      .where(eq(users.id, userId));\n  }\n\n  async assignStudentToTeacher(studentId: string, teacherId: string): Promise<void> {\n    await db\n      .update(users)\n      .set({ \n        assignedTeacherId: teacherId,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, studentId));\n  }\n\n  async removeStudentFromTeacher(studentId: string): Promise<void> {\n    await db\n      .update(users)\n      .set({ \n        assignedTeacherId: null,\n        updatedAt: new Date()\n      })\n      .where(eq(users.id, studentId));\n  }\n\n  async deleteUser(id: string): Promise<void> {\n    console.log(`üóëÔ∏è Starting comprehensive user deletion for: ${id}`);\n    \n    try {\n      // Delete in reverse dependency order to avoid foreign key violations\n      \n      // 1. Delete chat messages\n      const deletedMessages = await db.delete(chatMessages).where(eq(chatMessages.userId, id));\n      console.log(`Deleted ${deletedMessages.rowCount || 0} chat messages`);\n      \n      // 2. Delete module progress\n      await db.execute(sql`DELETE FROM module_progress WHERE user_id = ${id}`);\n      \n      // 3. Delete API calls\n      await db.execute(sql`DELETE FROM api_calls WHERE user_id = ${id}`);\n      \n      // 4. Delete admin messages (as sender)\n      await db.execute(sql`DELETE FROM admin_messages WHERE sender_id = ${id}`);\n      \n      // 5. Delete teacher-student relationships (both directions)\n      await db.execute(sql`DELETE FROM teacher_students WHERE teacher_id = ${id} OR student_id = ${id}`);\n      \n      // 6. Delete group memberships\n      await db.execute(sql`DELETE FROM group_members WHERE user_id = ${id}`);\n      \n      // 7. Delete project participations\n      await db.execute(sql`DELETE FROM project_participants WHERE user_id = ${id}`);\n      \n      // 8. Delete discussions authored by user\n      await db.execute(sql`DELETE FROM discussions WHERE author_id = ${id}`);\n      \n      // 9. Delete peer reviews (both as reviewer and reviewed)\n      await db.execute(sql`DELETE FROM peer_reviews WHERE reviewer_id = ${id} OR reviewed_user_id = ${id}`);\n      \n      // 10. Delete equipment manuals uploaded by user\n      await db.execute(sql`DELETE FROM equipment_manuals WHERE uploaded_by = ${id}`);\n      \n      // 11. Delete equipment models manufactured by user\n      await db.execute(sql`DELETE FROM equipment_models WHERE manufacturer_id = ${id}`);\n      \n      // 12. Handle community groups created by user (cascade delete)\n      const userGroups = await db.execute(sql`SELECT id FROM community_groups WHERE created_by = ${id}`);\n      for (const group of userGroups.rows) {\n        const groupId = group.id;\n        // Delete group members first\n        await db.execute(sql`DELETE FROM group_members WHERE group_id = ${groupId}`);\n        // Delete group projects and their participants\n        const groupProjects = await db.execute(sql`SELECT id FROM community_projects WHERE created_by = ${id}`);\n        for (const project of groupProjects.rows) {\n          await db.execute(sql`DELETE FROM project_participants WHERE project_id = ${project.id}`);\n        }\n        // Delete community projects\n        await db.execute(sql`DELETE FROM community_projects WHERE created_by = ${id}`);\n        // Finally delete the group\n        await db.execute(sql`DELETE FROM community_groups WHERE id = ${groupId}`);\n      }\n      \n      // 13. Update classes where user is assigned teacher (set to null)\n      await db.execute(sql`UPDATE classes SET assigned_teacher_id = NULL WHERE assigned_teacher_id = ${id}`);\n      \n      // 14. Finally delete the user\n      const deletedUser = await db.delete(users).where(eq(users.id, id));\n      \n      console.log(`‚úÖ User ${id} and all related data successfully deleted`);\n      \n    } catch (error) {\n      console.error(`‚ùå Error during user deletion:`, error);\n      throw error;\n    }\n  }\n\n  // Profession operations\n  async getProfessions(): Promise<Profession[]> {\n    return await db.select().from(professions).orderBy(professions.name);\n  }\n\n  async getProfession(id: number): Promise<Profession | undefined> {\n    const [profession] = await db.select().from(professions).where(eq(professions.id, id));\n    return profession;\n  }\n\n  async createProfession(professionData: InsertProfession): Promise<Profession> {\n    const [profession] = await db\n      .insert(professions)\n      .values(professionData)\n      .returning();\n    return profession;\n  }\n\n  async updateProfession(id: number, professionData: Partial<InsertProfession>): Promise<Profession> {\n    const [profession] = await db\n      .update(professions)\n      .set({ ...professionData, updatedAt: new Date() })\n      .where(eq(professions.id, id))\n      .returning();\n    return profession;\n  }\n\n  async deleteProfession(id: number): Promise<void> {\n    await db.delete(professions).where(eq(professions.id, id));\n  }\n\n  // Subject operations\n  async getSubjects(professionId?: number): Promise<Subject[]> {\n    if (professionId) {\n      return await db.select().from(subjects)\n        .where(eq(subjects.professionId, professionId))\n        .orderBy(subjects.name);\n    }\n    return await db.select().from(subjects).orderBy(subjects.name);\n  }\n\n  async getSubject(id: number): Promise<Subject | undefined> {\n    const [subject] = await db.select().from(subjects).where(eq(subjects.id, id));\n    return subject;\n  }\n\n  async createSubject(subjectData: InsertSubject): Promise<Subject> {\n    const [subject] = await db\n      .insert(subjects)\n      .values(subjectData)\n      .returning();\n    return subject;\n  }\n\n  async updateSubject(id: number, subjectData: Partial<InsertSubject>): Promise<Subject> {\n    const [subject] = await db\n      .update(subjects)\n      .set({ ...subjectData, updatedAt: new Date() })\n      .where(eq(subjects.id, id))\n      .returning();\n    return subject;\n  }\n\n  async deleteSubject(id: number): Promise<void> {\n    await db.delete(subjects).where(eq(subjects.id, id));\n  }\n\n  // Module operations\n  async getModules(subjectId?: number): Promise<Module[]> {\n    if (subjectId) {\n      return await db.select().from(modules)\n        .where(eq(modules.subjectId, subjectId))\n        .orderBy(modules.moduleNumber, modules.title);\n    }\n    return await db.select().from(modules).orderBy(modules.moduleNumber, modules.title);\n  }\n\n  async getPublishedModules(subjectId?: number): Promise<Module[]> {\n    if (subjectId) {\n      return await db\n        .select()\n        .from(modules)\n        .where(and(eq(modules.subjectId, subjectId), eq(modules.isPublished, true)))\n        .orderBy(modules.moduleNumber, modules.title);\n    }\n    return await db\n      .select()\n      .from(modules)\n      .where(eq(modules.isPublished, true))\n      .orderBy(modules.moduleNumber, modules.title);\n  }\n\n  async getModule(id: number): Promise<Module | undefined> {\n    const [module] = await db.select().from(modules).where(eq(modules.id, id));\n    return module;\n  }\n\n  async createModule(module: InsertModule): Promise<Module> {\n    const [newModule] = await db\n      .insert(modules)\n      .values(module)\n      .returning();\n    return newModule;\n  }\n\n  async updateModule(id: number, moduleData: Partial<InsertModule>): Promise<Module> {\n    const [module] = await db\n      .update(modules)\n      .set({ ...moduleData, updatedAt: new Date() })\n      .where(eq(modules.id, id))\n      .returning();\n    return module;\n  }\n\n  async deleteModule(id: number): Promise<void> {\n    await db.delete(modules).where(eq(modules.id, id));\n  }\n\n  // Chat operations\n  async getChatMessages(userId: string, moduleId?: number): Promise<ChatMessage[]> {\n    const conditions = [eq(chatMessages.userId, userId)];\n    if (moduleId) {\n      conditions.push(eq(chatMessages.relatedModuleId, moduleId));\n    }\n\n    return await db\n      .select()\n      .from(chatMessages)\n      .where(and(...conditions))\n      .orderBy(chatMessages.timestamp);\n  }\n\n  async createChatMessage(message: InsertChatMessage): Promise<ChatMessage> {\n    const [newMessage] = await db\n      .insert(chatMessages)\n      .values(message)\n      .returning();\n    return newMessage;\n  }\n\n  async deleteChatMessages(userId: string, moduleId?: number): Promise<void> {\n    if (moduleId !== undefined) {\n      // Delete messages for specific module\n      await db\n        .delete(chatMessages)\n        .where(and(\n          eq(chatMessages.userId, userId),\n          eq(chatMessages.relatedModuleId, moduleId)\n        ));\n    } else {\n      // Delete all messages for user\n      await db\n        .delete(chatMessages)\n        .where(eq(chatMessages.userId, userId));\n    }\n  }\n\n  // System settings operations\n  async getSystemSetting(key: string): Promise<SystemSetting | undefined> {\n    const [setting] = await db.select().from(systemSettings).where(eq(systemSettings.key, key));\n    return setting || undefined;\n  }\n\n  async setSystemSetting(key: string, value: string, updatedBy: string): Promise<SystemSetting> {\n    const [setting] = await db\n      .insert(systemSettings)\n      .values({\n        key,\n        value,\n        updatedBy,\n        updatedAt: new Date(),\n      })\n      .onConflictDoUpdate({\n        target: systemSettings.key,\n        set: {\n          value,\n          updatedBy,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return setting;\n  }\n\n  // AI settings operations\n  async getAISettings(): Promise<AISetting | undefined> {\n    const [settings] = await db.select().from(aiSettings).limit(1);\n    return settings || undefined;\n  }\n\n  async updateAISettings(settingsData: any, updatedBy: string): Promise<AISetting> {\n    // Check if AI settings exist\n    const existing = await this.getAISettings();\n    \n    if (existing) {\n      // Update existing settings\n      const [updated] = await db\n        .update(aiSettings)\n        .set({\n          ...settingsData,\n          updatedBy,\n          updatedAt: new Date(),\n        })\n        .where(eq(aiSettings.id, existing.id))\n        .returning();\n      return updated;\n    } else {\n      // Create new settings\n      const [created] = await db\n        .insert(aiSettings)\n        .values({\n          ...settingsData,\n          updatedBy,\n          updatedAt: new Date(),\n        })\n        .returning();\n      return created;\n    }\n  }\n\n  // Community operations\n  async getCommunityGroups(professionId?: number): Promise<CommunityGroup[]> {\n    if (professionId) {\n      return await db.select().from(communityGroups).where(eq(communityGroups.professionId, professionId));\n    }\n    return await db.select().from(communityGroups);\n  }\n\n  async getCommunityGroup(id: number): Promise<CommunityGroup | undefined> {\n    const [group] = await db.select().from(communityGroups).where(eq(communityGroups.id, id));\n    return group;\n  }\n\n  async createCommunityGroup(groupData: InsertCommunityGroup): Promise<CommunityGroup> {\n    const [group] = await db\n      .insert(communityGroups)\n      .values(groupData)\n      .returning();\n    return group;\n  }\n\n  async updateCommunityGroup(id: number, groupData: Partial<InsertCommunityGroup>, userId: string): Promise<CommunityGroup> {\n    // Check if user is the creator\n    const [existingGroup] = await db.select().from(communityGroups).where(eq(communityGroups.id, id));\n    if (!existingGroup || existingGroup.createdBy !== userId) {\n      throw new Error('Unauthorized to update this group');\n    }\n    \n    const [updatedGroup] = await db\n      .update(communityGroups)\n      .set({ ...groupData, updatedAt: new Date() })\n      .where(eq(communityGroups.id, id))\n      .returning();\n    return updatedGroup;\n  }\n\n  async deleteCommunityGroup(id: number, userId: string): Promise<void> {\n    // Check if user is the creator\n    const [existingGroup] = await db.select().from(communityGroups).where(eq(communityGroups.id, id));\n    if (!existingGroup || existingGroup.createdBy !== userId) {\n      throw new Error('Unauthorized to delete this group');\n    }\n    \n    // Delete all related data first\n    await db.delete(groupMembers).where(eq(groupMembers.groupId, id));\n    await db.delete(discussions).where(eq(discussions.groupId, id));\n    await db.delete(communityGroups).where(eq(communityGroups.id, id));\n  }\n\n  async joinCommunityGroup(groupId: number, userId: string): Promise<void> {\n    await db\n      .insert(groupMembers)\n      .values({ groupId, userId, role: 'member' });\n  }\n\n  async leaveCommunityGroup(groupId: number, userId: string): Promise<void> {\n    await db\n      .delete(groupMembers)\n      .where(and(eq(groupMembers.groupId, groupId), eq(groupMembers.userId, userId)));\n  }\n\n  async getGroupMembers(groupId: number): Promise<GroupMember[]> {\n    return await db.select().from(groupMembers).where(eq(groupMembers.groupId, groupId));\n  }\n\n  // Community projects\n  async getCommunityProjects(groupId?: number): Promise<CommunityProject[]> {\n    if (groupId) {\n      return await db.select().from(communityProjects).where(eq(communityProjects.groupId, groupId));\n    }\n    return await db.select().from(communityProjects);\n  }\n\n  async getCommunityProject(id: number): Promise<CommunityProject | undefined> {\n    const [project] = await db.select().from(communityProjects).where(eq(communityProjects.id, id));\n    return project;\n  }\n\n  async createCommunityProject(projectData: InsertCommunityProject): Promise<CommunityProject> {\n    const [project] = await db\n      .insert(communityProjects)\n      .values(projectData)\n      .returning();\n    return project;\n  }\n\n  async joinProject(projectId: number, userId: string): Promise<void> {\n    await db\n      .insert(projectParticipants)\n      .values({ projectId, userId, role: 'participant' });\n  }\n\n  async getProjectParticipants(projectId: number): Promise<ProjectParticipant[]> {\n    return await db.select().from(projectParticipants).where(eq(projectParticipants.projectId, projectId));\n  }\n\n  // Discussions\n  async getDiscussions(groupId?: number, projectId?: number): Promise<Discussion[]> {\n    if (groupId && projectId) {\n      return await db.select().from(discussions)\n        .where(and(eq(discussions.groupId, groupId), eq(discussions.projectId, projectId)))\n        .orderBy(desc(discussions.createdAt));\n    } else if (groupId) {\n      return await db.select().from(discussions)\n        .where(eq(discussions.groupId, groupId))\n        .orderBy(desc(discussions.createdAt));\n    } else if (projectId) {\n      return await db.select().from(discussions)\n        .where(eq(discussions.projectId, projectId))\n        .orderBy(desc(discussions.createdAt));\n    }\n    \n    return await db.select().from(discussions).orderBy(desc(discussions.createdAt));\n  }\n\n  async createDiscussion(discussionData: InsertDiscussion): Promise<Discussion> {\n    const [discussion] = await db\n      .insert(discussions)\n      .values(discussionData)\n      .returning();\n    return discussion;\n  }\n\n  // Peer reviews\n  async createPeerReview(reviewData: InsertPeerReview): Promise<PeerReview> {\n    const [review] = await db\n      .insert(peerReviews)\n      .values(reviewData)\n      .returning();\n    return review;\n  }\n\n  async getPeerReviews(projectId: number): Promise<PeerReview[]> {\n    return await db.select().from(peerReviews).where(eq(peerReviews.projectId, projectId));\n  }\n\n  // Admin messages\n  async createAdminMessage(messageData: InsertAdminMessage): Promise<AdminMessage> {\n    const [message] = await db\n      .insert(adminMessages)\n      .values(messageData)\n      .returning();\n    return message;\n  }\n\n  async getAdminMessages(): Promise<AdminMessage[]> {\n    return await db.select().from(adminMessages).orderBy(desc(adminMessages.createdAt));\n  }\n\n  async getUserAdminMessages(userId: string): Promise<AdminMessage[]> {\n    return await db.select().from(adminMessages)\n      .where(eq(adminMessages.senderId, userId))\n      .orderBy(desc(adminMessages.createdAt));\n  }\n\n  async respondToAdminMessage(messageId: number, response: string): Promise<AdminMessage> {\n    const [message] = await db\n      .update(adminMessages)\n      .set({\n        response,\n        isResolved: true,\n        respondedAt: new Date()\n      })\n      .where(eq(adminMessages.id, messageId))\n      .returning();\n    return message;\n  }\n\n  // Class operations\n  async getClassesBySchoolAdmin(schoolAdminId: string): Promise<Class[]> {\n    return await db\n      .select()\n      .from(classes)\n      .where(eq(classes.schoolAdminId, schoolAdminId))\n      .orderBy(classes.name);\n  }\n\n  async getClassById(classId: number): Promise<Class | undefined> {\n    const [classData] = await db\n      .select()\n      .from(classes)\n      .where(eq(classes.id, classId));\n    return classData;\n  }\n\n  async getStudentsByClass(classId: number): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .where(and(eq(users.classId, classId), eq(users.role, 'student')))\n      .orderBy(users.firstName, users.lastName, users.username);\n  }\n\n  async getStudentsBySchoolAdmin(schoolAdminId: string): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .where(and(eq(users.schoolAdminId, schoolAdminId), eq(users.role, 'student')))\n      .orderBy(users.firstName, users.lastName, users.username);\n  }\n\n  async getTeachersBySchoolAdmin(schoolAdminId: string): Promise<User[]> {\n    return await db\n      .select()\n      .from(users)\n      .where(and(eq(users.schoolAdminId, schoolAdminId), eq(users.role, 'teacher')))\n      .orderBy(users.firstName, users.lastName, users.username);\n  }\n\n  async createClass(classData: InsertClass): Promise<Class> {\n    const [newClass] = await db\n      .insert(classes)\n      .values(classData)\n      .returning();\n    return newClass;\n  }\n\n  async updateClass(id: number, classData: Partial<InsertClass>): Promise<Class> {\n    const [updatedClass] = await db\n      .update(classes)\n      .set({ ...classData, updatedAt: new Date() })\n      .where(eq(classes.id, id))\n      .returning();\n    return updatedClass;\n  }\n\n  async deleteClass(id: number): Promise<void> {\n    // Remove students from class first\n    await db\n      .update(users)\n      .set({ classId: null })\n      .where(eq(users.classId, id));\n    \n    // Delete the class\n    await db.delete(classes).where(eq(classes.id, id));\n  }\n\n  async assignStudentToClass(studentId: string, classId: number): Promise<void> {\n    await db\n      .update(users)\n      .set({ classId })\n      .where(eq(users.id, studentId));\n  }\n\n  async addStudentToClass(studentId: string, classId: number): Promise<void> {\n    await db\n      .update(users)\n      .set({ classId, updatedAt: new Date() })\n      .where(eq(users.id, studentId));\n  }\n\n  async removeStudentFromClass(studentId: string): Promise<void> {\n    await db\n      .update(users)\n      .set({ classId: null, updatedAt: new Date() })\n      .where(eq(users.id, studentId));\n  }\n\n  async assignTeacherToClass(teacherId: string, classId: number): Promise<void> {\n    await db\n      .update(users)\n      .set({ assignedTeacherId: teacherId, updatedAt: new Date() })\n      .where(eq(users.id, teacherId));\n  }\n\n  async assignProfessionToClass(classId: number, professionId: number): Promise<void> {\n    // Oszt√°lyhoz szakma hozz√°rendel√©se\n    await db\n      .update(classes)\n      .set({ professionId, updatedAt: new Date() })\n      .where(eq(classes.id, classId));\n    \n    // Az oszt√°lyban l√©v≈ë √∂sszes di√°k szakm√°j√°nak friss√≠t√©se\n    await db\n      .update(users)\n      .set({ selectedProfessionId: professionId, updatedAt: new Date() })\n      .where(eq(users.classId, classId));\n  }\n\n  async assignTeacherToClassById(classId: number, teacherId: string): Promise<void> {\n    // Tan√°r hozz√°rendel√©se oszt√°lyhoz\n    await db\n      .update(classes)\n      .set({ assignedTeacherId: teacherId, updatedAt: new Date() })\n      .where(eq(classes.id, classId));\n  }\n\n  async getClassWithProfession(classId: number): Promise<Class & { profession?: any } | undefined> {\n    const result = await db\n      .select({\n        id: classes.id,\n        name: classes.name,\n        description: classes.description,\n        schoolAdminId: classes.schoolAdminId,\n        assignedTeacherId: classes.assignedTeacherId,\n        professionId: classes.professionId,\n        createdAt: classes.createdAt,\n        updatedAt: classes.updatedAt,\n        profession: professions\n      })\n      .from(classes)\n      .leftJoin(professions, eq(classes.professionId, professions.id))\n      .where(eq(classes.id, classId))\n      .limit(1);\n    \n    return result[0] || undefined;\n  }\n\n  // Cost tracking operations\n  async logApiCall(callData: InsertApiCall): Promise<ApiCall> {\n    const [call] = await db\n      .insert(apiCalls)\n      .values(callData)\n      .returning();\n    return call;\n  }\n\n  async getApiCallStats(year?: number, month?: number): Promise<any> {\n    let baseQuery = db\n      .select({\n        provider: apiCalls.provider,\n        service: apiCalls.service,\n        totalCalls: sql<number>`count(*)::int`,\n        totalCost: sql<number>`sum(${apiCalls.costUsd})::float`,\n        totalTokens: sql<number>`sum(${apiCalls.tokenCount})::int`,\n      })\n      .from(apiCalls);\n\n    if (year && month) {\n      return await baseQuery\n        .where(\n          and(\n            sql`extract(year from ${apiCalls.createdAt}) = ${year}`,\n            sql`extract(month from ${apiCalls.createdAt}) = ${month}`\n          )\n        )\n        .groupBy(apiCalls.provider, apiCalls.service);\n    } else if (year) {\n      return await baseQuery\n        .where(sql`extract(year from ${apiCalls.createdAt}) = ${year}`)\n        .groupBy(apiCalls.provider, apiCalls.service);\n    }\n\n    return await baseQuery.groupBy(apiCalls.provider, apiCalls.service);\n  }\n\n  async getMonthlyCosts(year?: number): Promise<MonthlyCost[]> {\n    if (year) {\n      return await db\n        .select()\n        .from(monthlyCosts)\n        .where(eq(monthlyCosts.year, year))\n        .orderBy(desc(monthlyCosts.year), desc(monthlyCosts.month));\n    }\n    \n    return await db\n      .select()\n      .from(monthlyCosts)\n      .orderBy(desc(monthlyCosts.year), desc(monthlyCosts.month));\n  }\n\n  // Calculate monthly API costs from api_calls table\n  async calculateMonthlyApiCosts(year: number, month: number): Promise<number> {\n    try {\n      const result = await db\n        .select({\n          totalCost: sql<string>`COALESCE(SUM(CAST(${apiCalls.costUsd} AS DECIMAL)), 0)`\n        })\n        .from(apiCalls)\n        .where(\n          and(\n            sql`EXTRACT(YEAR FROM ${apiCalls.createdAt}) = ${year}`,\n            sql`EXTRACT(MONTH FROM ${apiCalls.createdAt}) = ${month}`\n          )\n        );\n      \n      return parseFloat(result[0]?.totalCost || '0');\n    } catch (error) {\n      console.error('Error calculating monthly API costs:', error);\n      return 0;\n    }\n  }\n\n  // Ensure current month cost entry exists\n  async ensureCurrentMonthCostEntry(): Promise<MonthlyCost> {\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = now.getMonth() + 1;\n\n    // Check if current month entry exists\n    const existing = await db\n      .select()\n      .from(monthlyCosts)\n      .where(\n        and(\n          eq(monthlyCosts.year, year),\n          eq(monthlyCosts.month, month)\n        )\n      );\n\n    if (existing.length > 0) {\n      // Update API costs for existing entry\n      const apiCosts = await this.calculateMonthlyApiCosts(year, month);\n      const existingEntry = existing[0];\n      const totalCosts = parseFloat(apiCosts.toString()) + \n                        parseFloat(existingEntry.developmentCosts?.toString() || '0') + \n                        parseFloat(existingEntry.infrastructureCosts?.toString() || '0') + \n                        parseFloat(existingEntry.otherCosts?.toString() || '0');\n\n      const [updated] = await db\n        .update(monthlyCosts)\n        .set({\n          apiCosts: apiCosts.toFixed(2),\n          totalCosts: totalCosts.toFixed(2),\n          updatedAt: new Date(),\n        })\n        .where(eq(monthlyCosts.id, existingEntry.id))\n        .returning();\n      return updated;\n    } else {\n      // Create new entry for current month\n      const apiCosts = await this.calculateMonthlyApiCosts(year, month);\n      const [inserted] = await db\n        .insert(monthlyCosts)\n        .values({\n          year,\n          month,\n          apiCosts: apiCosts.toFixed(2),\n          developmentCosts: '0.00',\n          infrastructureCosts: '0.00',\n          otherCosts: '0.00',\n          totalCosts: apiCosts.toFixed(2),\n          notes: 'Automatikusan l√©trehozva',\n        })\n        .returning();\n      return inserted;\n    }\n  }\n\n  // Get monthly cost by ID\n  async getMonthlyCostById(id: number): Promise<MonthlyCost | null> {\n    try {\n      const result = await db\n        .select()\n        .from(monthlyCosts)\n        .where(eq(monthlyCosts.id, id));\n      \n      return result[0] || null;\n    } catch (error) {\n      console.error('Error getting monthly cost by ID:', error);\n      return null;\n    }\n  }\n\n  // Update monthly cost\n  async updateMonthlyCost(id: number, updateData: Partial<InsertMonthlyCost>): Promise<MonthlyCost> {\n    const [updated] = await db\n      .update(monthlyCosts)\n      .set({\n        ...updateData,\n        updatedAt: new Date(),\n      })\n      .where(eq(monthlyCosts.id, id))\n      .returning();\n    return updated;\n  }\n\n  async upsertMonthlyCost(costData: InsertMonthlyCost): Promise<MonthlyCost> {\n    // Check if record exists\n    const existing = await db\n      .select()\n      .from(monthlyCosts)\n      .where(\n        and(\n          eq(monthlyCosts.year, costData.year),\n          eq(monthlyCosts.month, costData.month)\n        )\n      );\n\n    if (existing.length > 0) {\n      // Update existing record\n      const [updated] = await db\n        .update(monthlyCosts)\n        .set({\n          ...costData,\n          updatedAt: new Date(),\n        })\n        .where(eq(monthlyCosts.id, existing[0].id))\n        .returning();\n      return updated;\n    } else {\n      // Insert new record\n      const [inserted] = await db\n        .insert(monthlyCosts)\n        .values(costData)\n        .returning();\n      return inserted;\n    }\n  }\n\n  async calculateMonthlyApiCosts(year: number, month: number): Promise<number> {\n    const result = await db\n      .select({\n        total: sql<number>`sum(${apiCalls.costUsd})::float`\n      })\n      .from(apiCalls)\n      .where(\n        and(\n          sql`extract(year from ${apiCalls.createdAt}) = ${year}`,\n          sql`extract(month from ${apiCalls.createdAt}) = ${month}`\n        )\n      );\n\n    return result[0]?.total || 0;\n  }\n\n  // API pricing operations\n  async getApiPricing(): Promise<ApiPricing[]> {\n    return await db\n      .select()\n      .from(apiPricing)\n      .where(eq(apiPricing.isActive, true))\n      .orderBy(apiPricing.provider, apiPricing.service);\n  }\n\n  async upsertApiPricing(pricingData: InsertApiPricing): Promise<ApiPricing> {\n    // Check if record exists\n    const existing = await db\n      .select()\n      .from(apiPricing)\n      .where(\n        and(\n          eq(apiPricing.provider, pricingData.provider),\n          eq(apiPricing.service, pricingData.service),\n          pricingData.model ? eq(apiPricing.model, pricingData.model) : isNull(apiPricing.model)\n        )\n      );\n\n    if (existing.length > 0) {\n      // Update existing record\n      const [updated] = await db\n        .update(apiPricing)\n        .set({\n          ...pricingData,\n          updatedAt: new Date(),\n        })\n        .where(eq(apiPricing.id, existing[0].id))\n        .returning();\n      return updated;\n    } else {\n      // Insert new record\n      const [inserted] = await db\n        .insert(apiPricing)\n        .values(pricingData)\n        .returning();\n      return inserted;\n    }\n  }\n\n  async deleteApiPricing(id: number): Promise<void> {\n    await db\n      .update(apiPricing)\n      .set({ isActive: false })\n      .where(eq(apiPricing.id, id));\n  }\n\n  async getUniqueApiProviders(): Promise<{provider: string, service: string, model?: string}[]> {\n    const result = await db\n      .selectDistinct({\n        provider: apiCalls.provider,\n        service: apiCalls.service,\n        model: apiCalls.model,\n      })\n      .from(apiCalls)\n      .orderBy(apiCalls.provider, apiCalls.service);\n\n    return result;\n  }\n\n  // API Call tracking for AI regeneration\n  async recordSimpleApiCall(provider: string, service: string, estimatedCost: number = 0.01): Promise<void> {\n    try {\n      // Record actual API call in database\n      await db.insert(apiCalls).values({\n        provider: provider,\n        service: service,\n        model: provider === 'openai' ? 'gpt-4o-mini' : (provider === 'gemini' ? 'gemini-pro' : null),\n        tokenCount: Math.floor(Math.random() * 1000) + 500, // Estimated token count\n        costUsd: estimatedCost.toFixed(4),\n        userId: null,\n        moduleId: null,\n        requestData: { type: 'ai_generation', service: service },\n        responseData: { success: true, provider: provider },\n        createdAt: new Date()\n      });\n      \n      console.log(`üí∞ API call recorded in database: ${provider}/${service} - $${estimatedCost.toFixed(4)}`);\n    } catch (error) {\n      console.error('Failed to record API call in database:', error);\n      // Fallback to console logging\n      console.log(`üí∞ AI Cost Tracked (console only): ${provider}/${service} - $${estimatedCost.toFixed(4)}`);\n    }\n  }\n\n  async calculateApiCost(provider: string, service: string, model: string | null, inputTokens: number, outputTokens: number): Promise<number> {\n    try {\n      const pricing = await db\n        .select()\n        .from(apiPricing)\n        .where(\n          and(\n            eq(apiPricing.provider, provider),\n            eq(apiPricing.service, service),\n            model ? eq(apiPricing.model, model) : sql`${apiPricing.model} IS NULL`,\n            eq(apiPricing.isActive, true)\n          )\n        )\n        .limit(1);\n\n      if (pricing.length === 0) {\n        console.log(`No pricing found for ${provider}/${service}/${model || 'null'}`);\n        return 0;\n      }\n\n      const price = pricing[0];\n      let cost = 0;\n\n      if (price.pricingType === 'token') {\n        if (price.inputTokenPrice && inputTokens > 0) {\n          cost += (inputTokens / 1000) * parseFloat(price.inputTokenPrice);\n        }\n        if (price.outputTokenPrice && outputTokens > 0) {\n          cost += (outputTokens / 1000) * parseFloat(price.outputTokenPrice);\n        }\n      } else if (price.pricingType === 'request' && price.requestPrice) {\n        cost = parseFloat(price.requestPrice);\n      }\n\n      return cost;\n    } catch (error) {\n      console.error('Failed to calculate API cost:', error);\n      return 0;\n    }\n  }\n\n  // Privacy and GDPR compliance operations\n  async saveUserConsent(consent: InsertUserConsent): Promise<UserConsent> {\n    const [savedConsent] = await db\n      .insert(userConsents)\n      .values(consent)\n      .returning();\n    return savedConsent;\n  }\n\n  async getUserConsents(userId?: string, sessionId?: string): Promise<UserConsent[]> {\n    const conditions = [];\n    if (userId) conditions.push(eq(userConsents.userId, userId));\n    if (sessionId) conditions.push(eq(userConsents.sessionId, sessionId));\n    \n    if (conditions.length === 0) {\n      return await db.select().from(userConsents).orderBy(desc(userConsents.createdAt));\n    }\n    \n    return await db.select().from(userConsents)\n      .where(and(...conditions))\n      .orderBy(desc(userConsents.createdAt));\n  }\n\n  async createPrivacyRequest(request: InsertPrivacyRequest): Promise<PrivacyRequest> {\n    const [savedRequest] = await db\n      .insert(privacyRequests)\n      .values(request)\n      .returning();\n    return savedRequest;\n  }\n\n  async getPrivacyRequests(email?: string): Promise<PrivacyRequest[]> {\n    if (email) {\n      return await db.select().from(privacyRequests)\n        .where(eq(privacyRequests.email, email))\n        .orderBy(desc(privacyRequests.createdAt));\n    }\n    return await db.select().from(privacyRequests).orderBy(desc(privacyRequests.createdAt));\n  }\n\n  async getPrivacyRequest(id: number): Promise<PrivacyRequest | undefined> {\n    const [request] = await db.select().from(privacyRequests).where(eq(privacyRequests.id, id));\n    return request;\n  }\n\n  async updatePrivacyRequestStatus(id: number, status: string, responseData?: any, processedBy?: string): Promise<PrivacyRequest> {\n    const updateData: Partial<InsertPrivacyRequest> = {\n      status,\n      responseData,\n      processedBy\n    };\n\n    if (status === 'completed') {\n      updateData.completedAt = new Date();\n    }\n\n    const [updatedRequest] = await db\n      .update(privacyRequests)\n      .set(updateData)\n      .where(eq(privacyRequests.id, id))\n      .returning();\n    \n    return updatedRequest;\n  }\n\n  async exportUserData(userId: string): Promise<any> {\n    try {\n      // Get user data\n      const userData = await this.getUser(userId);\n      if (!userData) return null;\n\n      // Get chat messages\n      const chatMessages = await this.getChatMessages(userId);\n      \n      // Get API calls\n      const apiCalls = await db.select().from(apiCalls).where(eq(apiCalls.userId, userId));\n      \n      // Get consents\n      const consents = await this.getUserConsents(userId);\n      \n      // Get privacy requests\n      const requests = await this.getPrivacyRequests(userData.email || '');\n\n      return {\n        user: userData,\n        chatMessages,\n        apiCalls,\n        consents,\n        privacyRequests: requests,\n        exportedAt: new Date().toISOString(),\n        exportFormat: 'JSON'\n      };\n    } catch (error) {\n      console.error('Failed to export user data:', error);\n      throw error;\n    }\n  }\n\n  async deleteUserPersonalData(userId: string): Promise<void> {\n    // This is the same as the existing deleteUser method\n    // but explicitly named for GDPR compliance\n    await this.deleteUser(userId);\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":49002},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2254},"shared/schema.ts":{"content":"import {\n  pgTable,\n  text,\n  varchar,\n  timestamp,\n  jsonb,\n  index,\n  integer,\n  serial,\n  boolean,\n  numeric,\n} from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table (required for Replit Auth)\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table (supports both Replit Auth and local auth)\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().notNull(),\n  username: varchar(\"username\").unique(), // for local auth\n  password: varchar(\"password\"), // for local auth (hashed)\n  email: varchar(\"email\").unique(),\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  role: varchar(\"role\").notNull().default(\"student\"), // \"student\", \"teacher\", \"admin\", or \"school_admin\"\n  authType: varchar(\"auth_type\").notNull().default(\"replit\"), // \"replit\" or \"local\"\n  selectedProfessionId: integer(\"selected_profession_id\").references(() => professions.id),\n  assignedProfessionIds: jsonb(\"assigned_profession_ids\").default([]).$type<number[]>(), // Admin √°ltal hozz√°rendelt szakm√°k\n  assignedTeacherId: varchar(\"assigned_teacher_id\"), // Iskolai admin √°ltal hozz√°rendelt tan√°r\n  schoolName: varchar(\"school_name\"), // Iskola neve (csak iskolai adminoknak)\n  schoolAdminId: varchar(\"school_admin_id\"), // Melyik iskolai admin hozta l√©tre\n  classId: integer(\"class_id\"), // Melyik oszt√°lyhoz tartozik\n  completedModules: jsonb(\"completed_modules\").default([]).$type<number[]>(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Professions table - szakm√°k (pl. Hegeszt≈ë)\nexport const professions = pgTable(\"professions\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  iconName: varchar(\"icon_name\"), // Lucide icon name (pl. \"wrench\", \"hammer\", \"cpu\")\n  iconUrl: varchar(\"icon_url\"), // Felt√∂lt√∂tt k√©p URL\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Subjects table - tant√°rgyak egy szakm√°n bel√ºl (pl. Anyagismeret, G√©p√©szet)\nexport const subjects = pgTable(\"subjects\", {\n  id: serial(\"id\").primaryKey(),\n  professionId: integer(\"profession_id\").references(() => professions.id).notNull(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  orderIndex: integer(\"order_index\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Modules table - modulok egy tant√°rgyon bel√ºl (pl. K√©miai tulajdons√°gok)\nexport const modules = pgTable(\"modules\", {\n  id: serial(\"id\").primaryKey(),\n  subjectId: integer(\"subject_id\").references(() => subjects.id).notNull(),\n  title: varchar(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  conciseContent: text(\"concise_content\"), // T√∂m√∂r verzi√≥\n  detailedContent: text(\"detailed_content\"), // B≈ëv√≠tett verzi√≥\n  keyConceptsData: jsonb(\"key_concepts_data\"), // JSON struktura a kulcsfogalmakhoz √©s vide√≥khoz\n  moduleNumber: integer(\"module_number\").notNull(),\n  videoUrl: varchar(\"video_url\"), // Felt√∂lt√∂tt vide√≥ vagy YouTube URL\n  audioUrl: varchar(\"audio_url\"), // Felt√∂lt√∂tt podcast/hang f√°jl\n  imageUrl: varchar(\"image_url\"), // Modul bor√≠t√≥k√©p\n  youtubeUrl: varchar(\"youtube_url\"), // YouTube vide√≥ URL\n  podcastUrl: varchar(\"podcast_url\"), // K√ºls≈ë podcast URL\n  isPublished: boolean(\"is_published\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Chat messages table\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: serial(\"id\").primaryKey(),\n  message: text(\"message\").notNull(),\n  senderRole: varchar(\"sender_role\").notNull(), // \"user\" or \"ai\"\n  userId: varchar(\"user_id\").notNull().references(() => users.id),\n  relatedModuleId: integer(\"related_module_id\").references(() => modules.id),\n  isSystemMessage: boolean(\"is_system_message\").default(false), // jelzi, hogy rendszer √ºzenet-e\n  timestamp: timestamp(\"timestamp\").defaultNow(),\n});\n\n// Relations\nexport const usersRelations = relations(users, ({ one, many }) => ({\n  selectedProfession: one(professions, { fields: [users.selectedProfessionId], references: [professions.id] }),\n  chatMessages: many(chatMessages),\n  assignedClass: one(classes, { fields: [users.classId], references: [classes.id] }),\n}));\n\nexport const professionsRelations = relations(professions, ({ many }) => ({\n  subjects: many(subjects),\n}));\n\nexport const subjectsRelations = relations(subjects, ({ one, many }) => ({\n  profession: one(professions, { fields: [subjects.professionId], references: [professions.id] }),\n  modules: many(modules),\n}));\n\nexport const modulesRelations = relations(modules, ({ one, many }) => ({\n  subject: one(subjects, { fields: [modules.subjectId], references: [subjects.id] }),\n  chatMessages: many(chatMessages),\n}));\n\nexport const chatMessagesRelations = relations(chatMessages, ({ one }) => ({\n  user: one(users, {\n    fields: [chatMessages.userId],\n    references: [users.id],\n  }),\n  relatedModule: one(modules, {\n    fields: [chatMessages.relatedModuleId],\n    references: [modules.id],\n  }),\n}));\n\n// System settings table for storing API keys and configurations\nexport const systemSettings = pgTable(\"system_settings\", {\n  id: serial(\"id\").primaryKey(),\n  key: varchar(\"key\").unique().notNull(),\n  value: text(\"value\"),\n  encrypted: boolean(\"encrypted\").default(false),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n  updatedBy: varchar(\"updated_by\"),\n});\n\n// AI settings table for OpenAI configuration\nexport const aiSettings = pgTable(\"ai_settings\", {\n  id: serial(\"id\").primaryKey(),\n  maxTokens: integer(\"max_tokens\").default(2000).notNull(),\n  temperature: text(\"temperature\").default(\"0.7\").notNull(),\n  model: varchar(\"model\", { length: 100 }).default(\"gpt-4o-mini\").notNull(),\n  systemMessage: text(\"system_message\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  updatedBy: varchar(\"updated_by\", { length: 255 }).notNull(),\n});\n\n// Community groups for collaborative learning\nexport const communityGroups = pgTable(\"community_groups\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull(),\n  description: text(\"description\"),\n  professionId: integer(\"profession_id\").references(() => professions.id),\n  createdBy: varchar(\"created_by\").references(() => users.id).notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  memberLimit: integer(\"member_limit\").default(50),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Group membership table\nexport const groupMembers = pgTable(\"group_members\", {\n  id: serial(\"id\").primaryKey(),\n  groupId: integer(\"group_id\").references(() => communityGroups.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\").default(\"member\"), // \"admin\", \"moderator\", \"member\"\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n});\n\n// Community projects for collaborative learning\nexport const communityProjects = pgTable(\"community_projects\", {\n  id: serial(\"id\").primaryKey(),\n  title: varchar(\"title\").notNull(),\n  description: text(\"description\"),\n  groupId: integer(\"group_id\").references(() => communityGroups.id).notNull(),\n  moduleId: integer(\"module_id\").references(() => modules.id),\n  createdBy: varchar(\"created_by\").references(() => users.id).notNull(),\n  status: varchar(\"status\").default(\"active\"), // \"active\", \"completed\", \"cancelled\"\n  dueDate: timestamp(\"due_date\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Project participants\nexport const projectParticipants = pgTable(\"project_participants\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => communityProjects.id).notNull(),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  role: varchar(\"role\").default(\"participant\"), // \"lead\", \"participant\"\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n});\n\n// Discussion threads for groups and projects\nexport const discussions = pgTable(\"discussions\", {\n  id: serial(\"id\").primaryKey(),\n  title: varchar(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  authorId: varchar(\"author_id\").references(() => users.id).notNull(),\n  groupId: integer(\"group_id\").references(() => communityGroups.id),\n  projectId: integer(\"project_id\").references(() => communityProjects.id),\n  parentId: integer(\"parent_id\"), // Self-reference handled separately\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Peer reviews and feedback\nexport const peerReviews = pgTable(\"peer_reviews\", {\n  id: serial(\"id\").primaryKey(),\n  projectId: integer(\"project_id\").references(() => communityProjects.id).notNull(),\n  reviewerId: varchar(\"reviewer_id\").references(() => users.id).notNull(),\n  reviewedUserId: varchar(\"reviewed_user_id\").references(() => users.id).notNull(),\n  rating: integer(\"rating\"), // 1-5 stars\n  feedback: text(\"feedback\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Admin messages from students\nexport const adminMessages = pgTable(\"admin_messages\", {\n  id: serial(\"id\").primaryKey(),\n  senderId: varchar(\"sender_id\").references(() => users.id).notNull(),\n  subject: varchar(\"subject\", { length: 255 }).notNull(),\n  message: text(\"message\").notNull(),\n  response: text(\"response\"),\n  isResolved: boolean(\"is_resolved\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  respondedAt: timestamp(\"responded_at\"),\n});\n\n// Classes table for school admin organization\nexport const classes = pgTable(\"classes\", {\n  id: serial(\"id\").primaryKey(),\n  name: varchar(\"name\").notNull(), // pl. \"9.A\", \"Hegeszt≈ë 2024\"\n  description: text(\"description\"), // Oszt√°ly le√≠r√°sa\n  schoolAdminId: varchar(\"school_admin_id\").references(() => users.id).notNull(), // Melyik iskolai admin hozta l√©tre\n  assignedTeacherId: varchar(\"assigned_teacher_id\").references(() => users.id), // Oszt√°lyf≈ën√∂k\n  professionId: integer(\"profession_id\").references(() => professions.id), // Oszt√°lyhoz rendelt szakma\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  email: true,\n  firstName: true,\n  lastName: true,\n  profileImageUrl: true,\n  role: true,\n  authType: true,\n});\n\n// Schema for local user registration\nexport const localUserRegisterSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n  firstName: true,\n  lastName: true,\n}).extend({\n  email: z.string().email(\"√ârv√©nyes email c√≠met adj meg\"),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"A jelszavak nem egyeznek\",\n  path: [\"confirmPassword\"],\n});\n\n// Schema for local user login\nexport const localUserLoginSchema = z.object({\n  username: z.string().min(1, \"Felhaszn√°l√≥n√©v sz√ºks√©ges\"),\n  password: z.string().min(1, \"Jelsz√≥ sz√ºks√©ges\"),\n});\n\n// API Cost Tracking tables\nexport const apiCalls = pgTable(\"api_calls\", {\n  id: serial(\"id\").primaryKey(),\n  provider: varchar(\"provider\").notNull(), // \"openai\", \"google\", \"youtube\", \"wikipedia\", etc.\n  service: varchar(\"service\").notNull(), // \"chat\", \"tts\", \"search\", \"video_search\", etc.\n  model: varchar(\"model\"), // \"gpt-4\", \"gemini-pro\", etc.\n  tokenCount: integer(\"token_count\").default(0),\n  costUsd: numeric(\"cost_usd\", { precision: 10, scale: 6 }).notNull(), // Cost in USD with 6 decimal precision\n  userId: varchar(\"user_id\").references(() => users.id),\n  moduleId: integer(\"module_id\").references(() => modules.id),\n  requestData: jsonb(\"request_data\"), // Store request details for analysis\n  responseData: jsonb(\"response_data\"), // Store response details for analysis\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const monthlyCosts = pgTable(\"monthly_costs\", {\n  id: serial(\"id\").primaryKey(),\n  year: integer(\"year\").notNull(),\n  month: integer(\"month\").notNull(), // 1-12\n  apiCosts: numeric(\"api_costs\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  developmentCosts: numeric(\"development_costs\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  infrastructureCosts: numeric(\"infrastructure_costs\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  otherCosts: numeric(\"other_costs\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  totalCosts: numeric(\"total_costs\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Cost tracking types\nexport type ApiCall = typeof apiCalls.$inferSelect;\nexport type InsertApiCall = typeof apiCalls.$inferInsert;\n\nexport type MonthlyCost = typeof monthlyCosts.$inferSelect;\nexport type InsertMonthlyCost = typeof monthlyCosts.$inferInsert;\n\nexport const insertApiCallSchema = createInsertSchema(apiCalls);\nexport const insertMonthlyCostSchema = createInsertSchema(monthlyCosts);\n\n// API pricing configuration table\nexport const apiPricing = pgTable(\"api_pricing\", {\n  id: serial(\"id\").primaryKey(),\n  provider: varchar(\"provider\", { length: 50 }).notNull(),\n  service: varchar(\"service\", { length: 50 }).notNull(),\n  model: varchar(\"model\", { length: 100 }),\n  pricePerToken: text(\"price_per_token\").default(\"0.00000000\"),\n  pricePerRequest: text(\"price_per_request\").default(\"0.000000\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport type ApiPricing = typeof apiPricing.$inferSelect;\nexport type InsertApiPricing = typeof apiPricing.$inferInsert;\n\nexport const insertApiPricingSchema = createInsertSchema(apiPricing);\n\nexport const insertProfessionSchema = createInsertSchema(professions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSubjectSchema = createInsertSchema(subjects).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Type definitions for key concepts data structure\nexport const youtubeVideoSchema = z.object({\n  title: z.string(),\n  videoId: z.string(),\n  description: z.string(),\n  url: z.string(),\n});\n\n// Wikipedia link schema\nexport const wikipediaLinkSchema = z.object({\n  text: z.string(),\n  url: z.string(),\n  description: z.string().optional(),\n});\n\nexport const keyConceptSchema = z.object({\n  concept: z.string(),\n  definition: z.string(),\n  youtubeVideos: z.array(youtubeVideoSchema),\n  wikipediaLinks: z.array(wikipediaLinkSchema).optional(),\n});\n\nexport const keyConceptsDataSchema = z.array(keyConceptSchema);\n\nexport const insertModuleSchema = createInsertSchema(modules).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  youtubeUrl: z.string().optional().nullable(),\n  podcastUrl: z.string().optional().nullable(),\n  keyConceptsData: keyConceptsDataSchema.optional().nullable(),\n});\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  timestamp: true,\n});\n\n// Community relations (after all table declarations)\nexport const communityGroupsRelations = relations(communityGroups, ({ one, many }) => ({\n  profession: one(professions, { fields: [communityGroups.professionId], references: [professions.id] }),\n  creator: one(users, { fields: [communityGroups.createdBy], references: [users.id] }),\n  members: many(groupMembers),\n  projects: many(communityProjects),\n  discussions: many(discussions),\n}));\n\nexport const groupMembersRelations = relations(groupMembers, ({ one }) => ({\n  group: one(communityGroups, { fields: [groupMembers.groupId], references: [communityGroups.id] }),\n  user: one(users, { fields: [groupMembers.userId], references: [users.id] }),\n}));\n\nexport const communityProjectsRelations = relations(communityProjects, ({ one, many }) => ({\n  group: one(communityGroups, { fields: [communityProjects.groupId], references: [communityGroups.id] }),\n  module: one(modules, { fields: [communityProjects.moduleId], references: [modules.id] }),\n  creator: one(users, { fields: [communityProjects.createdBy], references: [users.id] }),\n  participants: many(projectParticipants),\n  discussions: many(discussions),\n  reviews: many(peerReviews),\n}));\n\nexport const projectParticipantsRelations = relations(projectParticipants, ({ one }) => ({\n  project: one(communityProjects, { fields: [projectParticipants.projectId], references: [communityProjects.id] }),\n  user: one(users, { fields: [projectParticipants.userId], references: [users.id] }),\n}));\n\nexport const discussionsRelations = relations(discussions, ({ one, many }) => ({\n  author: one(users, { fields: [discussions.authorId], references: [users.id] }),\n  group: one(communityGroups, { fields: [discussions.groupId], references: [communityGroups.id] }),\n  project: one(communityProjects, { fields: [discussions.projectId], references: [communityProjects.id] }),\n  parent: one(discussions, { fields: [discussions.parentId], references: [discussions.id] }),\n  replies: many(discussions),\n}));\n\nexport const peerReviewsRelations = relations(peerReviews, ({ one }) => ({\n  project: one(communityProjects, { fields: [peerReviews.projectId], references: [communityProjects.id] }),\n  reviewer: one(users, { fields: [peerReviews.reviewerId], references: [users.id] }),\n  reviewedUser: one(users, { fields: [peerReviews.reviewedUserId], references: [users.id] }),\n}));\n\nexport const adminMessagesRelations = relations(adminMessages, ({ one }) => ({\n  sender: one(users, { fields: [adminMessages.senderId], references: [users.id] }),\n}));\n\nexport const classesRelations = relations(classes, ({ one, many }) => ({\n  schoolAdmin: one(users, { fields: [classes.schoolAdminId], references: [users.id] }),\n  assignedTeacher: one(users, { fields: [classes.assignedTeacherId], references: [users.id] }),\n  profession: one(professions, { fields: [classes.professionId], references: [professions.id] }),\n  students: many(users),\n}));\n\n// Community schemas\nexport const insertCommunityGroupSchema = createInsertSchema(communityGroups).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCommunityProjectSchema = createInsertSchema(communityProjects).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertDiscussionSchema = createInsertSchema(discussions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPeerReviewSchema = createInsertSchema(peerReviews).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertAdminMessageSchema = createInsertSchema(adminMessages).omit({\n  id: true,\n  createdAt: true,\n  respondedAt: true,\n  isResolved: true,\n  response: true,\n});\n\nexport const insertClassSchema = createInsertSchema(classes).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Types\nexport type UpsertUser = typeof users.$inferInsert;\nexport type User = typeof users.$inferSelect;\nexport type InsertProfession = z.infer<typeof insertProfessionSchema>;\nexport type Class = typeof classes.$inferSelect;\nexport type InsertClass = z.infer<typeof insertClassSchema>;\nexport type Profession = typeof professions.$inferSelect;\nexport type InsertSubject = z.infer<typeof insertSubjectSchema>;\nexport type Subject = typeof subjects.$inferSelect;\nexport type InsertModule = z.infer<typeof insertModuleSchema>;\nexport type Module = typeof modules.$inferSelect;\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\nexport type ChatMessage = typeof chatMessages.$inferSelect;\nexport type YoutubeVideo = z.infer<typeof youtubeVideoSchema>;\nexport type WikipediaLink = z.infer<typeof wikipediaLinkSchema>;\nexport type KeyConcept = z.infer<typeof keyConceptSchema>;\nexport type KeyConceptsData = z.infer<typeof keyConceptsDataSchema>;\n\n// Community types\nexport type CommunityGroup = typeof communityGroups.$inferSelect;\nexport type InsertCommunityGroup = z.infer<typeof insertCommunityGroupSchema>;\nexport type GroupMember = typeof groupMembers.$inferSelect;\nexport type CommunityProject = typeof communityProjects.$inferSelect;\nexport type InsertCommunityProject = z.infer<typeof insertCommunityProjectSchema>;\nexport type ProjectParticipant = typeof projectParticipants.$inferSelect;\nexport type Discussion = typeof discussions.$inferSelect;\nexport type InsertDiscussion = z.infer<typeof insertDiscussionSchema>;\nexport type PeerReview = typeof peerReviews.$inferSelect;\nexport type InsertPeerReview = z.infer<typeof insertPeerReviewSchema>;\nexport type AdminMessage = typeof adminMessages.$inferSelect;\nexport type InsertAdminMessage = z.infer<typeof insertAdminMessageSchema>;\n\nexport type SystemSetting = typeof systemSettings.$inferSelect;\nexport type InsertSystemSetting = typeof systemSettings.$inferInsert;\n\nexport type AISetting = typeof aiSettings.$inferSelect;\nexport type InsertAISetting = typeof aiSettings.$inferInsert;\n\n// AI settings schema for validation\nexport const insertAISettingsSchema = z.object({\n  maxTokens: z.number().min(100).max(4000).default(2000),\n  temperature: z.string().default(\"0.7\"),\n  model: z.string().default(\"gpt-4o-mini\"),\n  systemMessage: z.string().optional(),\n});\n\n// Privacy compliance tables\nexport const userConsents = pgTable(\"user_consents\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  sessionId: varchar(\"session_id\"), // For users not yet registered\n  consentType: varchar(\"consent_type\").notNull(), // \"cookies\", \"analytics\", \"marketing\", \"data_processing\"\n  consentValue: boolean(\"consent_value\").notNull(),\n  consentSource: varchar(\"consent_source\").default(\"website\"), // \"website\", \"email\", \"phone\"\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const privacyRequests = pgTable(\"privacy_requests\", {\n  id: serial(\"id\").primaryKey(),\n  userId: varchar(\"user_id\").references(() => users.id),\n  email: varchar(\"email\").notNull(),\n  requestType: varchar(\"request_type\").notNull(), // \"data_export\", \"data_deletion\", \"data_correction\", \"restrict_processing\"\n  status: varchar(\"status\").notNull().default(\"pending\"), // \"pending\", \"in_progress\", \"completed\", \"rejected\"\n  requestData: jsonb(\"request_data\"), // Additional request details\n  responseData: jsonb(\"response_data\"), // Response/completion details\n  processedBy: varchar(\"processed_by\"), // Admin who processed the request\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const dataProcessingActivities = pgTable(\"data_processing_activities\", {\n  id: serial(\"id\").primaryKey(),\n  activityName: varchar(\"activity_name\").notNull(),\n  purpose: text(\"purpose\").notNull(),\n  legalBasis: varchar(\"legal_basis\").notNull(), // \"consent\", \"contract\", \"legal_obligation\", \"legitimate_interest\"\n  dataCategories: text(\"data_categories\").array(), // [\"personal_data\", \"sensitive_data\", \"technical_data\"]\n  dataSubjects: text(\"data_subjects\").array(), // [\"students\", \"teachers\", \"admins\"]\n  recipients: text(\"recipients\").array(), // Who has access to this data\n  retentionPeriod: varchar(\"retention_period\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Privacy compliance types and schemas\nexport type UserConsent = typeof userConsents.$inferSelect;\nexport type InsertUserConsent = typeof userConsents.$inferInsert;\nexport type PrivacyRequest = typeof privacyRequests.$inferSelect;\nexport type InsertPrivacyRequest = typeof privacyRequests.$inferInsert;\nexport type DataProcessingActivity = typeof dataProcessingActivities.$inferSelect;\nexport type InsertDataProcessingActivity = typeof dataProcessingActivities.$inferInsert;\n\nexport const insertUserConsentSchema = createInsertSchema(userConsents);\nexport const insertPrivacyRequestSchema = createInsertSchema(privacyRequests);\nexport const insertDataProcessingActivitySchema = createInsertSchema(dataProcessingActivities);\n","size_bytes":24571},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/components/theme-provider\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { VoiceNavigation } from \"@/components/voice-navigation\";\n\nimport NotFound from \"@/pages/not-found\";\nimport Landing from \"@/pages/landing-futuristic-fixed\";\nimport StudentDashboard from \"@/pages/student-dashboard\";\nimport AdminDashboard from \"@/pages/admin-dashboard\";\nimport ModuleViewer from \"@/pages/module-viewer\";\nimport ProfessionSelection from \"@/pages/profession-selection\";\nimport PlatformInfo from \"@/pages/platform-info\";\nimport Learning from \"@/pages/learning\";\nimport ProgressPage from \"@/pages/progress\";\n\nimport SettingsPage from \"@/pages/settings\";\nimport AdminLogin from \"@/pages/admin-login\";\nimport StudentAuth from \"@/pages/student-auth\";\nimport TeacherAuth from \"@/pages/teacher-auth\";\nimport TeacherDashboard from \"@/pages/teacher-dashboard\";\nimport SchoolAdminAuth from \"@/pages/school-admin-auth\";\nimport SchoolAdminDashboard from \"@/pages/school-admin-dashboard\";\nimport ModulesPage from \"@/pages/modules\";\nimport SubjectsPage from \"@/pages/subjects\";\nimport HomePage from \"@/pages/home\";\nimport TananyagokPage from \"@/pages/tananyagok\";\nimport CommunityLearning from \"@/pages/community-learning\";\nimport MermaidTest from \"@/pages/mermaid-test\";\nimport ChatPage from \"@/pages/chat\";\nimport PrivacyPolicy from \"@/pages/privacy-policy\";\nimport PrivacyRequests from \"@/pages/privacy-requests\";\nimport CookieBanner from \"@/components/cookie-banner\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading, user } = useAuth();\n  const [location, navigate] = useLocation();\n\n  const handleNavigation = (path: string) => {\n    navigate(path);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-neutral-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <Switch>\n      {/* Always accessible routes */}\n      <Route path=\"/admin-login\" component={AdminLogin} />\n      <Route path=\"/student-auth\" component={StudentAuth} />\n      <Route path=\"/teacher-auth\" component={TeacherAuth} />\n      <Route path=\"/school-admin-auth\" component={SchoolAdminAuth} />\n      <Route path=\"/school-admin-dashboard\" component={SchoolAdminDashboard} />\n      <Route path=\"/privacy-policy\" component={PrivacyPolicy} />\n      <Route path=\"/privacy-requests\" component={PrivacyRequests} />\n      \n      {!isAuthenticated ? (\n        <Route path=\"/\" component={Landing} />\n      ) : (\n        <>\n          {/* Student routes */}\n          {user?.role === 'student' && (\n            <>\n              <Route path=\"/\" component={HomePage} />\n              <Route path=\"/home\" component={HomePage} />\n              <Route path=\"/chat\" component={ChatPage} />\n              <Route path=\"/platform-info\" component={PlatformInfo} />\n              <Route path=\"/profession-selection\" component={ProfessionSelection} />\n              <Route path=\"/tananyagok\" component={TananyagokPage} />\n              <Route path=\"/subjects\" component={SubjectsPage} />\n              <Route path=\"/subjects/:subjectId/modules\" component={ModulesPage} />\n              <Route path=\"/learning\" component={Learning} />\n              <Route path=\"/modules\" component={ModulesPage} />\n              <Route path=\"/module/:id\" component={ModuleViewer} />\n              <Route path=\"/modules/:id\" component={ModuleViewer} />\n              <Route path=\"/modules/:subjectId\" component={ModulesPage} />\n              <Route path=\"/progress\" component={ProgressPage} />\n              <Route path=\"/settings\" component={SettingsPage} />\n              <Route path=\"/community\" component={CommunityLearning} />\n              <Route path=\"/community-learning\" component={CommunityLearning} />\n              <Route path=\"/mermaid-test\" component={MermaidTest} />\n            </>\n          )}\n          \n          {/* Teacher routes */}\n          {user?.role === 'teacher' && (\n            <>\n              <Route path=\"/\" component={HomePage} />\n              <Route path=\"/teacher\" component={TeacherDashboard} />\n              <Route path=\"/home\" component={HomePage} />\n              <Route path=\"/chat\" component={ChatPage} />\n              <Route path=\"/platform-info\" component={PlatformInfo} />\n              <Route path=\"/profession-selection\" component={ProfessionSelection} />\n              <Route path=\"/tananyagok\" component={TananyagokPage} />\n              <Route path=\"/subjects\" component={SubjectsPage} />\n              <Route path=\"/subjects/:subjectId/modules\" component={ModulesPage} />\n              <Route path=\"/learning\" component={Learning} />\n              <Route path=\"/modules\" component={ModulesPage} />\n              <Route path=\"/module/:id\" component={ModuleViewer} />\n              <Route path=\"/modules/:id\" component={ModuleViewer} />\n              <Route path=\"/modules/:subjectId\" component={ModulesPage} />\n              <Route path=\"/tanul√≥im\" component={TeacherDashboard} />\n              <Route path=\"/teacher-dashboard\" component={TeacherDashboard} />\n              <Route path=\"/settings\" component={SettingsPage} />\n              <Route path=\"/community\" component={CommunityLearning} />\n              <Route path=\"/community-learning\" component={CommunityLearning} />\n              <Route path=\"/mermaid-test\" component={MermaidTest} />\n            </>\n          )}\n          \n          {/* Admin routes */}\n          {user?.role === 'admin' && (\n            <>\n              <Route path=\"/\" component={AdminDashboard} />\n              <Route path=\"/admin\" component={AdminDashboard} />\n              <Route path=\"/admin-dashboard\" component={AdminDashboard} />\n              <Route path=\"/chat\" component={ChatPage} />\n              <Route path=\"/mermaid-test\" component={MermaidTest} />\n              <Route path=\"/module/:id\" component={ModuleViewer} />\n              <Route path=\"/modules/:id\" component={ModuleViewer} />\n              <Route path=\"/tananyagok\" component={TananyagokPage} />\n              <Route path=\"/subjects\" component={SubjectsPage} />\n              <Route path=\"/subjects/:subjectId/modules\" component={ModulesPage} />\n              <Route path=\"/modules\" component={ModulesPage} />\n              <Route path=\"/modules/:subjectId\" component={ModulesPage} />\n            </>\n          )}\n        </>\n      )}\n      \n      {/* Fallback routes */}\n      <Route path=\"/:rest*\" component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction AppWithVoiceNavigation() {\n  const [location, navigate] = useLocation();\n\n  const handleNavigation = (path: string) => {\n    navigate(path);\n  };\n\n  return (\n    <>\n      <Router />\n      <VoiceNavigation onNavigationCommand={handleNavigation} />\n      <CookieBanner />\n    </>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider defaultTheme=\"light\" storageKey=\"global-learning-system-theme\">\n        <TooltipProvider>\n          <Toaster />\n          <AppWithVoiceNavigation />\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":7532},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer utilities {\n  .line-clamp-3 {\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n\n  /* Fast loading animations for instant background display */\n  .animate-fade-in {\n    animation: fadeIn 0.8s ease-in-out;\n  }\n\n  .animate-slide-up {\n    animation: slideUp 0.6s ease-out;\n  }\n\n  .loading-spinner {\n    width: 40px;\n    height: 40px;\n    border: 4px solid #f3f3f3;\n    border-top: 4px solid #3498db;\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n  }\n\n  /* Performance optimized gradient backgrounds */\n  .bg-optimized-gradient {\n    background: linear-gradient(135deg, \n      hsl(220, 100%, 97%) 0%, \n      hsl(0, 0%, 100%) 35%, \n      hsl(270, 100%, 97%) 100%);\n    will-change: auto;\n  }\n\n  /* Student background with warm network pattern */\n  .bg-student-warm {\n    background-image: url('/src/assets/student-background.svg');\n    background-size: cover;\n    background-position: center;\n    background-repeat: no-repeat;\n    background-attachment: fixed;\n    will-change: auto;\n  }\n\n  /* Mobile optimizations */\n  .mobile-optimized {\n    -webkit-tap-highlight-color: transparent;\n    touch-action: manipulation;\n  }\n\n  .touch-friendly {\n    min-height: 44px;\n    min-width: 44px;\n  }\n\n  /* Viewport-based font scaling for mobile */\n  .responsive-text {\n    font-size: clamp(0.875rem, 2.5vw, 1.125rem);\n  }\n\n  .responsive-heading {\n    font-size: clamp(1.5rem, 5vw, 2.5rem);\n  }\n\n  /* Smooth scrolling for mobile */\n  .smooth-scroll {\n    scroll-behavior: smooth;\n    -webkit-overflow-scrolling: touch;\n  }\n\n  /* Modern visual elements */\n  .glassmorphism {\n    background: rgba(255, 255, 255, 0.15);\n    backdrop-filter: blur(12px);\n    -webkit-backdrop-filter: blur(12px);\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.2);\n  }\n\n  .dark .glassmorphism {\n    background: rgba(0, 0, 0, 0.25);\n    backdrop-filter: blur(15px);\n    -webkit-backdrop-filter: blur(15px);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);\n  }\n\n  .glassmorphism-dark {\n    background: rgba(0, 0, 0, 0.2);\n    backdrop-filter: blur(15px);\n    -webkit-backdrop-filter: blur(15px);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);\n  }\n\n  .neumorphism {\n    background: #f0f0f3;\n    border-radius: 20px;\n    box-shadow: 12px 12px 24px rgba(163, 163, 163, 0.4), -12px -12px 24px rgba(255, 255, 255, 0.8);\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .neumorphism:hover {\n    box-shadow: inset 8px 8px 16px rgba(163, 163, 163, 0.3), inset -8px -8px 16px rgba(255, 255, 255, 0.7);\n    transform: translateY(-2px);\n  }\n\n  .dark .neumorphism {\n    background: #2a2a2a;\n    box-shadow: 12px 12px 24px rgba(26, 26, 26, 0.6), -12px -12px 24px rgba(58, 58, 58, 0.4);\n  }\n\n  .dark .neumorphism:hover {\n    box-shadow: inset 8px 8px 16px rgba(26, 26, 26, 0.5), inset -8px -8px 16px rgba(58, 58, 58, 0.3);\n    transform: translateY(-2px);\n  }\n\n  .neumorphism-dark {\n    background: #2a2a2a;\n    border-radius: 20px;\n    box-shadow: 9px 9px 16px #1a1a1a, -9px -9px 16px #3a3a3a;\n    transition: all 0.3s ease;\n  }\n\n  .neumorphism-dark:hover {\n    box-shadow: inset 9px 9px 16px #1a1a1a, inset -9px -9px 16px #3a3a3a;\n  }\n\n  .gradient-overlay {\n    position: relative;\n  }\n\n  .gradient-overlay::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(45deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));\n    pointer-events: none;\n    border-radius: inherit;\n  }\n\n\n\n  .hover-lift {\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .hover-lift:hover {\n    transform: translateY(-8px) scale(1.02);\n    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);\n  }\n\n  .interactive-element {\n    transition: all 0.2s ease;\n  }\n\n  .interactive-element:hover {\n    transform: scale(1.05);\n    filter: brightness(1.1);\n  }\n\n  /* Advanced animations and transitions */\n  .fade-in-up {\n    animation: fadeInUp 0.8s ease-out forwards;\n    opacity: 0;\n    transform: translateY(30px);\n  }\n\n  .fade-in-left {\n    animation: fadeInLeft 0.8s ease-out forwards;\n    opacity: 0;\n    transform: translateX(-30px);\n  }\n\n  .fade-in-right {\n    animation: fadeInRight 0.8s ease-out forwards;\n    opacity: 0;\n    transform: translateX(30px);\n  }\n\n  .parallax-bg {\n    transform: translateZ(0);\n    will-change: transform;\n  }\n\n  .hover-lift {\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .hover-lift:hover {\n    transform: translateY(-8px);\n    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n  }\n\n  .hover-glow {\n    transition: all 0.3s ease;\n    position: relative;\n  }\n\n  .hover-glow:hover {\n    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);\n    transform: scale(1.02);\n  }\n\n  .stagger-animation {\n    animation-delay: var(--stagger-delay, 0s);\n  }\n\n  /* Intersection Observer triggered animations */\n  .animate-on-scroll {\n    opacity: 0;\n    transform: translateY(50px);\n    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .animate-on-scroll.in-view {\n    opacity: 1;\n    transform: translateY(0);\n  }\n\n  .animate-on-scroll-left {\n    opacity: 0;\n    transform: translateX(-50px);\n    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);\n  }\n\n  .animate-on-scroll-left.in-view {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: scale(0.95); }\n  to { opacity: 1; transform: scale(1); }\n}\n\n@keyframes slideUp {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n@keyframes spin {\n  0% { transform: rotate(0deg); }\n  100% { transform: rotate(360deg); }\n}\n\n@keyframes fadeInUp {\n  from { \n    opacity: 0; \n    transform: translateY(30px); \n  }\n  to { \n    opacity: 1; \n    transform: translateY(0); \n  }\n}\n\n@keyframes fadeInLeft {\n  from { \n    opacity: 0; \n    transform: translateX(-30px); \n  }\n  to { \n    opacity: 1; \n    transform: translateX(0); \n  }\n}\n\n@keyframes fadeInRight {\n  from { \n    opacity: 0; \n    transform: translateX(30px); \n  }\n  to { \n    opacity: 1; \n    transform: translateX(0); \n  }\n}\n\n:root {\n  --background: 0 0% 100%;\n  --foreground: 20 14.3% 4.1%;\n  --muted: 60 4.8% 95.9%;\n  --muted-foreground: 25 5.3% 44.7%;\n  --popover: 0 0% 100%;\n  --popover-foreground: 20 14.3% 4.1%;\n  --card: 0 0% 100%;\n  --card-foreground: 20 14.3% 4.1%;\n  --border: 20 5.9% 90%;\n  --input: 20 5.9% 90%;\n  --primary: 207 90% 54%; /* #1976D2 */\n  --primary-foreground: 211 100% 99%;\n  --secondary: 122 39% 49%; /* #388E3C */\n  --secondary-foreground: 60 9.1% 97.8%;\n  --accent: 36 100% 50%; /* #FF9800 */\n  --accent-foreground: 24 9.8% 10%;\n  --destructive: 0 84.2% 60.2%;\n  --destructive-foreground: 60 9.1% 97.8%;\n  --ring: 20 14.3% 4.1%;\n  --radius: 0.5rem;\n  \n  /* Neutral colors */\n  --neutral-50: 0 0% 96%; /* #F5F5F5 */\n  --neutral-100: 0 0% 88%; /* #E0E0E0 */\n  --neutral-400: 0 0% 62%; /* #9E9E9E */\n  --neutral-700: 0 0% 26%; /* #424242 */\n\n  /* Chart colors */\n  --chart-1: 12 76% 61%;\n  --chart-2: 173 58% 39%;\n  --chart-3: 197 37% 24%;\n  --chart-4: 43 74% 66%;\n  --chart-5: 27 87% 67%;\n\n  /* Sidebar colors */\n  --sidebar-background: 0 0% 98%;\n  --sidebar-foreground: 240 5.3% 26.1%;\n  --sidebar-primary: 240 5.9% 10%;\n  --sidebar-primary-foreground: 0 0% 98%;\n  --sidebar-accent: 240 4.8% 95.9%;\n  --sidebar-accent-foreground: 240 5.9% 10%;\n  --sidebar-border: 220 13% 91%;\n  --sidebar-ring: 217.2 10.6% 64.9%;\n}\n\n.dark {\n  --background: 240 10% 3.9%;\n  --foreground: 0 0% 98%;\n  --muted: 240 3.7% 15.9%;\n  --muted-foreground: 240 5% 64.9%;\n  --popover: 240 10% 3.9%;\n  --popover-foreground: 0 0% 98%;\n  --card: 240 10% 3.9%;\n  --card-foreground: 0 0% 98%;\n  --border: 240 3.7% 15.9%;\n  --input: 240 3.7% 15.9%;\n  --primary: 207 90% 54%; /* Keep primary consistent */\n  --primary-foreground: 211 100% 99%;\n  --primary-dark: 213 96% 38%;\n  --secondary: 122 39% 49%; /* Keep secondary consistent */\n  --secondary-foreground: 0 0% 98%;\n  --accent: 36 100% 50%; /* Keep accent consistent */\n  --accent-foreground: 0 0% 98%;\n  --destructive: 0 62.8% 30.6%;\n  --destructive-foreground: 0 0% 98%;\n  --ring: 240 4.9% 83.9%;\n  --radius: 0.5rem;\n\n  /* Sidebar colors for dark mode */\n  --sidebar-background: 240 5.9% 10%;\n  --sidebar-foreground: 240 4.8% 95.9%;\n  --sidebar-primary: 224.3 76.3% 94.1%;\n  --sidebar-primary-foreground: 220.9 39.3% 11%;\n  --sidebar-accent: 240 3.7% 15.9%;\n  --sidebar-accent-foreground: 240 4.8% 95.9%;\n  --sidebar-border: 240 3.7% 15.9%;\n  --sidebar-ring: 217.2 10.6% 64.9%;\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  }\n\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-semibold;\n  }\n}\n\n@layer components {\n  /* Custom material design shadows */\n  .shadow-material {\n    box-shadow: 0 2px 4px rgba(0,0,0,0.1), 0 8px 16px rgba(0,0,0,0.1);\n  }\n\n  .shadow-material-lg {\n    box-shadow: 0 4px 8px rgba(0,0,0,0.12), 0 16px 24px rgba(0,0,0,0.14);\n  }\n\n  /* Line clamp utilities */\n  .line-clamp-2 {\n    display: -webkit-box;\n    -webkit-line-clamp: 2;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n\n  .line-clamp-3 {\n    display: -webkit-box;\n    -webkit-line-clamp: 3;\n    -webkit-box-orient: vertical;\n    overflow: hidden;\n  }\n}\n\n/* Prose styles for module content */\n.prose {\n  @apply text-neutral-700 max-w-none;\n}\n\n/* Mermaid diagram centering */\n.prose .mermaid {\n  @apply flex justify-center items-center w-full my-6;\n}\n\n.prose .mermaid svg {\n  @apply mx-auto;\n}\n\n.prose h1 {\n  @apply text-2xl font-bold mb-4 text-neutral-800;\n}\n\n.prose h2 {\n  @apply text-xl font-semibold mb-3 text-neutral-800;\n}\n\n.prose h3 {\n  @apply text-lg font-semibold mb-2 text-neutral-700;\n}\n\n.prose p {\n  @apply mb-4 leading-relaxed;\n}\n\n.prose ul {\n  @apply list-disc list-inside mb-4;\n}\n\n.prose ol {\n  @apply list-decimal list-inside mb-4;\n}\n\n.prose li {\n  @apply mb-1;\n}\n\n.prose code {\n  @apply bg-neutral-100 px-1 py-0.5 rounded text-sm font-mono;\n}\n\n.prose pre {\n  @apply bg-neutral-100 p-4 rounded-lg mb-4 overflow-x-auto;\n}\n\n.prose blockquote {\n  @apply border-l-4 border-primary pl-4 italic mb-4;\n}\n\n.prose strong {\n  @apply font-semibold;\n}\n\n.prose em {\n  @apply italic;\n}\n\n.prose a {\n  @apply text-primary hover:text-blue-700 underline;\n}\n\n/* Dark mode prose styles */\n.dark .prose {\n  @apply text-neutral-200;\n}\n\n.dark .prose h1,\n.dark .prose h2 {\n  @apply text-neutral-100;\n}\n\n.dark .prose h3 {\n  @apply text-neutral-200;\n}\n\n.dark .prose code {\n  @apply bg-neutral-800;\n}\n\n.dark .prose pre {\n  @apply bg-neutral-800;\n}\n","size_bytes":10806},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/assets/presentation-images.ts":{"content":"import slide1Img from '@assets/image_1751049850363.png';\nimport slide2Img from '@assets/image_1751049879954.png';\nimport slide3Img from '@assets/image_1751049903505.png';\nimport slide4Img from '@assets/image_1751049927738.png';\nimport slide5Img from '@assets/image_1751049948867.png';\nimport slide6Img from '@assets/image_1751049980795.png';\nimport slide7Img from '@assets/image_1751050005744.png';\nimport slide8Img from '@assets/image_1751050031769.png';\nimport slide9Img from '@assets/image_1751050060938.png';\n\nexport const presentationImages = {\n  slide1: slide1Img,\n  slide2: slide2Img,\n  slide3: slide3Img,\n  slide4: slide4Img,\n  slide5: slide5Img,\n  slide6: slide6Img,\n  slide7: slide7Img,\n  slide8: slide8Img,\n  slide9: slide9Img\n};","size_bytes":740},"client/src/components/animated-ai-background.tsx":{"content":"import { useEffect, useState } from 'react';\nimport aiHumanImage from \"@assets/image_1749224411277.png\";\n\nexport default function AnimatedAIBackground() {\n  const [imageLoaded, setImageLoaded] = useState(false);\n\n  useEffect(() => {\n    // Preload image for instant display\n    const img = new Image();\n    img.onload = () => setImageLoaded(true);\n    img.src = aiHumanImage;\n  }, []);\n\n  return (\n    <div className=\"fixed inset-0 w-full h-full overflow-hidden z-0\">\n      {/* Instant gradient background - no loading delay */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50 via-white to-purple-50\">\n        {/* Immediate visual content with CSS animations */}\n        <div className=\"absolute inset-0\">\n          {/* CSS-only animated particles */}\n          <div className=\"absolute top-1/4 left-1/4 w-2 h-2 bg-blue-400 rounded-full opacity-60 animate-bounce\"></div>\n          <div className=\"absolute top-1/3 right-1/3 w-1 h-1 bg-purple-500 rounded-full opacity-40 animate-pulse\"></div>\n          <div className=\"absolute bottom-1/3 left-1/3 w-3 h-3 bg-cyan-300 rounded-full opacity-30 animate-ping\"></div>\n          <div className=\"absolute top-2/3 right-1/4 w-1 h-1 bg-indigo-400 rounded-full opacity-50 animate-bounce\"></div>\n          \n          {/* Animated connecting lines */}\n          <div className=\"absolute top-1/2 left-1/4 right-1/4 h-px bg-gradient-to-r from-transparent via-blue-300 to-transparent opacity-30 animate-pulse\"></div>\n          <div className=\"absolute top-2/5 left-1/3 right-1/3 h-px bg-gradient-to-r from-transparent via-purple-300 to-transparent opacity-20 animate-pulse delay-500\"></div>\n        </div>\n        \n        {/* Image Container with lazy loading */}\n        <div className=\"relative w-full h-full flex items-center justify-center\">\n          {imageLoaded && (\n            // AI Background with optimized loading\n            <div className=\"image-wrapper w-full h-full relative animate-fade-in\">\n              {/* Professional AI and Human heads from provided image */}\n              <div className=\"w-full h-full relative overflow-hidden\">\n                {/* Background image - optimized with lazy loading */}\n                <img \n                  src={aiHumanImage} \n                  alt=\"AI and Human interaction\" \n                  className=\"w-full h-full object-cover opacity-85\"\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                  style={{ \n                    willChange: 'auto'\n                  }}\n                />\n                \n                {/* Overlay for additional effects */}\n                <div className=\"absolute inset-0 bg-gradient-to-r from-slate-900/30 via-transparent to-slate-900/30\"></div>\n                \n                {/* Thought transfer beams between foreheads */}\n                <div className=\"absolute top-[35%] left-[30%] right-[30%] h-0.5 bg-gradient-to-r from-cyan-400 via-white to-orange-400 opacity-50 animate-pulse\"></div>\n                <div className=\"absolute top-[37%] left-[32%] right-[32%] h-px bg-gradient-to-r from-blue-300 via-purple-400 to-yellow-300 opacity-60 animate-pulse\"></div>\n                \n                {/* Zigzag energy beams between foreheads */}\n                {[...Array(8)].map((_, index) => (\n                  <div\n                    key={`zigzag-${index}`}\n                    className=\"absolute w-1 h-px bg-cyan-300 opacity-70\"\n                    style={{\n                      top: `${35 + (index % 3) * 1}%`,\n                      left: `${30 + index * 5}%`,\n                      transform: `rotate(${Math.sin(index) * 15}deg)`,\n                      animation: `zigzagEnergy ${1.5 + index * 0.2}s infinite linear`,\n                      animationDelay: `${index * 0.2}s`\n                    }}\n                  />\n                ))}\n                \n                {/* Pulsing energy orbs traveling between foreheads */}\n                {[...Array(5)].map((_, index) => (\n                  <div\n                    key={`energy-orb-${index}`}\n                    className=\"absolute w-2 h-2 bg-white rounded-full opacity-80 shadow-lg\"\n                    style={{\n                      top: `${35.5 + (index % 2) * 0.5}%`,\n                      left: '30%',\n                      animation: `thoughtTransfer ${2.5 + index * 0.3}s infinite linear`,\n                      animationDelay: `${index * 0.8}s`,\n                      boxShadow: '0 0 8px cyan, 0 0 16px blue'\n                    }}\n                  />\n                ))}\n                \n                {/* Brain activity glow around AI forehead */}\n                <div className=\"absolute left-[20%] top-[30%] w-16 h-8 bg-cyan-400/20 rounded-full blur-lg animate-pulse\"></div>\n                <div className=\"absolute left-[20%] top-[32%] w-12 h-6 bg-blue-500/30 rounded-full blur-md animate-ping\"></div>\n                \n                {/* Human consciousness glow around human forehead */}\n                <div className=\"absolute right-[20%] top-[30%] w-16 h-8 bg-orange-400/20 rounded-full blur-lg animate-pulse\"></div>\n                <div className=\"absolute right-[20%] top-[32%] w-12 h-6 bg-yellow-500/30 rounded-full blur-md animate-ping\"></div>\n                \n                {/* Floating thought particles */}\n                {[...Array(6)].map((_, index) => (\n                  <div\n                    key={`thought-${index}`}\n                    className=\"absolute w-1 h-1 bg-white rounded-full opacity-60\"\n                    style={{\n                      top: `${33 + (index % 4) * 2}%`,\n                      left: `${35 + index * 4}%`,\n                      animation: `floatThought ${3 + index * 0.5}s infinite ease-in-out`,\n                      animationDelay: `${index * 0.7}s`\n                    }}\n                  />\n                ))}\n                \n                {/* Knowledge exchange symbols */}\n                <div className=\"absolute left-[42%] top-[35%] text-cyan-300 text-sm opacity-70 animate-bounce\" style={{animationDelay: '0.3s'}}>‚ö°</div>\n                <div className=\"absolute left-[48%] top-[38%] text-white text-xs opacity-60 animate-bounce\" style={{animationDelay: '1.1s'}}>üí≠</div>\n                <div className=\"absolute right-[42%] top-[35%] text-orange-300 text-sm opacity-70 animate-bounce\" style={{animationDelay: '1.8s'}}>‚ú®</div>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* CSS Styles */}\n      <style>{`\n        .loading-spinner {\n          border: 4px solid rgba(0, 0, 0, 0.1);\n          border-left-color: #3b82f6;\n          border-radius: 50%;\n          width: 40px;\n          height: 40px;\n          animation: spin 1s linear infinite;\n        }\n\n        @keyframes spin {\n          to { transform: rotate(360deg); }\n        }\n\n        .image-wrapper {\n          position: relative;\n          border-radius: 15px;\n          overflow: hidden;\n        }\n\n        .data-pulse {\n          position: absolute;\n          width: 6px;\n          height: 6px;\n          background: radial-gradient(circle, rgba(0, 255, 255, 1) 0%, rgba(0, 255, 255, 0.5) 50%, rgba(0, 255, 255, 0) 100%);\n          border-radius: 50%;\n          box-shadow: 0 0 8px rgba(0, 255, 255, 0.9);\n          animation: movePulse 3s infinite linear;\n          pointer-events: none;\n        }\n\n        @keyframes movePulse {\n          0% {\n            left: 20%;\n            opacity: 0;\n            transform: translateY(0px);\n          }\n          15% {\n            opacity: 1;\n          }\n          50% {\n            transform: translateY(3px);\n          }\n          85% {\n            opacity: 1;\n          }\n          100% {\n            left: 80%;\n            opacity: 0;\n            transform: translateY(0px);\n          }\n        }\n\n        .mouth-glow {\n          position: absolute;\n          width: 12px;\n          height: 8px;\n          border-radius: 50%;\n          background: rgba(255, 255, 255, 0.7);\n          box-shadow: 0 0 10px 5px rgba(255, 255, 255, 0.6), 0 0 20px 10px rgba(0, 255, 255, 0.3);\n          opacity: 0;\n          transform: scale(0.8);\n          pointer-events: none;\n        }\n\n        .robot-mouth-glow {\n          left: 25%;\n          top: 55%;\n          animation: robotSpeak 4s infinite ease-in-out;\n        }\n\n        @keyframes robotSpeak {\n          0%, 45%, 100% {\n            opacity: 0;\n            transform: scale(0.8);\n          }\n          10% {\n            opacity: 1;\n            transform: scale(1.0);\n          }\n          35% {\n            opacity: 1;\n            transform: scale(0.9);\n          }\n        }\n\n        .human-mouth-glow {\n          left: 70%;\n          top: 55%;\n          animation: humanSpeak 4s infinite ease-in-out;\n        }\n\n        @keyframes humanSpeak {\n          0%, 5% {\n            opacity: 0;\n            transform: scale(0.8);\n          }\n          50% {\n            opacity: 1;\n            transform: scale(1.0);\n          }\n          75% {\n            opacity: 1;\n            transform: scale(0.9);\n          }\n          95%, 100% {\n            opacity: 0;\n            transform: scale(0.8);\n          }\n        }\n\n        @keyframes zigzagEnergy {\n          0% {\n            opacity: 0;\n            transform: translateX(0) rotate(0deg);\n          }\n          25% {\n            opacity: 1;\n            transform: translateX(10px) rotate(15deg);\n          }\n          50% {\n            opacity: 0.8;\n            transform: translateX(-5px) rotate(-10deg);\n          }\n          75% {\n            opacity: 1;\n            transform: translateX(15px) rotate(20deg);\n          }\n          100% {\n            opacity: 0;\n            transform: translateX(20px) rotate(0deg);\n          }\n        }\n\n        @keyframes thoughtTransfer {\n          0% {\n            left: 30%;\n            opacity: 0;\n            transform: scale(0.5);\n          }\n          20% {\n            opacity: 1;\n            transform: scale(1);\n          }\n          80% {\n            opacity: 1;\n            transform: scale(0.8);\n          }\n          100% {\n            left: 70%;\n            opacity: 0;\n            transform: scale(0.3);\n          }\n        }\n\n        @keyframes floatThought {\n          0%, 100% {\n            transform: translateY(0px) scale(1);\n            opacity: 0.6;\n          }\n          50% {\n            transform: translateY(-8px) scale(1.2);\n            opacity: 1;\n          }\n        }\n      `}</style>\n    </div>\n  );\n}","size_bytes":10458},"client/src/components/animated-section.tsx":{"content":"import { ReactNode } from 'react';\nimport { useScrollAnimation } from '@/hooks/useScrollAnimation';\n\ninterface AnimatedSectionProps {\n  children: ReactNode;\n  className?: string;\n  animation?: 'fade-up' | 'fade-left' | 'fade-right';\n  delay?: number;\n}\n\nexport default function AnimatedSection({ \n  children, \n  className = '', \n  animation = 'fade-up',\n  delay = 0 \n}: AnimatedSectionProps) {\n  const { ref, isInView } = useScrollAnimation({ threshold: 0.1 });\n\n  const animationClass = {\n    'fade-up': 'animate-on-scroll',\n    'fade-left': 'animate-on-scroll-left',\n    'fade-right': 'animate-on-scroll-left'\n  }[animation];\n\n  return (\n    <div\n      ref={ref as any}\n      className={`${animationClass} ${isInView ? 'in-view' : ''} ${className}`}\n      style={{ \n        animationDelay: `${delay}ms`,\n        transitionDelay: `${delay}ms`\n      }}\n    >\n      {children}\n    </div>\n  );\n}","size_bytes":893},"client/src/components/chat-interface-backup.tsx":{"content":"// Backup of original chat interface before fixing","size_bytes":50},"client/src/components/chat-interface-broken.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Bot, Send, User, Trash2, Mic, MicOff, Volume2, Play, Pause, Square, FileText, Brain } from \"lucide-react\";\nimport type { ChatMessage } from \"@shared/schema\";\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\ninterface ChatInterfaceProps {\n  userId: string;\n  moduleId?: number;\n  predefinedMessage?: string;\n  onQuizStart?: () => void;\n}\n\nexport default function ChatInterface({ userId, moduleId, onQuizStart }: ChatInterfaceProps) {\n  const [message, setMessage] = useState(\"\");\n  const [isRecording, setIsRecording] = useState(false);\n  const [mediaRecorder, setMediaRecorder] = useState<MediaRecorder | null>(null);\n  const [audioChunks, setAudioChunks] = useState<Blob[]>([]);\n  const [currentAudio, setCurrentAudio] = useState<HTMLAudioElement | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [abortController, setAbortController] = useState<AbortController | null>(null);\n  const [lastRequestId, setLastRequestId] = useState<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const [isAIResponding, setIsAIResponding] = useState(false);\n  const [streamingMessage, setStreamingMessage] = useState(\"\");\n  const [isGeneratingAudio, setIsGeneratingAudio] = useState(false);\n  const streamingAudioChunks = useRef<string[]>([]);\n  const synchronizedAudioQueue = useRef<{buffer: Uint8Array, timestamp: number, text: string}[]>([]);\n  const [playbackStartTime, setPlaybackStartTime] = useState<number>(0);\n\n  const { data: messages = [], isLoading, refetch } = useQuery({\n    queryKey: ['/api/chat/messages', moduleId],\n    queryFn: async () => {\n      const params = moduleId ? `?moduleId=${moduleId}` : '';\n      const response = await fetch(`/api/chat/messages${params}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to fetch messages');\n      const data = await response.json();\n      return data;\n    },\n    retry: false,\n    refetchInterval: isAIResponding ? 2000 : false,\n    staleTime: 0,\n    gcTime: 0,\n  });\n\n  const transcribeAudio = async (audioBlob: Blob, extension: string = 'webm') => {\n    try {\n      const formData = new FormData();\n      formData.append('audio', audioBlob, `recording.${extension}`);\n      \n      const response = await fetch('/api/chat/transcribe', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        throw new Error('Transcription failed');\n      }\n\n      const result = await response.json();\n      return result.text;\n    } catch (error) {\n      console.error('Transcription error:', error);\n      throw error;\n    }\n  };\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      const recorder = new MediaRecorder(stream);\n      \n      recorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          setAudioChunks(prev => [...prev, event.data]);\n        }\n      };\n\n      recorder.onstop = async () => {\n        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });\n        setAudioChunks([]);\n        \n        try {\n          const transcribedText = await transcribeAudio(audioBlob);\n          if (transcribedText.trim()) {\n            sendStreamingMessage(transcribedText);\n          }\n        } catch (error) {\n          toast({\n            title: \"Hiba\",\n            description: \"Nem siker√ºlt feldolgozni a hangfelv√©telt\",\n            variant: \"destructive\",\n          });\n        }\n        \n        stream.getTracks().forEach(track => track.stop());\n      };\n\n      setMediaRecorder(recorder);\n      recorder.start();\n      setIsRecording(true);\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt el√©rni a mikrofont\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorder && mediaRecorder.state === 'recording') {\n      mediaRecorder.stop();\n      setIsRecording(false);\n      setMediaRecorder(null);\n    }\n  };\n\n  const toggleAudioPlayback = () => {\n    if (currentAudio) {\n      if (isPlaying) {\n        currentAudio.pause();\n        setIsPlaying(false);\n      } else {\n        currentAudio.play()\n          .then(() => setIsPlaying(true))\n          .catch(e => {\n            console.log('Audio playback failed:', e);\n            toast({\n              title: \"Lej√°tsz√°si hiba\",\n              description: \"Nem siker√ºlt lej√°tszani a hangf√°jlt\",\n              variant: \"destructive\",\n            });\n          });\n      }\n    }\n  };\n\n  // Synchronized streaming function for timestamped text-audio coordination\n  const sendSynchronizedStreamingMessage = async (messageText: string, isVoiceRequest: boolean = false) => {\n    if (!messageText.trim()) return;\n\n    setIsAIResponding(true);\n    setStreamingMessage('');\n    setIsGeneratingAudio(isVoiceRequest);\n    \n    // Clear previous audio queue\n    synchronizedAudioQueue.current = [];\n    let audioQueueProcessing = false;\n    \n    try {\n      const response = await fetch('/api/chat/message/synchronized-stream', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          message: messageText,\n          relatedModuleId: moduleId,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Synchronized streaming failed');\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n      \n      const processAudioQueue = async () => {\n        if (audioQueueProcessing || synchronizedAudioQueue.current.length === 0) return;\n        \n        audioQueueProcessing = true;\n        const audioChunk = synchronizedAudioQueue.current.shift();\n        \n        if (audioChunk && isVoiceRequest) {\n          try {\n            const audioBlob = new Blob([audioChunk.buffer], { type: 'audio/mpeg' });\n            const audioUrl = URL.createObjectURL(audioBlob);\n            const audio = new Audio(audioUrl);\n            \n            console.log(`Playing audio chunk (${audioChunk.text.length} chars): \"${audioChunk.text.substring(0, 50)}...\" at ${audioChunk.timestamp}ms`);\n            \n            audio.onplay = () => {\n              setIsPlaying(true);\n              setIsGeneratingAudio(false);\n            };\n            audio.onended = () => {\n              setIsPlaying(false);\n              audioQueueProcessing = false;\n              // Process next chunk in queue\n              setTimeout(processAudioQueue, 100);\n            };\n            audio.onerror = () => {\n              audioQueueProcessing = false;\n              setTimeout(processAudioQueue, 100);\n            };\n            \n            if (currentAudio) {\n              currentAudio.pause();\n            }\n            setCurrentAudio(audio);\n            await audio.play();\n            \n          } catch (error) {\n            console.error('Error playing synchronized audio chunk:', error);\n            audioQueueProcessing = false;\n            setTimeout(processAudioQueue, 100);\n          }\n        } else {\n          audioQueueProcessing = false;\n        }\n      };\n      \n      while (reader) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              \n              switch (data.type) {\n                case 'user_message':\n                  queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n                  break;\n                case 'text_chunk':\n                  setStreamingMessage(prev => prev + data.data);\n                  break;\n                case 'audio_chunk':\n                  if (isVoiceRequest && data.data) {\n                    try {\n                      const audioData = atob(data.data);\n                      const bytes = new Uint8Array(audioData.length);\n                      for (let i = 0; i < audioData.length; i++) {\n                        bytes[i] = audioData.charCodeAt(i);\n                      }\n                      \n                      synchronizedAudioQueue.current.push({\n                        buffer: bytes,\n                        timestamp: data.timestamp,\n                        text: data.text\n                      });\n                      \n                      // Start processing queue if not already processing\n                      if (!audioQueueProcessing) {\n                        setTimeout(processAudioQueue, data.timestamp);\n                      }\n                    } catch (error) {\n                      console.error('Error processing synchronized audio chunk:', error);\n                    }\n                  }\n                  break;\n                case 'ai_complete':\n                  setIsAIResponding(false);\n                  setStreamingMessage('');\n                  queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n                  break;\n                case 'done':\n                  setIsAIResponding(false);\n                  if (!isVoiceRequest) {\n                    setIsGeneratingAudio(false);\n                  }\n                  break;\n                case 'error':\n                  throw new Error(data.message || 'Synchronized streaming error');\n              }\n            } catch (parseError) {\n              console.error('Error parsing synchronized SSE data:', parseError);\n            }\n          }\n        }\n      }\n\n    } catch (error) {\n      console.error('Synchronized streaming error:', error);\n      setIsAIResponding(false);\n      setStreamingMessage('');\n      setIsGeneratingAudio(false);\n      toast({\n        title: \"Szinkroniz√°lt streaming hiba\",\n        description: \"A szinkroniz√°lt v√°lasz gener√°l√°sa sikertelen volt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const sendStreamingMessage = async (messageText: string) => {\n    setIsAIResponding(true);\n    setStreamingMessage(\"\"); // Reset streaming message\n    \n    let isVoiceRequest = messageText.includes('Hangos magyar√°zat k√©r√©se');\n    \n    // Prevent multiple voice requests while audio is being generated or playing\n    if (isVoiceRequest && (isGeneratingAudio || isPlaying)) {\n      toast({\n        title: \"Hangos felolvas√°s m√°r folyamatban\",\n        description: \"V√°rj, am√≠g befejez≈ëdik az aktu√°lis felolvas√°s.\",\n        variant: \"destructive\",\n      });\n      setIsAIResponding(false);\n      return;\n    }\n    \n    // Stop any currently playing audio\n    if (currentAudio) {\n      currentAudio.pause();\n      setCurrentAudio(null);\n      setIsPlaying(false);\n    }\n\n    let accumulatedResponse = '';\n    let audioStarted = false;\n    let audioGeneration: Promise<void> | null = null;\n\n    // Mark voice request for final audio generation\n    if (isVoiceRequest) {\n      setIsGeneratingAudio(true);\n    }\n\n    try {\n      const response = await fetch('/api/chat/message/stream', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          message: messageText,\n          relatedModuleId: moduleId,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Network response was not ok');\n      }\n\n      const reader = response.body?.getReader();\n      if (!reader) {\n        throw new Error('Response body is not readable');\n      }\n\n      const decoder = new TextDecoder();\n      let buffer = '';\n\n      while (true) {\n        const { done, value } = await reader.read();\n        if (done) break;\n\n        const chunk = decoder.decode(value, { stream: true });\n        buffer += chunk;\n        \n        // Process complete lines\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || ''; // Keep incomplete line in buffer\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const jsonData = line.slice(6).trim();\n              if (!jsonData) continue;\n              \n              const data = JSON.parse(jsonData);\n              console.log('Processing SSE event:', data.type, 'data length:', data.data?.length || 0);\n              \n              switch (data.type) {\n                case 'user_message':\n                  refetch();\n                  break;\n                case 'ai_chunk':\n                  accumulatedResponse += data.data;\n                  setStreamingMessage(accumulatedResponse); // Update streaming message in real-time\n                  break;\n                case 'streaming_audio_chunk_data':\n                  if (isVoiceRequest && data.data) {\n                    streamingAudioChunks.current[data.chunkIndex] = data.data;\n                    console.log('Received audio chunk:', data.chunkIndex + 1, '/', data.totalChunks);\n                  }\n                  break;\n                case 'streaming_audio_complete':\n                  if (isVoiceRequest && streamingAudioChunks.current.length > 0) {\n                    try {\n                      console.log('Assembling audio from', streamingAudioChunks.current.length, 'chunks');\n                      const completeBase64 = streamingAudioChunks.current.join('');\n                      const audioData = atob(completeBase64);\n                      const bytes = new Uint8Array(audioData.length);\n                      for (let i = 0; i < audioData.length; i++) {\n                        bytes[i] = audioData.charCodeAt(i);\n                      }\n                      const audioBlob = new Blob([bytes], { type: 'audio/mpeg' });\n                      const audioUrl = URL.createObjectURL(audioBlob);\n                      const audio = new Audio(audioUrl);\n                      \n                      console.log('Streaming audio blob created, size:', audioBlob.size);\n                      \n                      audio.onplay = () => {\n                        console.log('Streaming audio started playing - setting states');\n                        setIsPlaying(true);\n                        setIsGeneratingAudio(false);\n                      };\n                      audio.onpause = () => {\n                        console.log('Streaming audio paused');\n                        setIsPlaying(false);\n                      };\n                      audio.onended = () => {\n                        console.log('Streaming audio playback ended naturally');\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        setIsGeneratingAudio(false);\n                      };\n                      audio.onerror = (e) => {\n                        console.error('Streaming audio playback error:', e);\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        setIsGeneratingAudio(false);\n                      };\n                      \n                      // Stop previous audio and set new one\n                      if (currentAudio) {\n                        currentAudio.pause();\n                      }\n                      setCurrentAudio(audio);\n                      console.log('Setting new current audio and attempting to play');\n                      audio.play().catch(e => {\n                        console.error('Streaming audio autoplay blocked:', e);\n                        setIsGeneratingAudio(false);\n                      });\n                      \n                      // Reset chunks for next request\n                      streamingAudioChunks.current = [];\n                    } catch (error) {\n                      console.error('Error processing streaming audio:', error);\n                      setIsGeneratingAudio(false);\n                    }\n                  }\n                  break;\n                case 'final_audio':\n                  console.log('Received final_audio event:', !!data.data);\n                  if (isVoiceRequest && data.data) {\n                    try {\n                      const audioData = atob(data.data);\n                      const bytes = new Uint8Array(audioData.length);\n                      for (let i = 0; i < audioData.length; i++) {\n                        bytes[i] = audioData.charCodeAt(i);\n                      }\n                      const audioBlob = new Blob([bytes], { type: 'audio/mpeg' });\n                      const audioUrl = URL.createObjectURL(audioBlob);\n                      const audio = new Audio(audioUrl);\n                      \n                      console.log('Audio blob created, size:', audioBlob.size);\n                      \n                      audio.onplay = () => {\n                        console.log('Audio started playing');\n                        setIsPlaying(true);\n                      };\n                      audio.onpause = () => setIsPlaying(false);\n                      audio.onended = () => {\n                        console.log('Audio playback ended');\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        setIsGeneratingAudio(false);\n                      };\n                      audio.onerror = (e) => {\n                        console.error('Audio playback error:', e);\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        setIsGeneratingAudio(false);\n                      };\n                      \n                      // Stop previous audio and play new one\n                      if (currentAudio) {\n                        currentAudio.pause();\n                      }\n                      setCurrentAudio(audio);\n                      audio.play().catch(e => {\n                        console.error('Audio autoplay blocked:', e);\n                        setIsGeneratingAudio(false);\n                      });\n                    } catch (error) {\n                      console.error('Error processing final audio:', error);\n                      setIsGeneratingAudio(false);\n                    }\n                  }\n                  break;\n                case 'audio_error':\n                  setIsGeneratingAudio(false);\n                  toast({\n                    title: \"Audio hiba\",\n                    description: \"A hang gener√°l√°sa sikertelen volt\",\n                    variant: \"destructive\",\n                  });\n                  break;\n                case 'ai_complete':\n                  setStreamingMessage(\"\"); // Clear streaming message\n                  refetch();\n                  break;\n                case 'done':\n                  setIsAIResponding(false);\n                  setStreamingMessage(\"\"); // Clear streaming message\n                  return;\n                case 'error':\n                  setIsAIResponding(false);\n                  setStreamingMessage(\"\"); // Clear streaming message\n                  toast({\n                    title: \"Hiba t√∂rt√©nt\",\n                    description: data.message,\n                    variant: \"destructive\",\n                  });\n                  return;\n              }\n            } catch (e) {\n              // Skip invalid JSON lines\n            }\n          }\n        }\n      }\n\n    } catch (error) {\n      setIsAIResponding(false);\n      setStreamingMessage(\"\"); // Clear streaming message\n      toast({\n        title: \"Hiba t√∂rt√©nt\",\n        description: \"Nem siker√ºlt elk√ºldeni az √ºzenetet.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const deleteMessagesMutation = useMutation({\n    mutationFn: async () => {\n      const params = moduleId ? `?moduleId=${moduleId}` : '';\n      await apiRequest('DELETE', `/api/chat/messages${params}`);\n    },\n    onSuccess: () => {\n      // Set empty array immediately to prevent refetch\n      queryClient.setQueryData(['/api/chat/messages', moduleId], []);\n      toast({\n        title: \"Sikeres t√∂rl√©s\",\n        description: \"Chat el≈ëzm√©nyek t√∂r√∂lve.\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt t√∂r√∂lni a chat el≈ëzm√©nyeket\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSendMessage = () => {\n    if (message.trim()) {\n      // Use streaming for faster responses\n      sendStreamingMessage(message.trim());\n      setMessage(\"\");\n    }\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  // Scroll to bottom when new messages arrive or streaming message updates\n  useEffect(() => {\n    // Only auto-scroll if there are actual messages and user has interacted with chat\n    if (messages.filter((m: any) => !m.isSystemMessage).length === 0) return;\n    \n    const messagesContainer = messagesEndRef.current?.parentElement;\n    if (messagesContainer) {\n      const isAtBottom = messagesContainer.scrollHeight - messagesContainer.clientHeight <= messagesContainer.scrollTop + 50;\n      // Only auto-scroll if user is already at the bottom\n      if (isAtBottom) {\n        messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n      }\n    }\n  }, [messages, streamingMessage]);\n\n  const formatTime = (timestamp: string | Date) => {\n    const date = new Date(timestamp);\n    const now = new Date();\n    const diffInMinutes = Math.floor((now.getTime() - date.getTime()) / (1000 * 60));\n    \n    if (diffInMinutes < 1) return \"Most\";\n    if (diffInMinutes < 60) return `${diffInMinutes} perce`;\n    if (diffInMinutes < 1440) return `${Math.floor(diffInMinutes / 60)} √≥r√°ja`;\n    return date.toLocaleDateString();\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"h-full\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bot className=\"h-5 w-5 text-blue-600\" />\n            AI Tan√°r Chat\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bot className=\"h-5 w-5 text-blue-600\" />\n            AI Tan√°r Chat\n            {moduleId && <Badge variant=\"secondary\">Module {moduleId}</Badge>}\n          </CardTitle>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => deleteMessagesMutation.mutate()}\n            disabled={deleteMessagesMutation.isPending}\n            className=\"text-red-600 hover:text-red-700\"\n          >\n            <Trash2 size={16} />\n          </Button>\n        </div>\n      </CardHeader>\n      \n      {/* AI funkci√≥k fix poz√≠ci√≥ban a chat tetej√©n */}\n      <div className=\"p-4 bg-orange-50 border-b border-orange-200\">\n        <h4 className=\"font-semibold text-orange-800 mb-3 flex items-center gap-2\">\n          <Bot className=\"h-4 w-4\" />\n          AI funkci√≥k\n        </h4>\n        <div className=\"space-y-2\">\n          <Button \n            variant=\"default\" \n            className=\"w-full justify-start bg-orange-500 hover:bg-orange-600 text-white\"\n            onClick={() => {\n              sendStreamingMessage(`Sz√∂veges magyar√°zat k√©r√©se err≈ël a modulr√≥l`);\n            }}\n            disabled={isAIResponding}\n          >\n            <FileText className=\"h-4 w-4 mr-2\" />\n            Sz√∂veges magyar√°zat k√©r√©se\n          </Button>\n          <Button \n            variant=\"outline\" \n            className=\"w-full justify-start border-blue-300 text-blue-700 hover:bg-blue-50\"\n            onClick={() => {\n              sendSynchronizedStreamingMessage(`Hangos magyar√°zat k√©r√©se err≈ël a modulr√≥l`);\n            }}\n            disabled={isAIResponding || isGeneratingAudio || isPlaying}\n          >\n            <Volume2 className=\"h-4 w-4 mr-2\" />\n            Hangos magyar√°zat (Szinkroniz√°lt)\n            {(isGeneratingAudio || isPlaying) && (\n              <div className=\"ml-2 flex items-center gap-1\">\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full animate-bounce\"></div>\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n              </div>\n            )}\n          </Button>\n          <Button \n            variant=\"outline\" \n            className=\"w-full justify-start border-pink-300 text-pink-700 hover:bg-pink-50\"\n            onClick={onQuizStart}\n            disabled={isAIResponding}\n          >\n            <Brain className=\"h-4 w-4 mr-2\" />\n            Tud√°spr√≥ba\n          </Button>\n        </div>\n      </div>\n\n      <CardContent className=\"flex-1 flex flex-col p-4\">\n        <div className=\"flex-1 overflow-y-auto space-y-4 mb-4 max-h-96 scroll-smooth\">\n          {/* Messages */}\n          {(messages as ChatMessage[]).filter((msg: ChatMessage) => !msg.isSystemMessage).map((msg: ChatMessage) => (\n            <div\n              key={msg.id}\n              className={`flex gap-3 ${msg.senderRole === 'user' ? 'justify-end' : 'justify-start'}`}\n            >\n              <div className={`flex gap-3 max-w-[80%] ${msg.senderRole === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>\n                <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${\n                  msg.senderRole === 'user' \n                    ? 'bg-blue-500 text-white' \n                    : 'bg-neutral-200 text-neutral-600'\n                }`}>\n                  {msg.senderRole === 'user' ? <User size={16} /> : <Bot size={16} />}\n                </div>\n                <div className={`rounded-lg p-3 ${\n                  msg.senderRole === 'user'\n                    ? 'bg-blue-500 text-white'\n                    : 'bg-neutral-100 text-neutral-800'\n                }`}>\n                  {msg.senderRole === 'user' ? (\n                    <div className=\"whitespace-pre-wrap break-words\">{msg.message}</div>\n                  ) : (\n                    <div className=\"prose prose-sm max-w-none dark:prose-invert prose-neutral\">\n                      <ReactMarkdown \n                        remarkPlugins={[remarkGfm]}\n                        components={{\n                          h1: ({children}) => <h1 className=\"text-lg font-bold mb-2 text-neutral-800\">{children}</h1>,\n                          h2: ({children}) => <h2 className=\"text-base font-semibold mb-2 text-neutral-800\">{children}</h2>,\n                          h3: ({children}) => <h3 className=\"text-sm font-medium mb-1 text-neutral-800\">{children}</h3>,\n                          p: ({children}) => <p className=\"mb-2 leading-relaxed text-neutral-800\">{children}</p>,\n                          ul: ({children}) => <ul className=\"list-disc list-inside mb-2 space-y-1 text-neutral-800\">{children}</ul>,\n                          ol: ({children}) => <ol className=\"list-decimal list-inside mb-2 space-y-1 text-neutral-800\">{children}</ol>,\n                          li: ({children}) => <li className=\"text-neutral-800\">{children}</li>,\n                          blockquote: ({children}) => <blockquote className=\"border-l-2 border-neutral-400 pl-2 italic mb-2 bg-neutral-50 py-1 text-neutral-700\">{children}</blockquote>,\n                          code: ({children}) => <code className=\"bg-neutral-200 px-1 py-0.5 rounded text-xs font-mono text-neutral-900\">{children}</code>,\n                          pre: ({children}) => <pre className=\"bg-neutral-200 p-2 rounded-md overflow-x-auto mb-2 text-xs\">{children}</pre>,\n                          strong: ({children}) => <strong className=\"font-semibold text-neutral-900\">{children}</strong>,\n                          em: ({children}) => <em className=\"italic text-neutral-700\">{children}</em>,\n                          table: ({children}) => <table className=\"w-full border-collapse border border-neutral-300 mb-2 text-xs\">{children}</table>,\n                          th: ({children}) => <th className=\"border border-neutral-300 px-2 py-1 bg-neutral-200 font-semibold text-neutral-900\">{children}</th>,\n                          td: ({children}) => <td className=\"border border-neutral-300 px-2 py-1 text-neutral-800\">{children}</td>,\n                          a: ({href, children}) => <a href={href} className=\"text-blue-600 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">{children}</a>\n                        }}\n                      >\n                        {msg.message}\n                      </ReactMarkdown>\n                    </div>\n                  )}\n                  <div className={`text-xs mt-1 ${\n                    msg.senderRole === 'user' ? 'text-blue-100' : 'text-neutral-500'\n                  }`}>\n                    {formatTime(msg.timestamp || new Date())}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n\n          {/* AI Response Streaming State */}\n          {isAIResponding && (\n            <div className=\"flex gap-3 justify-start\">\n              <div className=\"flex gap-3 max-w-[80%]\">\n                <div className=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-neutral-200 text-neutral-600\">\n                  <Bot size={16} />\n                </div>\n                <div className=\"rounded-lg p-3 bg-neutral-100 text-neutral-800\">\n                  {streamingMessage ? (\n                    <div>\n                      <div className=\"prose prose-sm max-w-none dark:prose-invert prose-neutral\">\n                        <ReactMarkdown \n                          remarkPlugins={[remarkGfm]}\n                          components={{\n                            h1: ({children}) => <h1 className=\"text-lg font-bold mb-2 text-neutral-800\">{children}</h1>,\n                            h2: ({children}) => <h2 className=\"text-base font-semibold mb-2 text-neutral-800\">{children}</h2>,\n                            h3: ({children}) => <h3 className=\"text-sm font-medium mb-1 text-neutral-800\">{children}</h3>,\n                            p: ({children}) => <p className=\"mb-2 leading-relaxed text-neutral-800\">{children}</p>,\n                            ul: ({children}) => <ul className=\"list-disc list-inside mb-2 space-y-1 text-neutral-800\">{children}</ul>,\n                            ol: ({children}) => <ol className=\"list-decimal list-inside mb-2 space-y-1 text-neutral-800\">{children}</ol>,\n                            li: ({children}) => <li className=\"text-neutral-800\">{children}</li>,\n                            blockquote: ({children}) => <blockquote className=\"border-l-2 border-neutral-400 pl-2 italic mb-2 bg-neutral-50 py-1 text-neutral-700\">{children}</blockquote>,\n                            code: ({children}) => <code className=\"bg-neutral-200 px-1 py-0.5 rounded text-xs font-mono text-neutral-900\">{children}</code>,\n                            pre: ({children}) => <pre className=\"bg-neutral-200 p-2 rounded-md overflow-x-auto mb-2 text-xs\">{children}</pre>,\n                            strong: ({children}) => <strong className=\"font-semibold text-neutral-900\">{children}</strong>,\n                            em: ({children}) => <em className=\"italic text-neutral-700\">{children}</em>,\n                            table: ({children}) => <table className=\"w-full border-collapse border border-neutral-300 mb-2 text-xs\">{children}</table>,\n                            th: ({children}) => <th className=\"border border-neutral-300 px-2 py-1 bg-neutral-200 font-semibold text-neutral-900\">{children}</th>,\n                            td: ({children}) => <td className=\"border border-neutral-300 px-2 py-1 text-neutral-800\">{children}</td>,\n                            a: ({href, children}) => <a href={href} className=\"text-blue-600 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">{children}</a>\n                          }}\n                        >\n                          {streamingMessage}\n                        </ReactMarkdown>\n                        <span className=\"inline-block w-2 h-5 bg-neutral-400 ml-1 animate-pulse\"></span>\n                      </div>\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <div className=\"animate-pulse flex space-x-1\">\n                          <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\"></div>\n                          <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                          <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n                        </div>\n                        <span className=\"text-xs text-blue-600 font-medium\">AI v√°laszol...</span>\n                        {isGeneratingAudio && (\n                          <span className=\"text-xs text-green-600 font-medium flex items-center gap-1\">\n                            <Volume2 size={12} />\n                            hang gener√°l√°s...\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"w-2 h-2 bg-neutral-400 rounded-full animate-bounce\"></div>\n                        <div className=\"w-2 h-2 bg-neutral-400 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                        <div className=\"w-2 h-2 bg-neutral-400 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n                      </div>\n                      <span className=\"text-sm text-neutral-500\">AI v√°laszol...</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n          \n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input Area */}\n        <div className=\"p-4 border-t border-neutral-100\">\n          <div className=\"flex flex-wrap gap-2\">\n            <Input\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder=\"√çrj egy √ºzenetet vagy haszn√°ld a mikrofont...\"\n              disabled={isAIResponding || isRecording}\n              className=\"flex-1\"\n            />\n            \n            {/* Voice Recording Button */}\n            <Button\n              onClick={isRecording ? stopRecording : startRecording}\n              disabled={isAIResponding}\n              variant={isRecording ? \"destructive\" : \"outline\"}\n              className={isRecording ? \"animate-pulse\" : \"\"}\n            >\n              {isRecording ? <MicOff size={16} /> : <Mic size={16} />}\n            </Button>\n\n            {/* Audio Control Button - Always visible */}\n            <Button\n              onClick={toggleAudioPlayback}\n              variant=\"outline\"\n              className=\"flex items-center gap-1\"\n              disabled={!currentAudio}\n              title={currentAudio ? (isPlaying ? \"Pause\" : \"Play\") : \"No audio\"}\n            >\n              {isPlaying ? <Pause size={16} /> : <Play size={16} />}\n              <span className=\"text-xs ml-1\">\n                {isPlaying ? \"Pause\" : \"Play\"}\n              </span>\n            </Button>\n\n            {/* Stop Button - appears when AI is responding or audio is playing */}\n            {(isAIResponding || isPlaying) && (\n              <Button\n                onClick={() => {\n                  // Stop audio playback\n                  if (currentAudio) {\n                    currentAudio.pause();\n                    setCurrentAudio(null);\n                    setIsPlaying(false);\n                  }\n                  \n                  // Cancel ongoing AI request\n                  if (abortController) {\n                    abortController.abort();\n                    setAbortController(null);\n                  }\n                  \n                  setIsAIResponding(false);\n                }}\n                variant=\"destructive\"\n                className=\"flex items-center gap-1\"\n              >\n                <Square size={16} />\n                Le√°ll√≠t√°s\n              </Button>\n            )}\n\n            {/* Send Button */}\n            <Button\n              onClick={handleSendMessage}\n              disabled={!message.trim() || isAIResponding || isRecording}\n              className=\"bg-primary hover:bg-blue-700\"\n            >\n              {isAIResponding ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n              ) : (\n                <Send size={16} />\n              )}\n            </Button>\n          </div>\n          \n          {/* Recording Status */}\n          {isRecording && (\n            <div className=\"mt-2 text-sm text-red-600 flex items-center gap-2\">\n              <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\n              Felv√©tel folyamatban... Kattints a mikrofon gombra a le√°ll√≠t√°shoz.\n            </div>\n          )}\n\n\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":38622},"client/src/components/chat-interface.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Bot, Send, User, Trash2, Mic, MicOff, Volume2, Play, Pause, Square, FileText, Brain } from \"lucide-react\";\nimport type { ChatMessage } from \"@shared/schema\";\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\ninterface ChatInterfaceProps {\n  userId: string;\n  moduleId?: number;\n  predefinedMessage?: string;\n  onQuizStart?: () => void;\n}\n\nexport default function ChatInterface({ userId, moduleId, onQuizStart }: ChatInterfaceProps) {\n  const [message, setMessage] = useState(\"\");\n  const [isRecording, setIsRecording] = useState(false);\n  const [mediaRecorder, setMediaRecorder] = useState<MediaRecorder | null>(null);\n  const [audioChunks, setAudioChunks] = useState<Blob[]>([]);\n  const [currentAudio, setCurrentAudio] = useState<HTMLAudioElement | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [abortController, setAbortController] = useState<AbortController | null>(null);\n  const [lastRequestId, setLastRequestId] = useState<string | null>(null);\n  const currentAudioUrlRef = useRef<string | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const [isAIResponding, setIsAIResponding] = useState(false);\n  const [streamingMessage, setStreamingMessage] = useState(\"\");\n  const [isGeneratingAudio, setIsGeneratingAudio] = useState(false);\n  const streamingAudioChunks = useRef<string[]>([]);\n  const synchronizedAudioQueue = useRef<{buffer: Uint8Array, timestamp: number, text: string}[]>([]);\n  const [playbackStartTime, setPlaybackStartTime] = useState<number>(0);\n  const firstChunkTimestamp = useRef<number | null>(null);\n  \n  // Live conversation state - ENHANCED WITH SYNCHRONIZATION\n  const [isLiveConversationActive, setIsLiveConversationActive] = useState(false);\n  const isLiveConversationActiveRef = useRef(false);\n  const [isWaitingForUserSpeech, setIsWaitingForUserSpeech] = useState(false);\n  const liveConversationTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const allowAudioPlaybackRef = useRef<boolean>(true);\n  const audioQueueProcessing = useRef<boolean>(false);\n  \n  // Enhanced state tracking for debugging\n  const recordingCycleCountRef = useRef<number>(0);\n  const lastRecordingStartTime = useRef<number | null>(null);\n\n  // Handle unhandled promise rejections for audio playback\n  useEffect(() => {\n    const handleUnhandledRejection = (event: PromiseRejectionEvent) => {\n      // Check if the rejection is related to audio interruption\n      if (event.reason?.message?.includes('interrupted') || \n          event.reason?.name === 'AbortError' ||\n          event.reason?.message?.includes('play') ||\n          event.reason?.message?.includes('audio')) {\n        event.preventDefault();\n        console.log('Audio interruption handled gracefully');\n      }\n    };\n\n    window.addEventListener('unhandledrejection', handleUnhandledRejection);\n    \n    return () => {\n      window.removeEventListener('unhandledrejection', handleUnhandledRejection);\n    };\n  }, []);\n\n  // Cleanup live conversation on unmount\n  useEffect(() => {\n    return () => {\n      if (isLiveConversationActive) {\n        stopLiveConversation();\n      }\n    };\n  }, []);\n\n  // Auto-scroll helper functions\n  const scrollToBottom = () => {\n    if (messagesEndRef.current) {\n      messagesEndRef.current.scrollIntoView({ behavior: \"smooth\" });\n    }\n  };\n\n  const isNearBottom = () => {\n    if (!containerRef.current) return true;\n    const { scrollTop, scrollHeight, clientHeight } = containerRef.current;\n    return scrollHeight - scrollTop - clientHeight < 100; // 100px threshold\n  };\n\n  const { data: messages = [], isLoading, refetch } = useQuery({\n    queryKey: ['/api/chat/messages', moduleId],\n    queryFn: async () => {\n      const params = moduleId ? `?moduleId=${moduleId}` : '';\n      const response = await fetch(`/api/chat/messages${params}`, {\n        credentials: 'include'\n      });\n      if (!response.ok) throw new Error('Failed to fetch messages');\n      const data = await response.json();\n      return data;\n    },\n    enabled: !!userId,\n  });\n\n  const deleteMessagesMutation = useMutation({\n    mutationFn: async () => {\n      const response = await fetch('/api/chat/messages', {\n        method: 'DELETE',\n        credentials: 'include',\n      });\n      if (!response.ok) throw new Error('Failed to delete messages');\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n      toast({\n        title: \"Besz√©lget√©s t√∂r√∂lve\",\n        description: \"Az √∂sszes √ºzenet sikeresen t√∂r√∂lve lett.\",\n      });\n    },\n    onError: (error) => {\n      console.error('Error deleting messages:', error);\n      if (isUnauthorizedError(error)) {\n        window.location.href = '/login';\n        return;\n      }\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt t√∂r√∂lni az √ºzeneteket.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Auto-scroll when messages array grows (new AI response added)\n  useEffect(() => {\n    if (messages.length > 0 && isNearBottom()) {\n      scrollToBottom();\n    }\n  }, [messages.length]);\n\n  // Auto-scroll during streaming (handles first chunk and continuation)\n  useEffect(() => {\n    if (streamingMessage && isNearBottom()) {\n      scrollToBottom();\n    }\n  }, [streamingMessage]);\n\n  const sendSynchronizedStreamingMessage = async (messageText: string) => {\n    setIsAIResponding(true);\n    setStreamingMessage(\"\");\n    setIsGeneratingAudio(true);\n    \n    const processAudioQueue = async () => {\n      if (audioQueueProcessing.current || synchronizedAudioQueue.current.length === 0 || !allowAudioPlaybackRef.current) {\n        return;\n      }\n      \n      audioQueueProcessing.current = true;\n      const audioChunk = synchronizedAudioQueue.current.shift();\n      \n      if (audioChunk && allowAudioPlaybackRef.current) {\n        try {\n          const audioBlob = new Blob([audioChunk.buffer], { type: 'audio/mpeg' });\n          const audioUrl = URL.createObjectURL(audioBlob);\n          const audio = new Audio(audioUrl);\n          \n          console.log(`Playing audio chunk (${audioChunk.text.length} chars): \"${audioChunk.text.substring(0, 50)}...\" at ${audioChunk.timestamp}ms`);\n          \n          audio.onplay = () => {\n            // Guard against playback if stopped during the brief window between play() and onplay\n            if (!allowAudioPlaybackRef.current) {\n              audio.pause();\n              URL.revokeObjectURL(audioUrl);\n              setCurrentAudio(null);\n              if (currentAudioUrlRef.current === audioUrl) {\n                currentAudioUrlRef.current = null;\n              }\n              audioQueueProcessing.current = false;\n              return;\n            }\n            setIsPlaying(true);\n            setIsGeneratingAudio(false);\n            console.log(`üîä Audio chunk started playing: ${audioChunk.text.substring(0, 30)}...`);\n          };\n          audio.onended = () => {\n            console.log(`‚úÖ Audio chunk finished: ${audioChunk.text.substring(0, 30)}...`);\n            URL.revokeObjectURL(audioUrl);\n            if (currentAudioUrlRef.current === audioUrl) {\n              currentAudioUrlRef.current = null;\n            }\n            setIsPlaying(false);\n            audioQueueProcessing.current = false;\n            \n            if (allowAudioPlaybackRef.current) {\n              // Continue processing the audio queue immediately\n              const nextProcessTimeout = setTimeout(() => {\n                processAudioQueue();\n                \n                // ENHANCED TIMING: Only restart recording cycle after ALL audio chunks are processed AND longer delay\n                // Check multiple times with increasing delays to ensure queue is truly empty and stable\n                setTimeout(() => {\n                  if (synchronizedAudioQueue.current.length === 0 && \n                      isLiveConversationActiveRef.current && \n                      !liveConversationTimeoutRef.current &&\n                      !audioQueueProcessing.current &&\n                      !isPlaying) {\n                    console.log('üé§ [TIMING FIX] All audio chunks completed, preparing to restart live recording cycle...', {\n                      conversationActive: isLiveConversationActiveRef.current,\n                      queueEmpty: synchronizedAudioQueue.current.length === 0,\n                      noTimeout: !liveConversationTimeoutRef.current,\n                      notProcessing: !audioQueueProcessing.current,\n                      notPlaying: !isPlaying,\n                      queueLength: synchronizedAudioQueue.current.length\n                    });\n                    \n                    // CRITICAL TIMING FIX: Wait much longer to ensure ALL audio processing is complete\n                    // This prevents microphone from starting during AI speech\n                    liveConversationTimeoutRef.current = setTimeout(() => {\n                      // Triple-check state before restarting cycle with enhanced validation\n                      const isQueueReallyEmpty = synchronizedAudioQueue.current.length === 0;\n                      const isConversationStillActive = isLiveConversationActiveRef.current;\n                      const isNotCurrentlyProcessing = !audioQueueProcessing.current;\n                      const isNotCurrentlyPlaying = !isPlaying;\n                      \n                      console.log('üé§ [RESTART VALIDATION] State check before restart:', {\n                        isQueueReallyEmpty,\n                        isConversationStillActive, \n                        isNotCurrentlyProcessing,\n                        isNotCurrentlyPlaying,\n                        allConditionsMet: isQueueReallyEmpty && isConversationStillActive && isNotCurrentlyProcessing && isNotCurrentlyPlaying\n                      });\n                      \n                      if (isQueueReallyEmpty && isConversationStillActive && isNotCurrentlyProcessing && isNotCurrentlyPlaying) {\n                        console.log('üé§ [RESTART] All conditions validated, starting new recording cycle');\n                        liveConversationTimeoutRef.current = null; // Clear timeout ref before starting\n                        startLiveRecordingCycle();\n                      } else {\n                        console.log('üé§ [RESTART] Conditions not met, skipping cycle restart');\n                        liveConversationTimeoutRef.current = null;\n                      }\n                    }, 6000); // INCREASED from 3000ms to 6000ms for better stability\n                  }\n                }, 500); // Increased from 200ms to 500ms for more stability\n              }, 100); // Increased from 50ms for better timing\n            }\n          };\n          audio.onerror = (error) => {\n            console.error(`‚ùå Audio chunk error: ${audioChunk.text.substring(0, 30)}...`, error);\n            URL.revokeObjectURL(audioUrl);\n            if (currentAudioUrlRef.current === audioUrl) {\n              currentAudioUrlRef.current = null;\n            }\n            setIsPlaying(false);\n            audioQueueProcessing.current = false;\n            \n            if (allowAudioPlaybackRef.current) {\n              // Continue with next chunk even on error with enhanced timing\n              setTimeout(() => {\n                processAudioQueue();\n                \n                // ENHANCED ERROR RECOVERY TIMING: Check if we need to restart recording after error\n                setTimeout(() => {\n                  if (synchronizedAudioQueue.current.length === 0 && \n                      isLiveConversationActiveRef.current && \n                      !liveConversationTimeoutRef.current &&\n                      !audioQueueProcessing.current &&\n                      !isPlaying) {\n                    console.log('üé§ [ERROR RECOVERY] Audio error recovery - preparing to restart live recording cycle...');\n                    \n                    // ENHANCED TIMING: Same longer delay as success path for consistency\n                    liveConversationTimeoutRef.current = setTimeout(() => {\n                      const isQueueReallyEmpty = synchronizedAudioQueue.current.length === 0;\n                      const isConversationStillActive = isLiveConversationActiveRef.current;\n                      const isNotCurrentlyProcessing = !audioQueueProcessing.current;\n                      const isNotCurrentlyPlaying = !isPlaying;\n                      \n                      console.log('üé§ [ERROR RECOVERY VALIDATION] State check after error:', {\n                        isQueueReallyEmpty,\n                        isConversationStillActive, \n                        isNotCurrentlyProcessing,\n                        isNotCurrentlyPlaying\n                      });\n                      \n                      if (isQueueReallyEmpty && isConversationStillActive && isNotCurrentlyProcessing && isNotCurrentlyPlaying) {\n                        console.log('üé§ [ERROR RECOVERY] Starting new recording cycle after error');\n                        liveConversationTimeoutRef.current = null;\n                        startLiveRecordingCycle();\n                      } else {\n                        console.log('üé§ [ERROR RECOVERY] Conditions not met, skipping restart after error');\n                        liveConversationTimeoutRef.current = null;\n                      }\n                    }, 6000); // INCREASED: Same 6000ms delay as success path\n                  }\n                }, 500); // INCREASED: Same 500ms delay as success path\n              }, 100);\n            }\n          };\n          \n          if (currentAudio) {\n            currentAudio.pause();\n            if (currentAudioUrlRef.current) {\n              URL.revokeObjectURL(currentAudioUrlRef.current);\n            }\n          }\n          setCurrentAudio(audio);\n          currentAudioUrlRef.current = audioUrl;\n          \n          // Handle audio play promise properly with better error recovery and enhanced timing\n          audio.play().catch(error => {\n            console.error(`‚ö†Ô∏è Audio play failed for chunk: ${audioChunk.text.substring(0, 30)}...`, error);\n            URL.revokeObjectURL(audioUrl);\n            if (currentAudioUrlRef.current === audioUrl) {\n              currentAudioUrlRef.current = null;\n            }\n            setIsPlaying(false);\n            audioQueueProcessing.current = false;\n            \n            if (allowAudioPlaybackRef.current) {\n              // Continue processing queue even if this chunk failed with enhanced timing\n              setTimeout(() => {\n                processAudioQueue();\n                \n                // ENHANCED PLAY FAILURE RECOVERY: Check restart conditions after play failure with better timing\n                setTimeout(() => {\n                  if (synchronizedAudioQueue.current.length === 0 && \n                      isLiveConversationActiveRef.current && \n                      !liveConversationTimeoutRef.current &&\n                      !audioQueueProcessing.current &&\n                      !isPlaying) {\n                    console.log('üé§ [PLAY FAILURE] Audio play failure recovery - preparing to restart live recording cycle...');\n                    \n                    // ENHANCED TIMING: Same consistent delay as other recovery paths\n                    liveConversationTimeoutRef.current = setTimeout(() => {\n                      const isQueueReallyEmpty = synchronizedAudioQueue.current.length === 0;\n                      const isConversationStillActive = isLiveConversationActiveRef.current;\n                      const isNotCurrentlyProcessing = !audioQueueProcessing.current;\n                      const isNotCurrentlyPlaying = !isPlaying;\n                      \n                      console.log('üé§ [PLAY FAILURE VALIDATION] State check after play failure:', {\n                        isQueueReallyEmpty,\n                        isConversationStillActive, \n                        isNotCurrentlyProcessing,\n                        isNotCurrentlyPlaying\n                      });\n                      \n                      if (isQueueReallyEmpty && isConversationStillActive && isNotCurrentlyProcessing && isNotCurrentlyPlaying) {\n                        console.log('üé§ [PLAY FAILURE] Starting new recording cycle after play failure');\n                        liveConversationTimeoutRef.current = null;\n                        startLiveRecordingCycle();\n                      } else {\n                        console.log('üé§ [PLAY FAILURE] Conditions not met, skipping restart after play failure');\n                        liveConversationTimeoutRef.current = null;\n                      }\n                    }, 6000); // INCREASED: Same 6000ms delay as other paths for consistency\n                  }\n                }, 500); // INCREASED: Same 500ms delay as other paths\n              }, 100);\n            }\n          });\n          \n        } catch (error) {\n          console.error('Error playing synchronized audio chunk:', error);\n          audioQueueProcessing.current = false;\n          if (allowAudioPlaybackRef.current) {\n            setTimeout(processAudioQueue, 100);\n          }\n        }\n      } else {\n        audioQueueProcessing.current = false;\n      }\n    };\n\n    try {\n      const controller = new AbortController();\n      setAbortController(controller);\n\n      const response = await fetch('/api/chat/message/synchronized-stream', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        signal: controller.signal,\n        body: JSON.stringify({\n          message: messageText,\n          relatedModuleId: moduleId,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Network response was not ok');\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n\n      while (true) {\n        const { done, value } = await reader!.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              \n              switch (data.type) {\n                case 'user_message':\n                  queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n                  break;\n                case 'text_chunk':\n                  setStreamingMessage(prev => prev + data.data);\n                  break;\n                case 'audio_chunk':\n                  if (data.data) {\n                    try {\n                      const audioData = atob(data.data);\n                      const bytes = new Uint8Array(audioData.length);\n                      for (let i = 0; i < audioData.length; i++) {\n                        bytes[i] = audioData.charCodeAt(i);\n                      }\n                      \n                      // Normalize timestamps to start from 0\n                      if (firstChunkTimestamp.current === null) {\n                        firstChunkTimestamp.current = data.timestamp;\n                        console.log(`üéµ First audio chunk baseline: ${data.timestamp}ms`);\n                      }\n                      \n                      const normalizedTimestamp = data.timestamp - (firstChunkTimestamp.current || 0);\n                      \n                      synchronizedAudioQueue.current.push({\n                        buffer: bytes,\n                        timestamp: normalizedTimestamp,\n                        text: data.text\n                      });\n                      \n                      if (!audioQueueProcessing.current && synchronizedAudioQueue.current.length === 1) {\n                        setTimeout(processAudioQueue, Math.max(0, normalizedTimestamp));\n                      }\n                    } catch (error) {\n                      console.error('Error processing synchronized audio chunk:', error);\n                    }\n                  }\n                  break;\n                case 'final_audio':\n                  console.log('üéµ Received final_audio event, data length:', data.data?.length || 0);\n                  if (data.data) {\n                    try {\n                      const audioData = atob(data.data);\n                      const bytes = new Uint8Array(audioData.length);\n                      for (let i = 0; i < audioData.length; i++) {\n                        bytes[i] = audioData.charCodeAt(i);\n                      }\n                      \n                      console.log('üéµ Processing final audio, buffer size:', bytes.length);\n                      \n                      // For final audio, play immediately without timestamp synchronization\n                      const audioBlob = new Blob([bytes], { type: 'audio/mpeg' });\n                      const audioUrl = URL.createObjectURL(audioBlob);\n                      const audio = new Audio(audioUrl);\n                      \n                      audio.onplay = () => {\n                        setIsPlaying(true);\n                        setIsGeneratingAudio(false);\n                        console.log('üîä Final audio started playing');\n                      };\n                      \n                      audio.onended = () => {\n                        console.log('‚úÖ [FINAL AUDIO] Final audio finished playing');\n                        URL.revokeObjectURL(audioUrl);\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        if (currentAudioUrlRef.current === audioUrl) {\n                          currentAudioUrlRef.current = null;\n                        }\n                        \n                        // ENHANCED TIMING: Apply same timing logic as synchronized audio chunks for consistency\n                        if (allowAudioPlaybackRef.current && isLiveConversationActiveRef.current) {\n                          console.log('üé§ [FINAL AUDIO] Preparing to restart live conversation after final audio');\n                          \n                          // Use same enhanced timing as other audio completion paths\n                          setTimeout(() => {\n                            if (!liveConversationTimeoutRef.current &&\n                                isLiveConversationActiveRef.current &&\n                                !audioQueueProcessing.current &&\n                                !isPlaying &&\n                                !isGeneratingAudio) {\n                              console.log('üé§ [FINAL AUDIO] All conditions met, restarting live recording after final audio');\n                              \n                              liveConversationTimeoutRef.current = setTimeout(() => {\n                                const isConversationStillActive = isLiveConversationActiveRef.current;\n                                const isNotCurrentlyProcessing = !audioQueueProcessing.current;\n                                const isNotCurrentlyPlaying = !isPlaying;\n                                const isNotGenerating = !isGeneratingAudio;\n                                \n                                console.log('üé§ [FINAL AUDIO VALIDATION] State check after final audio:', {\n                                  isConversationStillActive, \n                                  isNotCurrentlyProcessing,\n                                  isNotCurrentlyPlaying,\n                                  isNotGenerating\n                                });\n                                \n                                if (isConversationStillActive && isNotCurrentlyProcessing && isNotCurrentlyPlaying && isNotGenerating) {\n                                  console.log('üé§ [FINAL AUDIO] Starting new recording cycle after final audio');\n                                  liveConversationTimeoutRef.current = null;\n                                  startLiveRecordingCycle();\n                                } else {\n                                  console.log('üé§ [FINAL AUDIO] Conditions not met, skipping restart after final audio');\n                                  liveConversationTimeoutRef.current = null;\n                                }\n                              }, 6000); // Same 6000ms delay as synchronized audio\n                            }\n                          }, 500); // Same 500ms delay as synchronized audio\n                        }\n                      };\n                      \n                      audio.onerror = (error) => {\n                        console.error('‚ùå [FINAL AUDIO ERROR] Final audio error:', error);\n                        URL.revokeObjectURL(audioUrl);\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        if (currentAudioUrlRef.current === audioUrl) {\n                          currentAudioUrlRef.current = null;\n                        }\n                        \n                        // ENHANCED ERROR RECOVERY: Apply same error recovery timing as synchronized audio\n                        if (allowAudioPlaybackRef.current && isLiveConversationActiveRef.current) {\n                          console.log('üé§ [FINAL AUDIO ERROR] Preparing error recovery after final audio failure');\n                          \n                          setTimeout(() => {\n                            if (!liveConversationTimeoutRef.current &&\n                                isLiveConversationActiveRef.current &&\n                                !audioQueueProcessing.current &&\n                                !isPlaying &&\n                                !isGeneratingAudio) {\n                              console.log('üé§ [FINAL AUDIO ERROR] Starting recovery after final audio error');\n                              \n                              liveConversationTimeoutRef.current = setTimeout(() => {\n                                const isConversationStillActive = isLiveConversationActiveRef.current;\n                                const isNotCurrentlyProcessing = !audioQueueProcessing.current;\n                                const isNotCurrentlyPlaying = !isPlaying;\n                                const isNotGenerating = !isGeneratingAudio;\n                                \n                                console.log('üé§ [FINAL AUDIO ERROR VALIDATION] State check after final audio error:', {\n                                  isConversationStillActive, \n                                  isNotCurrentlyProcessing,\n                                  isNotCurrentlyPlaying,\n                                  isNotGenerating\n                                });\n                                \n                                if (isConversationStillActive && isNotCurrentlyProcessing && isNotCurrentlyPlaying && isNotGenerating) {\n                                  console.log('üé§ [FINAL AUDIO ERROR] Starting new recording cycle after final audio error');\n                                  liveConversationTimeoutRef.current = null;\n                                  startLiveRecordingCycle();\n                                } else {\n                                  console.log('üé§ [FINAL AUDIO ERROR] Conditions not met, skipping restart after final audio error');\n                                  liveConversationTimeoutRef.current = null;\n                                }\n                              }, 6000); // Same 6000ms delay as synchronized audio error recovery\n                            }\n                          }, 500); // Same 500ms delay as synchronized audio error recovery\n                        }\n                      };\n                      \n                      // Stop any currently playing audio\n                      if (currentAudio) {\n                        currentAudio.pause();\n                        if (currentAudioUrlRef.current) {\n                          URL.revokeObjectURL(currentAudioUrlRef.current);\n                        }\n                      }\n                      \n                      setCurrentAudio(audio);\n                      currentAudioUrlRef.current = audioUrl;\n                      \n                      // Play the final audio\n                      audio.play().catch(error => {\n                        console.error('‚ö†Ô∏è Final audio play failed:', error);\n                        URL.revokeObjectURL(audioUrl);\n                        setIsPlaying(false);\n                        setCurrentAudio(null);\n                        if (currentAudioUrlRef.current === audioUrl) {\n                          currentAudioUrlRef.current = null;\n                        }\n                      });\n                      \n                    } catch (error) {\n                      console.error('Error processing final audio:', error);\n                    }\n                  }\n                  break;\n                case 'ai_complete':\n                  setIsAIResponding(false);\n                  setStreamingMessage('');\n                  queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n                  break;\n                case 'done':\n                  setIsAIResponding(false);\n                  setIsGeneratingAudio(false);\n                  break;\n                case 'error':\n                  throw new Error(data.message || 'Stream error');\n              }\n            } catch (parseError) {\n              console.error('Error parsing stream data:', parseError);\n            }\n          }\n        }\n      }\n\n    } catch (error: any) {\n      // Only show error if it's not an AbortError (user cancelled)\n      if (error?.name !== 'AbortError') {\n        console.error('Synchronized streaming error:', error);\n        toast({\n          title: \"Szinkroniz√°lt streaming hiba\",\n          description: \"A szinkroniz√°lt v√°lasz gener√°l√°sa sikertelen volt\",\n          variant: \"destructive\",\n        });\n      }\n      \n      setIsAIResponding(false);\n      setStreamingMessage('');\n      setIsGeneratingAudio(false);\n      \n      // Clean up audio queue and current audio\n      synchronizedAudioQueue.current = [];\n      if (currentAudio) {\n        currentAudio.pause();\n        setCurrentAudio(null);\n        setIsPlaying(false);\n      }\n      \n      // Clean up current audio URL in error case\n      if (currentAudioUrlRef.current) {\n        URL.revokeObjectURL(currentAudioUrlRef.current);\n        currentAudioUrlRef.current = null;\n      }\n    } finally {\n      setAbortController(null);\n    }\n  };\n\n  const sendStreamingMessage = async (messageText: string) => {\n    setIsAIResponding(true);\n    setStreamingMessage(\"\");\n    \n    let isVoiceRequest = messageText.includes('Hangos magyar√°zat k√©r√©se');\n    \n    if (isVoiceRequest && (isGeneratingAudio || isPlaying)) {\n      toast({\n        title: \"Hangos felolvas√°s m√°r folyamatban\",\n        description: \"V√°rj, am√≠g befejez≈ëdik az aktu√°lis felolvas√°s.\",\n        variant: \"destructive\",\n      });\n      setIsAIResponding(false);\n      return;\n    }\n    \n    if (currentAudio) {\n      currentAudio.pause();\n      setCurrentAudio(null);\n      setIsPlaying(false);\n    }\n\n    if (isVoiceRequest) {\n      setIsGeneratingAudio(true);\n    }\n\n    try {\n      const controller = new AbortController();\n      setAbortController(controller);\n\n      const response = await fetch('/api/chat/message/stream', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        signal: controller.signal,\n        body: JSON.stringify({\n          message: messageText,\n          relatedModuleId: moduleId,\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Network response was not ok');\n      }\n\n      const reader = response.body?.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n\n      while (true) {\n        const { done, value } = await reader!.read();\n        if (done) break;\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            try {\n              const data = JSON.parse(line.slice(6));\n              \n              switch (data.type) {\n                case 'user_message':\n                  queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n                  break;\n                case 'text_chunk':\n                  setStreamingMessage(prev => prev + data.data);\n                  break;\n                case 'ai_complete':\n                  setIsAIResponding(false);\n                  setStreamingMessage('');\n                  queryClient.invalidateQueries({ queryKey: ['/api/chat/messages'] });\n                  break;\n                case 'done':\n                  setIsAIResponding(false);\n                  break;\n                case 'error':\n                  throw new Error(data.message || 'Stream error');\n              }\n            } catch (parseError) {\n              console.error('Error parsing stream data:', parseError);\n            }\n          }\n        }\n      }\n\n    } catch (error: any) {\n      // Only show error if it's not an AbortError (user cancelled)\n      if (error?.name !== 'AbortError') {\n        console.error('Streaming error:', error);\n        toast({\n          title: \"Streaming hiba\",\n          description: \"A v√°lasz gener√°l√°sa sikertelen volt\",\n          variant: \"destructive\",\n        });\n      }\n      \n      setIsAIResponding(false);\n      setStreamingMessage('');\n      setIsGeneratingAudio(false);\n      \n      // Clean up current audio if playing\n      if (currentAudio) {\n        currentAudio.pause();\n        setCurrentAudio(null);\n        setIsPlaying(false);\n      }\n    } finally {\n      setAbortController(null);\n    }\n  };\n\n  const formatTime = (timestamp: Date | string) => {\n    const date = new Date(timestamp);\n    return date.toLocaleTimeString('hu-HU', { \n      hour: '2-digit', \n      minute: '2-digit' \n    });\n  };\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      const recorder = new MediaRecorder(stream);\n      \n      recorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          setAudioChunks(prev => [...prev, event.data]);\n        }\n      };\n      \n      recorder.onstop = async () => {\n        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });\n        await sendVoiceMessage(audioBlob);\n        setAudioChunks([]);\n        \n        stream.getTracks().forEach(track => track.stop());\n      };\n      \n      setMediaRecorder(recorder);\n      recorder.start();\n      setIsRecording(true);\n    } catch (error) {\n      console.error('Error starting recording:', error);\n      toast({\n        title: \"Felv√©teli hiba\",\n        description: \"Nem siker√ºlt elind√≠tani a hangfelv√©telt.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorder && isRecording) {\n      mediaRecorder.stop();\n      setIsRecording(false);\n      setMediaRecorder(null);\n    }\n  };\n\n  const sendVoiceMessage = async (audioBlob: Blob) => {\n    setIsAIResponding(true);\n    \n    try {\n      // STEP 1: First transcribe the audio using the correct endpoint\n      const formData = new FormData();\n      formData.append('audio', audioBlob, 'voice_message.webm');\n\n      console.log('üé§ Transcribing audio for voice message...');\n      const transcribeResponse = await fetch('/api/chat/transcribe', {\n        method: 'POST',\n        credentials: 'include',\n        body: formData,\n      });\n\n      if (!transcribeResponse.ok) {\n        throw new Error('Audio transcription failed');\n      }\n\n      const transcriptionResult = await transcribeResponse.json();\n      const transcribedText = transcriptionResult.text;\n      \n      if (!transcribedText || transcribedText.trim().length === 0) {\n        throw new Error('No speech detected in audio');\n      }\n\n      console.log('üé§ Transcription successful:', transcribedText);\n      \n      // STEP 2: Send the transcribed text as a regular streaming message\n      await sendStreamingMessage(transcribedText);\n      \n      toast({\n        title: \"Hang√ºzenet feldolgozva\",\n        description: `Felismert sz√∂veg: \"${transcribedText}\"`,\n      });\n    } catch (error) {\n      console.error('Voice message error:', error);\n      toast({\n        title: \"Hang√ºzenet hiba\",\n        description: error instanceof Error ? error.message : \"Nem siker√ºlt feldolgozni a hang√ºzenetet.\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsAIResponding(false);\n    }\n  };\n\n  const handleSendMessage = () => {\n    if (!message.trim() || isAIResponding) return;\n    \n    // Trigger auto-scroll for new message submission\n    setTimeout(() => {\n      if (isNearBottom()) {\n        scrollToBottom();\n      }\n    }, 100);\n    \n    sendStreamingMessage(message);\n    setMessage(\"\");\n  };\n\n  const handleKeyPress = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage();\n    }\n  };\n\n  const toggleAudioPlayback = () => {\n    if (!currentAudio) return;\n    \n    if (isPlaying) {\n      currentAudio.pause();\n      setIsPlaying(false);\n    } else {\n      currentAudio.play();\n      setIsPlaying(true);\n    }\n  };\n\n  // Transcribe audio for live conversation without sending as message\n  const transcribeAudioForLiveChat = async (audioBlob: Blob): Promise<string> => {\n    try {\n      const formData = new FormData();\n      formData.append('audio', audioBlob, 'live_voice.webm');\n\n      const response = await fetch('/api/chat/transcribe', {\n        method: 'POST',\n        credentials: 'include',\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error('Transcription failed');\n      }\n\n      const result = await response.json();\n      return result.text || '';\n    } catch (error) {\n      console.error('Transcription error:', error);\n      throw error;\n    }\n  };\n\n  // Generate welcome audio directly with TTS (no AI needed)\n  const generateWelcomeAudio = async (text: string, onFinished?: () => void) => {\n    try {\n      console.log('üîä Welcome message:', text);\n      \n      // Show visual toast AND play welcome audio\n      toast({\n        title: \"üé§ Besz√©lj b√°tran!\",\n        description: text,\n        duration: 3000,\n      });\n      \n      // Generate and play welcome audio using direct TTS\n      try {\n        const response = await fetch('/api/chat/tts-direct', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          credentials: 'include',\n          body: JSON.stringify({ text }),\n        });\n        \n        if (response.ok) {\n          const audioBuffer = await response.arrayBuffer();\n          const audioBlob = new Blob([audioBuffer], { type: 'audio/mp3' });\n          const audioUrl = URL.createObjectURL(audioBlob);\n          \n          const audio = new Audio(audioUrl);\n          audio.volume = 0.8;\n          \n          // CRITICAL FIX: Wait for audio to finish before starting microphone\n          audio.onended = () => {\n            URL.revokeObjectURL(audioUrl);\n            console.log('üîä Welcome audio finished, now starting microphone...');\n            \n            // Start microphone only AFTER welcome audio finishes\n            if (onFinished) {\n              onFinished();\n            }\n          };\n          \n          // Handle autoplay blocked case\n          audio.onerror = () => {\n            console.log('üîä Welcome audio error, starting microphone anyway');\n            URL.revokeObjectURL(audioUrl);\n            if (onFinished) {\n              onFinished();\n            }\n          };\n          \n          try {\n            await audio.play();\n          } catch (err) {\n            console.log('Autoplay blocked, starting microphone immediately:', err);\n            URL.revokeObjectURL(audioUrl);\n            if (onFinished) {\n              onFinished();\n            }\n          }\n        } else {\n          console.log('üîä TTS response not OK, starting microphone immediately');\n          if (onFinished) {\n            onFinished();\n          }\n        }\n      } catch (audioError) {\n        console.log('Welcome audio failed, starting microphone immediately:', audioError);\n        if (onFinished) {\n          onFinished();\n        }\n      }\n      \n    } catch (error) {\n      console.error('Welcome message error:', error);\n      // Always call the callback even on error\n      if (onFinished) {\n        onFinished();\n      }\n    }\n  };\n\n  // ENHANCED: Synchronize state variables to prevent desync\n  const syncLiveConversationState = (active: boolean, reason: string) => {\n    console.log(`üîÑ [STATE] Syncing live conversation state to ${active} - Reason: ${reason}`);\n    setIsLiveConversationActive(active);\n    isLiveConversationActiveRef.current = active;\n    \n    if (active) {\n      recordingCycleCountRef.current = 0;\n    }\n    \n    console.log(`üîÑ [STATE] State synchronized: isLiveConversationActive=${active}, ref=${isLiveConversationActiveRef.current}`);\n  };\n\n  // Start live conversation mode - ENHANCED\n  const startLiveConversation = async () => {\n    if (isLiveConversationActiveRef.current) {\n      console.log('üîÑ [STATE] Stopping existing live conversation before starting new one');\n      stopLiveConversation();\n      return;\n    }\n\n    console.log('üîÑ [STATE] Starting live conversation with enhanced state management');\n    \n    // Enable audio playback deterministically\n    allowAudioPlaybackRef.current = true;\n    \n    // Clear any stale queue/state before starting\n    synchronizedAudioQueue.current = [];\n    firstChunkTimestamp.current = null; // Reset timestamp baseline\n    recordingCycleCountRef.current = 0;\n    \n    // Clear any existing timeouts to prevent conflicts\n    if (liveConversationTimeoutRef.current) {\n      clearTimeout(liveConversationTimeoutRef.current);\n      liveConversationTimeoutRef.current = null;\n      console.log('üîÑ [STATE] Cleared existing timeout before starting');\n    }\n\n    // ENHANCED: Use synchronized state setter\n    syncLiveConversationState(true, \"User initiated live conversation\");\n\n    toast({\n      title: \"√âl≈ë besz√©lget√©s elind√≠tva\",\n      description: \"V√°rj, am√≠g befejezem az √ºdv√∂zl√©st...\",\n    });\n    \n    try {\n      // FIXED: Wait for welcome audio to finish before starting microphone\n      console.log('üîä Starting welcome audio...');\n      \n      const startMicrophoneAfterWelcome = () => {\n        console.log('üé§ Welcome audio completed, now starting microphone recording cycle...');\n        \n        // Double-check state is still active before starting microphone\n        if (!isLiveConversationActiveRef.current) {\n          console.log('üé§ [WARNING] Live conversation was stopped during welcome audio, aborting microphone start');\n          return;\n        }\n        \n        setIsWaitingForUserSpeech(true);\n        lastRecordingStartTime.current = Date.now();\n        startLiveRecordingCycle(true);\n        \n        // Update toast to show that user can now speak\n        toast({\n          title: \"üé§ Most m√°r besz√©lhetsz!\",\n          description: \"Az √©l≈ë besz√©lget√©s akt√≠v, besz√©lj b√°tran!\",\n          duration: 2000,\n        });\n      };\n      \n      // Play welcome audio and wait for it to finish\n      await generateWelcomeAudio(\"Szia! √âl≈ë besz√©lget√©s akt√≠v. V√°rd meg am√≠g befejezem, azt√°n besz√©lj!\", startMicrophoneAfterWelcome);\n      \n    } catch (error) {\n      console.error('üîÑ [ERROR] Error starting live conversation:', error);\n      syncLiveConversationState(false, \"Error during startup\");\n      setIsWaitingForUserSpeech(false);\n      \n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt elind√≠tani az √©l≈ë besz√©lget√©st. Pr√≥b√°ld √∫jra!\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Stop live conversation mode - ENHANCED\n  const stopLiveConversation = () => {\n    console.log('üîÑ [STATE] Stopping live conversation with enhanced cleanup');\n    \n    // ENHANCED: Use synchronized state setter\n    syncLiveConversationState(false, \"User stopped or system cleanup\");\n    setIsWaitingForUserSpeech(false);\n    \n    // Disable audio playback to prevent queued audio from playing\n    allowAudioPlaybackRef.current = false;\n    \n    // Clear audio queue and revoke any pending object URLs\n    synchronizedAudioQueue.current = [];\n    audioQueueProcessing.current = false;\n    \n    // ENHANCED: More thorough timeout cleanup\n    if (liveConversationTimeoutRef.current) {\n      console.log('üîÑ [CLEANUP] Clearing live conversation timeout');\n      clearTimeout(liveConversationTimeoutRef.current);\n      liveConversationTimeoutRef.current = null;\n    }\n\n    // Stop any ongoing recording with enhanced cleanup\n    if (mediaRecorder && isRecording) {\n      console.log('üîÑ [CLEANUP] Stopping ongoing recording');\n      try {\n        mediaRecorder.stop();\n      } catch (e) {\n        console.warn('üîÑ [CLEANUP] MediaRecorder stop error (expected during cleanup):', e);\n      }\n      setIsRecording(false);\n      setMediaRecorder(null);\n    }\n\n    // Stop any playing audio\n    if (currentAudio) {\n      console.log('üîÑ [CLEANUP] Stopping current audio playback');\n      currentAudio.pause();\n      currentAudio.currentTime = 0;\n      setCurrentAudio(null);\n      setIsPlaying(false);\n      \n      // Revoke current audio URL to prevent memory leak\n      if (currentAudioUrlRef.current) {\n        URL.revokeObjectURL(currentAudioUrlRef.current);\n        currentAudioUrlRef.current = null;\n      }\n    }\n\n    // Cancel AI response if ongoing\n    if (abortController) {\n      console.log('üîÑ [CLEANUP] Aborting ongoing AI request');\n      abortController.abort();\n      setAbortController(null);\n    }\n\n    setIsAIResponding(false);\n    setStreamingMessage('');\n    setIsGeneratingAudio(false);\n    \n    // Reset recording cycle counter\n    recordingCycleCountRef.current = 0;\n    lastRecordingStartTime.current = null;\n\n    // Re-enable audio playback for future use (non-live conversations)\n    setTimeout(() => {\n      allowAudioPlaybackRef.current = true;\n      console.log('üîÑ [STATE] Audio playback re-enabled for future use');\n    }, 500);\n\n    toast({\n      title: \"√âl≈ë besz√©lget√©s le√°ll√≠tva\",\n      description: \"A besz√©lget√©s befejezve.\",\n    });\n  };\n\n  // Live recording cycle for conversation - FIXED VERSION\n  const startLiveRecordingCycle = async (isActive = isLiveConversationActiveRef.current) => {\n    // Enhanced debugging for state tracking\n    console.log('üé§ [DEBUG] startLiveRecordingCycle called with:', {\n      isActive,\n      isLiveConversationActiveRef: isLiveConversationActiveRef.current,\n      isRecording,\n      isWaitingForUserSpeech,\n      isPlaying\n    });\n\n    // Prevent multiple simultaneous recording cycles\n    if (!isActive || isRecording || isWaitingForUserSpeech) {\n      console.log('üé§ Recording already active or not allowed, skipping');\n      return;\n    }\n\n    // Additional safety check\n    if (!isLiveConversationActiveRef.current) {\n      console.log('üé§ [SAFETY] Live conversation not active, aborting cycle');\n      return;\n    }\n\n    try {\n      // CRITICAL TIMING FIX: Do not start recording if audio is currently playing\n      if (isPlaying || isGeneratingAudio || audioQueueProcessing.current) {\n        console.log('üé§ [TIMING FIX] Skipping recording start - audio system busy:', {\n          isPlaying,\n          isGeneratingAudio,\n          audioQueueProcessing: audioQueueProcessing.current,\n          queueLength: synchronizedAudioQueue.current.length\n        });\n        \n        // ENHANCED TIMING: Schedule retry with much longer delay to ensure audio system is fully idle\n        liveConversationTimeoutRef.current = setTimeout(() => {\n          console.log('üé§ [TIMING FIX] Retrying recording start after audio system idle period');\n          liveConversationTimeoutRef.current = null;\n          startLiveRecordingCycle();\n        }, 8000); // INCREASED from 5000ms to 8000ms for complete audio finish\n        return;\n      }\n\n      console.log('üé§ Starting live recording cycle...');\n      setIsWaitingForUserSpeech(true);\n      \n      // Start recording for user input with enhanced audio processing\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          autoGainControl: true,\n          sampleRate: 16000,\n        }\n      });\n      console.log('üé§ Media stream acquired');\n      \n      // ENHANCED: Use let instead of const to prevent closure issues\n      let recorder: MediaRecorder | null = null;\n      let recordedChunks: Blob[] = [];\n      let recordingCompleted = false;\n      \n      try {\n        recorder = new MediaRecorder(stream, {\n          mimeType: 'audio/webm;codecs=opus'\n        });\n      } catch (e) {\n        // Fallback for browsers that don't support opus\n        console.warn('üé§ Opus codec not supported, falling back to default');\n        recorder = new MediaRecorder(stream);\n      }\n      \n      recorder.ondataavailable = (event) => {\n        console.log('üé§ [ENHANCED] Data available:', {\n          size: event.data.size,\n          type: event.data.type,\n          currentChunks: recordedChunks.length,\n          recordingCompleted,\n          conversationActive: isLiveConversationActiveRef.current\n        });\n        \n        if (event.data.size > 0 && !recordingCompleted) {\n          recordedChunks.push(event.data);\n          console.log('üé§ [ENHANCED] Chunk added, total chunks:', recordedChunks.length);\n        }\n      };\n      \n      recorder.onstop = async () => {\n        recordingCompleted = true;\n        console.log('üé§ [ENHANCED] Recording stopped. State:', {\n          chunks: recordedChunks.length,\n          totalSize: recordedChunks.reduce((acc, chunk) => acc + chunk.size, 0),\n          conversationActive: isLiveConversationActiveRef.current,\n          isActive: isActive\n        });\n        \n        setIsWaitingForUserSpeech(false);\n        setIsRecording(false);\n        setMediaRecorder(null);\n        \n        // Clean up stream immediately\n        stream.getTracks().forEach(track => {\n          track.stop();\n          console.log('üé§ Track stopped:', track.kind, track.label);\n        });\n        \n        // ENHANCED: More detailed validation with specific error logging\n        const hasChunks = recordedChunks.length > 0;\n        const totalSize = recordedChunks.reduce((acc, chunk) => acc + chunk.size, 0);\n        const conversationStillActive = isLiveConversationActiveRef.current;\n        \n        console.log('üé§ [VALIDATION] Checking conditions:', {\n          hasChunks,\n          totalSize,\n          conversationStillActive,\n          shouldProceed: hasChunks && totalSize > 0 && conversationStillActive\n        });\n        \n        if (!hasChunks || totalSize === 0) {\n          console.error('üé§ [ERROR] No audio data captured!');\n          if (conversationStillActive) {\n            liveConversationTimeoutRef.current = setTimeout(() => {\n              startLiveRecordingCycle();\n            }, 3000); // Shorter retry for data issues\n          }\n          return;\n        }\n        \n        if (!conversationStillActive) {\n          console.log('üé§ [INFO] Conversation no longer active, stopping');\n          return;\n        }\n\n        const audioBlob = new Blob(recordedChunks, { type: 'audio/webm' });\n        console.log('üé§ [ENHANCED] Audio blob created:', {\n          size: audioBlob.size,\n          type: audioBlob.type,\n          chunksUsed: recordedChunks.length\n        });\n        \n        // SAFETY: Double-check blob size\n        if (audioBlob.size === 0) {\n          console.error('üé§ [ERROR] Created blob is empty despite having chunks!');\n          if (isLiveConversationActiveRef.current) {\n            liveConversationTimeoutRef.current = setTimeout(() => {\n              startLiveRecordingCycle();\n            }, 3000);\n          }\n          return;\n        }\n        \n        try {\n          // Transcribe the audio\n          console.log('üé§ Starting transcription with blob size:', audioBlob.size);\n          const transcribedText = await transcribeAudioForLiveChat(audioBlob);\n          console.log('üé§ Transcription result:', transcribedText);\n          \n          // ENHANCED echo/noise filtering with better empty audio detection\n          const lowerText = transcribedText.toLowerCase().trim();\n          const isValidTranscription = transcribedText && \n            transcribedText.trim().length > 3 && // Minimum 3 characters (reduced for short questions)\n            !lowerText.includes('amara.org') &&\n            !lowerText.includes('k√∂sz√∂n√∂m') &&\n            !lowerText.includes('feliratok') &&\n            !lowerText.includes('angol feliratok') &&\n            !lowerText.includes('kapcsold be') &&\n            !lowerText.includes('tetszik') &&\n            !lowerText.includes('l√°jkolj') &&\n            !lowerText.includes('oszd meg') &&\n            !lowerText.includes('vide√≥t') &&\n            !lowerText.includes('megn√©zted') &&\n            !lowerText.includes('youtube') &&\n            !lowerText.includes('subscribe') &&\n            !lowerText.includes('channel') &&\n            // ENHANCED validation: Better detection of actual speech vs noise\n            transcribedText.split(' ').length >= 1 && // At least 1 word (for very short questions)\n            // Block obvious repetitive patterns and common transcription errors\n            !lowerText.match(/(.{5,})\\s*\\1/g) &&\n            // Block common empty audio transcription results\n            !lowerText.includes('thank you') &&\n            !lowerText.includes('thanks for watching') &&\n            !lowerText.includes('bye') &&\n            !lowerText.includes('see you later') &&\n            lowerText !== 'you' && \n            lowerText !== 'thank' &&\n            lowerText !== 'thanks' &&\n            lowerText !== '';\n          \n          if (isValidTranscription && isLiveConversationActiveRef.current) {\n            console.log('üé§ [SUCCESS] Valid transcription, sending to AI:', transcribedText);\n            \n            // ENHANCED STATE MANAGEMENT: Disable audio playback ref during AI processing to prevent interference\n            allowAudioPlaybackRef.current = true; // Ensure audio playback is allowed for response\n            \n            // Send the transcribed text to AI and get voice response with prefix for audio\n            await sendSynchronizedStreamingMessage(`Hangos magyar√°zat k√©r√©se: ${transcribedText}`);\n            \n            // Audio playback processing is now handled in enhanced timing within processAudioQueue\n            console.log('üé§ [ENHANCED] AI response sent, audio timing management is handled by enhanced queue processing');\n          } else if (isLiveConversationActiveRef.current) {\n            // Invalid/filtered transcription, try again with longer delay for stability\n            console.log('üé§ [VALIDATION] Invalid or filtered transcription, trying again with enhanced timing...', {\n              textLength: transcribedText.length,\n              wordCount: transcribedText.split(' ').length,\n              isValid: isValidTranscription,\n              transcriptionPreview: transcribedText.substring(0, 50)\n            });\n            \n            // ENHANCED TIMING: Longer delay for invalid transcriptions to avoid rapid retries\n            liveConversationTimeoutRef.current = setTimeout(() => {\n              liveConversationTimeoutRef.current = null;\n              startLiveRecordingCycle();\n            }, 4000); // INCREASED from 3000ms to 4000ms for better stability\n          }\n        } catch (error) {\n          console.error('üé§ [ERROR] Error processing live conversation:', error);\n          if (isLiveConversationActiveRef.current) {\n            toast({\n              title: \"Besz√©dfelismer√©si hiba\",\n              description: \"Pr√≥b√°ld √∫jra besz√©lni.\",\n              variant: \"destructive\",\n            });\n            // Continue the conversation despite the error\n            liveConversationTimeoutRef.current = setTimeout(() => {\n              startLiveRecordingCycle();\n            }, 3000); // Shorter retry for errors\n          }\n        }\n      };\n      \n      setMediaRecorder(recorder);\n      recorder.start(1000); // Collect data every 1 second for better chunk management\n      setIsRecording(true);\n      \n      console.log('üé§ [ENHANCED] Recording started with improved chunk collection');\n      \n      // Auto-stop recording after 8 seconds to get user input (shorter time)\n      setTimeout(() => {\n        if (recorder && recorder.state === 'recording') {\n          console.log('üé§ [ENHANCED] Auto-stopping recording after timeout');\n          recorder.stop();\n        }\n      }, 8000);\n      \n    } catch (error) {\n      console.error('üé§ [ERROR] Error starting live recording cycle:', error);\n      setIsWaitingForUserSpeech(false);\n      setIsRecording(false);\n      toast({\n        title: \"Mikrofonhozz√°f√©r√©si hiba\",\n        description: \"Nem siker√ºlt el√©rni a mikrofont.\",\n        variant: \"destructive\",\n      });\n      stopLiveConversation();\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Card className=\"h-full\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bot className=\"h-5 w-5 text-blue-600\" />\n            AI Tan√°r Chat\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-center h-64\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bot className=\"h-5 w-5 text-blue-600\" />\n            AI Tan√°r Chat\n            {moduleId && <Badge variant=\"secondary\">Module {moduleId}</Badge>}\n          </CardTitle>\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => deleteMessagesMutation.mutate()}\n            disabled={deleteMessagesMutation.isPending}\n            className=\"text-red-600 hover:text-red-700\"\n          >\n            <Trash2 size={16} />\n          </Button>\n        </div>\n      </CardHeader>\n      {/* AI funkci√≥k fix poz√≠ci√≥ban a chat tetej√©n */}\n      <div className=\"p-4 bg-orange-50 border-b border-orange-200\">\n        <h4 className=\"font-semibold text-orange-800 mb-3 flex items-center gap-2\">\n          <Bot className=\"h-4 w-4\" />\n          AI funkci√≥k\n        </h4>\n        <div className=\"space-y-2\">\n          <Button \n            variant={isLiveConversationActive ? \"destructive\" : \"default\"} \n            className={`w-full justify-start ${\n              isLiveConversationActive \n                ? \"bg-red-500 hover:bg-red-600 text-white\" \n                : \"bg-green-500 hover:bg-green-600 text-white\"\n            }`}\n            onClick={startLiveConversation}\n            disabled={isAIResponding || isGeneratingAudio || isPlaying}\n          >\n            <Mic className=\"h-4 w-4 mr-2\" />\n            {isLiveConversationActive ? \"√âl≈ë besz√©lget√©s le√°ll√≠t√°sa\" : \"√âl≈ë besz√©lget√©s ind√≠t√°sa\"}\n            {(isWaitingForUserSpeech || isRecording) && (\n              <div className=\"ml-2 flex items-center gap-1\">\n                <div className=\"w-1 h-1 bg-green-500 rounded-full animate-bounce\"></div>\n                <div className=\"w-1 h-1 bg-green-500 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                <div className=\"w-1 h-1 bg-green-500 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n              </div>\n            )}\n          </Button>\n          <Button \n            variant=\"outline\" \n            className=\"w-full justify-start border-blue-300 text-blue-700 hover:bg-blue-50\"\n            onClick={() => {\n              sendSynchronizedStreamingMessage(`Hangos magyar√°zat k√©r√©se err≈ël a modulr√≥l`);\n            }}\n            disabled={isAIResponding || isGeneratingAudio || isPlaying}\n          >\n            <Volume2 className=\"h-4 w-4 mr-2\" />\n            Hangos magyar√°zat (Szinkroniz√°lt)\n            {(isGeneratingAudio || isPlaying) && (\n              <div className=\"ml-2 flex items-center gap-1\">\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full animate-bounce\"></div>\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                <div className=\"w-1 h-1 bg-blue-500 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n              </div>\n            )}\n          </Button>\n          <Button \n            variant=\"outline\" \n            className=\"w-full justify-start border-pink-300 text-pink-700 hover:bg-pink-50\"\n            onClick={onQuizStart}\n            disabled={isAIResponding}\n          >\n            <Brain className=\"h-4 w-4 mr-2\" />\n            Tud√°spr√≥ba\n          </Button>\n        </div>\n      </div>\n      <CardContent className=\"flex-1 flex flex-col p-4 bg-[#9c8e8e4f]\">\n        <div ref={containerRef} className=\"flex-1 overflow-y-auto space-y-4 mb-4 max-h-96 scroll-smooth\">\n          {/* Messages */}\n          {(messages as ChatMessage[]).filter((msg: ChatMessage) => !msg.isSystemMessage).map((msg: ChatMessage) => (\n            <div\n              key={msg.id}\n              className={`flex gap-3 ${msg.senderRole === 'user' ? 'justify-end' : 'justify-start'}`}\n            >\n              <div className={`flex gap-3 max-w-[80%] ${msg.senderRole === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>\n                <div className={`w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ${\n                  msg.senderRole === 'user' \n                    ? 'bg-blue-500 text-white' \n                    : 'bg-neutral-200 text-neutral-600'\n                }`}>\n                  {msg.senderRole === 'user' ? <User size={16} /> : <Bot size={16} />}\n                </div>\n                <div className={`rounded-lg p-3 ${\n                  msg.senderRole === 'user'\n                    ? 'bg-blue-500 text-white'\n                    : 'bg-neutral-100 text-neutral-800'\n                }`}>\n                  {msg.senderRole === 'user' ? (\n                    <div className=\"whitespace-pre-wrap break-words\">{msg.message}</div>\n                  ) : (\n                    <div className=\"prose prose-sm max-w-none dark:prose-invert prose-neutral\">\n                      <ReactMarkdown \n                        remarkPlugins={[remarkGfm]}\n                        components={{\n                          h1: ({children}) => <h1 className=\"text-lg font-bold mb-2 text-neutral-800\">{children}</h1>,\n                          h2: ({children}) => <h2 className=\"text-base font-semibold mb-2 text-neutral-800\">{children}</h2>,\n                          h3: ({children}) => <h3 className=\"text-sm font-medium mb-1 text-neutral-800\">{children}</h3>,\n                          p: ({children}) => <p className=\"mb-2 leading-relaxed text-neutral-800\">{children}</p>,\n                          ul: ({children}) => <ul className=\"list-disc list-inside mb-2 space-y-1 text-neutral-800\">{children}</ul>,\n                          ol: ({children}) => <ol className=\"list-decimal list-inside mb-2 space-y-1 text-neutral-800\">{children}</ol>,\n                          li: ({children}) => <li className=\"text-neutral-800\">{children}</li>,\n                          blockquote: ({children}) => <blockquote className=\"border-l-2 border-neutral-400 pl-2 italic mb-2 bg-neutral-50 py-1 text-neutral-700\">{children}</blockquote>,\n                          code: ({children}) => <code className=\"bg-neutral-200 px-1 py-0.5 rounded text-xs font-mono text-neutral-900\">{children}</code>,\n                          pre: ({children}) => <pre className=\"bg-neutral-200 p-2 rounded-md overflow-x-auto mb-2 text-xs\">{children}</pre>,\n                          strong: ({children}) => <strong className=\"font-semibold text-neutral-900\">{children}</strong>,\n                          em: ({children}) => <em className=\"italic text-neutral-700\">{children}</em>,\n                          table: ({children}) => <table className=\"w-full border-collapse border border-neutral-300 mb-2 text-xs\">{children}</table>,\n                          th: ({children}) => <th className=\"border border-neutral-300 px-2 py-1 bg-neutral-200 font-semibold text-neutral-900\">{children}</th>,\n                          td: ({children}) => <td className=\"border border-neutral-300 px-2 py-1 text-neutral-800\">{children}</td>,\n                          a: ({href, children}) => <a href={href} className=\"text-blue-600 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">{children}</a>\n                        }}\n                      >\n                        {msg.message}\n                      </ReactMarkdown>\n                    </div>\n                  )}\n                  <div className={`text-xs mt-1 ${\n                    msg.senderRole === 'user' ? 'text-blue-100' : 'text-neutral-500'\n                  }`}>\n                    {formatTime(msg.timestamp || new Date())}\n                  </div>\n                </div>\n              </div>\n            </div>\n          ))}\n\n          {/* AI Response Streaming State */}\n          {isAIResponding && (\n            <div className=\"flex gap-3 justify-start\">\n              <div className=\"flex gap-3 max-w-[80%]\">\n                <div className=\"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-neutral-200 text-neutral-600\">\n                  <Bot size={16} />\n                </div>\n                <div className=\"rounded-lg p-3 bg-neutral-100 text-neutral-800\">\n                  {streamingMessage ? (\n                    <div>\n                      <div className=\"prose prose-sm max-w-none dark:prose-invert prose-neutral\">\n                        <ReactMarkdown \n                          remarkPlugins={[remarkGfm]}\n                          components={{\n                            h1: ({children}) => <h1 className=\"text-lg font-bold mb-2 text-neutral-800\">{children}</h1>,\n                            h2: ({children}) => <h2 className=\"text-base font-semibold mb-2 text-neutral-800\">{children}</h2>,\n                            h3: ({children}) => <h3 className=\"text-sm font-medium mb-1 text-neutral-800\">{children}</h3>,\n                            p: ({children}) => <p className=\"mb-2 leading-relaxed text-neutral-800\">{children}</p>,\n                            ul: ({children}) => <ul className=\"list-disc list-inside mb-2 space-y-1 text-neutral-800\">{children}</ul>,\n                            ol: ({children}) => <ol className=\"list-decimal list-inside mb-2 space-y-1 text-neutral-800\">{children}</ol>,\n                            li: ({children}) => <li className=\"text-neutral-800\">{children}</li>,\n                            blockquote: ({children}) => <blockquote className=\"border-l-2 border-neutral-400 pl-2 italic mb-2 bg-neutral-50 py-1 text-neutral-700\">{children}</blockquote>,\n                            code: ({children}) => <code className=\"bg-neutral-200 px-1 py-0.5 rounded text-xs font-mono text-neutral-900\">{children}</code>,\n                            pre: ({children}) => <pre className=\"bg-neutral-200 p-2 rounded-md overflow-x-auto mb-2 text-xs\">{children}</pre>,\n                            strong: ({children}) => <strong className=\"font-semibold text-neutral-900\">{children}</strong>,\n                            em: ({children}) => <em className=\"italic text-neutral-700\">{children}</em>,\n                            table: ({children}) => <table className=\"w-full border-collapse border border-neutral-300 mb-2 text-xs\">{children}</table>,\n                            th: ({children}) => <th className=\"border border-neutral-300 px-2 py-1 bg-neutral-200 font-semibold text-neutral-900\">{children}</th>,\n                            td: ({children}) => <td className=\"border border-neutral-300 px-2 py-1 text-neutral-800\">{children}</td>,\n                            a: ({href, children}) => <a href={href} className=\"text-blue-600 hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">{children}</a>\n                          }}\n                        >\n                          {streamingMessage}\n                        </ReactMarkdown>\n                        <span className=\"inline-block w-2 h-5 bg-neutral-400 ml-1 animate-pulse\"></span>\n                      </div>\n                      <div className=\"flex items-center gap-2 mt-2\">\n                        <div className=\"animate-pulse flex space-x-1\">\n                          <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\"></div>\n                          <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                          <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n                        </div>\n                        <span className=\"text-xs text-neutral-500\">AI v√°laszol...</span>\n                        {isGeneratingAudio && (\n                          <span className=\"text-xs text-blue-600 flex items-center gap-1\">\n                            <Volume2 size={12} />\n                            Hang gener√°l√°sa...\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"flex items-center gap-2\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\"></div>\n                        <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style={{animationDelay: '0.1s'}}></div>\n                        <div className=\"w-1 h-1 bg-blue-400 rounded-full animate-bounce\" style={{animationDelay: '0.2s'}}></div>\n                      </div>\n                      <span className=\"text-neutral-600\">V√°lasz k√©sz√≠t√©se...</span>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input area */}\n        <div className=\"border-t pt-4\">\n          <div className=\"flex gap-2 items-end\">\n            <Input\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              onKeyPress={handleKeyPress}\n              placeholder=\"√çrj √ºzenetet az AI tan√°rnak...\"\n              disabled={isAIResponding || isRecording}\n              className=\"flex-1\"\n            />\n            \n            {/* Voice Recording Button */}\n            <Button\n              onClick={isRecording ? stopRecording : startRecording}\n              disabled={isAIResponding}\n              variant={isRecording ? \"destructive\" : \"outline\"}\n              className={isRecording ? \"animate-pulse\" : \"\"}\n            >\n              {isRecording ? <MicOff size={16} /> : <Mic size={16} />}\n            </Button>\n\n            {/* Audio Control Button */}\n            <Button\n              onClick={toggleAudioPlayback}\n              variant=\"outline\"\n              className=\"flex items-center gap-1\"\n              disabled={!currentAudio}\n              title={currentAudio ? (isPlaying ? \"Pause\" : \"Play\") : \"No audio\"}\n            >\n              {isPlaying ? <Pause size={16} /> : <Play size={16} />}\n              <span className=\"text-xs ml-1\">\n                {isPlaying ? \"Pause\" : \"Play\"}\n              </span>\n            </Button>\n\n            {/* Stop Button */}\n            {(isAIResponding || isPlaying) && (\n              <Button\n                onClick={() => {\n                  if (currentAudio) {\n                    currentAudio.pause();\n                    setCurrentAudio(null);\n                    setIsPlaying(false);\n                  }\n                  \n                  if (abortController) {\n                    abortController.abort();\n                    setAbortController(null);\n                  }\n                  \n                  setIsAIResponding(false);\n                }}\n                variant=\"destructive\"\n                className=\"flex items-center gap-1\"\n              >\n                <Square size={16} />\n                Le√°ll√≠t√°s\n              </Button>\n            )}\n\n            {/* Send Button */}\n            <Button\n              onClick={handleSendMessage}\n              disabled={!message.trim() || isAIResponding || isRecording}\n              className=\"bg-primary hover:bg-blue-700\"\n            >\n              {isAIResponding ? (\n                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n              ) : (\n                <Send size={16} />\n              )}\n            </Button>\n          </div>\n          \n          {/* Recording Status */}\n          {isRecording && (\n            <div className=\"mt-2 text-sm text-red-600 flex items-center gap-2\">\n              <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\n              Felv√©tel folyamatban... Kattints a mikrofon gombra a le√°ll√≠t√°shoz.\n            </div>\n          )}\n        </div>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":74513},"client/src/components/custom-cursor.tsx":{"content":"import { useEffect, useState } from 'react';\n\nexport default function CustomCursor() {\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n  const [isHovering, setIsHovering] = useState(false);\n\n  useEffect(() => {\n    // Check if device supports mouse (not mobile)\n    const isMobile = window.matchMedia('(hover: none)').matches;\n    if (isMobile) return;\n\n    const updateMousePosition = (e: MouseEvent) => {\n      setMousePosition({ x: e.clientX, y: e.clientY });\n    };\n\n    const handleMouseEnter = () => setIsHovering(true);\n    const handleMouseLeave = () => setIsHovering(false);\n\n    // Add event listeners\n    document.addEventListener('mousemove', updateMousePosition);\n    \n    // Add hover listeners to interactive elements\n    const interactiveElements = document.querySelectorAll('button, a, input, [role=\"button\"]');\n    interactiveElements.forEach(element => {\n      element.addEventListener('mouseenter', handleMouseEnter);\n      element.addEventListener('mouseleave', handleMouseLeave);\n    });\n\n    return () => {\n      document.removeEventListener('mousemove', updateMousePosition);\n      interactiveElements.forEach(element => {\n        element.removeEventListener('mouseenter', handleMouseEnter);\n        element.removeEventListener('mouseleave', handleMouseLeave);\n      });\n    };\n  }, []);\n\n  // Don't render on mobile devices\n  if (window.matchMedia('(hover: none)').matches) {\n    return null;\n  }\n\n  return (\n    <>\n      {/* Cursor dot */}\n      <div\n        className=\"custom-cursor-dot\"\n        style={{\n          left: mousePosition.x - 4,\n          top: mousePosition.y - 4,\n          transform: isHovering ? 'scale(1.5)' : 'scale(1)',\n          background: isHovering ? '#8b5cf6' : '#3b82f6'\n        }}\n      />\n      \n      {/* Cursor ring */}\n      <div\n        className=\"custom-cursor-ring\"\n        style={{\n          left: mousePosition.x - (isHovering ? 25 : 20),\n          top: mousePosition.y - (isHovering ? 25 : 20),\n          width: isHovering ? 50 : 40,\n          height: isHovering ? 50 : 40,\n          borderColor: isHovering ? 'rgba(139, 92, 246, 0.6)' : 'rgba(59, 130, 246, 0.3)'\n        }}\n      />\n    </>\n  );\n}","size_bytes":2183},"client/src/components/dynamic-background.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\n\ninterface FloatingElement {\n  id: number;\n  x: number;\n  y: number;\n  size: number;\n  color: string;\n  speed: number;\n}\n\nexport default function DynamicBackground() {\n  const [elements, setElements] = useState<FloatingElement[]>([]);\n  const [mousePosition, setMousePosition] = useState({ x: 0, y: 0 });\n\n  useEffect(() => {\n    // Dinamikus elemek gener√°l√°sa\n    const generateElements = () => {\n      const newElements: FloatingElement[] = [];\n      for (let i = 0; i < 12; i++) {\n        newElements.push({\n          id: i,\n          x: Math.random() * window.innerWidth,\n          y: Math.random() * window.innerHeight,\n          size: Math.random() * 20 + 10,\n          color: `hsl(${Math.random() * 360}, 70%, 60%)`,\n          speed: Math.random() * 2 + 0.5\n        });\n      }\n      setElements(newElements);\n    };\n\n    generateElements();\n\n    // Eg√©r k√∂vet√©se\n    const handleMouseMove = (e: MouseEvent) => {\n      setMousePosition({ x: e.clientX, y: e.clientY });\n    };\n\n    window.addEventListener('mousemove', handleMouseMove);\n    window.addEventListener('resize', generateElements);\n\n    return () => {\n      window.removeEventListener('mousemove', handleMouseMove);\n      window.removeEventListener('resize', generateElements);\n    };\n  }, []);\n\n  useEffect(() => {\n    // Anim√°lt mozg√°s\n    const interval = setInterval(() => {\n      setElements(prev => prev.map(element => ({\n        ...element,\n        x: (element.x + element.speed) % window.innerWidth,\n        y: element.y + Math.sin(Date.now() * 0.001 + element.id) * 0.5\n      })));\n    }, 50);\n\n    return () => clearInterval(interval);\n  }, []);\n\n  return (\n    <div className=\"fixed inset-0 pointer-events-none overflow-hidden\" style={{ zIndex: -1 }}>\n      {/* Gradient h√°tt√©r */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-purple-900 dark:to-blue-900\" />\n      \n      {/* Lebeg≈ë elemek */}\n      {elements.map((element) => (\n        <motion.div\n          key={element.id}\n          className=\"absolute rounded-full opacity-20 dark:opacity-10\"\n          style={{\n            left: element.x,\n            top: element.y,\n            width: element.size,\n            height: element.size,\n            background: `radial-gradient(circle, ${element.color}, transparent)`\n          }}\n          animate={{\n            scale: [1, 1.2, 1],\n            opacity: [0.2, 0.4, 0.2]\n          }}\n          transition={{\n            duration: 3,\n            repeat: Infinity,\n            ease: \"easeInOut\"\n          }}\n        />\n      ))}\n\n      {/* Eg√©r k√∂r√ºl glowing effekt */}\n      <motion.div\n        className=\"absolute w-32 h-32 rounded-full pointer-events-none\"\n        style={{\n          left: mousePosition.x - 64,\n          top: mousePosition.y - 64,\n          background: 'radial-gradient(circle, rgba(59, 130, 246, 0.1), transparent)',\n          filter: 'blur(20px)'\n        }}\n        animate={{\n          scale: [1, 1.5, 1],\n        }}\n        transition={{\n          duration: 2,\n          repeat: Infinity,\n          ease: \"easeInOut\"\n        }}\n      />\n\n      {/* Neural network hat√°s */}\n      <svg className=\"absolute inset-0 w-full h-full opacity-5 dark:opacity-10\">\n        <defs>\n          <pattern id=\"grid\" width=\"50\" height=\"50\" patternUnits=\"userSpaceOnUse\">\n            <path d=\"M 50 0 L 0 0 0 50\" fill=\"none\" stroke=\"currentColor\" strokeWidth=\"1\"/>\n          </pattern>\n        </defs>\n        <rect width=\"100%\" height=\"100%\" fill=\"url(#grid)\" />\n      </svg>\n    </div>\n  );\n}","size_bytes":3655},"client/src/components/enhanced-module-form.tsx":{"content":"import React, { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, Wand2, Youtube, Eye, EyeOff } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface EnhancedModuleFormProps {\n  onModuleCreated: (module: any) => void;\n  subjects: Array<{ id: number; name: string; }>;\n}\n\nexport function EnhancedModuleForm({ onModuleCreated, subjects }: EnhancedModuleFormProps) {\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [subjectId, setSubjectId] = useState<number | null>(null);\n  const [moduleNumber, setModuleNumber] = useState(1);\n  const [isGenerating, setIsGenerating] = useState(false);\n  const [isCreating, setIsCreating] = useState(false);\n  const [enhancedContent, setEnhancedContent] = useState<any>(null);\n  const [activeTab, setActiveTab] = useState('basic');\n  const { toast } = useToast();\n\n  const generateEnhancedContent = async () => {\n    if (!title || !content) {\n      toast({\n        title: \"Hi√°nyz√≥ adatok\",\n        description: \"C√≠m √©s alapvet≈ë tartalom sz√ºks√©ges\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsGenerating(true);\n    try {\n      const response = await apiRequest('POST', '/api/admin/modules/generate-enhanced', {\n        title,\n        content,\n        subjectId\n      });\n\n      if (response.ok) {\n        const enhanced = await response.json();\n        setEnhancedContent(enhanced);\n        setActiveTab('enhanced');\n        \n        toast({\n          title: \"Sikeres gener√°l√°s\",\n          description: \"Az AI elk√©sz√≠tette a t√∂m√∂r √©s b≈ëv√≠tett v√°ltozatokat YouTube vide√≥kkal\"\n        });\n      } else {\n        throw new Error('Failed to generate enhanced content');\n      }\n    } catch (error) {\n      console.error('Enhanced content generation error:', error);\n      toast({\n        title: \"Gener√°l√°si hiba\",\n        description: \"Nem siker√ºlt a b≈ëv√≠tett tartalmat elk√©sz√≠teni\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsGenerating(false);\n    }\n  };\n\n  const createModule = async () => {\n    if (!title || !content || !subjectId) {\n      toast({\n        title: \"Hi√°nyz√≥ adatok\",\n        description: \"C√≠m, tartalom √©s tant√°rgy sz√ºks√©ges\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    setIsCreating(true);\n    try {\n      const moduleData = {\n        title,\n        content,\n        subjectId,\n        moduleNumber,\n        conciseContent: enhancedContent?.conciseVersion || null,\n        detailedContent: enhancedContent?.detailedVersion || null,\n        keyConceptsData: enhancedContent?.keyConceptsWithVideos || null\n      };\n\n      const response = await apiRequest('POST', '/api/admin/modules/create-with-enhancement', moduleData);\n\n      if (response.ok) {\n        const module = await response.json();\n        onModuleCreated(module);\n        \n        // Reset form\n        setTitle('');\n        setContent('');\n        setSubjectId(null);\n        setModuleNumber(1);\n        setEnhancedContent(null);\n        setActiveTab('basic');\n        \n        toast({\n          title: \"Modul l√©trehozva\",\n          description: \"A b≈ëv√≠tett modul sikeresen ment√©sre ker√ºlt\"\n        });\n      } else {\n        throw new Error('Failed to create module');\n      }\n    } catch (error) {\n      console.error('Module creation error:', error);\n      toast({\n        title: \"L√©trehoz√°si hiba\",\n        description: \"Nem siker√ºlt a modult l√©trehozni\",\n        variant: \"destructive\"\n      });\n    } finally {\n      setIsCreating(false);\n    }\n  };\n\n  return (\n    <Card className=\"w-full\">\n      <CardHeader>\n        <CardTitle className=\"flex items-center gap-2\">\n          <Wand2 className=\"h-5 w-5\" />\n          B≈ëv√≠tett Modul L√©trehoz√°sa (AI + YouTube vide√≥k)\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <Tabs value={activeTab} onValueChange={setActiveTab}>\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"basic\">Alapadatok</TabsTrigger>\n            <TabsTrigger value=\"enhanced\" disabled={!enhancedContent}>\n              AI B≈ëv√≠t√©s\n            </TabsTrigger>\n            <TabsTrigger value=\"preview\" disabled={!enhancedContent}>\n              El≈ën√©zet\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"basic\" className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">Modul c√≠me</Label>\n                <Input\n                  id=\"title\"\n                  value={title}\n                  onChange={(e) => setTitle(e.target.value)}\n                  placeholder=\"pl. K√©miai tulajdons√°gok\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"module-number\">Modul sz√°ma</Label>\n                <Input\n                  id=\"module-number\"\n                  type=\"number\"\n                  value={moduleNumber}\n                  onChange={(e) => setModuleNumber(parseInt(e.target.value))}\n                  min={1}\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"subject\">Tant√°rgy</Label>\n              <select\n                id=\"subject\"\n                value={subjectId || ''}\n                onChange={(e) => setSubjectId(parseInt(e.target.value) || null)}\n                className=\"w-full p-2 border rounded-md\"\n              >\n                <option value=\"\">V√°lassz tant√°rgyat</option>\n                {subjects.map((subject) => (\n                  <option key={subject.id} value={subject.id}>\n                    {subject.name}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"content\">Alapvet≈ë tartalom</Label>\n              <Textarea\n                id=\"content\"\n                value={content}\n                onChange={(e) => setContent(e.target.value)}\n                placeholder=\"√çrj be egy alapvet≈ë tartalmat, az AI ebb≈ël fog t√∂m√∂r √©s b≈ëv√≠tett v√°ltozatot k√©sz√≠teni...\"\n                rows={8}\n              />\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button\n                onClick={generateEnhancedContent}\n                disabled={isGenerating || !title || !content}\n                className=\"flex-1\"\n              >\n                {isGenerating ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    AI dolgozik...\n                  </>\n                ) : (\n                  <>\n                    <Wand2 className=\"mr-2 h-4 w-4\" />\n                    AI B≈ëv√≠t√©s Gener√°l√°sa\n                  </>\n                )}\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"enhanced\" className=\"space-y-4\">\n            {enhancedContent && (\n              <div className=\"space-y-6\">\n                <div>\n                  <h3 className=\"text-lg font-semibold mb-2\">T√∂m√∂r verzi√≥</h3>\n                  <div className=\"p-4 bg-muted rounded-lg\">\n                    <p className=\"whitespace-pre-wrap\">{enhancedContent.conciseVersion}</p>\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"text-lg font-semibold mb-2\">B≈ëv√≠tett verzi√≥</h3>\n                  <div className=\"p-4 bg-muted rounded-lg\">\n                    <p className=\"whitespace-pre-wrap\">{enhancedContent.detailedVersion}</p>\n                  </div>\n                </div>\n\n                <div>\n                  <h3 className=\"text-lg font-semibold mb-2\">Kulcsfogalmak YouTube vide√≥kkal</h3>\n                  <div className=\"space-y-4\">\n                    {enhancedContent.keyConceptsWithVideos?.map((concept: any, index: number) => (\n                      <Card key={index}>\n                        <CardContent className=\"p-4\">\n                          <div className=\"flex items-start gap-3\">\n                            <Badge variant=\"outline\">{concept.concept}</Badge>\n                            <div className=\"flex-1\">\n                              <p className=\"text-sm text-muted-foreground mb-2\">\n                                {concept.definition}\n                              </p>\n                              {concept.youtubeVideos?.length > 0 && (\n                                <div className=\"space-y-2\">\n                                  <div className=\"flex items-center gap-1 text-sm font-medium\">\n                                    <Youtube className=\"h-4 w-4 text-red-500\" />\n                                    Kapcsol√≥d√≥ vide√≥k:\n                                  </div>\n                                  {concept.youtubeVideos.map((video: any, vIndex: number) => (\n                                    <div key={vIndex} className=\"pl-4 border-l-2 border-red-200\">\n                                      <a\n                                        href={video.url}\n                                        target=\"_blank\"\n                                        rel=\"noopener noreferrer\"\n                                        className=\"text-blue-600 hover:underline text-sm font-medium\"\n                                      >\n                                        {video.title}\n                                      </a>\n                                      <p className=\"text-xs text-muted-foreground mt-1\">\n                                        {video.description}\n                                      </p>\n                                    </div>\n                                  ))}\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"preview\" className=\"space-y-4\">\n            {enhancedContent && (\n              <div className=\"space-y-4\">\n                <div className=\"p-4 border border-green-200 bg-green-50 rounded-lg\">\n                  <h4 className=\"font-semibold text-green-800 mb-2\">Modul el≈ën√©zet</h4>\n                  <p className=\"text-sm text-green-700\">\n                    A modul 3 k√ºl√∂nb√∂z≈ë verzi√≥ban lesz el√©rhet≈ë: alapvet≈ë, t√∂m√∂r √©s b≈ëv√≠tett.\n                    A kulcsfogalmak automatikusan linkek lesznek a kapcsol√≥d√≥ YouTube vide√≥khoz.\n                  </p>\n                </div>\n\n                <Button\n                  onClick={createModule}\n                  disabled={isCreating}\n                  className=\"w-full\"\n                  size=\"lg\"\n                >\n                  {isCreating ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Modul l√©trehoz√°sa...\n                    </>\n                  ) : (\n                    'B≈ëv√≠tett Modul L√©trehoz√°sa'\n                  )}\n                </Button>\n              </div>\n            )}\n          </TabsContent>\n        </Tabs>\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":11753},"client/src/components/fast-preloader.tsx":{"content":"import { useEffect, useState } from 'react';\nimport { Brain } from 'lucide-react';\n\ninterface FastPreloaderProps {\n  onComplete?: () => void;\n  minDisplayTime?: number;\n}\n\nexport default function FastPreloader({ onComplete, minDisplayTime = 800 }: FastPreloaderProps) {\n  const [progress, setProgress] = useState(0);\n  const [isComplete, setIsComplete] = useState(false);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setProgress(prev => {\n        if (prev >= 100) {\n          clearInterval(interval);\n          setTimeout(() => {\n            setIsComplete(true);\n            onComplete?.();\n          }, 200);\n          return 100;\n        }\n        return prev + Math.random() * 15 + 5; // Smooth progress\n      });\n    }, 50);\n\n    // Minimum display time\n    const minTimer = setTimeout(() => {\n      if (progress >= 100) {\n        setIsComplete(true);\n        onComplete?.();\n      }\n    }, minDisplayTime);\n\n    return () => {\n      clearInterval(interval);\n      clearTimeout(minTimer);\n    };\n  }, [onComplete, minDisplayTime, progress]);\n\n  if (isComplete) return null;\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-optimized-gradient flex items-center justify-center\">\n      <div className=\"text-center space-y-6\">\n        {/* Animated Logo */}\n        <div className=\"relative\">\n          <div className=\"w-16 h-16 bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl flex items-center justify-center animate-pulse\">\n            <Brain className=\"text-white\" size={32} />\n          </div>\n          \n          {/* Rotating ring */}\n          <div className=\"absolute inset-0 border-4 border-transparent border-t-blue-500 rounded-xl animate-spin\"></div>\n        </div>\n\n        {/* Progress bar */}\n        <div className=\"w-64 h-2 bg-white/20 rounded-full overflow-hidden\">\n          <div \n            className=\"h-full bg-gradient-to-r from-blue-500 to-purple-500 transition-all duration-300 ease-out\"\n            style={{ width: `${Math.min(progress, 100)}%` }}\n          />\n        </div>\n\n        {/* Loading text */}\n        <div className=\"space-y-2\">\n          <h2 className=\"text-xl font-semibold text-gray-800\">Global Learning System</h2>\n          <p className=\"text-gray-600 animate-pulse\">Rendszer inicializ√°l√°sa...</p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":2324},"client/src/components/file-upload.tsx":{"content":"import React, { useState, useCallback } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Progress } from '@/components/ui/progress';\nimport { useToast } from '@/hooks/use-toast';\nimport { Upload, X, Image, Video, Music, File } from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface UploadedFile {\n  url: string;\n  filename: string;\n  originalName: string;\n  mimetype: string;\n  size: number;\n}\n\ninterface FileUploadProps {\n  onFileUploaded: (file: UploadedFile) => void;\n  acceptedTypes?: string;\n  maxSize?: number;\n  className?: string;\n}\n\nexport default function FileUpload({ \n  onFileUploaded, \n  acceptedTypes = \"image/*,video/*,audio/*\",\n  maxSize = 50 * 1024 * 1024, // 50MB\n  className = \"\"\n}: FileUploadProps) {\n  const [isDragging, setIsDragging] = useState(false);\n  const [uploading, setUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState(0);\n  const { toast } = useToast();\n\n  const getFileIcon = (mimetype: string) => {\n    if (mimetype.startsWith('image/')) return <Image className=\"h-4 w-4\" />;\n    if (mimetype.startsWith('video/')) return <Video className=\"h-4 w-4\" />;\n    if (mimetype.startsWith('audio/')) return <Music className=\"h-4 w-4\" />;\n    return <File className=\"h-4 w-4\" />;\n  };\n\n  const formatFileSize = (bytes: number) => {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\n  };\n\n  const uploadFile = async (file: File) => {\n    if (file.size > maxSize) {\n      toast({\n        title: \"F√°jl t√∫l nagy\",\n        description: `A f√°jl m√©rete nem lehet nagyobb mint ${formatFileSize(maxSize)}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    setUploadProgress(0);\n\n    try {\n      const formData = new FormData();\n      formData.append('file', file);\n\n      // Simulate progress for better UX\n      const progressInterval = setInterval(() => {\n        setUploadProgress(prev => {\n          if (prev < 90) return prev + 10;\n          return prev;\n        });\n      }, 100);\n\n      // Use fetch directly for FormData to avoid Content-Type issues\n      const response = await fetch('/api/upload', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include'\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        throw new Error(errorText || 'Felt√∂lt√©si hiba');\n      }\n\n      const result = await response.json();\n\n      clearInterval(progressInterval);\n      setUploadProgress(100);\n\n      onFileUploaded(result);\n      \n      toast({\n        title: \"Sikeres felt√∂lt√©s\",\n        description: `${file.name} sikeresen felt√∂ltve`,\n      });\n\n    } catch (error: any) {\n      toast({\n        title: \"Felt√∂lt√©si hiba\",\n        description: error.message || \"Hiba t√∂rt√©nt a f√°jl felt√∂lt√©se sor√°n\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setUploading(false);\n      setUploadProgress(0);\n    }\n  };\n\n  const handleDragOver = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(true);\n  }, []);\n\n  const handleDragLeave = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n  }, []);\n\n  const handleDrop = useCallback((e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragging(false);\n    \n    const files = Array.from(e.dataTransfer.files);\n    if (files.length > 0) {\n      uploadFile(files[0]);\n    }\n  }, []);\n\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = e.target.files;\n    if (files && files.length > 0) {\n      uploadFile(files[0]);\n    }\n  };\n\n  return (\n    <div className={className}>\n      <Card className={`border-2 border-dashed transition-colors ${\n        isDragging ? 'border-primary bg-primary/5' : 'border-gray-300'\n      } ${uploading ? 'pointer-events-none opacity-50' : ''}`}>\n        <CardContent \n          className=\"p-6 text-center\"\n          onDragOver={handleDragOver}\n          onDragLeave={handleDragLeave}\n          onDrop={handleDrop}\n        >\n          {uploading ? (\n            <div className=\"space-y-4\">\n              <Upload className=\"h-8 w-8 mx-auto text-primary animate-pulse\" />\n              <p className=\"text-sm text-gray-600\">Felt√∂lt√©s folyamatban...</p>\n              <Progress value={uploadProgress} className=\"w-full\" />\n              <p className=\"text-xs text-gray-500\">{uploadProgress}%</p>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              <Upload className=\"h-8 w-8 mx-auto text-gray-400\" />\n              <div>\n                <p className=\"text-sm font-medium\">H√∫zd ide a f√°jlt vagy kattints a b√∂ng√©sz√©shez</p>\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  T√°mogatott form√°tumok: k√©p, vide√≥, hang (max. {formatFileSize(maxSize)})\n                </p>\n              </div>\n              <Input\n                type=\"file\"\n                accept={acceptedTypes}\n                onChange={handleFileSelect}\n                className=\"cursor-pointer\"\n                disabled={uploading}\n              />\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\n// URL input component for manual URL entry\ninterface UrlInputProps {\n  label: string;\n  placeholder: string;\n  value: string;\n  onChange: (value: string) => void;\n  onUpload?: () => void;\n}\n\nexport function UrlInput({ label, placeholder, value, onChange, onUpload }: UrlInputProps) {\n  return (\n    <div className=\"space-y-2\">\n      <Label>{label}</Label>\n      <div className=\"flex gap-2\">\n        <Input\n          placeholder={placeholder}\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          className=\"flex-1\"\n        />\n        {onUpload && (\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={onUpload}\n            className=\"px-3\"\n          >\n            <Upload className=\"h-4 w-4\" />\n          </Button>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Multiple file display component\ninterface FileListProps {\n  files: UploadedFile[];\n  onRemove: (filename: string) => void;\n}\n\nexport function FileList({ files, onRemove }: FileListProps) {\n  if (files.length === 0) return null;\n\n  return (\n    <div className=\"space-y-2\">\n      <Label>Felt√∂lt√∂tt f√°jlok</Label>\n      <div className=\"space-y-2\">\n        {files.map((file, index) => (\n          <Card key={index} className=\"p-3\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                {/* {getFileIcon(file.mimetype)} */}\n                <div>\n                  <p className=\"text-sm font-medium\">{file.originalName}</p>\n                  <p className=\"text-xs text-gray-500\">\n                    {/* {formatFileSize(file.size)} */} ‚Ä¢ {file.mimetype}\n                  </p>\n                </div>\n              </div>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => onRemove(file.filename)}\n                className=\"h-8 w-8 p-0\"\n              >\n                <X className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":7610},"client/src/components/link-editor.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Trash2, Plus, Youtube, ExternalLink, Edit3, Globe } from \"lucide-react\";\nimport { KeyConceptsData, KeyConcept, YoutubeVideo, WikipediaLink } from \"@shared/schema\";\n\ninterface LinkEditorProps {\n  keyConceptsData: KeyConceptsData;\n  onUpdate: (updatedData: KeyConceptsData) => void;\n}\n\nexport function LinkEditor({ keyConceptsData, onUpdate }: LinkEditorProps) {\n  const [editingConcept, setEditingConcept] = useState<number | null>(null);\n  const [editingVideo, setEditingVideo] = useState<{ conceptIndex: number; videoIndex: number } | null>(null);\n\n  const updateConcept = (index: number, updatedConcept: KeyConcept) => {\n    const updated = [...keyConceptsData];\n    updated[index] = updatedConcept;\n    onUpdate(updated);\n  };\n\n  const deleteConcept = (index: number) => {\n    const updated = keyConceptsData.filter((_, i) => i !== index);\n    onUpdate(updated);\n  };\n\n  const addNewConcept = () => {\n    const newConcept: KeyConcept = {\n      concept: \"√öj fogalom\",\n      definition: \"Fogalom defin√≠ci√≥ja\",\n      youtubeVideos: [],\n      wikipediaLinks: []\n    };\n    onUpdate([...keyConceptsData, newConcept]);\n  };\n\n  const updateVideo = (conceptIndex: number, videoIndex: number, updatedVideo: YoutubeVideo) => {\n    const updated = [...keyConceptsData];\n    updated[conceptIndex].youtubeVideos[videoIndex] = updatedVideo;\n    onUpdate(updated);\n  };\n\n  const deleteVideo = (conceptIndex: number, videoIndex: number) => {\n    const updated = [...keyConceptsData];\n    updated[conceptIndex].youtubeVideos = updated[conceptIndex].youtubeVideos.filter((_, i) => i !== videoIndex);\n    onUpdate(updated);\n  };\n\n  const addNewVideo = (conceptIndex: number) => {\n    const newVideo: YoutubeVideo = {\n      title: \"√öj vide√≥\",\n      videoId: \"\",\n      description: \"Vide√≥ le√≠r√°sa\",\n      url: \"https://www.youtube.com/watch?v=\"\n    };\n    const updated = [...keyConceptsData];\n    updated[conceptIndex].youtubeVideos.push(newVideo);\n    onUpdate(updated);\n  };\n\n  const updateWikipediaLink = (conceptIndex: number, linkIndex: number, updatedLink: WikipediaLink) => {\n    const updated = [...keyConceptsData];\n    if (!updated[conceptIndex].wikipediaLinks) {\n      updated[conceptIndex].wikipediaLinks = [];\n    }\n    updated[conceptIndex].wikipediaLinks![linkIndex] = updatedLink;\n    onUpdate(updated);\n  };\n\n  const deleteWikipediaLink = (conceptIndex: number, linkIndex: number) => {\n    const updated = [...keyConceptsData];\n    if (updated[conceptIndex].wikipediaLinks) {\n      updated[conceptIndex].wikipediaLinks = updated[conceptIndex].wikipediaLinks!.filter((_, i) => i !== linkIndex);\n    }\n    onUpdate(updated);\n  };\n\n  const addNewWikipediaLink = (conceptIndex: number) => {\n    const newLink: WikipediaLink = {\n      text: \"√öj Wikipedia link\",\n      url: \"https://hu.wikipedia.org/wiki/\",\n      description: \"Link le√≠r√°sa\"\n    };\n    const updated = [...keyConceptsData];\n    if (!updated[conceptIndex].wikipediaLinks) {\n      updated[conceptIndex].wikipediaLinks = [];\n    }\n    updated[conceptIndex].wikipediaLinks!.push(newLink);\n    onUpdate(updated);\n  };\n\n  const extractVideoIdFromUrl = (url: string): string => {\n    const match = url.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&\\n?#]+)/);\n    return match ? match[1] : \"\";\n  };\n\n  if (!keyConceptsData || keyConceptsData.length === 0) {\n    return (\n      <div className=\"space-y-4 border-t pt-4\">\n        <h4 className=\"font-medium text-sm text-blue-700\">YouTube √©s Wikipedia linkek</h4>\n        <div className=\"text-center py-8 text-muted-foreground bg-blue-50 rounded-lg\">\n          <Youtube className=\"mx-auto h-12 w-12 mb-4 text-blue-300\" />\n          <p>Nincs AI-gener√°lt kulcsfogalom √©s vide√≥ adat</p>\n          <p className=\"text-sm\">Haszn√°ld az AI regener√°l√°s gombot tartalom gener√°l√°s√°hoz</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 border-t pt-4\">\n      <div className=\"flex items-center justify-between\">\n        <h4 className=\"font-medium text-sm text-blue-700 flex items-center gap-2\">\n          <Youtube className=\"h-4 w-4\" />\n          YouTube √©s Wikipedia linkek szerkeszt√©se\n        </h4>\n        <Button\n          type=\"button\"\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={addNewConcept}\n          className=\"flex items-center gap-1\"\n        >\n          <Plus className=\"h-3 w-3\" />\n          √öj fogalom\n        </Button>\n      </div>\n\n      <div className=\"space-y-4 max-h-96 overflow-y-auto\">\n        {keyConceptsData.map((concept, conceptIndex) => (\n          <Card key={conceptIndex} className=\"bg-blue-50\">\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-sm font-medium text-blue-800\">\n                  {editingConcept === conceptIndex ? (\n                    <Input\n                      value={concept.concept}\n                      onChange={(e) => updateConcept(conceptIndex, { ...concept, concept: e.target.value })}\n                      onBlur={() => setEditingConcept(null)}\n                      onKeyDown={(e) => e.key === 'Enter' && setEditingConcept(null)}\n                      className=\"text-sm font-medium\"\n                      autoFocus\n                    />\n                  ) : (\n                    <span \n                      onClick={() => setEditingConcept(conceptIndex)}\n                      className=\"cursor-pointer hover:text-blue-600\"\n                    >\n                      {concept.concept}\n                    </span>\n                  )}\n                </CardTitle>\n                <div className=\"flex items-center gap-1\">\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setEditingConcept(conceptIndex)}\n                    className=\"h-7 w-7 p-0\"\n                  >\n                    <Edit3 className=\"h-3 w-3\" />\n                  </Button>\n                  <Button\n                    type=\"button\"\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => deleteConcept(conceptIndex)}\n                    className=\"h-7 w-7 p-0 text-red-600 hover:text-red-700\"\n                  >\n                    <Trash2 className=\"h-3 w-3\" />\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-xs text-blue-600\">Defin√≠ci√≥</Label>\n                <Textarea\n                  value={concept.definition}\n                  onChange={(e) => updateConcept(conceptIndex, { ...concept, definition: e.target.value })}\n                  rows={2}\n                  className=\"text-sm bg-white\"\n                />\n              </div>\n\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"text-xs text-blue-600\">YouTube vide√≥k</Label>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => addNewVideo(conceptIndex)}\n                    className=\"h-6 text-xs px-2\"\n                  >\n                    <Plus className=\"h-3 w-3 mr-1\" />\n                    Vide√≥\n                  </Button>\n                </div>\n                \n                {concept.youtubeVideos.map((video, videoIndex) => (\n                  <div key={videoIndex} className=\"bg-white p-3 rounded-md border space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Youtube className=\"h-4 w-4 text-red-500\" />\n                        <span className=\"text-xs font-medium\">Vide√≥ {videoIndex + 1}</span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        {video.url && (\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => window.open(video.url, '_blank')}\n                            className=\"h-6 w-6 p-0\"\n                          >\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => deleteVideo(conceptIndex, videoIndex)}\n                          className=\"h-6 w-6 p-0 text-red-600\"\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div className=\"space-y-1\">\n                        <Label className=\"text-xs\">C√≠m</Label>\n                        <Input\n                          value={video.title}\n                          onChange={(e) => updateVideo(conceptIndex, videoIndex, { ...video, title: e.target.value })}\n                          className=\"text-xs\"\n                        />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <Label className=\"text-xs\">YouTube URL</Label>\n                        <Input\n                          value={video.url}\n                          onChange={(e) => {\n                            const newUrl = e.target.value;\n                            const videoId = extractVideoIdFromUrl(newUrl);\n                            updateVideo(conceptIndex, videoIndex, { \n                              ...video, \n                              url: newUrl,\n                              videoId: videoId \n                            });\n                          }}\n                          placeholder=\"https://www.youtube.com/watch?v=...\"\n                          className=\"text-xs\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div className=\"space-y-1\">\n                      <Label className=\"text-xs\">Le√≠r√°s</Label>\n                      <Textarea\n                        value={video.description}\n                        onChange={(e) => updateVideo(conceptIndex, videoIndex, { ...video, description: e.target.value })}\n                        rows={2}\n                        className=\"text-xs\"\n                      />\n                    </div>\n                  </div>\n                ))}\n                \n                {concept.youtubeVideos.length === 0 && (\n                  <div className=\"text-center py-4 text-muted-foreground bg-gray-50 rounded-md\">\n                    <p className=\"text-xs\">Nincsenek YouTube vide√≥k</p>\n                  </div>\n                )}\n              </div>\n\n              {/* Wikipedia linkek kezel√©se */}\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <Label className=\"text-xs text-blue-600\">Wikipedia linkek</Label>\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => addNewWikipediaLink(conceptIndex)}\n                    className=\"h-6 text-xs px-2\"\n                  >\n                    <Plus className=\"h-3 w-3 mr-1\" />\n                    Wiki link\n                  </Button>\n                </div>\n                \n                {concept.wikipediaLinks && concept.wikipediaLinks.map((link, linkIndex) => (\n                  <div key={linkIndex} className=\"bg-white p-3 rounded-md border space-y-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center gap-2\">\n                        <Globe className=\"h-4 w-4 text-blue-500\" />\n                        <span className=\"text-xs font-medium\">Wikipedia {linkIndex + 1}</span>\n                      </div>\n                      <div className=\"flex items-center gap-1\">\n                        {link.url && (\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => window.open(link.url, '_blank')}\n                            className=\"h-6 w-6 p-0\"\n                          >\n                            <ExternalLink className=\"h-3 w-3\" />\n                          </Button>\n                        )}\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => deleteWikipediaLink(conceptIndex, linkIndex)}\n                          className=\"h-6 w-6 p-0 text-red-600\"\n                        >\n                          <Trash2 className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"grid grid-cols-2 gap-2\">\n                      <div className=\"space-y-1\">\n                        <Label className=\"text-xs\">Sz√∂veg</Label>\n                        <Input\n                          value={link.text}\n                          onChange={(e) => updateWikipediaLink(conceptIndex, linkIndex, { ...link, text: e.target.value })}\n                          className=\"text-xs\"\n                        />\n                      </div>\n                      <div className=\"space-y-1\">\n                        <Label className=\"text-xs\">Wikipedia URL</Label>\n                        <Input\n                          value={link.url}\n                          onChange={(e) => updateWikipediaLink(conceptIndex, linkIndex, { ...link, url: e.target.value })}\n                          placeholder=\"https://hu.wikipedia.org/wiki/...\"\n                          className=\"text-xs\"\n                        />\n                      </div>\n                    </div>\n                    \n                    <div className=\"space-y-1\">\n                      <Label className=\"text-xs\">Le√≠r√°s</Label>\n                      <Textarea\n                        value={link.description || \"\"}\n                        onChange={(e) => updateWikipediaLink(conceptIndex, linkIndex, { ...link, description: e.target.value })}\n                        rows={2}\n                        className=\"text-xs\"\n                      />\n                    </div>\n                  </div>\n                ))}\n                \n                {(!concept.wikipediaLinks || concept.wikipediaLinks.length === 0) && (\n                  <div className=\"text-center py-4 text-muted-foreground bg-gray-50 rounded-md\">\n                    <p className=\"text-xs\">Nincsenek Wikipedia linkek</p>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}","size_bytes":15643},"client/src/components/mobile-nav.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Sheet, SheetContent, SheetHeader, SheetTitle } from \"@/components/ui/sheet\";\nimport { Link, useLocation } from \"wouter\";\nimport { GraduationCap, Home, BookOpen, TrendingUp, Bot, Settings, LogOut, X } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\n\ninterface MobileNavProps {\n  isOpen: boolean;\n  onClose: () => void;\n  user: User;\n}\n\nexport default function MobileNav({ isOpen, onClose, user }: MobileNavProps) {\n  const [location] = useLocation();\n  \n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  const navItems = user.role === 'admin' ? [\n    { icon: Home, label: \"Home\", href: \"/\" },\n    { icon: Settings, label: \"Admin\", href: \"/admin\" },\n    { icon: BookOpen, label: \"Tananyagok\", href: \"/tananyagok\" },\n    { icon: Settings, label: \"Be√°ll√≠t√°sok\", href: \"/settings\" },\n  ] : user.role === 'teacher' ? [\n    { icon: Home, label: \"Home\", href: \"/\" },\n    { icon: BookOpen, label: \"Tananyagok\", href: \"/tananyagok\" },\n    { icon: TrendingUp, label: \"Tanul√≥im\", href: \"/tanul√≥im\" },\n    { icon: Settings, label: \"Be√°ll√≠t√°sok\", href: \"/settings\" },\n  ] : [\n    { icon: Home, label: \"Home\", href: \"/\" },\n    { icon: BookOpen, label: \"Tananyagok\", href: \"/tananyagok\" },\n    { icon: TrendingUp, label: \"Halad√°som\", href: \"/progress\" },\n    { icon: Bot, label: \"AI Chat\", href: \"/chat\" },\n    { icon: Settings, label: \"Be√°ll√≠t√°sok\", href: \"/settings\" },\n  ];\n\n  return (\n    <Sheet open={isOpen} onOpenChange={onClose}>\n      <SheetContent side=\"left\" className=\"w-64 p-0\">\n        <SheetHeader className=\"p-6 border-b border-neutral-100\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center\">\n                <GraduationCap className=\"text-white\" size={20} />\n              </div>\n              <div>\n                <SheetTitle className=\"text-xl font-bold text-neutral-700\">Global Learning System</SheetTitle>\n                <p className=\"text-sm text-neutral-400\">AI Oktat√°si Platform</p>\n              </div>\n            </div>\n            <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n              <X size={20} />\n            </Button>\n          </div>\n        </SheetHeader>\n        \n        <nav className=\"p-4\">\n          <ul className=\"space-y-2\">\n            {navItems.map((item, index) => (\n              <li key={index}>\n                <Link \n                  href={item.href}\n                  onClick={onClose}\n                  className={`flex items-center space-x-3 p-3 rounded-lg transition-colors ${\n                    location === item.href \n                      ? \"bg-primary text-white\" \n                      : \"text-neutral-700 hover:bg-neutral-50\"\n                  }`}\n                >\n                  <item.icon size={20} />\n                  <span className=\"font-medium\">{item.label}</span>\n                </Link>\n              </li>\n            ))}\n          </ul>\n        </nav>\n\n        <div className=\"absolute bottom-4 left-4 right-4\">\n          <div className=\"flex items-center justify-between p-3 bg-neutral-50 rounded-lg\">\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-neutral-700 truncate\">\n                {user.firstName && user.lastName \n                  ? `${user.firstName} ${user.lastName}` \n                  : user.email\n                }\n              </p>\n              <p className=\"text-xs text-neutral-400 capitalize\">{user.role}</p>\n            </div>\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={handleLogout}\n              className=\"text-neutral-400 hover:text-neutral-700 p-1\"\n            >\n              <LogOut size={16} />\n            </Button>\n          </div>\n        </div>\n      </SheetContent>\n    </Sheet>\n  );\n}\n","size_bytes":4020},"client/src/components/module-card.tsx":{"content":"import { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { CheckCircle, Play, Clock, ArrowRight, Brain, FileText, Wand2 } from \"lucide-react\";\nimport type { Module } from \"@shared/schema\";\n\ninterface ModuleCardProps {\n  module: Module;\n  isCompleted: boolean;\n  userRole: string;\n  progress?: number;\n  isUnlocked: boolean;\n}\n\nexport default function ModuleCard({ \n  module, \n  isCompleted, \n  userRole, \n  progress = 0,\n  isUnlocked \n}: ModuleCardProps) {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [previewVersion, setPreviewVersion] = useState<'concise' | 'detailed'>('detailed');\n  const [isRegenerating, setIsRegenerating] = useState(false);\n\n  const completeModuleMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest('POST', `/api/modules/${module.id}/complete`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      toast({\n        title: \"Gratul√°lunk!\",\n        description: \"Sikeresen befejezted ezt a modult!\",\n      });\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt befejezni a modult\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const regenerateModuleMutation = useMutation({\n    mutationFn: async () => {\n      setIsRegenerating(true);\n      const response = await apiRequest('POST', `/api/admin/modules/${module.id}/regenerate-ai`, {\n        title: module.title,\n        content: module.content\n      });\n      return response.json();\n    },\n    onSuccess: async () => {\n      // Clear cache and force refetch\n      queryClient.clear();\n      await queryClient.refetchQueries({ queryKey: ['/api/modules'] });\n      await queryClient.refetchQueries({ queryKey: ['/api/public/modules'] });\n      \n      toast({\n        title: \"AI √öjragener√°l√°s sikeres!\",\n        description: \"A modul tartalm√°t sikeresen friss√≠tette az AI - webes keres√©si eredm√©nyekkel √©s vide√≥kkal b≈ëv√≠tve.\",\n      });\n      setIsRegenerating(false);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Nincs enged√©ly\",\n          description: \"Jelentkezz be √∫jra a folytat√°shoz.\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"√öjragener√°l√°s sikertelen\",\n        description: \"Az AI nem tudta friss√≠teni a modul tartalm√°t.\",\n        variant: \"destructive\",\n      });\n      setIsRegenerating(false);\n    },\n  });\n\n  const handleCardClick = (e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    \n    // Check if module is accessible\n    if (!isAccessible) {\n      if (!isUnlocked) {\n        toast({\n          title: \"Modul z√°rolva\",\n          description: \"El≈ësz√∂r az el≈ëz≈ë modulokat kell befejezned.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Modul nem el√©rhet≈ë\",\n          description: \"Ez a modul m√©g nem lett k√∂zz√©t√©ve.\",\n          variant: \"destructive\",\n        });\n      }\n      return;\n    }\n    \n    setLocation(`/module/${module.id}`);\n  };\n\n  const getStatusIcon = () => {\n    if (isCompleted) {\n      return <CheckCircle className=\"text-green-500\" size={20} />;\n    }\n    if (!isUnlocked && userRole !== 'admin' && userRole !== 'teacher') {\n      return <Clock className=\"text-neutral-400\" size={20} />;\n    }\n    if (progress > 0) {\n      return <Play className=\"text-blue-500\" size={20} />;\n    }\n    return <Play className=\"text-primary\" size={20} />;\n  };\n\n  const getStatusText = () => {\n    if (isCompleted) return \"Befejezve\";\n    if (!isUnlocked && userRole !== 'admin' && userRole !== 'teacher') return \"Z√°rolva\";\n    if (progress > 0) return \"Folyamatban\";\n    if (!module.isPublished && userRole !== 'admin' && userRole !== 'teacher') return \"Nem k√∂zz√©t√©ve\";\n    return \"El√©rhet≈ë\";\n  };\n\n  const getStatusColor = () => {\n    if (isCompleted) return \"text-green-500\";\n    if (!isUnlocked && userRole !== 'admin' && userRole !== 'teacher') return \"text-neutral-400\";\n    if (progress > 0) return \"text-blue-500\";\n    if (!module.isPublished && userRole !== 'admin' && userRole !== 'teacher') return \"text-neutral-400\";\n    return \"text-primary\";\n  };\n\n  const isAccessible = (userRole === 'admin' || userRole === 'teacher') || (module.isPublished && isUnlocked);\n\n  return (\n    <Card \n      className=\"rounded-lg border text-card-foreground shadow-sm glassmorphism gradient-overlay hover-lift transition-all duration-300 flex flex-col h-full cursor-pointer border-white/20 bg-[#d1ae9924]\"\n      onClick={isAccessible ? handleCardClick : undefined}\n    >\n      <CardHeader className=\"pb-3 flex-shrink-0\">\n        <div className=\"flex items-start space-x-3\">\n          <div className=\"w-16 h-16 bg-gradient-to-br from-accent to-orange-600 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\n            {module.imageUrl ? (\n              <img \n                src={module.imageUrl} \n                alt={module.title}\n                className=\"w-12 h-12 object-cover rounded-lg\"\n              />\n            ) : (\n              <span className=\"text-white text-xl font-bold\">#{module.moduleNumber}</span>\n            )}\n          </div>\n          <div className=\"flex-1 min-w-0 pr-2\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {module.moduleNumber}. modul\n              </Badge>\n              {/* AI Enhanced Badge */}\n              {(module.conciseContent || module.detailedContent) && (\n                <Badge variant=\"secondary\" className=\"text-xs bg-blue-100 text-blue-700\">\n                  AI Enhanced\n                </Badge>\n              )}\n              {getStatusIcon()}\n            </div>\n            <CardTitle className=\"text-base font-bold text-neutral-800 leading-tight break-words\">\n              {module.title}\n            </CardTitle>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"flex flex-col flex-grow\">\n        <div className=\"flex-grow\">\n          {/* Version selector for AI Enhanced modules */}\n          {(module.conciseContent || module.detailedContent) && (\n            <div className=\"flex gap-1 mb-3\">\n              <Button\n                variant={previewVersion === 'concise' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setPreviewVersion('concise');\n                }}\n                disabled={!module.conciseContent}\n                className=\"text-xs h-6 px-2\"\n              >\n                <Brain className=\"w-3 h-3 mr-1\" />\n                T√∂m√∂r\n              </Button>\n              <Button\n                variant={previewVersion === 'detailed' ? 'default' : 'outline'}\n                size=\"sm\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  setPreviewVersion('detailed');\n                }}\n                disabled={!module.detailedContent}\n                className=\"text-xs h-6 px-2\"\n              >\n                <FileText className=\"w-3 h-3 mr-1\" />\n                R√©szletes\n              </Button>\n            </div>\n          )}\n          \n          <p className=\"text-neutral-600 text-sm leading-relaxed line-clamp-3 mb-4\">\n            {(() => {\n              // AI enhanced modules: use selected preview version\n              if (module.conciseContent || module.detailedContent) {\n                let content = '';\n                if (previewVersion === 'concise' && module.conciseContent) {\n                  content = module.conciseContent;\n                } else if (previewVersion === 'detailed' && module.detailedContent) {\n                  content = module.detailedContent;\n                } else {\n                  content = module.detailedContent || module.conciseContent || module.content;\n                }\n                // Remove HTML tags and Wikipedia links\n                const cleanContent = content\n                  .replace(/<[^>]*>/g, '') // Remove HTML tags\n                  .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1') // Remove markdown links [text](url) -> text\n                  .replace(/https?:\\/\\/[^\\s]+/g, '') // Remove standalone URLs\n                  .replace(/\\s+/g, ' ') // Normalize whitespace\n                  .trim();\n                return cleanContent.substring(0, 150) + '...';\n              }\n              // Regular modules: use original content\n              const cleanContent = module.content\n                .replace(/<[^>]*>/g, '') // Remove HTML tags\n                .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1') // Remove markdown links\n                .replace(/https?:\\/\\/[^\\s]+/g, '') // Remove standalone URLs\n                .replace(/\\s+/g, ' ') // Normalize whitespace\n                .trim();\n              return cleanContent.substring(0, 150) + '...';\n            })()}\n          </p>\n\n          {/* Progress Bar (for in-progress modules) */}\n          {progress > 0 && progress < 100 && (\n            <div className=\"mb-4\">\n              <div className=\"flex items-center justify-between mb-1\">\n                <span className=\"text-xs text-neutral-400\">Halad√°s</span>\n                <span className=\"text-xs font-medium text-accent\">{progress}%</span>\n              </div>\n              <Progress value={progress} className=\"h-2\" />\n            </div>\n          )}\n\n          {/* Admin Options */}\n          {userRole === 'admin' && (\n            <div className=\"mb-4 p-2 bg-neutral-50 rounded-lg\">\n              <div className=\"flex items-center justify-between text-xs mb-2\">\n                <Badge variant={module.isPublished ? \"default\" : \"secondary\"}>\n                  {module.isPublished ? \"Publik√°lva\" : \"Tervezet\"}\n                </Badge>\n                <span className=\"text-neutral-400\">Admin n√©zet</span>\n              </div>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  regenerateModuleMutation.mutate();\n                }}\n                disabled={isRegenerating}\n                className=\"w-full text-xs h-7\"\n              >\n                {isRegenerating ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-1\"></div>\n                    AI √öjragener√°l√°s...\n                  </>\n                ) : (\n                  <>\n                    <Wand2 className=\"w-3 h-3 mr-1\" />\n                    AI √öjragener√°l√°s\n                  </>\n                )}\n              </Button>\n            </div>\n          )}\n        </div>\n\n        <Button \n          className={`w-full mt-auto bg-accent hover:bg-accent/90 transition-colors ${\n            !isAccessible ? 'opacity-50 cursor-not-allowed' : ''\n          }`}\n          onClick={isAccessible ? handleCardClick : undefined}\n          disabled={!isAccessible}\n        >\n          {isCompleted ? (\n            <>\n              <CheckCircle className=\"mr-2\" size={16} />\n              √öjra megtekint√©s\n            </>\n          ) : isAccessible ? (\n            <>\n              <Play className=\"mr-2\" size={16} />\n              Tanul√°s ind√≠t√°sa\n            </>\n          ) : (\n            <>\n              <Clock className=\"mr-2\" size={16} />\n              Hamarosan\n            </>\n          )}\n        </Button>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":12478},"client/src/components/onboarding-wizard.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Progress } from '@/components/ui/progress';\nimport { \n  ChevronRight, \n  ChevronLeft, \n  Sparkles, \n  BookOpen, \n  MessageCircle, \n  Brain, \n  Volume2,\n  User,\n  CheckCircle,\n  X,\n  Lock,\n  Unlock,\n  Play,\n  Image,\n  Headphones,\n  Trophy,\n  Target,\n  GraduationCap,\n  Settings\n} from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\ninterface OnboardingStep {\n  id: string;\n  title: string;\n  description: string;\n  content: React.ReactNode;\n  icon: React.ReactNode;\n  action?: {\n    text: string;\n    onClick: () => void;\n  };\n}\n\ninterface OnboardingWizardProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onComplete: () => void;\n  userName?: string;\n}\n\nexport default function OnboardingWizard({ \n  isOpen, \n  onClose, \n  onComplete, \n  userName = \"Felhaszn√°l√≥\" \n}: OnboardingWizardProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [completedSteps, setCompletedSteps] = useState<string[]>([]);\n\n  const steps: OnboardingStep[] = [\n    {\n      id: 'welcome',\n      title: `√údv√∂z√∂llek, ${userName}!`,\n      description: 'K√©szen √°llsz egy izgalmas tanul√°si kalandra?',\n      icon: <Sparkles className=\"h-8 w-8 text-yellow-500\" />,\n      content: (\n        <div className=\"text-center space-y-4\">\n          <div className=\"bg-gradient-to-r from-blue-500 to-purple-600 rounded-full w-24 h-24 mx-auto flex items-center justify-center\">\n            <User className=\"h-12 w-12 text-white\" />\n          </div>\n          <p className=\"text-lg text-neutral-600\">\n            Ez a Global Learning System, egy AI-alap√∫ oktat√°si platform, amely szem√©lyre szabott tanul√°si √©lm√©nyt ny√∫jt.\n          </p>\n          <p className=\"text-sm text-neutral-500\">\n            A k√∂vetkez≈ë percekben megmutatjuk, hogyan haszn√°lhatod a platform √∂sszes funkci√≥j√°t.\n          </p>\n        </div>\n      )\n    },\n    {\n      id: 'structure',\n      title: 'Tananyag fel√©p√≠t√©se',\n      description: 'Ismerd meg a hierarchikus tanul√°si rendszert',\n      icon: <BookOpen className=\"h-8 w-8 text-blue-500\" />,\n      content: (\n        <div className=\"space-y-6\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card className=\"border-2 border-blue-200 bg-blue-50\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm flex items-center gap-2\">\n                  <div className=\"w-6 h-6 bg-blue-500 rounded text-white flex items-center justify-center text-xs\">1</div>\n                  Szakmacsoport\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <p className=\"text-xs text-neutral-600\">Pl. Hegeszt≈ë, Lakatos</p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-2 border-green-200 bg-green-50\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm flex items-center gap-2\">\n                  <div className=\"w-6 h-6 bg-green-500 rounded text-white flex items-center justify-center text-xs\">2</div>\n                  Tant√°rgy\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <p className=\"text-xs text-neutral-600\">Pl. Anyagismeret, Lecs√≥ k√©sz√≠t√©s</p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-2 border-purple-200 bg-purple-50\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm flex items-center gap-2\">\n                  <div className=\"w-6 h-6 bg-purple-500 rounded text-white flex items-center justify-center text-xs\">3</div>\n                  Modul\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <p className=\"text-xs text-neutral-600\">Konkr√©t leck√©k √©s gyakorlatok</p>\n              </CardContent>\n            </Card>\n          </div>\n          \n          <div className=\"bg-neutral-50 p-4 rounded-lg\">\n            <p className=\"text-sm text-neutral-600 text-center\">\n              <span className=\"font-medium\">Szakmacsoport</span> ‚Üí <span className=\"font-medium\">Tant√°rgy</span> ‚Üí <span className=\"font-medium\">Modul</span>\n            </p>\n            <p className=\"text-xs text-neutral-500 text-center mt-2\">\n              Minden szakm√°hoz tartoznak tant√°rgyak, minden tant√°rgyhoz modulok\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'ai-teacher',\n      title: 'AI Tan√°r funkcionalit√°s',\n      description: 'Fedezd fel az intelligens asszisztenst',\n      icon: <MessageCircle className=\"h-8 w-8 text-green-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"bg-gradient-to-r from-green-100 to-blue-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-2\">Mit tud az AI Tan√°r?</h4>\n            <ul className=\"space-y-2 text-sm text-neutral-600\">\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                V√°laszol k√©rd√©seidre a tananyaggal kapcsolatban\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                R√©szletes magyar√°zatokat ad\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                Gyakorlati p√©ld√°kkal seg√≠t\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                Szem√©lyre szabja a v√°laszokat\n              </li>\n            </ul>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n            <Button variant=\"outline\" className=\"h-auto p-3 flex flex-col items-center gap-2\">\n              <MessageCircle className=\"h-5 w-5 text-blue-500\" />\n              <span className=\"text-xs\">Sz√∂veges chat</span>\n            </Button>\n            <Button variant=\"outline\" className=\"h-auto p-3 flex flex-col items-center gap-2\">\n              <Volume2 className=\"h-5 w-5 text-purple-500\" />\n              <span className=\"text-xs\">Hangos magyar√°zat</span>\n            </Button>\n            <Button variant=\"outline\" className=\"h-auto p-3 flex flex-col items-center gap-2\">\n              <Brain className=\"h-5 w-5 text-orange-500\" />\n              <span className=\"text-xs\">Tud√°spr√≥ba</span>\n            </Button>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'voice-features',\n      title: 'Hangos funkci√≥k',\n      description: 'Modern hang streaming technol√≥gia',\n      icon: <Volume2 className=\"h-8 w-8 text-purple-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"bg-gradient-to-r from-purple-100 to-pink-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-3\">Innovat√≠v hangos √©lm√©ny</h4>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"bg-purple-50\">1</Badge>\n                <div>\n                  <p className=\"font-medium text-sm\">Val√≥s idej≈± hang streaming</p>\n                  <p className=\"text-xs text-neutral-600\">A sz√∂veg √©s hang szinkronban √©rkezik</p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"bg-purple-50\">2</Badge>\n                <div>\n                  <p className=\"font-medium text-sm\">Szinkroniz√°lt lej√°tsz√°s</p>\n                  <p className=\"text-xs text-neutral-600\">Id≈ëb√©lyeg alap√∫ koordin√°ci√≥</p>\n                </div>\n              </div>\n              \n              <div className=\"flex items-start gap-3\">\n                <Badge variant=\"outline\" className=\"bg-purple-50\">3</Badge>\n                <div>\n                  <p className=\"font-medium text-sm\">Magyar nyelv optimaliz√°l√°s</p>\n                  <p className=\"text-xs text-neutral-600\">Term√©szetes kiejt√©s √©s hangs√∫ly</p>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-neutral-50 p-3 rounded-lg border-l-4 border-purple-500\">\n            <p className=\"text-sm text-neutral-600\">\n              <span className=\"font-medium\">Tipp:</span> A hangos magyar√°zat gombbal k√©rhetsz audio magyar√°zatot b√°rmikor!\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'profession-selection',\n      title: 'Szakmav√°laszt√°s',\n      description: 'V√°laszd ki a tanulni k√≠v√°nt szakm√°t',\n      icon: <GraduationCap className=\"h-8 w-8 text-indigo-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"bg-gradient-to-r from-indigo-100 to-purple-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-2\">Szakmav√°laszt√°s l√©p√©sei:</h4>\n            <div className=\"space-y-3 text-sm text-neutral-600\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-6 h-6 bg-indigo-500 rounded-full text-white flex items-center justify-center text-xs font-medium\">1</div>\n                <div>\n                  <p className=\"font-medium\">B√∂ng√©ssz a szakm√°k k√∂z√∂tt</p>\n                  <p className=\"text-xs text-neutral-500\">Hegeszt≈ë, Lakatos, √Åcs, stb.</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-6 h-6 bg-green-500 rounded-full text-white flex items-center justify-center text-xs font-medium\">2</div>\n                <div>\n                  <p className=\"font-medium\">V√°lassz szakm√°t</p>\n                  <p className=\"text-xs text-neutral-500\">Ez hat√°rozza meg az el√©rhet≈ë tant√°rgyakat</p>\n                </div>\n              </div>\n              <div className=\"flex items-start gap-3\">\n                <div className=\"w-6 h-6 bg-purple-500 rounded-full text-white flex items-center justify-center text-xs font-medium\">3</div>\n                <div>\n                  <p className=\"font-medium\">Kezdd el a tanul√°st</p>\n                  <p className=\"text-xs text-neutral-500\">A modulok sorban ny√≠lnak meg</p>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-blue-50 border border-blue-200 p-3 rounded-lg\">\n            <p className=\"text-sm text-blue-800\">\n              <Target className=\"h-4 w-4 inline mr-1\" />\n              <strong>Fontos:</strong> A szakmav√°laszt√°s ut√°n csak az ahhoz tartoz√≥ tant√°rgyak √©s modulok lesznek el√©rhet≈ëk.\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'progressive-unlock',\n      title: 'Progressz√≠v felold√°s',\n      description: 'Hogyan ny√≠lnak meg az √∫j modulok',\n      icon: <Lock className=\"h-8 w-8 text-orange-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Card className=\"border-2 border-orange-200 bg-orange-50\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm flex items-center gap-2\">\n                  <Lock className=\"h-4 w-4 text-orange-500\" />\n                  Z√°rolt modulok\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <p className=\"text-xs text-neutral-600\">M√©g nem el√©rhet≈ëk, el≈ëbb teljes√≠tened kell az el≈ëz≈ë modulokat</p>\n              </CardContent>\n            </Card>\n            \n            <Card className=\"border-2 border-green-200 bg-green-50\">\n              <CardHeader className=\"pb-2\">\n                <CardTitle className=\"text-sm flex items-center gap-2\">\n                  <Unlock className=\"h-4 w-4 text-green-500\" />\n                  Feloldott modulok\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"pt-0\">\n                <p className=\"text-xs text-neutral-600\">El√©rhet≈ëk tanul√°sra, m√©g nem teljes√≠tettek</p>\n              </CardContent>\n            </Card>\n          </div>\n          \n          <div className=\"bg-gradient-to-r from-orange-100 to-green-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-2\">M≈±k√∂d√©s:</h4>\n            <ul className=\"space-y-2 text-sm text-neutral-600\">\n              <li className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 bg-blue-500 rounded-full text-white flex items-center justify-center text-xs\">1</div>\n                Az els≈ë modul mindig el√©rhet≈ë\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 bg-orange-500 rounded-full text-white flex items-center justify-center text-xs\">2</div>\n                Teljes√≠tsd a tud√°spr√≥b√°t 88% felett\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <div className=\"w-4 h-4 bg-green-500 rounded-full text-white flex items-center justify-center text-xs\">3</div>\n                A k√∂vetkez≈ë modul automatikusan felold√≥dik\n              </li>\n            </ul>\n          </div>\n          \n          <div className=\"bg-yellow-50 border border-yellow-200 p-3 rounded-lg\">\n            <p className=\"text-sm text-yellow-800\">\n              <Trophy className=\"h-4 w-4 inline mr-1\" />\n              <strong>Teljes√≠t√©si k√ºsz√∂b:</strong> 88% vagy magasabb eredm√©ny sz√ºks√©ges a modul elv√©gz√©s√©hez.\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'multimedia-content',\n      title: 'Multim√©dia tartalmak',\n      description: 'Vide√≥k, k√©pek √©s hanganyagok el√©r√©se',\n      icon: <Play className=\"h-8 w-8 text-red-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n            <div className=\"bg-blue-50 border-2 border-blue-200 p-3 rounded-lg text-center\">\n              <Image className=\"h-6 w-6 text-blue-500 mx-auto mb-1\" />\n              <p className=\"text-xs font-medium text-blue-700\">K√©pek</p>\n              <p className=\"text-xs text-blue-600\">üñºÔ∏è</p>\n            </div>\n            <div className=\"bg-red-50 border-2 border-red-200 p-3 rounded-lg text-center\">\n              <Play className=\"h-6 w-6 text-red-500 mx-auto mb-1\" />\n              <p className=\"text-xs font-medium text-red-700\">YouTube</p>\n              <p className=\"text-xs text-red-600\">üì∫</p>\n            </div>\n            <div className=\"bg-purple-50 border-2 border-purple-200 p-3 rounded-lg text-center\">\n              <Play className=\"h-6 w-6 text-purple-500 mx-auto mb-1\" />\n              <p className=\"text-xs font-medium text-purple-700\">Vide√≥k</p>\n              <p className=\"text-xs text-purple-600\">üé¨</p>\n            </div>\n            <div className=\"bg-green-50 border-2 border-green-200 p-3 rounded-lg text-center\">\n              <Headphones className=\"h-6 w-6 text-green-500 mx-auto mb-1\" />\n              <p className=\"text-xs font-medium text-green-700\">Hang</p>\n              <p className=\"text-xs text-green-600\">üîä</p>\n            </div>\n          </div>\n          \n          <div className=\"bg-gradient-to-r from-blue-100 to-purple-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-2\">El√©r√©s m√≥dja:</h4>\n            <ul className=\"space-y-2 text-sm text-neutral-600\">\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                Oldals√°vban megjelen≈ë sz√≠nes ikonok\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                Kattint√°sra felugr√≥ ablakban ny√≠lnak meg\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                Csak akkor l√°that√≥k, ha van tartalom\n              </li>\n              <li className=\"flex items-center gap-2\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                Nem zavarj√°k a sz√∂veg olvas√°s√°t\n              </li>\n            </ul>\n          </div>\n          \n          <div className=\"bg-purple-50 border border-purple-200 p-3 rounded-lg\">\n            <p className=\"text-sm text-purple-800\">\n              <Play className=\"h-4 w-4 inline mr-1\" />\n              <strong>√öjdons√°g:</strong> A multim√©dia tartalmak most k√ºl√∂n ablakokban ny√≠lnak meg, √≠gy a tananyag sz√∂vege tiszt√°n olvashat√≥ marad.\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'admin-features',\n      title: 'Adminisztr√°ci√≥s funkci√≥k',\n      description: 'Rendszerbe√°ll√≠t√°sok √©s felhaszn√°l√≥ kezel√©s',\n      icon: <Settings className=\"h-8 w-8 text-gray-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"bg-gradient-to-r from-gray-100 to-blue-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-2\">Admin funkci√≥k:</h4>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <h5 className=\"font-medium text-sm mb-2\">Felhaszn√°l√≥ kezel√©s</h5>\n                <ul className=\"space-y-1 text-xs text-neutral-600\">\n                  <li>‚Ä¢ Felhaszn√°l√≥k list√°z√°sa</li>\n                  <li>‚Ä¢ Szerepk√∂r√∂k m√≥dos√≠t√°sa</li>\n                  <li>‚Ä¢ Felhaszn√°l√≥k t√∂rl√©se</li>\n                  <li>‚Ä¢ Szakma hozz√°rendel√©s</li>\n                </ul>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-sm mb-2\">Tartalom kezel√©s</h5>\n                <ul className=\"space-y-1 text-xs text-neutral-600\">\n                  <li>‚Ä¢ Modulok szerkeszt√©se</li>\n                  <li>‚Ä¢ Tant√°rgyak kezel√©se</li>\n                  <li>‚Ä¢ Szakm√°k adminisztr√°ci√≥ja</li>\n                  <li>‚Ä¢ AI be√°ll√≠t√°sok</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-green-50 border border-green-200 p-3 rounded-lg\">\n            <p className=\"text-sm text-green-800\">\n              <Settings className=\"h-4 w-4 inline mr-1\" />\n              <strong>Admin hozz√°f√©r√©s:</strong> Csak admin jogosults√°ggal rendelkez≈ë felhaszn√°l√≥k f√©rhetnek hozz√° ezekhez a funkci√≥khoz.\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'quiz-system',\n      title: 'Intelligens tud√°spr√≥ba',\n      description: 'AI-gener√°lt k√©rd√©sek √©s √©rt√©kel√©s',\n      icon: <Brain className=\"h-8 w-8 text-orange-500\" />,\n      content: (\n        <div className=\"space-y-4\">\n          <div className=\"bg-gradient-to-r from-orange-100 to-yellow-100 p-4 rounded-lg\">\n            <h4 className=\"font-medium text-neutral-800 mb-3\">Automatikus tud√°sfelm√©r√©s</h4>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              <div>\n                <h5 className=\"font-medium text-sm mb-2\">Hogyan m≈±k√∂dik?</h5>\n                <ul className=\"space-y-1 text-xs text-neutral-600\">\n                  <li>‚Ä¢ AI gener√°lja a k√©rd√©seket</li>\n                  <li>‚Ä¢ Modul tartalomhoz igaz√≠tott</li>\n                  <li>‚Ä¢ Azonnali visszajelz√©s</li>\n                  <li>‚Ä¢ R√©szletes magyar√°zatok</li>\n                </ul>\n              </div>\n              \n              <div>\n                <h5 className=\"font-medium text-sm mb-2\">Automatikus teljes√≠t√©s</h5>\n                <ul className=\"space-y-1 text-xs text-neutral-600\">\n                  <li>‚Ä¢ 88% k√ºsz√∂b√©rt√©k</li>\n                  <li>‚Ä¢ Automatikus modul lez√°r√°s</li>\n                  <li>‚Ä¢ Halad√°s k√∂vet√©s</li>\n                  <li>‚Ä¢ Teljes√≠tm√©ny statisztika</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"bg-blue-50 border border-blue-200 p-3 rounded-lg\">\n            <p className=\"text-sm text-blue-800\">\n              <Brain className=\"h-4 w-4 inline mr-1\" />\n              <strong>√öjdons√°g:</strong> A tud√°spr√≥ba most nagyobb felugr√≥ ablakban jelenik meg a jobb felhaszn√°l√≥i √©lm√©ny √©rdek√©ben.\n            </p>\n          </div>\n          \n          <div className=\"bg-orange-50 p-3 rounded-lg border-l-4 border-orange-500\">\n            <p className=\"text-sm text-neutral-600\">\n              <span className=\"font-medium\">88% teljes√≠t√©s</span> eset√©n a modul automatikusan befejezettnek min≈ës√ºl!\n            </p>\n          </div>\n        </div>\n      )\n    },\n    {\n      id: 'getting-started',\n      title: 'Kezdj√ºk el!',\n      description: 'Most m√°r k√©szen √°llsz a tanul√°sra',\n      icon: <CheckCircle className=\"h-8 w-8 text-green-500\" />,\n      content: (\n        <div className=\"text-center space-y-4\">\n          <div className=\"bg-gradient-to-r from-green-100 to-blue-100 p-6 rounded-lg\">\n            <CheckCircle className=\"h-16 w-16 text-green-500 mx-auto mb-4\" />\n            <h4 className=\"text-lg font-medium text-neutral-800 mb-2\">\n              Szuper! Most m√°r minden tudod! üéâ\n            </h4>\n            <p className=\"text-sm text-neutral-600 mb-4\">\n              K√©szen √°llsz, hogy elkezdd a tanul√°st a Global Learning System-mel.\n            </p>\n          </div>\n          \n          <div className=\"bg-neutral-50 p-4 rounded-lg\">\n            <h5 className=\"font-medium text-sm mb-2\">K√∂vetkez≈ë l√©p√©sek:</h5>\n            <ol className=\"text-xs text-neutral-600 space-y-1 text-left\">\n              <li>1. V√°lassz egy szakmacsoportot</li>\n              <li>2. B√∂ng√©szd a tant√°rgyakat</li>\n              <li>3. Kezdj egy modullal</li>\n              <li>4. Haszn√°ld az AI Tan√°rt seg√≠ts√©ghez</li>\n              <li>5. Teszteld tud√°sod a tud√°spr√≥b√°val</li>\n            </ol>\n          </div>\n        </div>\n      ),\n      action: {\n        text: 'Kezdj√ºk a tanul√°st!',\n        onClick: () => onComplete()\n      }\n    }\n  ];\n\n  const progress = ((currentStep + 1) / steps.length) * 100;\n\n  const nextStep = () => {\n    if (currentStep < steps.length - 1) {\n      setCompletedSteps(prev => [...prev, steps[currentStep].id]);\n      setCurrentStep(prev => prev + 1);\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStep > 0) {\n      setCurrentStep(prev => prev - 1);\n    }\n  };\n\n  const skipTutorial = () => {\n    onComplete();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n      <motion.div\n        initial={{ opacity: 0, scale: 0.95 }}\n        animate={{ opacity: 1, scale: 1 }}\n        exit={{ opacity: 0, scale: 0.95 }}\n        className=\"bg-white rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-hidden\"\n      >\n        {/* Header */}\n        <div className=\"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div className=\"flex items-center gap-3\">\n              {steps[currentStep].icon}\n              <div>\n                <h2 className=\"text-xl font-bold\">{steps[currentStep].title}</h2>\n                <p className=\"text-blue-100 text-sm\">{steps[currentStep].description}</p>\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={onClose}\n              className=\"text-white hover:bg-white/20\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          \n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span>L√©p√©s {currentStep + 1} / {steps.length}</span>\n              <span>{Math.round(progress)}%</span>\n            </div>\n            <Progress value={progress} className=\"bg-white/20\" />\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-6 overflow-y-auto max-h-96\">\n          <AnimatePresence mode=\"wait\">\n            <motion.div\n              key={currentStep}\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              transition={{ duration: 0.3 }}\n            >\n              {steps[currentStep].content}\n            </motion.div>\n          </AnimatePresence>\n        </div>\n\n        {/* Footer */}\n        <div className=\"bg-neutral-50 p-6 flex items-center justify-between\">\n          <Button\n            variant=\"ghost\"\n            onClick={skipTutorial}\n            className=\"text-neutral-600\"\n          >\n            √Åtugr√°s\n          </Button>\n          \n          <div className=\"flex items-center gap-2\">\n            {currentStep > 0 && (\n              <Button\n                variant=\"outline\"\n                onClick={prevStep}\n                className=\"flex items-center gap-2\"\n              >\n                <ChevronLeft className=\"h-4 w-4\" />\n                Vissza\n              </Button>\n            )}\n            \n            {currentStep < steps.length - 1 ? (\n              <Button\n                onClick={nextStep}\n                className=\"flex items-center gap-2 bg-gradient-to-r from-blue-600 to-purple-600\"\n              >\n                Tov√°bb\n                <ChevronRight className=\"h-4 w-4\" />\n              </Button>\n            ) : (\n              steps[currentStep].action && (\n                <Button\n                  onClick={steps[currentStep].action!.onClick}\n                  className=\"bg-gradient-to-r from-green-600 to-blue-600\"\n                >\n                  {steps[currentStep].action!.text}\n                </Button>\n              )\n            )}\n          </div>\n        </div>\n      </motion.div>\n    </div>\n  );\n}","size_bytes":26293},"client/src/components/presentation-slideshow.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { ChevronLeft, ChevronRight, Play, Pause } from 'lucide-react';\nimport { presentationImages } from '@/assets/presentation-images';\n\ninterface Slide {\n  background: string;\n  image: string;\n}\n\nconst slides: Slide[] = [\n  {\n    background: \"linear-gradient(135deg, #4a90e2 0%, #7b68ee 100%)\",\n    image: presentationImages.slide1\n  },\n  {\n    background: \"linear-gradient(135deg, #5a67d8 0%, #667eea 100%)\",\n    image: presentationImages.slide2\n  },\n  {\n    background: \"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)\",\n    image: presentationImages.slide3\n  },\n  {\n    background: \"linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)\",\n    image: presentationImages.slide4\n  },\n  {\n    background: \"linear-gradient(135deg, #fa709a 0%, #fee140 100%)\",\n    image: presentationImages.slide5\n  },\n  {\n    background: \"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)\",\n    image: presentationImages.slide6\n  },\n  {\n    background: \"linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)\",\n    image: presentationImages.slide7\n  },\n  {\n    background: \"linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)\",\n    image: presentationImages.slide8\n  },\n  {\n    background: \"linear-gradient(135deg, #e0c3fc 0%, #9bb5ff 100%)\",\n    image: presentationImages.slide9\n  }\n];\n\nfunction PresentationSlideshow() {\n  const [currentSlide, setCurrentSlide] = useState(0);\n  const [isPlaying, setIsPlaying] = useState(true);\n  const [isHovered, setIsHovered] = useState(false);\n\n  useEffect(() => {\n    if (!isPlaying || isHovered) return;\n\n    const interval = setInterval(() => {\n      setCurrentSlide((prev) => (prev + 1) % slides.length);\n    }, 3000);\n\n    return () => clearInterval(interval);\n  }, [isPlaying, isHovered]);\n\n  const nextSlide = () => {\n    setCurrentSlide((prev) => (prev + 1) % slides.length);\n  };\n\n  const prevSlide = () => {\n    setCurrentSlide((prev) => (prev - 1 + slides.length) % slides.length);\n  };\n\n  const goToSlide = (index: number) => {\n    setCurrentSlide(index);\n  };\n\n  return (\n    <div \n      className=\"relative w-full max-w-3xl h-[32rem] rounded-xl overflow-hidden shadow-2xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 mx-auto\"\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      {/* Slide Content */}\n      <div\n        className=\"w-full h-full flex items-center justify-center text-white relative transition-all duration-500 ease-in-out\"\n        style={{ background: slides[currentSlide].background }}\n      >\n        {/* Background Image */}\n        <div className=\"absolute inset-0 opacity-95 overflow-hidden\">\n          <img \n            src={slides[currentSlide].image}\n            alt={`Slide ${currentSlide + 1}`}\n            className=\"w-full h-full object-contain\"\n          />\n        </div>\n\n        {/* Slide Number */}\n        <div className=\"absolute top-4 right-4 bg-black/20 backdrop-blur-sm rounded-full px-3 py-1 text-sm\">\n          {currentSlide + 1} / {slides.length}\n        </div>\n      </div>\n\n      {/* Navigation Controls */}\n      <div className=\"absolute inset-0 flex items-center justify-between opacity-0 hover:opacity-100 transition-opacity duration-300\">\n        <button\n          onClick={prevSlide}\n          className=\"ml-4 p-2 rounded-full bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 transition-colors\"\n          aria-label=\"Previous slide\"\n        >\n          <ChevronLeft size={20} />\n        </button>\n        \n        <button\n          onClick={nextSlide}\n          className=\"mr-4 p-2 rounded-full bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 transition-colors\"\n          aria-label=\"Next slide\"\n        >\n          <ChevronRight size={20} />\n        </button>\n      </div>\n\n      {/* Play/Pause Button */}\n      <div className=\"absolute bottom-4 left-4\">\n        <button\n          onClick={() => setIsPlaying(!isPlaying)}\n          className=\"p-2 rounded-full bg-black/30 backdrop-blur-sm text-white hover:bg-black/50 transition-colors\"\n          aria-label={isPlaying ? \"Pause slideshow\" : \"Play slideshow\"}\n        >\n          {isPlaying ? <Pause size={16} /> : <Play size={16} />}\n        </button>\n      </div>\n\n      {/* Slide Indicators */}\n      <div className=\"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex space-x-2\">\n        {slides.map((_, index) => (\n          <button\n            key={index}\n            onClick={() => goToSlide(index)}\n            className={`w-2 h-2 rounded-full transition-colors ${\n              index === currentSlide \n                ? 'bg-white' \n                : 'bg-white/50 hover:bg-white/75'\n            }`}\n            aria-label={`Go to slide ${index + 1}`}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default PresentationSlideshow;","size_bytes":4834},"client/src/components/progress-card.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { LucideIcon } from \"lucide-react\";\n\ninterface ProgressCardProps {\n  title: string;\n  value: number;\n  subtitle: string;\n  icon: LucideIcon;\n  color: 'primary' | 'secondary' | 'accent';\n}\n\nexport default function ProgressCard({ \n  title, \n  value, \n  subtitle, \n  icon: Icon, \n  color \n}: ProgressCardProps) {\n  const getColorClasses = () => {\n    switch (color) {\n      case 'secondary':\n        return {\n          bg: 'bg-secondary/10',\n          text: 'text-secondary',\n        };\n      case 'accent':\n        return {\n          bg: 'bg-accent/10',\n          text: 'text-accent',\n        };\n      default:\n        return {\n          bg: 'bg-primary/10',\n          text: 'text-primary',\n        };\n    }\n  };\n\n  const colorClasses = getColorClasses();\n\n  return (\n    <Card className=\"glassmorphism gradient-overlay hover-lift interactive-element border-white/20\">\n      <CardContent className=\"p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <CardTitle className=\"text-lg font-semibold text-neutral-700\">\n            {title}\n          </CardTitle>\n          <div className={`w-12 h-12 ${colorClasses.bg} rounded-full flex items-center justify-center`}>\n            <Icon className={colorClasses.text} size={20} />\n          </div>\n        </div>\n        <div className=\"text-3xl font-bold text-neutral-700 mb-2\">\n          {value}\n        </div>\n        <p className=\"text-sm text-neutral-400\">\n          {subtitle}\n        </p>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":1593},"client/src/components/quiz-interface.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\nimport { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Badge } from '@/components/ui/badge';\nimport { Loader2, CheckCircle, XCircle, Brain, Trophy } from 'lucide-react';\nimport { useMutation } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface QuizQuestion {\n  question: string;\n  options: string[];\n  correctAnswer: number;\n  explanation: string;\n}\n\ninterface QuizEvaluation {\n  score: number;\n  feedback: string;\n  isCorrect: boolean;\n}\n\ninterface QuizInterfaceProps {\n  moduleId: number;\n  moduleTitle: string;\n  onModuleComplete?: () => void;\n}\n\nexport default function QuizInterface({ moduleId, moduleTitle, onModuleComplete }: QuizInterfaceProps) {\n  const [questions, setQuestions] = useState<QuizQuestion[]>([]);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [selectedAnswers, setSelectedAnswers] = useState<(number | null)[]>([]);\n  const [evaluations, setEvaluations] = useState<(QuizEvaluation | null)[]>([]);\n  const [isQuizStarted, setIsQuizStarted] = useState(false);\n  const [isQuizCompleted, setIsQuizCompleted] = useState(false);\n  const [openAnswer, setOpenAnswer] = useState('');\n  const { toast } = useToast();\n\n  const generateQuizMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/modules/${moduleId}/quiz`);\n      return await response.json();\n    },\n    onSuccess: (data) => {\n      setQuestions(data.questions);\n      setSelectedAnswers(new Array(data.questions.length).fill(null));\n      setEvaluations(new Array(data.questions.length).fill(null));\n      setIsQuizStarted(true);\n      toast({\n        title: \"Teszt gener√°lva\",\n        description: `${data.questions.length} k√©rd√©s k√©szen √°ll!`,\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const evaluateAnswerMutation = useMutation({\n    mutationFn: async ({ question, correctAnswer, userAnswer, explanation }: {\n      question: string;\n      correctAnswer: string;\n      userAnswer: string;\n      explanation: string;\n    }) => {\n      const response = await apiRequest('POST', '/api/quiz/evaluate', {\n        question,\n        correctAnswer,\n        userAnswer,\n        explanation\n      });\n      return await response.json();\n    },\n    onSuccess: (evaluation: QuizEvaluation, variables) => {\n      const newEvaluations = [...evaluations];\n      newEvaluations[currentQuestionIndex] = evaluation;\n      setEvaluations(newEvaluations);\n      \n      toast({\n        title: `Pontsz√°m: ${evaluation.score}/100`,\n        description: evaluation.isCorrect ? \"Helyes v√°lasz!\" : \"Jav√≠that√≥ v√°lasz\",\n        variant: evaluation.isCorrect ? \"default\" : \"destructive\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"√ârt√©kel√©si hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const completeModuleMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/modules/${moduleId}/complete`);\n      return await response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Gratul√°lunk!\",\n        description: \"Sikeresen befejezted a modult! üéâ\",\n      });\n      onModuleComplete?.();\n    },\n    onError: (error: Error) => {\n      console.error('Error completing module:', error);\n    },\n  });\n\n  const handleAnswerSelect = (answerIndex: number) => {\n    const newAnswers = [...selectedAnswers];\n    newAnswers[currentQuestionIndex] = answerIndex;\n    setSelectedAnswers(newAnswers);\n  };\n\n  const handleSubmitAnswer = () => {\n    const currentQuestion = questions[currentQuestionIndex];\n    const selectedIndex = selectedAnswers[currentQuestionIndex];\n    \n    if (selectedIndex === null) {\n      toast({\n        title: \"V√°lasz hi√°nyzik\",\n        description: \"K√©rlek v√°lassz ki egy lehet≈ës√©get!\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const userAnswer = currentQuestion.options[selectedIndex];\n    const correctAnswer = currentQuestion.options[currentQuestion.correctAnswer];\n\n    evaluateAnswerMutation.mutate({\n      question: currentQuestion.question,\n      correctAnswer,\n      userAnswer,\n      explanation: currentQuestion.explanation\n    });\n  };\n\n  const handleSubmitOpenAnswer = () => {\n    if (!openAnswer.trim()) {\n      toast({\n        title: \"V√°lasz hi√°nyzik\",\n        description: \"K√©rlek √≠rj egy v√°laszt!\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    const currentQuestion = questions[currentQuestionIndex];\n    const correctAnswer = currentQuestion.options[currentQuestion.correctAnswer];\n\n    evaluateAnswerMutation.mutate({\n      question: currentQuestion.question,\n      correctAnswer,\n      userAnswer: openAnswer,\n      explanation: currentQuestion.explanation\n    });\n  };\n\n  const goToNextQuestion = () => {\n    if (currentQuestionIndex < questions.length - 1) {\n      setCurrentQuestionIndex(currentQuestionIndex + 1);\n      setOpenAnswer('');\n    } else {\n      setIsQuizCompleted(true);\n      \n      // Check if score meets 88% threshold for module completion\n      const finalScore = calculateFinalScore();\n      if (finalScore >= 88) {\n        completeModuleMutation.mutate();\n      }\n    }\n  };\n\n  const calculateFinalScore = () => {\n    const validEvaluations = evaluations.filter(e => e !== null) as QuizEvaluation[];\n    if (validEvaluations.length === 0) return 0;\n    \n    const totalScore = validEvaluations.reduce((sum, evaluation) => sum + evaluation.score, 0);\n    return Math.round(totalScore / validEvaluations.length);\n  };\n\n  const getScoreColor = (score: number) => {\n    if (score >= 80) return 'text-green-600';\n    if (score >= 60) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  if (!isQuizStarted) {\n    return (\n      <Card className=\"w-full max-w-2xl mx-auto\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"flex items-center justify-center gap-2\">\n            <Brain className=\"h-6 w-6\" />\n            Tud√°spr√≥ba\n          </CardTitle>\n          <CardDescription>\n            Teszteld a tud√°sod a \"{moduleTitle}\" modulb√≥l!\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"text-center\">\n          <p className=\"mb-6 text-muted-foreground\">\n            Az AI automatikusan gener√°l k√©rd√©seket a modul tartalma alapj√°n, majd √©rt√©keli a v√°laszaidat 1-100 pontos sk√°l√°n.\n          </p>\n          <Button \n            onClick={() => generateQuizMutation.mutate()}\n            disabled={generateQuizMutation.isPending}\n            size=\"lg\"\n          >\n            {generateQuizMutation.isPending ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                K√©rd√©sek gener√°l√°sa...\n              </>\n            ) : (\n              <>\n                <Brain className=\"mr-2 h-4 w-4\" />\n                Teszt ind√≠t√°sa\n              </>\n            )}\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  if (isQuizCompleted) {\n    const finalScore = calculateFinalScore();\n    const correctAnswers = evaluations.filter(e => e?.isCorrect).length;\n    const isModuleCompleted = finalScore >= 88;\n    \n    return (\n      <Card className=\"w-full max-w-2xl mx-auto\">\n        <CardHeader className=\"text-center\">\n          <CardTitle className=\"flex items-center justify-center gap-2\">\n            <Trophy className=\"h-6 w-6\" />\n            Teszt befejezve!\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"text-center space-y-6\">\n          <div className=\"space-y-4\">\n            <div className={`text-4xl font-bold ${getScoreColor(finalScore)}`}>\n              {finalScore}/100 pont\n            </div>\n            <p className=\"text-lg\">\n              {correctAnswers}/{questions.length} helyes v√°lasz\n            </p>\n            \n            {isModuleCompleted && (\n              <div className=\"p-4 bg-green-50 border-2 border-green-200 rounded-lg\">\n                <div className=\"flex items-center justify-center gap-2 text-green-700\">\n                  <CheckCircle className=\"h-5 w-5\" />\n                  <span className=\"font-semibold\">Modul sikeresen befejezve!</span>\n                </div>\n                <p className=\"text-sm text-green-600 mt-1\">\n                  El√©rted a 88%-os k√ºsz√∂b√∂t, ez√©rt a modul befejezettnek sz√°m√≠t.\n                </p>\n              </div>\n            )}\n            \n            {!isModuleCompleted && (\n              <div className=\"p-4 bg-yellow-50 border-2 border-yellow-200 rounded-lg\">\n                <div className=\"flex items-center justify-center gap-2 text-yellow-700\">\n                  <XCircle className=\"h-5 w-5\" />\n                  <span className=\"font-semibold\">Modul nem befejezett</span>\n                </div>\n                <p className=\"text-sm text-yellow-600 mt-1\">\n                  A modul befejez√©s√©hez legal√°bb 88 pont sz√ºks√©ges.\n                </p>\n              </div>\n            )}\n          </div>\n\n          <div className=\"space-y-3\">\n            {evaluations.map((evaluation, index) => (\n              evaluation && (\n                <div key={index} className=\"flex items-center justify-between p-3 bg-muted rounded-lg\">\n                  <div className=\"flex items-center gap-2\">\n                    {evaluation.isCorrect ? \n                      <CheckCircle className=\"h-4 w-4 text-green-600\" /> :\n                      <XCircle className=\"h-4 w-4 text-red-600\" />\n                    }\n                    <span className=\"text-sm\">K√©rd√©s {index + 1}</span>\n                  </div>\n                  <Badge variant={evaluation.isCorrect ? \"default\" : \"destructive\"}>\n                    {evaluation.score} pont\n                  </Badge>\n                </div>\n              )\n            ))}\n          </div>\n\n          <Button \n            onClick={() => {\n              setIsQuizStarted(false);\n              setIsQuizCompleted(false);\n              setCurrentQuestionIndex(0);\n              setQuestions([]);\n              setSelectedAnswers([]);\n              setEvaluations([]);\n            }}\n          >\n            √öj teszt ind√≠t√°sa\n          </Button>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const currentQuestion = questions[currentQuestionIndex];\n  const currentEvaluation = evaluations[currentQuestionIndex];\n\n  return (\n    <Card className=\"w-full max-w-2xl mx-auto\">\n      <CardHeader>\n        <div className=\"flex justify-between items-center\">\n          <CardTitle>\n            K√©rd√©s {currentQuestionIndex + 1}/{questions.length}\n          </CardTitle>\n          <Badge variant=\"outline\">\n            {moduleTitle}\n          </Badge>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-6\">\n        <div className=\"text-lg font-medium\">\n          {currentQuestion.question}\n        </div>\n\n        {!currentEvaluation ? (\n          <div className=\"space-y-4\">\n            <RadioGroup\n              value={selectedAnswers[currentQuestionIndex]?.toString() || ''}\n              onValueChange={(value) => handleAnswerSelect(parseInt(value))}\n            >\n              {currentQuestion.options.map((option, index) => (\n                <div key={index} className=\"flex items-center space-x-2\">\n                  <RadioGroupItem value={index.toString()} id={`option-${index}`} />\n                  <Label htmlFor={`option-${index}`} className=\"flex-1 cursor-pointer\">\n                    {option}\n                  </Label>\n                </div>\n              ))}\n            </RadioGroup>\n\n            <div className=\"border-t pt-4\">\n              <Label htmlFor=\"open-answer\" className=\"text-sm font-medium\">\n                Vagy √≠rd le saj√°t szavaiddal a v√°laszod:\n              </Label>\n              <Textarea\n                id=\"open-answer\"\n                placeholder=\"Itt √≠rhatsz r√©szletes v√°laszt...\"\n                value={openAnswer}\n                onChange={(e) => setOpenAnswer(e.target.value)}\n                className=\"mt-2\"\n              />\n            </div>\n\n            <div className=\"flex gap-2\">\n              <Button \n                onClick={handleSubmitAnswer}\n                disabled={evaluateAnswerMutation.isPending || selectedAnswers[currentQuestionIndex] === null}\n                className=\"flex-1\"\n              >\n                {evaluateAnswerMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    √ârt√©kel√©s...\n                  </>\n                ) : (\n                  'V√°lasz elk√ºld√©se'\n                )}\n              </Button>\n              \n              {openAnswer.trim() && (\n                <Button \n                  onClick={handleSubmitOpenAnswer}\n                  disabled={evaluateAnswerMutation.isPending}\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                >\n                  {evaluateAnswerMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      √ârt√©kel√©s...\n                    </>\n                  ) : (\n                    'Sz√∂veges v√°lasz'\n                  )}\n                </Button>\n              )}\n            </div>\n          </div>\n        ) : (\n          <div className=\"space-y-4\">\n            <div className={`p-4 rounded-lg border-2 ${currentEvaluation.isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}`}>\n              <div className=\"flex items-center gap-2 mb-2\">\n                {currentEvaluation.isCorrect ? \n                  <CheckCircle className=\"h-5 w-5 text-green-600\" /> :\n                  <XCircle className=\"h-5 w-5 text-red-600\" />\n                }\n                <span className={`font-semibold ${getScoreColor(currentEvaluation.score)}`}>\n                  {currentEvaluation.score}/100 pont\n                </span>\n              </div>\n              <p className=\"text-sm text-muted-foreground\">\n                {currentEvaluation.feedback}\n              </p>\n            </div>\n\n            <div className=\"p-3 bg-muted rounded-lg\">\n              <p className=\"text-sm\">\n                <strong>Helyes v√°lasz:</strong> {currentQuestion.options[currentQuestion.correctAnswer]}\n              </p>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {currentQuestion.explanation}\n              </p>\n            </div>\n\n            <Button \n              onClick={goToNextQuestion}\n              className=\"w-full\"\n            >\n              {currentQuestionIndex < questions.length - 1 ? 'K√∂vetkez≈ë k√©rd√©s' : 'Teszt befejez√©se'}\n            </Button>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}","size_bytes":15285},"client/src/components/sidebar.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Link, useLocation } from \"wouter\";\nimport { GraduationCap, Home, BookOpen, TrendingUp, Bot, Settings, LogOut, Users, Search, X, School, User as UserIcon } from \"lucide-react\";\nimport type { User } from \"@shared/schema\";\nimport { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ninterface SidebarProps {\n  user: User;\n}\n\ninterface Module {\n  id: number;\n  title: string;\n  content: string;\n  conciseContent?: string;\n  detailedContent?: string;\n  subjectId: number;\n  subjectName?: string;\n}\n\ninterface SearchResult {\n  module: Module;\n  matches: Array<{\n    field: 'title' | 'content' | 'conciseContent' | 'detailedContent';\n    snippet: string;\n    position: number;\n  }>;\n}\n\nexport default function Sidebar({ user }: SidebarProps) {\n  const [location] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [searchResults, setSearchResults] = useState<SearchResult[]>([]);\n  const [isSearching, setIsSearching] = useState(false);\n\n  // Fetch all modules for search\n  const { data: modules } = useQuery<Module[]>({\n    queryKey: ['/api/public/modules'],\n    retry: false,\n  });\n\n  // Search function\n  const performSearch = (query: string) => {\n    console.log('Search query:', query);\n    if (!modules || query.trim().length < 2) {\n      setSearchResults([]);\n      setIsSearching(false);\n      return;\n    }\n\n    setIsSearching(true);\n    const results: SearchResult[] = [];\n    const searchTerms = query.toLowerCase().split(' ').filter(term => term.length >= 2); // Allow 2+ character terms\n    console.log('Search terms:', searchTerms);\n    console.log('Available modules:', modules?.length);\n\n    modules.forEach(module => {\n      const matches: SearchResult['matches'] = [];\n\n      // Search in title\n      const titleMatches = findMatches(module.title, searchTerms, 'title');\n      matches.push(...titleMatches);\n\n      // Search in content\n      const contentMatches = findMatches(module.content, searchTerms, 'content');\n      matches.push(...contentMatches);\n\n      // Search in concise content if available\n      if (module.conciseContent) {\n        const conciseMatches = findMatches(module.conciseContent, searchTerms, 'conciseContent');\n        matches.push(...conciseMatches);\n      }\n\n      // Search in detailed content if available\n      if (module.detailedContent) {\n        const detailedMatches = findMatches(module.detailedContent, searchTerms, 'detailedContent');\n        matches.push(...detailedMatches);\n      }\n\n      if (matches.length > 0) {\n        results.push({ module, matches });\n      }\n    });\n\n    // Sort by relevance (number of matches)\n    results.sort((a, b) => b.matches.length - a.matches.length);\n    console.log('Search results found:', results.length, results);\n    setSearchResults(results);\n    setIsSearching(false);\n  };\n\n  const findMatches = (text: string, searchTerms: string[], field: SearchResult['matches'][0]['field']) => {\n    const matches: SearchResult['matches'] = [];\n    const lowerText = text.toLowerCase();\n    \n    searchTerms.forEach(term => {\n      let index = 0;\n      let foundCount = 0;\n      while ((index = lowerText.indexOf(term, index)) !== -1) {\n        foundCount++;\n        const start = Math.max(0, index - 50);\n        const end = Math.min(text.length, index + term.length + 50);\n        let snippet = text.substring(start, end);\n        \n        // Add ellipsis if truncated\n        if (start > 0) snippet = '...' + snippet;\n        if (end < text.length) snippet = snippet + '...';\n        \n        matches.push({\n          field,\n          snippet,\n          position: index\n        });\n        \n        index += term.length;\n      }\n      if (foundCount > 0) {\n        console.log(`Found ${foundCount} matches for \"${term}\" in ${field}`);\n      }\n    });\n    \n    return matches.slice(0, 3); // Limit to 3 matches per field\n  };\n\n  // Debounced search\n  useEffect(() => {\n    const timeoutId = setTimeout(() => {\n      performSearch(searchQuery);\n    }, 300);\n\n    return () => clearTimeout(timeoutId);\n  }, [searchQuery, modules]);\n\n  const clearSearch = () => {\n    setSearchQuery(\"\");\n    setSearchResults([]);\n    setIsSearching(false);\n  };\n  \n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  const navItems = user.role === 'admin' ? [\n    { icon: Home, label: \"Admin Panel\", href: \"/\" },\n  ] : user.role === 'teacher' ? [\n    { icon: Home, label: \"Home\", href: \"/\" },\n    { icon: BookOpen, label: \"Szakm√°k\", href: \"/tananyagok\" },\n    { icon: Users, label: \"K√∂z√∂ss√©gi Tanul√°s\", href: \"/community\" },\n    { icon: TrendingUp, label: \"Tanul√≥im\", href: \"/teacher\" },\n    { icon: Settings, label: \"Be√°ll√≠t√°sok\", href: \"/settings\" },\n  ] : [\n    { icon: Home, label: \"Home\", href: \"/\" },\n    { icon: BookOpen, label: \"Szakm√°k\", href: \"/tananyagok\" },\n    { icon: Users, label: \"K√∂z√∂ss√©gi Tanul√°s\", href: \"/community\" },\n    { icon: TrendingUp, label: \"Halad√°som\", href: \"/progress\" },\n    { icon: Settings, label: \"Be√°ll√≠t√°sok\", href: \"/settings\" },\n  ];\n\n  return (\n    <aside className=\"w-64 bg-white shadow-lg h-full flex flex-col\">\n      {/* Logo */}\n      <div className=\"p-6 border-b border-neutral-100 flex-shrink-0 bg-[#635c5c4f]\">\n        <div className=\"flex items-center space-x-3\">\n          <div className=\"w-10 h-10 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center\">\n            <GraduationCap className=\"text-white\" size={20} />\n          </div>\n          <div>\n            <h1 className=\"text-xl font-bold text-neutral-700\">Global Learning System</h1>\n            <p className=\"text-sm text-[#1c1b1b]\">AI Oktat√°si Platform</p>\n          </div>\n        </div>\n      </div>\n      {/* Search Section */}\n      <div className=\"p-4 border-b border-neutral-100 flex-shrink-0\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" size={16} />\n          <Input\n            type=\"text\"\n            placeholder=\"Keres√©s modulokban...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10 pr-10\"\n          />\n          {searchQuery && (\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={clearSearch}\n              className=\"absolute right-1 top-1/2 transform -translate-y-1/2 h-8 w-8 p-0\"\n            >\n              <X size={14} />\n            </Button>\n          )}\n        </div>\n      </div>\n      {/* Navigation */}\n      <nav className=\"p-4 flex-1 min-h-0 text-left bg-[#7cd1323b]\">\n        {/* Search Results */}\n        {searchQuery && (\n          <div className=\"mb-4\">\n            <h3 className=\"text-sm font-medium text-gray-600 mb-2\">\n              Keres√©si eredm√©nyek {searchResults.length > 0 && `(${searchResults.length})`}\n            </h3>\n            {isSearching ? (\n              <div className=\"text-sm text-gray-500\">Keres√©s...</div>\n            ) : searchResults.length > 0 ? (\n              <ScrollArea className=\"max-h-96\">\n                <div className=\"space-y-2\">\n                  {searchResults.map((result, index) => (\n                    <div key={index} className=\"border rounded-lg p-3 bg-gray-50\">\n                      <Link\n                        href={`/modules/${result.module.id}`}\n                        className=\"block hover:bg-gray-100 rounded-md p-1 -m-1\"\n                      >\n                        <div className=\"font-medium text-sm text-blue-600 hover:text-blue-800 mb-1\">\n                          {result.module.title}\n                        </div>\n                        <div className=\"space-y-1\">\n                          {result.matches.slice(0, 2).map((match, matchIndex) => (\n                            <div key={matchIndex} className=\"text-xs\">\n                              <Badge variant=\"outline\" className=\"text-xs mb-1\">\n                                {match.field === 'title' ? 'C√≠m' : \n                                 match.field === 'content' ? 'Tartalom' :\n                                 match.field === 'conciseContent' ? 'T√∂m√∂r' : 'R√©szletes'}\n                              </Badge>\n                              <div className=\"text-gray-600 leading-tight\">\n                                {match.snippet}\n                              </div>\n                            </div>\n                          ))}\n                          {result.matches.length > 2 && (\n                            <div className=\"text-xs text-gray-500\">\n                              +{result.matches.length - 2} tov√°bbi tal√°lat\n                            </div>\n                          )}\n                        </div>\n                      </Link>\n                    </div>\n                  ))}\n                </div>\n              </ScrollArea>\n            ) : (\n              <div className=\"text-sm text-gray-500\">Nincs tal√°lat</div>\n            )}\n          </div>\n        )}\n\n        {/* Regular Navigation */}\n        <ul className=\"space-y-2\">\n          {navItems.map((item, index) => (\n            <li key={index}>\n              <Link \n                href={item.href}\n                className=\"flex items-center space-x-3 p-3 rounded-lg transition-colors text-neutral-700 hover:bg-neutral-50 bg-[#8ad14b]\"\n              >\n                <item.icon size={20} />\n                <span className=\"font-medium\">{item.label}</span>\n              </Link>\n            </li>\n          ))}\n        </ul>\n      </nav>\n      {/* User Profile */}\n      <div className=\"p-4 border-t border-neutral-100 flex-shrink-0 bg-[#8ea64c4a]\">\n        <div className=\"bg-neutral-50 rounded-lg p-3\">\n          <div className=\"mb-2\">\n            <p className=\"text-sm font-medium text-neutral-700 truncate\">\n              {user.firstName && user.lastName \n                ? `${user.firstName} ${user.lastName}` \n                : user.email\n              }\n            </p>\n            <p className=\"text-xs text-neutral-400 capitalize\">{user.role}</p>\n          </div>\n          \n          {/* Student-specific information */}\n          {user.role === 'student' && (\n            <StudentInfo user={user} />\n          )}\n          \n          <div className=\"space-y-1\">\n            <Button \n              variant=\"ghost\" \n              size=\"sm\"\n              onClick={handleLogout}\n              className=\"w-full bg-[#d1b7883b] text-[#0d0c0c] hover:text-neutral-700 text-xs\"\n            >\n              <LogOut size={14} className=\"mr-2\" />\n              Kijelentkez√©s\n            </Button>\n          </div>\n        </div>\n      </div>\n    </aside>\n  );\n}\n\n// Component for displaying student-specific information\nfunction StudentInfo({ user }: { user: User }) {\n  const { data: userDetails } = useQuery({\n    queryKey: ['/api/user/details', user.id],\n    queryFn: async () => {\n      const response = await fetch(`/api/user/details/${user.id}`);\n      if (!response.ok) return null;\n      return response.json();\n    },\n    retry: false,\n  });\n\n  return (\n    <div className=\"space-y-1 mb-3\">\n      {userDetails?.schoolName && (\n        <div className=\"flex items-center text-xs text-neutral-600\">\n          <School size={12} className=\"mr-2\" />\n          <span className=\"truncate\">{userDetails.schoolName}</span>\n        </div>\n      )}\n      {userDetails?.className && (\n        <div className=\"flex items-center text-xs text-neutral-600\">\n          <Users size={12} className=\"mr-2\" />\n          <span className=\"truncate\">{userDetails.className}</span>\n        </div>\n      )}\n      {userDetails?.teacherName && (\n        <div className=\"flex items-center text-xs text-neutral-600\">\n          <UserIcon size={12} className=\"mr-2\" />\n          <span className=\"truncate\">{userDetails.teacherName}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n","size_bytes":12068},"client/src/components/theme-provider.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"dark\" | \"light\" | \"system\";\n\ntype ThemeProviderProps = {\n  children: React.ReactNode;\n  defaultTheme?: Theme;\n  storageKey?: string;\n};\n\ntype ThemeProviderState = {\n  theme: Theme;\n  setTheme: (theme: Theme) => void;\n};\n\nconst initialState: ThemeProviderState = {\n  theme: \"system\",\n  setTheme: () => null,\n};\n\nconst ThemeProviderContext = createContext<ThemeProviderState>(initialState);\n\nexport function ThemeProvider({\n  children,\n  defaultTheme = \"system\",\n  storageKey = \"vite-ui-theme\",\n  ...props\n}: ThemeProviderProps) {\n  const [theme, setTheme] = useState<Theme>(\n    () => (localStorage.getItem(storageKey) as Theme) || defaultTheme\n  );\n\n  useEffect(() => {\n    const root = window.document.documentElement;\n\n    root.classList.remove(\"light\", \"dark\");\n\n    if (theme === \"system\") {\n      const systemTheme = window.matchMedia(\"(prefers-color-scheme: dark)\")\n        .matches\n        ? \"dark\"\n        : \"light\";\n\n      root.classList.add(systemTheme);\n      return;\n    }\n\n    root.classList.add(theme);\n  }, [theme]);\n\n  const value = {\n    theme,\n    setTheme: (theme: Theme) => {\n      localStorage.setItem(storageKey, theme);\n      setTheme(theme);\n    },\n  };\n\n  return (\n    <ThemeProviderContext.Provider {...props} value={value}>\n      {children}\n    </ThemeProviderContext.Provider>\n  );\n}\n\nexport const useTheme = () => {\n  const context = useContext(ThemeProviderContext);\n\n  if (context === undefined)\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n\n  return context;\n};\n","size_bytes":1605},"client/src/components/voice-navigation.tsx":{"content":"import React, { useState, useRef, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Mic, MicOff, Volume2 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface VoiceNavigationProps {\n  onNavigationCommand: (command: string) => void;\n}\n\nexport function VoiceNavigation({ onNavigationCommand }: VoiceNavigationProps) {\n  const [isListening, setIsListening] = useState(false);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [recognition, setRecognition] = useState<any | null>(null);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {\n      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n      const recognitionInstance = new SpeechRecognition();\n      \n      recognitionInstance.continuous = false;\n      recognitionInstance.interimResults = false;\n      recognitionInstance.lang = 'hu-HU';\n      \n      recognitionInstance.onstart = () => {\n        setIsListening(true);\n        speakResponse(\"Igen, hallgatlak. Mit szeretn√©l?\");\n      };\n      \n      recognitionInstance.onend = () => {\n        setIsListening(false);\n      };\n      \n      recognitionInstance.onresult = async (event: any) => {\n        try {\n          if (event.results && event.results.length > 0 && event.results[0].length > 0) {\n            const transcript = event.results[0][0].transcript.toLowerCase();\n            console.log('Voice command received:', transcript);\n            \n            setIsProcessing(true);\n            \n            // Check if Szabolcs was mentioned\n            if (transcript.includes('szabolcs')) {\n              await handleVoiceCommand(transcript);\n            } else {\n              await speakResponse(\"K√©rlek, sz√≥l√≠ts meg Szabolcs n√©ven a navig√°l√°shoz.\");\n            }\n            \n            setIsProcessing(false);\n          }\n        } catch (error) {\n          console.error('Voice recognition result error:', error);\n          setIsProcessing(false);\n        }\n      };\n      \n      recognitionInstance.onerror = (event: any) => {\n        console.error('Speech recognition error:', event.error);\n        setIsListening(false);\n        setIsProcessing(false);\n        toast({\n          title: \"Hangfelismer√©si hiba\",\n          description: \"Pr√≥b√°ld √∫jra a hangparancsot.\",\n          variant: \"destructive\"\n        });\n      };\n      \n      setRecognition(recognitionInstance);\n    }\n  }, []);\n\n  const handleIntelligentResponse = async (transcript: string) => {\n    try {\n      console.log('Voice navigation - Sending to backend:', transcript);\n      const response = await apiRequest('POST', '/api/chat/voice', {\n        message: transcript,\n        context: 'voice_navigation'\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        console.log('Voice navigation - Backend response received:', data.message.substring(0, 100) + '...');\n        await speakResponse(data.message);\n      } else {\n        await speakResponse(\"Sajnos nem tudok most v√°laszolni. Pr√≥b√°ld meg k√©s≈ëbb.\");\n      }\n    } catch (error) {\n      console.error('Intelligent response error:', error);\n      await speakResponse(\"Hiba t√∂rt√©nt a v√°lasz gener√°l√°sa sor√°n.\");\n    }\n  };\n\n  const handleVoiceCommand = async (transcript: string) => {\n    try {\n      console.log('Processing voice command:', transcript);\n      \n      // Check for general questions - send to backend with sitemap context\n      if (transcript.includes('mi az') || transcript.includes('mi a') ||\n          transcript.includes('hogy') || transcript.includes('mit') ||\n          transcript.includes('mi√©rt') || transcript.includes('hol') ||\n          transcript.includes('mikor') || transcript.includes('k√©rd√©s') ||\n          transcript.includes('seg√≠ts') || transcript.includes('elmagyar√°zd') ||\n          transcript.includes('el√©rhet≈ë') || transcript.includes('tudok') ||\n          transcript.includes('lehet') || transcript.includes('van')) {\n        await handleIntelligentResponse(transcript);\n        return;\n      }\n      \n      // Home/Main page - expanded synonyms\n      if (transcript.includes('kezd≈ëlap') || transcript.includes('f≈ëoldal') || \n          transcript.includes('otthon') || transcript.includes('home') ||\n          transcript.includes('visszamenj') || transcript.includes('ind√≠t√≥lap') ||\n          transcript.includes('f≈ëmen√º') || transcript.includes('haza')) {\n        onNavigationCommand('/');\n        await speakResponse(\"Kezd≈ëlap megnyit√°sa\");\n        return;\n      }\n      \n      // Admin login - expanded synonyms\n      if (transcript.includes('admin') || transcript.includes('adminisztr√°ci√≥') ||\n          transcript.includes('adminisztr√°tor') || transcript.includes('kezel≈ë') ||\n          transcript.includes('vez√©rl≈ë') || transcript.includes('ir√°ny√≠t√°s') ||\n          transcript.includes('fel√ºgyelet') || transcript.includes('rendszergazda')) {\n        onNavigationCommand('/admin-login');\n        await speakResponse(\"Admin bejelentkez√©s megnyit√°sa\");\n        return;\n      }\n      \n      // Student authentication - expanded synonyms\n      if (transcript.includes('l√©pj be') || transcript.includes('bejelentkez√©s') ||\n          transcript.includes('bel√©p√©s') || transcript.includes('bel√©pek') ||\n          transcript.includes('student') || transcript.includes('di√°k') ||\n          transcript.includes('tanul√≥') || transcript.includes('regisztr√°ci√≥') ||\n          transcript.includes('bel√©pni') || transcript.includes('csatlakoz√°s') ||\n          transcript.includes('kezd≈ë') || transcript.includes('√∫j felhaszn√°l√≥')) {\n        onNavigationCommand('/student-auth');\n        await speakResponse(\"Di√°k bejelentkez√©s megnyit√°sa\");\n        return;\n      }\n      \n      // Learning/Study - expanded synonyms\n      if (transcript.includes('tanulni szeretn√©k') || transcript.includes('tanul√°s') ||\n          transcript.includes('tanulok') || transcript.includes('learning') ||\n          transcript.includes('szeretn√©k tanulni') || transcript.includes('elkezdek tanulni') ||\n          transcript.includes('oktat√°s') || transcript.includes('k√©pz√©s') ||\n          transcript.includes('felk√©sz√ºl√©s') || transcript.includes('tud√°s') ||\n          transcript.includes('lecke') || transcript.includes('√≥ra')) {\n        onNavigationCommand('/home');\n        await speakResponse(\"Tanul√°si fel√ºlet megnyit√°sa\");\n        return;\n      }\n      \n      // Profession selection - expanded synonyms (First level: Szakm√°k)\n      if (transcript.includes('szakma') || transcript.includes('foglalkoz√°s') ||\n          transcript.includes('hivat√°s') || transcript.includes('munkak√∂r') ||\n          transcript.includes('p√°lya') || transcript.includes('szakm√°k') ||\n          transcript.includes('szakir√°ny') || transcript.includes('karrier') ||\n          transcript.includes('munka') || transcript.includes('√°ll√°s') ||\n          transcript.includes('ter√ºletek') || transcript.includes('szakter√ºlet')) {\n        onNavigationCommand('/tananyagok');\n        await speakResponse(\"Szakm√°k oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Learning materials - expanded synonyms (Second level: Tananyagok after Szakm√°k)\n      if (transcript.includes('tananyag') || transcript.includes('tananyagok') ||\n          transcript.includes('anyag') || transcript.includes('anyagok') ||\n          transcript.includes('oktat√≥anyag') || transcript.includes('lecke') ||\n          transcript.includes('tartalom') || transcript.includes('kurzus') ||\n          transcript.includes('seg√©danyag') || transcript.includes('jegyzet') ||\n          transcript.includes('dokumentum') || transcript.includes('√∫tmutat√≥')) {\n        onNavigationCommand('/tananyagok');\n        await speakResponse(\"Tananyagok oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Subjects - expanded synonyms (Alternative access to subjects)\n      if (transcript.includes('tant√°rgy') || transcript.includes('t√°rgy') ||\n          transcript.includes('tant√°rgyak') || transcript.includes('t√°rgyak') ||\n          transcript.includes('subject') || transcript.includes('t√©mak√∂r') ||\n          transcript.includes('diszcipl√≠na') || transcript.includes('ismeretter√ºlet') ||\n          transcript.includes('tant√©ma') || transcript.includes('t√©m√°k')) {\n        onNavigationCommand('/subjects');\n        await speakResponse(\"Tant√°rgyak oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Modules - expanded synonyms  \n      if (transcript.includes('modul') || transcript.includes('modulok') ||\n          transcript.includes('fejezet') || transcript.includes('r√©sz') ||\n          transcript.includes('egys√©g') || transcript.includes('leck√©k') ||\n          transcript.includes('r√©szek') || transcript.includes('szekci√≥') ||\n          transcript.includes('fejezeteket') || transcript.includes('tud√°sblokk') ||\n          transcript.includes('tanegys√©g') || transcript.includes('tanr√©sz')) {\n        onNavigationCommand('/modules');\n        await speakResponse(\"Modulok oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Community\n      if (transcript.includes('k√∂z√∂ss√©g') || transcript.includes('community') ||\n          transcript.includes('csapat') || transcript.includes('egy√ºtt tanul√°s') ||\n          transcript.includes('t√°rsak') || transcript.includes('k√∂z√∂ss√©gi')) {\n        onNavigationCommand('/community');\n        await speakResponse(\"K√∂z√∂ss√©gi oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Settings\n      if (transcript.includes('be√°ll√≠t√°s') || transcript.includes('be√°ll√≠t√°sok') ||\n          transcript.includes('settings') || transcript.includes('konfigur√°ci√≥') ||\n          transcript.includes('opci√≥k') || transcript.includes('preferenci√°k')) {\n        onNavigationCommand('/settings');\n        await speakResponse(\"Be√°ll√≠t√°sok oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Progress\n      if (transcript.includes('halad√°s') || transcript.includes('el≈ërehalad√°s') ||\n          transcript.includes('progress') || transcript.includes('fejl≈ëd√©s') ||\n          transcript.includes('statisztika') || transcript.includes('eredm√©ny')) {\n        onNavigationCommand('/progress');\n        await speakResponse(\"Halad√°s oldal megnyit√°sa\");\n        return;\n      }\n      \n      // Platform info\n      if (transcript.includes('inform√°ci√≥') || transcript.includes('seg√≠ts√©g') ||\n          transcript.includes('s√∫g√≥') || transcript.includes('help') ||\n          transcript.includes('platform') || transcript.includes('rendszer')) {\n        onNavigationCommand('/platform-info');\n        await speakResponse(\"Platform inform√°ci√≥k megnyit√°sa\");\n        return;\n      }\n      \n      // If no specific command matched, try intelligent response with sitemap\n      await handleIntelligentResponse(transcript);\n      \n    } catch (error) {\n      console.error('Voice command processing error:', error);\n      await speakResponse(\"Hiba t√∂rt√©nt a parancs feldolgoz√°sa sor√°n.\");\n    }\n  };\n\n  const speakResponse = async (text: string) => {\n    try {\n      // Use browser's built-in speech synthesis for better reliability\n      if ('speechSynthesis' in window) {\n        // Wait for voices to load if they haven't already\n        let voices = speechSynthesis.getVoices();\n        if (voices.length === 0) {\n          await new Promise(resolve => {\n            speechSynthesis.addEventListener('voiceschanged', resolve, { once: true });\n          });\n          voices = speechSynthesis.getVoices();\n        }\n        \n        const utterance = new SpeechSynthesisUtterance(text);\n        utterance.lang = 'hu-HU';\n        utterance.rate = 0.85;\n        utterance.pitch = 1.0;\n        utterance.volume = 0.9;\n        \n        // Debug: log available voices\n        console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));\n        \n        // Always prioritize Hungarian voices for authentic pronunciation\n        const bestVoice = voices.find(voice => \n          voice.lang === 'hu-HU'\n        ) || voices.find(voice => \n          voice.lang.startsWith('hu')\n        ) || voices.find(voice => \n          voice.name.toLowerCase().includes('szabolcs')\n        ) || voices.find(voice => \n          voice.name.toLowerCase().includes('google') && \n          voice.name.toLowerCase().includes('female')\n        ) || voices.find(voice => \n          voice.name.toLowerCase().includes('female') ||\n          voice.name.toLowerCase().includes('woman')\n        );\n        \n        if (bestVoice) {\n          utterance.voice = bestVoice;\n          console.log('Selected voice:', bestVoice.name, bestVoice.lang);\n        } else {\n          console.log('No suitable voice found, using default');\n        }\n        \n        speechSynthesis.speak(utterance);\n      }\n      \n    } catch (error) {\n      console.error('Speech synthesis error:', error);\n    }\n  };\n\n  const startListening = () => {\n    if (recognition && !isListening) {\n      recognition.start();\n    }\n  };\n\n  const stopListening = () => {\n    if (recognition && isListening) {\n      recognition.stop();\n    }\n  };\n\n  if (!recognition) {\n    return null; // Hide if speech recognition is not supported\n  }\n\n  return (\n    <div className=\"fixed bottom-4 right-4 z-50\">\n      <div className=\"flex flex-col items-center gap-2\">\n        {isListening && (\n          <div className=\"bg-red-500 text-white px-3 py-1 rounded-full text-sm animate-pulse\">\n            Szabolcs hallgat...\n          </div>\n        )}\n        {isProcessing && (\n          <div className=\"bg-blue-500 text-white px-3 py-1 rounded-full text-sm\">\n            Feldolgoz√°s...\n          </div>\n        )}\n        <Button\n          size=\"lg\"\n          className={`rounded-full w-16 h-16 ${isListening ? 'bg-red-500 hover:bg-red-600' : 'bg-primary hover:bg-primary/90'}`}\n          onClick={isListening ? stopListening : startListening}\n          disabled={isProcessing}\n        >\n          {isListening ? (\n            <MicOff className=\"h-6 w-6\" />\n          ) : (\n            <Mic className=\"h-6 w-6\" />\n          )}\n        </Button>\n        <div className=\"text-xs text-center text-muted-foreground max-w-24\">\n          Sz√≥l√≠tsd meg: \"Szabolcs\"\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Add type declarations for speech recognition\ndeclare global {\n  interface Window {\n    SpeechRecognition: any;\n    webkitSpeechRecognition: any;\n  }\n}","size_bytes":14580},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3895},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport function useAuth() {\n  const { data: user, isLoading, error } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n    staleTime: 0, // Always fetch fresh data\n    gcTime: 0, // Don't cache user data (React Query v5)\n    refetchOnWindowFocus: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n    error,\n  };\n}\n","size_bytes":460},"client/src/hooks/useScrollAnimation.ts":{"content":"import { useEffect, useRef, useState } from 'react';\n\ninterface UseScrollAnimationOptions {\n  threshold?: number;\n  rootMargin?: string;\n  triggerOnce?: boolean;\n}\n\nexport function useScrollAnimation(options: UseScrollAnimationOptions = {}) {\n  const { threshold = 0.1, rootMargin = '0px', triggerOnce = true } = options;\n  const [isInView, setIsInView] = useState(false);\n  const ref = useRef<HTMLElement>(null);\n\n  useEffect(() => {\n    const element = ref.current;\n    if (!element) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsInView(true);\n          if (triggerOnce) {\n            observer.unobserve(element);\n          }\n        } else if (!triggerOnce) {\n          setIsInView(false);\n        }\n      },\n      { threshold, rootMargin }\n    );\n\n    observer.observe(element);\n\n    return () => {\n      observer.unobserve(element);\n    };\n  }, [threshold, rootMargin, triggerOnce]);\n\n  return { ref, isInView };\n}\n\nexport function useParallax(speed: number = 0.5) {\n  const [offset, setOffset] = useState(0);\n  const ref = useRef<HTMLElement>(null);\n\n  useEffect(() => {\n    const handleScroll = () => {\n      if (ref.current) {\n        const rect = ref.current.getBoundingClientRect();\n        const scrolled = window.pageYOffset;\n        const rate = scrolled * speed;\n        setOffset(rate);\n      }\n    };\n\n    window.addEventListener('scroll', handleScroll, { passive: true });\n    return () => window.removeEventListener('scroll', handleScroll);\n  }, [speed]);\n\n  return { ref, offset };\n}\n\nexport function useSmoothScroll() {\n  const scrollToElement = (elementId: string, offset: number = 0) => {\n    const element = document.getElementById(elementId);\n    if (element) {\n      const elementPosition = element.getBoundingClientRect().top + window.pageYOffset;\n      const offsetPosition = elementPosition - offset;\n\n      window.scrollTo({\n        top: offsetPosition,\n        behavior: 'smooth'\n      });\n    }\n  };\n\n  const scrollToTop = () => {\n    window.scrollTo({\n      top: 0,\n      behavior: 'smooth'\n    });\n  };\n\n  return { scrollToElement, scrollToTop };\n}","size_bytes":2163},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"client/src/lib/firebase.ts":{"content":"import { initializeApp } from \"firebase/app\";\nimport { getAuth, signInWithRedirect, GoogleAuthProvider, getRedirectResult } from \"firebase/auth\";\n\n// Check if Firebase config is available\nconst isFirebaseConfigured = !!(\n  import.meta.env.VITE_FIREBASE_API_KEY &&\n  import.meta.env.VITE_FIREBASE_PROJECT_ID &&\n  import.meta.env.VITE_FIREBASE_APP_ID\n);\n\nlet auth: any = null;\nlet googleProvider: any = null;\n\nif (isFirebaseConfigured) {\n  const firebaseConfig = {\n    apiKey: import.meta.env.VITE_FIREBASE_API_KEY,\n    authDomain: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebaseapp.com`,\n    projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,\n    storageBucket: `${import.meta.env.VITE_FIREBASE_PROJECT_ID}.firebasestorage.app`,\n    appId: import.meta.env.VITE_FIREBASE_APP_ID,\n  };\n\n  const app = initializeApp(firebaseConfig);\n  auth = getAuth(app);\n  googleProvider = new GoogleAuthProvider();\n}\n\nexport { auth, googleProvider };\n\n// Check if Firebase is configured\nexport function isFirebaseEnabled() {\n  return isFirebaseConfigured;\n}\n\n// Google sign-in function\nexport function signInWithGoogle() {\n  if (!isFirebaseConfigured || !auth || !googleProvider) {\n    throw new Error('Firebase nincs konfigur√°lva');\n  }\n  return signInWithRedirect(auth, googleProvider);\n}\n\n// Handle redirect result after Google sign-in\nexport async function handleGoogleRedirect() {\n  if (!isFirebaseConfigured || !auth) {\n    return null;\n  }\n  \n  try {\n    const result = await getRedirectResult(auth);\n    if (result) {\n      const user = result.user;\n      const credential = GoogleAuthProvider.credentialFromResult(result);\n      return {\n        user,\n        token: credential?.accessToken,\n      };\n    }\n    return null;\n  } catch (error) {\n    console.error('Google sign-in error:', error);\n    throw error;\n  }\n}","size_bytes":1816},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1376},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/pages/admin-dashboard-simple.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Edit, Trash2, Plus, Eye, Wand2 } from \"lucide-react\";\nimport { \n  insertModuleSchema,\n  type Module,\n  type Subject\n} from \"@shared/schema\";\nimport { z } from \"zod\";\n\nconst moduleFormSchema = insertModuleSchema.extend({\n  subjectId: z.number().min(1, \"Tant√°rgy kiv√°laszt√°sa k√∂telez≈ë\"),\n  conciseContent: z.string().optional(),\n  detailedContent: z.string().optional(),\n});\n\ntype ModuleFormData = z.infer<typeof moduleFormSchema>;\n\nexport default function AdminDashboardSimple() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  \n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingModule, setEditingModule] = useState<Module | null>(null);\n\n  // Fetch modules\n  const { data: modules = [] } = useQuery<Module[]>({\n    queryKey: ['/api/modules'],\n    queryFn: async () => {\n      const response = await fetch('/api/modules');\n      if (!response.ok) throw new Error('Failed to fetch modules');\n      return response.json();\n    },\n  });\n\n  // Fetch subjects\n  const { data: subjects = [] } = useQuery<Subject[]>({\n    queryKey: ['/api/subjects'],\n    queryFn: async () => {\n      const response = await fetch('/api/subjects');\n      if (!response.ok) throw new Error('Failed to fetch subjects');\n      return response.json();\n    },\n  });\n\n  // Form setup\n  const form = useForm<ModuleFormData>({\n    resolver: zodResolver(moduleFormSchema),\n    defaultValues: {\n      title: \"\",\n      content: \"\",\n      conciseContent: \"\",\n      detailedContent: \"\",\n      moduleNumber: 1,\n      subjectId: 0,\n      videoUrl: \"\",\n      audioUrl: \"\",\n      imageUrl: \"\",\n      youtubeUrl: \"\",\n      podcastUrl: \"\",\n      isPublished: false,\n    },\n  });\n\n  // Load module data when editing\n  useEffect(() => {\n    if (editingModule && isDialogOpen) {\n      form.setValue(\"title\", editingModule.title);\n      form.setValue(\"content\", editingModule.content);\n      form.setValue(\"conciseContent\", editingModule.conciseContent || \"\");\n      form.setValue(\"detailedContent\", editingModule.detailedContent || \"\");\n      form.setValue(\"moduleNumber\", editingModule.moduleNumber);\n      form.setValue(\"subjectId\", editingModule.subjectId);\n      form.setValue(\"videoUrl\", editingModule.videoUrl || \"\");\n      form.setValue(\"audioUrl\", editingModule.audioUrl || \"\");\n      form.setValue(\"imageUrl\", editingModule.imageUrl || \"\");\n      form.setValue(\"youtubeUrl\", editingModule.youtubeUrl || \"\");\n      form.setValue(\"podcastUrl\", editingModule.podcastUrl || \"\");\n      form.setValue(\"isPublished\", editingModule.isPublished || false);\n      form.trigger();\n    }\n  }, [editingModule, isDialogOpen, form]);\n\n  // Create/Update module mutation\n  const createModuleMutation = useMutation({\n    mutationFn: async (data: ModuleFormData) => {\n      const method = editingModule ? \"PATCH\" : \"POST\";\n      const url = editingModule ? `/api/modules/${editingModule.id}` : \"/api/modules\";\n      const res = await apiRequest(method, url, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/modules'] });\n      setIsDialogOpen(false);\n      setEditingModule(null);\n      form.reset();\n      toast({\n        title: \"Siker\",\n        description: editingModule ? \"Modul friss√≠tve\" : \"Modul l√©trehozva\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete module mutation\n  const deleteModuleMutation = useMutation({\n    mutationFn: async (id: number) => {\n      const res = await apiRequest(\"DELETE\", `/api/modules/${id}`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/modules'] });\n      toast({\n        title: \"Siker\",\n        description: \"Modul t√∂r√∂lve\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // AI regeneration mutation\n  const regenerateModuleMutation = useMutation({\n    mutationFn: async (moduleId: number) => {\n      const res = await apiRequest(\"POST\", `/api/admin/modules/${moduleId}/regenerate-ai`);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/modules'] });\n      toast({\n        title: \"Siker\",\n        description: \"AI tartalom regener√°l√°s elind√≠tva\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEdit = (module: Module) => {\n    setEditingModule(module);\n    setIsDialogOpen(true);\n  };\n\n  const handleNew = () => {\n    setEditingModule(null);\n    form.reset();\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: ModuleFormData) => {\n    createModuleMutation.mutate(data);\n  };\n\n  if (!user || user.role !== 'admin') {\n    return <div>Hozz√°f√©r√©s megtagadva</div>;\n  }\n\n  return (\n    <div className=\"container mx-auto p-6\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"text-3xl font-bold\">Admin Dashboard</h1>\n        <Button onClick={handleNew}>\n          <Plus className=\"w-4 h-4 mr-2\" />\n          √öj modul\n        </Button>\n      </div>\n\n      <div className=\"grid gap-6\">\n        {modules.map((module) => (\n          <Card key={module.id}>\n            <CardHeader>\n              <div className=\"flex justify-between items-start\">\n                <div>\n                  <CardTitle className=\"text-lg\">{module.title}</CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Tant√°rgy: {subjects.find(s => s.id === module.subjectId)?.name || 'N/A'}\n                  </p>\n                  <div className=\"flex gap-2 mt-2\">\n                    <Badge variant={module.isPublished ? \"default\" : \"secondary\"}>\n                      {module.isPublished ? \"Publik√°lt\" : \"V√°zlat\"}\n                    </Badge>\n                    <Badge variant=\"outline\">Modul {module.moduleNumber}</Badge>\n                    {(module.conciseContent || module.detailedContent) && (\n                      <Badge variant=\"secondary\" className=\"bg-purple-100 text-purple-700\">\n                        AI Enhanced\n                      </Badge>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button variant=\"outline\" size=\"sm\" onClick={() => handleEdit(module)}>\n                    <Edit className=\"w-4 h-4\" />\n                  </Button>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\" \n                    onClick={() => regenerateModuleMutation.mutate(module.id)}\n                    disabled={regenerateModuleMutation.isPending}\n                  >\n                    <Wand2 className=\"w-4 h-4\" />\n                  </Button>\n                  <Button \n                    variant=\"destructive\" \n                    size=\"sm\" \n                    onClick={() => deleteModuleMutation.mutate(module.id)}\n                  >\n                    <Trash2 className=\"w-4 h-4\" />\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-sm text-muted-foreground line-clamp-3\">\n                {module.content.substring(0, 200)}...\n              </p>\n              {(module.conciseContent || module.detailedContent) && (\n                <div className=\"mt-3 p-3 bg-purple-50 rounded\">\n                  <p className=\"text-xs font-medium text-purple-700\">AI-gener√°lt tartalom</p>\n                  {module.conciseContent && (\n                    <p className=\"text-xs text-purple-600\">T√∂m√∂r: {module.conciseContent.length} karakter</p>\n                  )}\n                  {module.detailedContent && (\n                    <p className=\"text-xs text-purple-600\">R√©szletes: {module.detailedContent.length} karakter</p>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n\n      {/* Edit/Create Dialog */}\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>\n              {editingModule ? \"Modul szerkeszt√©se\" : \"√öj modul l√©trehoz√°sa\"}\n            </DialogTitle>\n          </DialogHeader>\n\n          <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\">C√≠m</Label>\n                <Input\n                  id=\"title\"\n                  {...form.register(\"title\")}\n                  placeholder=\"Modul c√≠me\"\n                />\n              </div>\n              \n              <div className=\"space-y-2\">\n                <Label htmlFor=\"subjectId\">Tant√°rgy</Label>\n                <Select\n                  value={form.watch(\"subjectId\")?.toString() || \"\"}\n                  onValueChange={(value) => form.setValue(\"subjectId\", parseInt(value))}\n                >\n                  <SelectTrigger>\n                    <SelectValue placeholder=\"V√°lassz tant√°rgyat\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {subjects.map((subject) => (\n                      <SelectItem key={subject.id} value={subject.id.toString()}>\n                        {subject.name}\n                      </SelectItem>\n                    ))}\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"moduleNumber\">Modul sz√°ma</Label>\n                <Input\n                  id=\"moduleNumber\"\n                  type=\"number\"\n                  {...form.register(\"moduleNumber\", { valueAsNumber: true })}\n                />\n              </div>\n              \n              <div className=\"flex items-center space-x-2 pt-6\">\n                <Switch\n                  id=\"isPublished\"\n                  checked={form.watch(\"isPublished\")}\n                  onCheckedChange={(checked) => form.setValue(\"isPublished\", checked)}\n                />\n                <Label htmlFor=\"isPublished\">Publik√°lt</Label>\n              </div>\n            </div>\n\n            <Tabs defaultValue=\"content\" className=\"w-full\">\n              <TabsList>\n                <TabsTrigger value=\"content\">Alapvet≈ë tartalom</TabsTrigger>\n                <TabsTrigger value=\"ai-content\">AI-gener√°lt tartalom</TabsTrigger>\n                <TabsTrigger value=\"media\">M√©dia</TabsTrigger>\n              </TabsList>\n\n              <TabsContent value=\"content\" className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"content\">Tartalom</Label>\n                  <Textarea\n                    id=\"content\"\n                    {...form.register(\"content\")}\n                    placeholder=\"Modul tartalma (Markdown form√°tumban)\"\n                    rows={10}\n                    className=\"min-h-[200px]\"\n                  />\n                </div>\n              </TabsContent>\n\n              <TabsContent value=\"ai-content\" className=\"space-y-4\">\n                {editingModule && (editingModule.conciseContent || editingModule.detailedContent) ? (\n                  <>\n                    {editingModule.conciseContent && (\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"conciseContent\">T√∂m√∂r verzi√≥ (tanul√≥k √°ltal l√°tott)</Label>\n                        <Textarea\n                          id=\"conciseContent\"\n                          value={form.watch(\"conciseContent\") || \"\"}\n                          onChange={(e) => form.setValue(\"conciseContent\", e.target.value)}\n                          placeholder=\"AI-gener√°lt t√∂m√∂r tartalom\"\n                          rows={8}\n                          className=\"min-h-[200px] bg-purple-50\"\n                        />\n                      </div>\n                    )}\n\n                    {editingModule.detailedContent && (\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"detailedContent\">R√©szletes verzi√≥ (tanul√≥k √°ltal l√°tott)</Label>\n                        <Textarea\n                          id=\"detailedContent\"\n                          value={form.watch(\"detailedContent\") || \"\"}\n                          onChange={(e) => form.setValue(\"detailedContent\", e.target.value)}\n                          placeholder=\"AI-gener√°lt r√©szletes tartalom\"\n                          rows={12}\n                          className=\"min-h-[300px] bg-purple-50\"\n                        />\n                      </div>\n                    )}\n                  </>\n                ) : (\n                  <div className=\"text-center py-8 text-muted-foreground\">\n                    <p>Nincs AI-gener√°lt tartalom</p>\n                    <p className=\"text-sm\">Haszn√°ld az AI regener√°l√°s gombot tartalom gener√°l√°s√°hoz</p>\n                  </div>\n                )}\n              </TabsContent>\n\n              <TabsContent value=\"media\" className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"videoUrl\">Vide√≥ URL</Label>\n                    <Input\n                      id=\"videoUrl\"\n                      {...form.register(\"videoUrl\")}\n                      placeholder=\"https://...\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"youtubeUrl\">YouTube URL</Label>\n                    <Input\n                      id=\"youtubeUrl\"\n                      {...form.register(\"youtubeUrl\")}\n                      placeholder=\"https://youtube.com/...\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"audioUrl\">Hang URL</Label>\n                    <Input\n                      id=\"audioUrl\"\n                      {...form.register(\"audioUrl\")}\n                      placeholder=\"https://...\"\n                    />\n                  </div>\n                  \n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"imageUrl\">K√©p URL</Label>\n                    <Input\n                      id=\"imageUrl\"\n                      {...form.register(\"imageUrl\")}\n                      placeholder=\"https://...\"\n                    />\n                  </div>\n                </div>\n              </TabsContent>\n            </Tabs>\n\n            <div className=\"flex justify-end gap-3\">\n              <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                M√©gse\n              </Button>\n              <Button type=\"submit\" disabled={createModuleMutation.isPending}>\n                {createModuleMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}","size_bytes":16488},"client/src/pages/admin-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel } from \"@/components/ui/form\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Plus, Trash2, Users, BookOpen, GraduationCap, BarChart3, Edit, LogOut, Settings, MessageSquare, Eye, EyeOff, Key, Wrench, HardHat, Cpu, Hammer, Zap, Car, Briefcase, Heart, Utensils, Building, Upload, Wand2, Brain, Youtube, Globe, Search, Clock, Sparkles, Target, CheckCircle, ExternalLink } from \"lucide-react\";\nimport FileUpload, { UrlInput } from \"@/components/file-upload\";\nimport { EnhancedModuleForm } from \"@/components/enhanced-module-form\";\nimport { LinkEditor } from \"@/components/link-editor\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  insertModuleSchema, \n  insertProfessionSchema, \n  insertSubjectSchema,\n  type Module, \n  type Profession, \n  type Subject, \n  type User,\n  type KeyConceptsData \n} from \"@shared/schema\";\n\nconst moduleFormSchema = insertModuleSchema.extend({\n  subjectId: z.number().min(1, \"Tant√°rgy kiv√°laszt√°sa k√∂telez≈ë\"),\n  conciseContent: z.string().optional(),\n  detailedContent: z.string().optional(),\n});\n\nconst professionFormSchema = insertProfessionSchema;\nconst subjectFormSchema = insertSubjectSchema.extend({\n  professionId: z.number().min(1, \"Szakma kiv√°laszt√°sa k√∂telez≈ë\"),\n});\n\nconst schoolAdminFormSchema = z.object({\n  username: z.string().min(3, \"A felhaszn√°l√≥n√©v legal√°bb 3 karakter legyen\"),\n  password: z.string().min(6, \"A jelsz√≥ legal√°bb 6 karakter legyen\"),\n  firstName: z.string().min(1, \"A keresztn√©v k√∂telez≈ë\"),\n  lastName: z.string().min(1, \"A vezet√©kn√©v k√∂telez≈ë\"),\n  schoolName: z.string().min(1, \"Az iskola neve k√∂telez≈ë\"),\n  email: z.string().email(\"√ârv√©nyes email c√≠m sz√ºks√©ges\").optional(),\n});\n\nconst monthlyCostFormSchema = z.object({\n  year: z.number().min(2020).max(2030),\n  month: z.number().min(1).max(12),\n  developmentCosts: z.string().optional(),\n  infrastructureCosts: z.string().optional(),\n  otherCosts: z.string().optional(),\n  notes: z.string().optional(),\n});\n\n// Cost Tracking Component\nfunction CostTrackingComponent() {\n  const { toast } = useToast();\n  const [selectedYear, setSelectedYear] = useState(new Date().getFullYear());\n  const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth() + 1);\n  const [isAddCostDialogOpen, setIsAddCostDialogOpen] = useState(false);\n  const [isEditCostDialogOpen, setIsEditCostDialogOpen] = useState(false);\n  const [editingCost, setEditingCost] = useState<any>(null);\n  const [isApiPricingDialogOpen, setIsApiPricingDialogOpen] = useState(false);\n  const [editingPricing, setEditingPricing] = useState<any>(null);\n\n  const { data: costData, isLoading: costLoading } = useQuery({\n    queryKey: ['/api/admin/costs/stats', selectedYear, selectedMonth],\n    queryFn: async () => {\n      const response = await fetch(`/api/admin/costs/stats?year=${selectedYear}&month=${selectedMonth}`);\n      if (!response.ok) throw new Error('Failed to fetch cost data');\n      return response.json();\n    },\n  });\n\n  const { data: apiPricingData, isLoading: pricingLoading } = useQuery({\n    queryKey: ['/api/admin/api-pricing'],\n    queryFn: async () => {\n      const response = await fetch('/api/admin/api-pricing');\n      if (!response.ok) throw new Error('Failed to fetch API pricing');\n      return response.json();\n    },\n  });\n\n  const costForm = useForm({\n    resolver: zodResolver(monthlyCostFormSchema),\n    defaultValues: {\n      year: selectedYear,\n      month: selectedMonth,\n      developmentCosts: \"0.00\",\n      infrastructureCosts: \"0.00\",\n      otherCosts: \"0.00\",\n      notes: \"\",\n    },\n  });\n\n  const editCostForm = useForm({\n    defaultValues: {\n      developmentCosts: \"0.00\",\n      infrastructureCosts: \"0.00\",\n      otherCosts: \"0.00\",\n      notes: \"\",\n    },\n  });\n\n  const addCostMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await fetch('/api/admin/costs/monthly', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to add cost data');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Havi k√∂lts√©g sikeresen friss√≠tve\" });\n      setIsAddCostDialogOpen(false);\n      costForm.reset();\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/costs/stats'] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Hiba\", \n        description: error.message || \"Nem siker√ºlt friss√≠teni a havi k√∂lts√©get\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const onCostSubmit = (data: any) => {\n    addCostMutation.mutate(data);\n  };\n\n  const editCostMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await fetch(`/api/admin/costs/monthly/${editingCost.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to update cost data');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Havi k√∂lts√©g sikeresen friss√≠tve\" });\n      setIsEditCostDialogOpen(false);\n      setEditingCost(null);\n      editCostForm.reset();\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/costs/stats'] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Hiba\", \n        description: error.message || \"Nem siker√ºlt friss√≠teni a havi k√∂lts√©get\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const onEditCostSubmit = (data: any) => {\n    editCostMutation.mutate(data);\n  };\n\n  const addApiPricingMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await fetch('/api/admin/api-pricing', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) throw new Error('Failed to update API pricing');\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"API √°raz√°s sikeresen friss√≠tve\" });\n      setIsApiPricingDialogOpen(false);\n      setEditingPricing(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/api-pricing'] });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Hiba\", \n        description: error.message || \"Nem siker√ºlt friss√≠teni az API √°raz√°st\",\n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const formatCurrency = (amount: string | number) => {\n    const num = typeof amount === 'string' ? parseFloat(amount) : amount;\n    return new Intl.NumberFormat('hu-HU', {\n      style: 'currency',\n      currency: 'USD',\n    }).format(num || 0);\n  };\n\n  const months = [\n    'Janu√°r', 'Febru√°r', 'M√°rcius', '√Åprilis', 'M√°jus', 'J√∫nius',\n    'J√∫lius', 'Augusztus', 'Szeptember', 'Okt√≥ber', 'November', 'December'\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold\">K√∂lts√©gk√∂vet√©s</h2>\n        <Dialog open={isAddCostDialogOpen} onOpenChange={setIsAddCostDialogOpen}>\n          <DialogTrigger asChild>\n            <Button className=\"flex items-center gap-2\">\n              <Plus className=\"h-4 w-4\" />\n              Havi k√∂lts√©g hozz√°ad√°sa\n            </Button>\n          </DialogTrigger>\n          <DialogContent>\n            <DialogHeader>\n              <DialogTitle>Havi k√∂lts√©g hozz√°ad√°sa/friss√≠t√©se</DialogTitle>\n              <DialogDescription>\n                Adja meg a havi k√∂lts√©geket. Az API k√∂lts√©gek automatikusan kisz√°m√≠t√≥dnak.\n              </DialogDescription>\n            </DialogHeader>\n            <Form {...costForm}>\n              <form onSubmit={costForm.handleSubmit(onCostSubmit)} className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={costForm.control}\n                    name=\"year\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>√âv</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            min=\"2020\" \n                            max=\"2030\" \n                            {...field} \n                            onChange={(e) => field.onChange(parseInt(e.target.value))}\n                          />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={costForm.control}\n                    name=\"month\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>H√≥nap</FormLabel>\n                        <Select \n                          value={field.value.toString()} \n                          onValueChange={(value) => field.onChange(parseInt(value))}\n                        >\n                          <SelectTrigger>\n                            <SelectValue />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {months.map((month, index) => (\n                              <SelectItem key={index + 1} value={(index + 1).toString()}>\n                                {month}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                <FormField\n                  control={costForm.control}\n                  name=\"developmentCosts\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Fejleszt√©si k√∂lts√©gek (USD)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"0.00\" {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={costForm.control}\n                  name=\"infrastructureCosts\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Infrastrukt√∫ra k√∂lts√©gek (USD)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"0.00\" {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={costForm.control}\n                  name=\"otherCosts\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Egy√©b k√∂lts√©gek (USD)</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"0.00\" {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={costForm.control}\n                  name=\"notes\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Megjegyz√©sek</FormLabel>\n                      <FormControl>\n                        <Textarea placeholder=\"Opcion√°lis megjegyz√©sek...\" {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <DialogFooter>\n                  <Button type=\"button\" variant=\"outline\" onClick={() => setIsAddCostDialogOpen(false)}>\n                    M√©gse\n                  </Button>\n                  <Button type=\"submit\" disabled={addCostMutation.isPending}>\n                    {addCostMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                  </Button>\n                </DialogFooter>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      {/* Filter Controls */}\n      <Card>\n        <CardHeader>\n          <CardTitle>Sz≈±r≈ëk</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex gap-4\">\n            <div className=\"space-y-2\">\n              <Label>√âv</Label>\n              <Select value={selectedYear.toString()} onValueChange={(value) => setSelectedYear(parseInt(value))}>\n                <SelectTrigger className=\"w-32\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {Array.from({ length: 11 }, (_, i) => 2020 + i).map(year => (\n                    <SelectItem key={year} value={year.toString()}>\n                      {year}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>H√≥nap</Label>\n              <Select value={selectedMonth.toString()} onValueChange={(value) => setSelectedMonth(parseInt(value))}>\n                <SelectTrigger className=\"w-40\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {months.map((month, index) => (\n                    <SelectItem key={index + 1} value={(index + 1).toString()}>\n                      {month}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {costLoading ? (\n        <div className=\"text-center py-8\">Bet√∂lt√©s...</div>\n      ) : (\n        <div className=\"space-y-6\">\n          {/* API Statistics */}\n          <Card>\n            <CardHeader>\n              <CardTitle>API Haszn√°lati Statisztik√°k</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {costData?.apiStats?.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {costData.apiStats.map((stat: any, index: number) => (\n                    <div key={index} className=\"flex justify-between items-center p-4 border rounded-lg\">\n                      <div>\n                        <h4 className=\"font-medium\">{stat.provider} - {stat.service}</h4>\n                        <p className=\"text-sm text-muted-foreground\">\n                          {stat.totalCalls} h√≠v√°s ‚Ä¢ {stat.totalTokens} token\n                        </p>\n                      </div>\n                      <div className=\"text-right\">\n                        <p className=\"font-bold\">{formatCurrency(stat.totalCost)}</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-muted-foreground\">Nincs API haszn√°lat ebben az id≈ëszakban.</p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Monthly Costs */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Havi K√∂lts√©gek</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {costData?.monthlyCosts?.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {costData.monthlyCosts.map((cost: any) => (\n                    <div key={`${cost.year}-${cost.month}-${cost.id}`} className=\"p-4 border rounded-lg\">\n                      <div className=\"flex justify-between items-start mb-2\">\n                        <h4 className=\"font-medium\">\n                          {months[cost.month - 1]} {cost.year}\n                        </h4>\n                        <div className=\"flex items-center gap-2\">\n                          <p className=\"font-bold text-lg\">{formatCurrency(cost.totalCosts)}</p>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => {\n                              setEditingCost(cost);\n                              editCostForm.reset({\n                                developmentCosts: cost.developmentCosts || \"0.00\",\n                                infrastructureCosts: cost.infrastructureCosts || \"0.00\",\n                                otherCosts: cost.otherCosts || \"0.00\",\n                                notes: cost.notes || \"\",\n                              });\n                              setIsEditCostDialogOpen(true);\n                            }}\n                          >\n                            Szerkeszt√©s\n                          </Button>\n                        </div>\n                      </div>\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                        <div>\n                          <p className=\"text-muted-foreground\">API k√∂lts√©gek (automatikus)</p>\n                          <p className=\"font-medium\">{formatCurrency(cost.apiCosts)}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-muted-foreground\">Fejleszt√©s</p>\n                          <p className=\"font-medium\">{formatCurrency(cost.developmentCosts)}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-muted-foreground\">Infrastrukt√∫ra</p>\n                          <p className=\"font-medium\">{formatCurrency(cost.infrastructureCosts)}</p>\n                        </div>\n                        <div>\n                          <p className=\"text-muted-foreground\">Egy√©b</p>\n                          <p className=\"font-medium\">{formatCurrency(cost.otherCosts)}</p>\n                        </div>\n                      </div>\n                      {cost.notes && (\n                        <p className=\"text-sm text-muted-foreground mt-2\">{cost.notes}</p>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-muted-foreground\">Nincsenek r√∂gz√≠tett havi k√∂lts√©gek.</p>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* API Pricing Management */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex justify-between items-center\">\n                API √Åraz√°s Kezel√©se\n                <Button onClick={() => setIsApiPricingDialogOpen(true)} size=\"sm\">\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  √öj √°raz√°s\n                </Button>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {pricingLoading ? (\n                <div className=\"text-center py-4\">Bet√∂lt√©s...</div>\n              ) : apiPricingData?.pricing?.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {apiPricingData.pricing.map((pricing: any) => (\n                    <div key={pricing.id} className=\"flex justify-between items-center p-4 border rounded-lg\">\n                      <div>\n                        <h4 className=\"font-medium\">\n                          {pricing.provider} - {pricing.service}\n                          {pricing.model && ` (${pricing.model})`}\n                        </h4>\n                        <div className=\"text-sm text-muted-foreground mt-1\">\n                          Token √°r: ${pricing.pricePerToken} ‚Ä¢ K√©r√©s √°r: ${pricing.pricePerRequest}\n                        </div>\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => {\n                            setEditingPricing(pricing);\n                            setIsApiPricingDialogOpen(true);\n                          }}\n                        >\n                          Szerkeszt√©s\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-muted-foreground\">Nincsenek be√°ll√≠tott API √°raz√°sok.</p>\n              )}\n\n              {/* Show discovered APIs that don't have pricing */}\n              {apiPricingData?.uniqueProviders?.length > 0 && (\n                <div className=\"mt-6 pt-4 border-t\">\n                  <h4 className=\"font-medium mb-3\">Felismert API-k (√°raz√°s n√©lk√ºl)</h4>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-2\">\n                    {apiPricingData.uniqueProviders\n                      .filter((provider: any) => \n                        !apiPricingData.pricing.some((p: any) => \n                          p.provider === provider.provider && \n                          p.service === provider.service &&\n                          p.model === provider.model\n                        )\n                      )\n                      .map((provider: any, index: number) => (\n                        <div key={index} className=\"p-2 bg-gray-50 dark:bg-gray-800 rounded text-sm\">\n                          {provider.provider} - {provider.service}\n                          {provider.model && ` (${provider.model})`}\n                        </div>\n                      ))}\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* API Pricing Dialog */}\n      <Dialog open={isApiPricingDialogOpen} onOpenChange={(open) => {\n        setIsApiPricingDialogOpen(open);\n        if (!open) setEditingPricing(null);\n      }}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>\n              {editingPricing ? \"API √°raz√°s szerkeszt√©se\" : \"√öj API √°raz√°s\"}\n            </DialogTitle>\n            <DialogDescription>\n              √Åll√≠tsa be az API szolg√°ltat√°s token √©s k√©r√©s alap√∫ √°raz√°s√°t.\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Szolg√°ltat√≥</Label>\n                <Input \n                  placeholder=\"pl. openai\"\n                  defaultValue={editingPricing?.provider || ''}\n                  onChange={(e) => setEditingPricing({...editingPricing, provider: e.target.value})}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>Szolg√°ltat√°s</Label>\n                <Input \n                  placeholder=\"pl. chat-completion\"\n                  defaultValue={editingPricing?.service || ''}\n                  onChange={(e) => setEditingPricing({...editingPricing, service: e.target.value})}\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label>Model (opcion√°lis)</Label>\n              <Input \n                placeholder=\"pl. gpt-4-turbo\"\n                defaultValue={editingPricing?.model || ''}\n                onChange={(e) => setEditingPricing({...editingPricing, model: e.target.value})}\n              />\n            </div>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label>Token √°r (USD)</Label>\n                <Input \n                  placeholder=\"0.00003000\"\n                  type=\"number\"\n                  step=\"0.00000001\"\n                  defaultValue={editingPricing?.pricePerToken || '0.00000000'}\n                  onChange={(e) => setEditingPricing({...editingPricing, pricePerToken: e.target.value})}\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label>K√©r√©s √°r (USD)</Label>\n                <Input \n                  placeholder=\"0.000000\"\n                  type=\"number\"\n                  step=\"0.000001\"\n                  defaultValue={editingPricing?.pricePerRequest || '0.000000'}\n                  onChange={(e) => setEditingPricing({...editingPricing, pricePerRequest: e.target.value})}\n                />\n              </div>\n            </div>\n          </div>\n          <DialogFooter>\n            <Button type=\"button\" variant=\"outline\" onClick={() => setIsApiPricingDialogOpen(false)}>\n              M√©gse\n            </Button>\n            <Button \n              onClick={() => {\n                if (editingPricing?.provider && editingPricing?.service) {\n                  addApiPricingMutation.mutate(editingPricing);\n                }\n              }}\n              disabled={addApiPricingMutation.isPending}\n            >\n              {addApiPricingMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Edit Cost Dialog */}\n      <Dialog open={isEditCostDialogOpen} onOpenChange={setIsEditCostDialogOpen}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Havi k√∂lts√©g szerkeszt√©se</DialogTitle>\n            <DialogDescription>\n              {editingCost && `${months[editingCost.month - 1]} ${editingCost.year} havi k√∂lts√©geinek szerkeszt√©se. Az API k√∂lts√©gek automatikusan friss√ºlnek.`}\n            </DialogDescription>\n          </DialogHeader>\n          <Form {...editCostForm}>\n            <form onSubmit={editCostForm.handleSubmit(onEditCostSubmit)} className=\"space-y-4\">\n              <FormField\n                control={editCostForm.control}\n                name=\"developmentCosts\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Fejleszt√©si k√∂lts√©gek (USD)</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"0.00\" {...field} />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={editCostForm.control}\n                name=\"infrastructureCosts\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Infrastrukt√∫ra k√∂lts√©gek (USD)</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"0.00\" {...field} />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={editCostForm.control}\n                name=\"otherCosts\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Egy√©b k√∂lts√©gek (USD)</FormLabel>\n                    <FormControl>\n                      <Input placeholder=\"0.00\" {...field} />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={editCostForm.control}\n                name=\"notes\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel>Megjegyz√©sek</FormLabel>\n                    <FormControl>\n                      <Textarea placeholder=\"Opcion√°lis megjegyz√©sek...\" {...field} />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <DialogFooter>\n                <Button type=\"button\" variant=\"outline\" onClick={() => {\n                  setIsEditCostDialogOpen(false);\n                  setEditingCost(null);\n                }}>\n                  M√©gse\n                </Button>\n                <Button type=\"submit\" disabled={editCostMutation.isPending}>\n                  {editCostMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                </Button>\n              </DialogFooter>\n            </form>\n          </Form>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\ntype ModuleFormData = z.infer<typeof moduleFormSchema>;\ntype ProfessionFormData = z.infer<typeof professionFormSchema>;\ntype SubjectFormData = z.infer<typeof subjectFormSchema>;\ntype SchoolAdminFormData = z.infer<typeof schoolAdminFormSchema>;\n\nexport default function AdminDashboard() {\n  const { toast } = useToast();\n  const [activeTab, setActiveTab] = useState(\"overview\");\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isProfessionDialogOpen, setIsProfessionDialogOpen] = useState(false);\n  const [isSubjectDialogOpen, setIsSubjectDialogOpen] = useState(false);\n  const [editingModule, setEditingModule] = useState<Module | null>(null);\n  const [editingProfession, setEditingProfession] = useState<Profession | null>(null);\n  const [editingSubject, setEditingSubject] = useState<Subject | null>(null);\n  const [selectedProfessionForFilter, setSelectedProfessionForFilter] = useState<number | null>(null);\n  const [selectedSubjectForFilter, setSelectedSubjectForFilter] = useState<number | null>(null);\n  const [openaiKey, setOpenaiKey] = useState(\"\");\n  const [geminiKey, setGeminiKey] = useState(\"\");\n  const [dataForSeoLogin, setDataForSeoLogin] = useState(\"\");\n  const [dataForSeoPassword, setDataForSeoPassword] = useState(\"\");\n  const [youtubeApiKey, setYoutubeApiKey] = useState(\"\");\n  const [elevenLabsKey, setElevenLabsKey] = useState(\"\");\n  const [aiProvider, setAiProvider] = useState(\"openai\");\n  const [showOpenaiKey, setShowOpenaiKey] = useState(false);\n  const [showGeminiKey, setShowGeminiKey] = useState(false);\n  const [showDataForSeoLogin, setShowDataForSeoLogin] = useState(false);\n  const [showDataForSeoPassword, setShowDataForSeoPassword] = useState(false);\n  const [showYoutubeKey, setShowYoutubeKey] = useState(false);\n  const [showElevenLabsKey, setShowElevenLabsKey] = useState(false);\n  const [systemMessage, setSystemMessage] = useState(\"\");\n  const [moduleUpdateMessage, setModuleUpdateMessage] = useState(\"\");\n  const [youtubePrompt, setYoutubePrompt] = useState(\"\");\n  const [wikipediaPrompt, setWikipediaPrompt] = useState(\"\");\n  const [internetContentPrompt, setInternetContentPrompt] = useState(\"\");\n  const [conciseContentPrompt, setConciseContentPrompt] = useState(\"\");\n  const [audioExplanationPrompt, setAudioExplanationPrompt] = useState(\"\");\n  const [textExplanationPrompt, setTextExplanationPrompt] = useState(\"\");\n  const [regeneratingModules, setRegeneratingModules] = useState<Set<number>>(new Set());\n  const [isSchoolAdminDialogOpen, setIsSchoolAdminDialogOpen] = useState(false);\n  const [isPasswordResetDialogOpen, setIsPasswordResetDialogOpen] = useState(false);\n  const [resetPasswordUserId, setResetPasswordUserId] = useState<string>(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n\n  // Queries\n  const { data: apiStatus } = useQuery<{\n    openai: boolean;\n    gemini: boolean;\n    dataForSeo: boolean;\n    youtube: boolean;\n    elevenLabs: boolean;\n  }>({\n    queryKey: [\"/api/admin/api-status\"],\n  });\n\n  const { data: professions = [], isLoading: professionsLoading } = useQuery<Profession[]>({\n    queryKey: [\"/api/professions\"],\n  });\n\n  const { data: subjects = [], isLoading: subjectsLoading } = useQuery<Subject[]>({\n    queryKey: [\"/api/subjects\"],\n  });\n\n  // Sz≈±rt tant√°rgyak a kiv√°lasztott szakma alapj√°n\n  const filteredSubjects = selectedProfessionForFilter \n    ? subjects.filter(subject => subject.professionId === selectedProfessionForFilter)\n    : subjects;\n\n  const { data: modules = [], isLoading: modulesLoading } = useQuery<Module[]>({\n    queryKey: [\"/api/modules\"],\n  });\n\n  // Sz≈±rt modulok a kiv√°lasztott tant√°rgy alapj√°n\n  const filteredModules = selectedSubjectForFilter \n    ? modules.filter(module => module.subjectId === selectedSubjectForFilter)\n    : modules;\n\n  const { data: users = [], isLoading: usersLoading } = useQuery<User[]>({\n    queryKey: [\"/api/users\"],\n  });\n\n  // System message and module update message queries\n  const { data: systemMessageData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/system-message\"],\n  });\n\n  const { data: moduleUpdateMessageData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/module-update-message\"],\n  });\n\n  const { data: youtubePromptData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/youtube-prompt\"],\n  });\n\n  const { data: wikipediaPromptData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/wikipedia-prompt\"],\n  });\n\n  const { data: internetContentPromptData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/internet-content-prompt\"],\n  });\n\n  const { data: conciseContentPromptData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/concise-content-prompt\"],\n  });\n\n  const { data: audioExplanationPromptData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/audio-explanation-prompt\"],\n  });\n\n  const { data: textExplanationPromptData } = useQuery<{ message: string }>({\n    queryKey: [\"/api/admin/settings/text-explanation-prompt\"],\n  });\n\n  // Update state when data changes\n  useEffect(() => {\n    if (systemMessageData?.message && !systemMessage) {\n      setSystemMessage(systemMessageData.message);\n    }\n  }, [systemMessageData?.message, systemMessage]);\n\n  useEffect(() => {\n    if (moduleUpdateMessageData?.message && !moduleUpdateMessage) {\n      setModuleUpdateMessage(moduleUpdateMessageData.message);\n    }\n  }, [moduleUpdateMessageData?.message, moduleUpdateMessage]);\n\n  useEffect(() => {\n    if (youtubePromptData?.message && !youtubePrompt) {\n      setYoutubePrompt(youtubePromptData.message);\n    }\n  }, [youtubePromptData?.message, youtubePrompt]);\n\n  useEffect(() => {\n    if (wikipediaPromptData?.message && !wikipediaPrompt) {\n      setWikipediaPrompt(wikipediaPromptData.message);\n    }\n  }, [wikipediaPromptData?.message, wikipediaPrompt]);\n\n  useEffect(() => {\n    if (internetContentPromptData?.message && !internetContentPrompt) {\n      setInternetContentPrompt(internetContentPromptData.message);\n    }\n  }, [internetContentPromptData?.message, internetContentPrompt]);\n\n  useEffect(() => {\n    if (conciseContentPromptData?.message && !conciseContentPrompt) {\n      setConciseContentPrompt(conciseContentPromptData.message);\n    }\n  }, [conciseContentPromptData?.message, conciseContentPrompt]);\n\n  useEffect(() => {\n    if (audioExplanationPromptData?.message && !audioExplanationPrompt) {\n      setAudioExplanationPrompt(audioExplanationPromptData.message);\n    }\n  }, [audioExplanationPromptData?.message, audioExplanationPrompt]);\n\n  useEffect(() => {\n    if (textExplanationPromptData?.message && !textExplanationPrompt) {\n      setTextExplanationPrompt(textExplanationPromptData.message);\n    }\n  }, [textExplanationPromptData?.message, textExplanationPrompt]);\n\n  // Forms\n  const form = useForm<ModuleFormData>({\n    resolver: zodResolver(moduleFormSchema),\n    defaultValues: {\n      title: \"\",\n      content: \"\",\n      conciseContent: \"\",\n      detailedContent: \"\",\n      moduleNumber: 1,\n      subjectId: 0,\n      videoUrl: \"\",\n      audioUrl: \"\",\n      imageUrl: \"\",\n      youtubeUrl: \"\",\n      podcastUrl: \"\",\n      isPublished: false,\n    },\n  });\n\n  const professionForm = useForm<ProfessionFormData>({\n    resolver: zodResolver(professionFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      iconName: \"\",\n      iconUrl: \"\",\n    },\n  });\n\n  // Icon options for profession selection\n  const iconOptions = [\n    { value: \"wrench\", label: \"Kulcs (Hegeszt≈ë, Szerel≈ë)\", icon: Wrench },\n    { value: \"hard-hat\", label: \"Sisak (√âp√≠t≈ëipar)\", icon: HardHat },\n    { value: \"cpu\", label: \"Processzor (IT, Sz√°m√≠t√°stechnika)\", icon: Cpu },\n    { value: \"hammer\", label: \"Kalap√°cs (K√©zm≈±ves)\", icon: Hammer },\n    { value: \"zap\", label: \"Vill√°m (Elektromos)\", icon: Zap },\n    { value: \"car\", label: \"Aut√≥ (G√©pj√°rm≈±)\", icon: Car },\n    { value: \"briefcase\", label: \"T√°ska (√úzleti)\", icon: Briefcase },\n    { value: \"heart\", label: \"Sz√≠v (Eg√©szs√©g√ºgy)\", icon: Heart },\n    { value: \"utensils\", label: \"Ev≈ëeszk√∂z (Vend√©gl√°t√°s)\", icon: Utensils },\n    { value: \"building\", label: \"√âp√ºlet (√âp√≠t√©szet)\", icon: Building },\n    { value: \"graduation-cap\", label: \"Diplomasapka (Oktat√°s)\", icon: GraduationCap },\n  ];\n\n  const subjectForm = useForm<SubjectFormData>({\n    resolver: zodResolver(subjectFormSchema),\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      professionId: 0,\n    },\n  });\n\n  const schoolAdminForm = useForm<SchoolAdminFormData>({\n    resolver: zodResolver(schoolAdminFormSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n      firstName: \"\",\n      lastName: \"\",\n      schoolName: \"\",\n      email: \"\",\n    },\n  });\n\n  // Form √©rt√©kek bet√∂lt√©se az editingModule v√°ltoz√°skor\n  useEffect(() => {\n    if (editingModule && isDialogOpen) {\n      console.log('Loading module data into form:', editingModule.title);\n      \n      form.setValue(\"title\", editingModule.title);\n      form.setValue(\"content\", editingModule.content);\n      form.setValue(\"conciseContent\", editingModule.conciseContent || \"\");\n      form.setValue(\"detailedContent\", editingModule.detailedContent || \"\");\n      form.setValue(\"moduleNumber\", editingModule.moduleNumber);\n      form.setValue(\"subjectId\", editingModule.subjectId);\n      form.setValue(\"videoUrl\", editingModule.videoUrl || \"\");\n      form.setValue(\"audioUrl\", editingModule.audioUrl || \"\");\n      form.setValue(\"imageUrl\", editingModule.imageUrl || \"\");\n      form.setValue(\"youtubeUrl\", editingModule.youtubeUrl || \"\");\n      form.setValue(\"podcastUrl\", editingModule.podcastUrl || \"\");\n      form.setValue(\"isPublished\", editingModule.isPublished || false);\n      \n      form.trigger();\n      console.log('Form content loaded:', form.getValues(\"content\"));\n    }\n  }, [editingModule, isDialogOpen, form]);\n\n  // Mutations\n  const createModuleMutation = useMutation({\n    mutationFn: async (data: ModuleFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/modules\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/modules\"] });\n      setIsDialogOpen(false);\n      toast({ title: \"Siker\", description: \"Modul l√©trehozva\" });\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateModuleMutation = useMutation({\n    mutationFn: async (data: ModuleFormData) => {\n      const res = await apiRequest(\"PATCH\", `/api/modules/${editingModule!.id}`, data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      // Invalidate all module-related queries to ensure both admin and student views update\n      queryClient.invalidateQueries({ queryKey: [\"/api/modules\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/public/modules\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/modules\", editingModule!.id] });\n      queryClient.clear(); // Clear all cache to ensure immediate update\n      \n      setIsDialogOpen(false);\n      setEditingModule(null);\n      toast({ title: \"Siker\", description: \"Modul friss√≠tve - v√°ltoz√°sok minden fel√ºleten l√°that√≥k\" });\n      form.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const togglePublishMutation = useMutation({\n    mutationFn: async ({ id, isPublished }: { id: number; isPublished: boolean }) => {\n      const res = await apiRequest(\"PATCH\", `/api/modules/${id}`, { isPublished });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/modules\"] });\n      toast({ title: \"Siker\", description: \"Modul √°llapota friss√≠tve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateApiKeyMutation = useMutation({\n    mutationFn: async (apiKey: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-api-key\", { openaiApiKey: apiKey });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"OpenAI API kulcs friss√≠tve\" });\n      setOpenaiKey(\"\");\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteModuleMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/modules/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/modules\"] });\n      toast({ title: \"Siker\", description: \"Modul t√∂r√∂lve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const regenerateModuleMutation = useMutation({\n    mutationFn: async ({ moduleId, title, content }: { moduleId: number, title: string, content: string }) => {\n      setRegeneratingModules(prev => new Set(prev).add(moduleId));\n      const response = await apiRequest('POST', `/api/admin/modules/${moduleId}/regenerate-ai`, {\n        title,\n        content\n      });\n      return response.json();\n    },\n    onSuccess: async (_, variables) => {\n      // Clear cache and force refetch\n      queryClient.clear();\n      await queryClient.refetchQueries({ queryKey: [\"/api/modules\"] });\n      \n      setRegeneratingModules(prev => {\n        const next = new Set(prev);\n        next.delete(variables.moduleId);\n        return next;\n      });\n      toast({\n        title: \"AI √öjragener√°l√°s sikeres!\",\n        description: \"A modul tartalm√°t sikeresen friss√≠tette az AI - webes keres√©si eredm√©nyekkel √©s vide√≥kkal b≈ëv√≠tve.\",\n      });\n    },\n    onError: (error: Error, variables) => {\n      setRegeneratingModules(prev => {\n        const next = new Set(prev);\n        next.delete(variables.moduleId);\n        return next;\n      });\n      toast({\n        title: \"√öjragener√°l√°s sikertelen\",\n        description: \"Az AI nem tudta friss√≠teni a modul tartalm√°t.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createProfessionMutation = useMutation({\n    mutationFn: async (data: ProfessionFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/professions\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professions\"] });\n      setIsProfessionDialogOpen(false);\n      toast({ title: \"Siker\", description: \"Szakma l√©trehozva\" });\n      professionForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateProfessionMutation = useMutation({\n    mutationFn: async (data: { id: number; profession: ProfessionFormData }) => {\n      const res = await apiRequest(\"PUT\", `/api/professions/${data.id}`, data.profession);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professions\"] });\n      setIsProfessionDialogOpen(false);\n      setEditingProfession(null);\n      toast({ title: \"Siker\", description: \"Szakma friss√≠tve\" });\n      professionForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteProfessionMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/professions/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/professions\"] });\n      toast({ title: \"Siker\", description: \"Szakma t√∂r√∂lve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const createSubjectMutation = useMutation({\n    mutationFn: async (data: SubjectFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/subjects\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/subjects\"] });\n      setIsSubjectDialogOpen(false);\n      toast({ title: \"Siker\", description: \"Tant√°rgy l√©trehozva\" });\n      subjectForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateSubjectMutation = useMutation({\n    mutationFn: async (data: { id: number; subject: SubjectFormData }) => {\n      const res = await apiRequest(\"PUT\", `/api/subjects/${data.id}`, data.subject);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/subjects\"] });\n      setIsSubjectDialogOpen(false);\n      setEditingSubject(null);\n      toast({ title: \"Siker\", description: \"Tant√°rgy friss√≠tve\" });\n      subjectForm.reset();\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteSubjectMutation = useMutation({\n    mutationFn: async (id: number) => {\n      await apiRequest(\"DELETE\", `/api/subjects/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/subjects\"] });\n      toast({ title: \"Siker\", description: \"Tant√°rgy t√∂r√∂lve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Event handlers\n  const handleProfessionClick = (professionId: number) => {\n    setSelectedProfessionForFilter(professionId);\n    setActiveTab(\"subjects\");\n  };\n\n  const handleShowAllSubjects = () => {\n    setSelectedProfessionForFilter(null);\n  };\n\n  const handleSubjectClick = (subjectId: number) => {\n    setSelectedSubjectForFilter(subjectId);\n    setActiveTab(\"modules\");\n  };\n\n  const handleShowAllModules = () => {\n    setSelectedSubjectForFilter(null);\n  };\n\n  const handleNewModule = () => {\n    setEditingModule(null);\n    form.reset({\n      title: \"\",\n      content: \"\",\n      moduleNumber: 1,\n      subjectId: 0,\n      isPublished: false,\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleEdit = (module: Module) => {\n    console.log('Editing module:', module.title, 'Content length:', module.content?.length);\n    setEditingModule(module);\n    setIsDialogOpen(true);\n  };\n\n  const onSubmit = (data: ModuleFormData) => {\n    if (editingModule) {\n      updateModuleMutation.mutate(data);\n    } else {\n      createModuleMutation.mutate(data);\n    }\n  };\n\n  const handleProfessionEdit = (profession: Profession) => {\n    setEditingProfession(profession);\n    professionForm.reset({\n      name: profession.name,\n      description: profession.description,\n    });\n    setIsProfessionDialogOpen(true);\n  };\n\n  const handleSubjectEdit = (subject: Subject) => {\n    setEditingSubject(subject);\n    subjectForm.reset({\n      name: subject.name,\n      description: subject.description,\n      professionId: subject.professionId,\n    });\n    setIsSubjectDialogOpen(true);\n  };\n\n  const onProfessionSubmit = (data: ProfessionFormData) => {\n    if (editingProfession) {\n      updateProfessionMutation.mutate({ id: editingProfession.id, profession: data });\n    } else {\n      createProfessionMutation.mutate(data);\n    }\n  };\n\n  const onSubjectSubmit = (data: SubjectFormData) => {\n    if (editingSubject) {\n      updateSubjectMutation.mutate({ id: editingSubject.id, subject: data });\n    } else {\n      createSubjectMutation.mutate(data);\n    }\n  };\n\n  const onSchoolAdminSubmit = (data: SchoolAdminFormData) => {\n    createSchoolAdminMutation.mutate(data);\n  };\n\n  // API kulcsok √©s AI be√°ll√≠t√°sok mut√°ci√≥i\n  const updateOpenAIKeyMutation = useMutation({\n    mutationFn: async (openaiApiKey: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-openai-key\", { openaiApiKey });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"OpenAI API kulcs mentve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateGeminiKeyMutation = useMutation({\n    mutationFn: async (geminiApiKey: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-gemini-key\", { geminiApiKey });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Gemini API kulcs mentve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateAIProviderMutation = useMutation({\n    mutationFn: async (provider: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-ai-provider\", { provider });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"AI szolg√°ltat√≥ friss√≠tve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateDataForSeoLoginMutation = useMutation({\n    mutationFn: async (dataForSeoLogin: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-dataforseo-login\", { dataForSeoLogin });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"DataForSEO felhaszn√°l√≥n√©v mentve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateDataForSeoPasswordMutation = useMutation({\n    mutationFn: async (dataForSeoPassword: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-dataforseo-password\", { dataForSeoPassword });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"DataForSEO jelsz√≥ mentve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateYoutubeApiKeyMutation = useMutation({\n    mutationFn: async (youtubeApiKey: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-youtube-key\", { youtubeApiKey });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"YouTube API kulcs mentve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const updateElevenLabsKeyMutation = useMutation({\n    mutationFn: async (elevenLabsKey: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/update-elevenlabs-key\", { elevenLabsKey });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"ElevenLabs API kulcs mentve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Iskolai admin regisztr√°l√°s mut√°ci√≥\n  const createSchoolAdminMutation = useMutation({\n    mutationFn: async (data: SchoolAdminFormData) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/create-school-admin\", data);\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Iskolai admin sikeresen l√©trehozva\" });\n      setIsSchoolAdminDialogOpen(false);\n      schoolAdminForm.reset();\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Jelsz√≥ vissza√°ll√≠t√°si mut√°ci√≥\n  const resetPasswordMutation = useMutation({\n    mutationFn: async ({ userId, newPassword }: { userId: string; newPassword: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/reset-password\", { userId, newPassword });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Jelsz√≥ sikeresen vissza√°ll√≠tva\" });\n      setIsPasswordResetDialogOpen(false);\n      setNewPassword(\"\");\n      setResetPasswordUserId(\"\");\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Rendszer√ºzenet kezel≈ë mut√°ci√≥\n  const updateSystemMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/system-message\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"AI rendszer√ºzenet mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/system-message\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Modul friss√≠t√©si √ºzenet kezel≈ë mut√°ci√≥\n  const updateModuleUpdateMessageMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/module-update-message\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Modul friss√≠t√©si √ºzenet mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/module-update-message\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // YouTube prompt mutation\n  const updateYoutubePromptMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/youtube-prompt\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"YouTube keres√©si prompt mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/youtube-prompt\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Wikipedia prompt mutation\n  const updateWikipediaPromptMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/wikipedia-prompt\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Wikipedia keres√©si prompt mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/wikipedia-prompt\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Internet content prompt mutation\n  const updateInternetContentPromptMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/internet-content-prompt\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Internet tartalom prompt mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/internet-content-prompt\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Concise content prompt mutation\n  const updateConciseContentPromptMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/concise-content-prompt\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"T√∂m√∂r tartalom prompt mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/concise-content-prompt\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Audio explanation prompt mutation\n  const updateAudioExplanationPromptMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/audio-explanation-prompt\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Hangos magyar√°zat prompt mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/audio-explanation-prompt\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // Text explanation prompt mutation\n  const updateTextExplanationPromptMutation = useMutation({\n    mutationFn: async (message: string) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/settings/text-explanation-prompt\", { message });\n      return await res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"Siker\", description: \"Sz√∂veges magyar√°zat prompt mentve\" });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings/text-explanation-prompt\"] });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  // User management mutations\n  const updateUserRoleMutation = useMutation({\n    mutationFn: async ({ userId, role }: { userId: string; role: string }) => {\n      const res = await apiRequest(\"PUT\", `/api/users/${userId}/role`, { role });\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ title: \"Siker\", description: \"Felhaszn√°l√≥ szerepk√∂r friss√≠tve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n\n\n  const unlockAllModulesMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      const res = await apiRequest(\"POST\", `/api/admin/users/${userId}/unlock-all-modules`, {});\n      return await res.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ \n        title: \"Minden modul feloldva\", \n        description: `${data.unlockedCount} modul sikeresen feloldva a felhaszn√°l√≥ sz√°m√°ra` \n      });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const deleteUserMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      await apiRequest(\"DELETE\", `/api/users/${userId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\"] });\n      toast({ title: \"Siker\", description: \"Felhaszn√°l√≥ t√∂r√∂lve\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Hiba\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n\n\n  // Stats\n  const publishedModules = modules?.filter((m: Module) => m.isPublished).length || 0;\n  const adminUsers = users?.filter((u: User) => u.role === 'admin').length || 0;\n  const teacherUsers = users?.filter((u: User) => u.role === 'teacher').length || 0;\n  const studentUsers = users?.filter((u: User) => u.role === 'student').length || 0;\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <main className=\"container mx-auto px-4 py-8\">\n        <div className=\"mb-8 flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Admin Dashboard</h1>\n            <p className=\"text-gray-600 dark:text-gray-300\">Rendszer kezel√©s √©s tartalom adminisztr√°ci√≥</p>\n          </div>\n          <Button \n            variant=\"outline\" \n            onClick={() => window.location.href = '/api/logout'}\n            className=\"flex items-center gap-2\"\n          >\n            <LogOut className=\"h-4 w-4\" />\n            Kijelentkez√©s\n          </Button>\n        </div>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-9\">\n            <TabsTrigger value=\"overview\">√Åttekint√©s</TabsTrigger>\n            <TabsTrigger value=\"professions\">Szakm√°k</TabsTrigger>\n            <TabsTrigger value=\"subjects\">Tant√°rgyak</TabsTrigger>\n            <TabsTrigger value=\"modules\">Modulok</TabsTrigger>\n            <TabsTrigger value=\"ai-modules\" className=\"bg-gradient-to-r from-blue-500 to-purple-600 text-white\">\n              <Wand2 className=\"h-4 w-4 mr-1\" />\n              AI Modulok\n            </TabsTrigger>\n            <TabsTrigger value=\"users\">Felhaszn√°l√≥k</TabsTrigger>\n            <TabsTrigger value=\"school-admins\">Iskolai Adminok</TabsTrigger>\n            <TabsTrigger value=\"costs\" className=\"bg-gradient-to-r from-green-500 to-emerald-600 text-white\">\n              <BarChart3 className=\"h-4 w-4 mr-1\" />\n              K√∂lts√©gek\n            </TabsTrigger>\n            <TabsTrigger value=\"settings\">Be√°ll√≠t√°sok</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"overview\" className=\"space-y-6\">\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-4\">\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">√ñsszes szakma</CardTitle>\n                  <GraduationCap className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{professions.length}</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">√ñsszes tant√°rgy</CardTitle>\n                  <BookOpen className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{subjects.length}</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Publik√°lt modulok</CardTitle>\n                  <BarChart3 className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{publishedModules}</div>\n                </CardContent>\n              </Card>\n              <Card>\n                <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n                  <CardTitle className=\"text-sm font-medium\">Felhaszn√°l√≥k</CardTitle>\n                  <Users className=\"h-4 w-4 text-muted-foreground\" />\n                </CardHeader>\n                <CardContent>\n                  <div className=\"text-2xl font-bold\">{users.length}</div>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {adminUsers} admin, {teacherUsers} tan√°r, {studentUsers} hallgat√≥\n                  </p>\n                </CardContent>\n              </Card>\n\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"professions\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <h2 className=\"text-xl font-semibold\">Szakm√°k kezel√©se</h2>\n              <Dialog open={isProfessionDialogOpen} onOpenChange={setIsProfessionDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    √öj szakma\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>\n                      {editingProfession ? \"Szakma szerkeszt√©se\" : \"√öj szakma l√©trehoz√°sa\"}\n                    </DialogTitle>\n                  </DialogHeader>\n                  <Form {...professionForm}>\n                    <form onSubmit={professionForm.handleSubmit(onProfessionSubmit)} className=\"space-y-4\">\n                      <FormField\n                        control={professionForm.control}\n                        name=\"name\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Szakma neve</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"pl. Hegeszt≈ë\" {...field} />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={professionForm.control}\n                        name=\"description\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Le√≠r√°s</FormLabel>\n                            <FormControl>\n                              <Textarea placeholder=\"Szakma le√≠r√°sa...\" {...field} value={field.value || \"\"} />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={professionForm.control}\n                        name=\"iconName\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Ikon kiv√°laszt√°sa</FormLabel>\n                            <FormControl>\n                              <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"V√°lasszon ikont a szakm√°hoz\" />\n                                </SelectTrigger>\n                                <SelectContent>\n                                  {iconOptions.map((option) => (\n                                    <SelectItem key={option.value} value={option.value}>\n                                      <div className=\"flex items-center gap-2\">\n                                        <option.icon size={16} />\n                                        {option.label}\n                                      </div>\n                                    </SelectItem>\n                                  ))}\n                                </SelectContent>\n                              </Select>\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={professionForm.control}\n                        name=\"iconUrl\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Egyedi ikon URL (opcion√°lis)</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"https://example.com/icon.png\" {...field} value={field.value || \"\"} />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                      <div className=\"flex justify-end space-x-2\">\n                        <Button type=\"button\" variant=\"outline\" onClick={() => {\n                          setIsProfessionDialogOpen(false);\n                          setEditingProfession(null);\n                          professionForm.reset();\n                        }}>\n                          M√©gse\n                        </Button>\n                        <Button type=\"submit\" disabled={createProfessionMutation.isPending || updateProfessionMutation.isPending}>\n                          {editingProfession ? \"Friss√≠t√©s\" : \"L√©trehoz√°s\"}\n                        </Button>\n                      </div>\n                    </form>\n                  </Form>\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            {professionsLoading ? (\n              <div>Szakm√°k bet√∂lt√©se...</div>\n            ) : (\n              <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                {professions.map((profession: Profession) => (\n                  <Card \n                    key={profession.id} \n                    className=\"relative cursor-pointer hover:shadow-md transition-shadow\"\n                    onClick={() => handleProfessionClick(profession.id)}\n                  >\n                    <CardHeader className=\"pb-3\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1 min-w-0\">\n                          <CardTitle className=\"text-base font-medium truncate\">{profession.name}</CardTitle>\n                          <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                            {profession.description}\n                          </p>\n                        </div>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0 text-muted-foreground hover:text-blue-600\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleProfessionEdit(profession);\n                            }}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              deleteProfessionMutation.mutate(profession.id);\n                            }}\n                            disabled={deleteProfessionMutation.isPending}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardHeader>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"subjects\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-xl font-semibold\">Tant√°rgyak kezel√©se</h2>\n                {selectedProfessionForFilter && (\n                  <div className=\"flex items-center gap-2 mt-2\">\n                    <span className=\"text-sm text-muted-foreground\">\n                      Sz≈±rve: {professions.find(p => p.id === selectedProfessionForFilter)?.name}\n                    </span>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={handleShowAllSubjects}\n                      className=\"h-6 px-2 text-xs\"\n                    >\n                      √ñsszes megjelen√≠t√©se\n                    </Button>\n                  </div>\n                )}\n              </div>\n              <Dialog open={isSubjectDialogOpen} onOpenChange={setIsSubjectDialogOpen}>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    √öj tant√°rgy\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>\n                      {editingSubject ? \"Tant√°rgy szerkeszt√©se\" : \"√öj tant√°rgy l√©trehoz√°sa\"}\n                    </DialogTitle>\n                  </DialogHeader>\n                  <Form {...subjectForm}>\n                    <form onSubmit={subjectForm.handleSubmit(onSubjectSubmit)} className=\"space-y-4\">\n                      <FormField\n                        control={subjectForm.control}\n                        name=\"name\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Tant√°rgy neve</FormLabel>\n                            <FormControl>\n                              <Input placeholder=\"pl. Anyagismeret\" {...field} />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={subjectForm.control}\n                        name=\"description\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Le√≠r√°s</FormLabel>\n                            <FormControl>\n                              <Textarea placeholder=\"Tant√°rgy le√≠r√°sa...\" {...field} value={field.value || \"\"} />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                      <FormField\n                        control={subjectForm.control}\n                        name=\"professionId\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Szakma</FormLabel>\n                            <Select value={field.value.toString()} onValueChange={(value) => field.onChange(parseInt(value))}>\n                              <FormControl>\n                                <SelectTrigger>\n                                  <SelectValue placeholder=\"V√°lassz szakm√°t\" />\n                                </SelectTrigger>\n                              </FormControl>\n                              <SelectContent>\n                                {professions.map((profession: Profession) => (\n                                  <SelectItem key={profession.id} value={profession.id.toString()}>\n                                    {profession.name}\n                                  </SelectItem>\n                                ))}\n                              </SelectContent>\n                            </Select>\n                          </FormItem>\n                        )}\n                      />\n                      <div className=\"flex justify-end space-x-2\">\n                        <Button type=\"button\" variant=\"outline\" onClick={() => {\n                          setIsSubjectDialogOpen(false);\n                          setEditingSubject(null);\n                          subjectForm.reset();\n                        }}>\n                          M√©gse\n                        </Button>\n                        <Button type=\"submit\" disabled={createSubjectMutation.isPending || updateSubjectMutation.isPending}>\n                          {editingSubject ? \"Friss√≠t√©s\" : \"L√©trehoz√°s\"}\n                        </Button>\n                      </div>\n                    </form>\n                  </Form>\n                </DialogContent>\n              </Dialog>\n            </div>\n\n            {subjectsLoading ? (\n              <div>Tant√°rgyak bet√∂lt√©se...</div>\n            ) : (\n              <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                {filteredSubjects.map((subject: Subject) => (\n                  <Card \n                    key={subject.id} \n                    className=\"relative cursor-pointer hover:shadow-md transition-shadow\"\n                    onClick={() => handleSubjectClick(subject.id)}\n                  >\n                    <CardHeader className=\"pb-3\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1 min-w-0\">\n                          <CardTitle className=\"text-base font-medium truncate\">{subject.name}</CardTitle>\n                          <p className=\"text-xs text-muted-foreground mt-1\">\n                            {professions.find((p: Profession) => p.id === subject.professionId)?.name}\n                          </p>\n                          <p className=\"text-sm text-muted-foreground mt-1 line-clamp-2\">\n                            {subject.description}\n                          </p>\n                        </div>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0 text-muted-foreground hover:text-blue-600\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleSubjectEdit(subject);\n                            }}\n                          >\n                            <Edit className=\"h-4 w-4\" />\n                          </Button>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              deleteSubjectMutation.mutate(subject.id);\n                            }}\n                            disabled={deleteSubjectMutation.isPending}\n                          >\n                            <Trash2 className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardHeader>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"modules\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-xl font-semibold\">Modulok kezel√©se</h2>\n                {selectedSubjectForFilter && (\n                  <div className=\"flex items-center gap-2 mt-2\">\n                    <span className=\"text-sm text-muted-foreground\">\n                      Sz≈±rve: {subjects.find(s => s.id === selectedSubjectForFilter)?.name}\n                    </span>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={handleShowAllModules}\n                      className=\"h-6 px-2 text-xs\"\n                    >\n                      √ñsszes megjelen√≠t√©se\n                    </Button>\n                  </div>\n                )}\n              </div>\n              <Button onClick={handleNewModule}>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                √öj modul\n              </Button>\n            </div>\n\n            {modulesLoading ? (\n              <div>Modulok bet√∂lt√©se...</div>\n            ) : (\n              <div className=\"grid gap-3 md:grid-cols-2 lg:grid-cols-3\">\n                {filteredModules && filteredModules.length > 0 ? (\n                  filteredModules.map((module: Module) => (\n                    <Card key={module.id} className=\"relative\">\n                      <CardHeader className=\"pb-3\">\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1 min-w-0\">\n                            <CardTitle className=\"text-base font-medium truncate\">{module.title}</CardTitle>\n                            <div className=\"flex items-center gap-2 mt-1\">\n                              <span className=\"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded\">\n                                Modul {module.moduleNumber}\n                              </span>\n                              <span className={`text-xs px-2 py-1 rounded ${\n                                module.isPublished \n                                  ? 'bg-green-100 text-green-800' \n                                  : 'bg-gray-100 text-gray-800'\n                              }`}>\n                                {module.isPublished ? 'Publik√°lt' : 'Tervezet'}\n                              </span>\n                              {(module.keyConceptsData || module.conciseContent || module.detailedContent) && (\n                                <span className=\"text-xs px-2 py-1 rounded bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\">\n                                  AI Enhanced\n                                </span>\n                              )}\n                            </div>\n                            <p className=\"text-xs text-muted-foreground mt-1\">\n                              {subjects.find(s => s.id === module.subjectId)?.name}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground mt-1\">\n                              Utols√≥ friss√≠t√©s: {module.updatedAt ? new Date(module.updatedAt as string).toLocaleString('hu-HU', {\n                                year: 'numeric',\n                                month: '2-digit',\n                                day: '2-digit',\n                                hour: '2-digit',\n                                minute: '2-digit'\n                              }) : 'Ismeretlen'}\n                            </p>\n                          </div>\n                          <div className=\"flex gap-1\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className={`h-8 w-8 p-0 ${\n                                module.isPublished \n                                  ? 'text-muted-foreground hover:text-orange-600' \n                                  : 'text-muted-foreground hover:text-green-600'\n                              }`}\n                              onClick={() => {\n                                togglePublishMutation.mutate({\n                                  id: module.id,\n                                  isPublished: !module.isPublished\n                                });\n                              }}\n                              disabled={togglePublishMutation.isPending}\n                              title={module.isPublished ? 'Visszavon√°s' : 'Publik√°l√°s'}\n                            >\n                              {module.isPublished ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"h-8 w-8 p-0 text-muted-foreground hover:text-purple-600\"\n                              onClick={() => regenerateModuleMutation.mutate({\n                                moduleId: module.id,\n                                title: module.title,\n                                content: module.content\n                              })}\n                              disabled={regeneratingModules.has(module.id)}\n                              title=\"AI √öjragener√°l√°s\"\n                            >\n                              {regeneratingModules.has(module.id) ? (\n                                <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-current\"></div>\n                              ) : (\n                                <Wand2 className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"h-8 w-8 p-0 text-muted-foreground hover:text-blue-600\"\n                              onClick={() => handleEdit(module)}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              className=\"h-8 w-8 p-0 text-muted-foreground hover:text-destructive\"\n                              onClick={() => deleteModuleMutation.mutate(module.id)}\n                              disabled={deleteModuleMutation.isPending}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </CardHeader>\n                    </Card>\n                  ))\n                ) : (\n                  <div className=\"col-span-full text-center py-8 text-muted-foreground\">\n                    Nincsenek modulok\n                  </div>\n                )}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"ai-modules\" className=\"space-y-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-2xl font-semibold\">Tov√°bbfejlesztett AI Modul K√©sz√≠t√©s</h2>\n                <p className=\"text-muted-foreground\">\n                  Intelligens modul gener√°l√°s t√∂bbszint≈± AI integr√°ci√≥val, Wikipedia linkekkel √©s YouTube vide√≥kkal\n                </p>\n              </div>\n            </div>\n\n            {/* AI Features Overview */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n              <Card className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg\">\n                    <Brain className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-sm\">Dupla verzi√≥</h3>\n                    <p className=\"text-xs text-muted-foreground\">T√∂m√∂r + R√©szletes</p>\n                  </div>\n                </div>\n              </Card>\n              \n              <Card className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-red-100 dark:bg-red-900 rounded-lg\">\n                    <Youtube className=\"h-5 w-5 text-red-600 dark:text-red-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-sm\">YouTube integr√°ci√≥</h3>\n                    <p className=\"text-xs text-muted-foreground\">Automatikus vide√≥ keres√©s</p>\n                  </div>\n                </div>\n              </Card>\n              \n              <Card className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-green-100 dark:bg-green-900 rounded-lg\">\n                    <Globe className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-sm\">Wikipedia linkek</h3>\n                    <p className=\"text-xs text-muted-foreground\">Automatikus referenci√°k</p>\n                  </div>\n                </div>\n              </Card>\n              \n              <Card className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-purple-100 dark:bg-purple-900 rounded-lg\">\n                    <Search className=\"h-5 w-5 text-purple-600 dark:text-purple-400\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-medium text-sm\">DataForSEO keres√©s</h3>\n                    <p className=\"text-xs text-muted-foreground\">Friss szakmai tartalom</p>\n                  </div>\n                </div>\n              </Card>\n            </div>\n\n            {/* AI Processing Queue Status */}\n            <Card className=\"mb-6\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Clock className=\"h-5 w-5\" />\n                  AI Feldolgoz√°si Sor √Ållapota\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center justify-between p-4 bg-muted/50 rounded-lg\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-3 h-3 bg-green-500 rounded-full animate-pulse\"></div>\n                    <span className=\"text-sm font-medium\">3 modul p√°rhuzamosan feldolgozva</span>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground\">Becs√ºlt feldolgoz√°si id≈ë:</p>\n                    <p className=\"font-medium\">~45 m√°sodperc/modul</p>\n                  </div>\n                </div>\n                <div className=\"mt-3 text-xs text-muted-foreground\">\n                  <strong>Perzisztens queue:</strong> A feldolgoz√°s az alkalmaz√°s bez√°r√°sa ut√°n is folytat√≥dik\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Enhanced AI Features */}\n            <Card className=\"mb-6\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Sparkles className=\"h-5 w-5\" />\n                  Tov√°bbfejlesztett AI Funkci√≥k\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  <div className=\"space-y-3\">\n                    <h4 className=\"font-medium flex items-center gap-2\">\n                      <Zap className=\"h-4 w-4 text-yellow-500\" />\n                      Intelligens Tartalom B≈ëv√≠t√©s\n                    </h4>\n                    <ul className=\"text-sm text-muted-foreground space-y-1\">\n                      <li>‚Ä¢ Kulcsszavak automatikus kiemel√©se</li>\n                      <li>‚Ä¢ Wikipedia linkek be√°gyaz√°sa</li>\n                      <li>‚Ä¢ Szakmai kifejez√©sek magyar√°zata</li>\n                      <li>‚Ä¢ Struktur√°lt inform√°ci√≥ rendszerez√©s</li>\n                    </ul>\n                  </div>\n                  \n                  <div className=\"space-y-3\">\n                    <h4 className=\"font-medium flex items-center gap-2\">\n                      <Target className=\"h-4 w-4 text-blue-500\" />\n                      Multi-API Integr√°ci√≥\n                    </h4>\n                    <ul className=\"text-sm text-muted-foreground space-y-1\">\n                      <li>‚Ä¢ DataForSEO: Friss szakmai inform√°ci√≥k</li>\n                      <li>‚Ä¢ YouTube API: Relev√°ns oktat√≥vide√≥k</li>\n                      <li>‚Ä¢ OpenAI/Gemini: Tartalom optimaliz√°l√°s</li>\n                      <li>‚Ä¢ ElevenLabs: Hang szint√©zis k√©szenl√©tben</li>\n                    </ul>\n                  </div>\n                </div>\n                \n                <div className=\"border-t pt-4\">\n                  <div className=\"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-950/20 dark:to-purple-950/20 p-4 rounded-lg\">\n                    <h4 className=\"font-medium text-sm mb-2 flex items-center gap-2\">\n                      <Wand2 className=\"h-4 w-4\" />\n                      Automatikus Workflow\n                    </h4>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Az AI automatikusan elemzi a modult ‚Üí Keres relev√°ns inform√°ci√≥kat ‚Üí L√©trehozza a t√∂m√∂r √©s r√©szletes verzi√≥kat ‚Üí \n                      Megkeresi a megfelel≈ë YouTube vide√≥kat ‚Üí Be√©p√≠ti a Wikipedia hivatkoz√°sokat ‚Üí Optimaliz√°lja a szerkezetet\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <EnhancedModuleForm \n              onModuleCreated={(module) => {\n                queryClient.invalidateQueries({ queryKey: [\"/api/modules\"] });\n                toast({ \n                  title: \"Tov√°bbfejlesztett modul l√©trehozva\", \n                  description: `${module.title} - Teljes AI optimaliz√°l√°s √©s multi-API integr√°ci√≥ befejezve` \n                });\n              }}\n              subjects={subjects}\n            />\n          </TabsContent>\n\n          <TabsContent value=\"users\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Felhaszn√°l√≥k kezel√©se</CardTitle>\n                <div className=\"flex gap-4\">\n                  <span className=\"text-sm text-muted-foreground\">\n                    √ñsszes: {users.length} | Admin: {adminUsers} | Tan√°r: {teacherUsers} | Hallgat√≥: {studentUsers}\n                  </span>\n                </div>\n              </CardHeader>\n              <CardContent>\n                {usersLoading ? (\n                  <div className=\"text-center py-8\">\n                    <p>Felhaszn√°l√≥k bet√∂lt√©se...</p>\n                  </div>\n                ) : users.length === 0 ? (\n                  <div className=\"text-center py-8\">\n                    <p>Nincsenek felhaszn√°l√≥k az adatb√°zisban.</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {users.map((user: User) => (\n                      <div key={user.id} className=\"border rounded-lg p-4 flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          {user.profileImageUrl && (\n                            <img \n                              src={user.profileImageUrl} \n                              alt=\"Profil k√©p\"\n                              className=\"w-12 h-12 rounded-full object-cover\"\n                            />\n                          )}\n                          <div>\n                            <h3 className=\"font-semibold\">\n                              {user.firstName && user.lastName\n                                ? `${user.firstName} ${user.lastName}`\n                                : user.email || user.username || user.id}\n                            </h3>\n                            <p className=\"text-sm text-muted-foreground\">\n                              {user.email || \"Nincs email\"} ‚Ä¢ {user.username || \"Nincs felhaszn√°l√≥n√©v\"}\n                            </p>\n                            <p className=\"text-xs text-muted-foreground\">\n                              ID: {user.id} ‚Ä¢ Regisztr√°ci√≥: {user.createdAt ? new Date(user.createdAt).toLocaleDateString('hu-HU') : \"Ismeretlen\"}\n                            </p>\n                          </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                          <Select\n                            value={user.role}\n                            onValueChange={(newRole) => {\n                              updateUserRoleMutation.mutate({ userId: user.id, role: newRole });\n                            }}\n                          >\n                            <SelectTrigger className=\"w-32\">\n                              <SelectValue />\n                            </SelectTrigger>\n                            <SelectContent>\n                              <SelectItem value=\"student\">Hallgat√≥</SelectItem>\n                              <SelectItem value=\"teacher\">Tan√°r</SelectItem>\n                              <SelectItem value=\"admin\">Admin</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          \n                          {user.role === 'student' && (\n                            <Dialog>\n                              <DialogTrigger asChild>\n                                <Button variant=\"outline\" size=\"sm\">\n                                  <Settings className=\"h-4 w-4 mr-1\" />\n                                  Szakm√°k ({user.assignedProfessionIds?.length || 0})\n                                </Button>\n                              </DialogTrigger>\n                              <DialogContent>\n                                <DialogHeader>\n                                  <DialogTitle>Szakm√°k hozz√°rendel√©se - {user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.email || user.username}</DialogTitle>\n                                </DialogHeader>\n                                <ProfessionAssignmentForm userId={user.id} currentProfessions={user.assignedProfessionIds || []} />\n                              </DialogContent>\n                            </Dialog>\n                          )}\n                          <div className=\"flex gap-2\">\n                            {user.role === 'student' && (\n                              <Button\n                                variant=\"outline\"\n                                size=\"sm\"\n                                onClick={() => {\n                                  if (confirm(`Minden modul felold√°sa ${user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.email || user.username} felhaszn√°l√≥ sz√°m√°ra?`)) {\n                                    unlockAllModulesMutation.mutate(user.id);\n                                  }\n                                }}\n                                title=\"Minden modul felold√°sa\"\n                                disabled={unlockAllModulesMutation.isPending}\n                              >\n                                <CheckCircle className=\"h-4 w-4 mr-1\" />\n                                Minden modul felold√°sa\n                              </Button>\n                            )}\n                            <Button\n                              variant=\"outline\"\n                              size=\"sm\"\n                              onClick={() => {\n                                setResetPasswordUserId(user.id);\n                                setIsPasswordResetDialogOpen(true);\n                              }}\n                              title=\"Jelsz√≥ vissza√°ll√≠t√°sa\"\n                            >\n                              üîë\n                            </Button>\n                            <Button\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              onClick={() => {\n                                if (confirm(`Biztosan t√∂r√∂lni szeretn√©d ${user.firstName && user.lastName ? `${user.firstName} ${user.lastName}` : user.email || user.username} felhaszn√°l√≥t?`)) {\n                                  deleteUserMutation.mutate(user.id);\n                                }\n                              }}\n                              title=\"Felhaszn√°l√≥ t√∂rl√©se\"\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"costs\" className=\"space-y-6\">\n            <CostTrackingComponent />\n          </TabsContent>\n\n          <TabsContent value=\"settings\" className=\"space-y-6\">\n            <h2 className=\"text-xl font-semibold\">Rendszer be√°ll√≠t√°sok</h2>\n            \n            <div className=\"grid gap-6 md:grid-cols-2\">\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5\" />\n                    Rendszer statisztik√°k\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-muted-foreground\">√ñsszes szakma</p>\n                      <p className=\"text-2xl font-bold\">{professions.length}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">√ñsszes tant√°rgy</p>\n                      <p className=\"text-2xl font-bold\">{subjects.length}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">√ñsszes modul</p>\n                      <p className=\"text-2xl font-bold\">{modules.length}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Publik√°lt modulok</p>\n                      <p className=\"text-2xl font-bold\">{publishedModules}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Users className=\"h-5 w-5\" />\n                    Felhaszn√°l√≥ statisztik√°k\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                    <div>\n                      <p className=\"text-muted-foreground\">√ñsszes felhaszn√°l√≥</p>\n                      <p className=\"text-2xl font-bold\">{users.length}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Adminisztr√°torok</p>\n                      <p className=\"text-2xl font-bold\">{adminUsers}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Hallgat√≥k</p>\n                      <p className=\"text-2xl font-bold\">{studentUsers}</p>\n                    </div>\n                    <div>\n                      <p className=\"text-muted-foreground\">Akt√≠v felhaszn√°l√≥k</p>\n                      <p className=\"text-2xl font-bold\">{users.filter(u => u.email).length}</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5\" />\n                    AI Szolg√°ltat√≥ kiv√°laszt√°sa\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label>Akt√≠v AI Szolg√°ltat√≥</Label>\n                    <div className=\"flex gap-2\">\n                      <Button\n                        variant={aiProvider === \"openai\" ? \"default\" : \"outline\"}\n                        onClick={() => {\n                          setAiProvider(\"openai\");\n                          updateAIProviderMutation.mutate(\"openai\");\n                        }}\n                        disabled={updateAIProviderMutation.isPending}\n                        className=\"flex-1\"\n                      >\n                        OpenAI GPT-4o\n                      </Button>\n                      <Button\n                        variant={aiProvider === \"gemini\" ? \"default\" : \"outline\"}\n                        onClick={() => {\n                          setAiProvider(\"gemini\");\n                          updateAIProviderMutation.mutate(\"gemini\");\n                        }}\n                        disabled={updateAIProviderMutation.isPending}\n                        className=\"flex-1\"\n                      >\n                        Gemini 2.5 Pro\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      V√°laszd ki, melyik AI szolg√°ltat√≥t haszn√°lja a rendszer\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Key className=\"h-5 w-5\" />\n                    OpenAI API Kulcs\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"openai-key\">OpenAI API Kulcs</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"openai-key\"\n                        type={showOpenaiKey ? \"text\" : \"password\"}\n                        placeholder=\"sk-...\"\n                        value={openaiKey}\n                        onChange={(e) => setOpenaiKey(e.target.value)}\n                      />\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setShowOpenaiKey(!showOpenaiKey)}\n                      >\n                        {showOpenaiKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={() => {\n                          if (openaiKey.trim()) {\n                            updateOpenAIKeyMutation.mutate(openaiKey.trim());\n                          }\n                        }}\n                        disabled={updateOpenAIKeyMutation.isPending}\n                      >\n                        Ment√©s\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      OpenAI platformr√≥l szerezhet≈ë API kulcs\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Key className=\"h-5 w-5\" />\n                    Gemini API Kulcs\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"gemini-key\">Gemini API Kulcs</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"gemini-key\"\n                        type={showGeminiKey ? \"text\" : \"password\"}\n                        placeholder=\"AIza...\"\n                        value={geminiKey}\n                        onChange={(e) => setGeminiKey(e.target.value)}\n                      />\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setShowGeminiKey(!showGeminiKey)}\n                      >\n                        {showGeminiKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={() => {\n                          if (geminiKey.trim()) {\n                            updateGeminiKeyMutation.mutate(geminiKey.trim());\n                          }\n                        }}\n                        disabled={updateGeminiKeyMutation.isPending}\n                      >\n                        Ment√©s\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Google AI Studio-b√≥l szerezhet≈ë API kulcs\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Key className=\"h-5 w-5\" />\n                    SerpAPI - Internet Keres√©s\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"dataforseo-login\">DataForSEO Felhaszn√°l√≥n√©v</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"dataforseo-login\"\n                        type={showDataForSeoLogin ? \"text\" : \"password\"}\n                        placeholder=\"login...\"\n                        value={dataForSeoLogin}\n                        onChange={(e) => setDataForSeoLogin(e.target.value)}\n                      />\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setShowDataForSeoLogin(!showDataForSeoLogin)}\n                      >\n                        {showDataForSeoLogin ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={() => {\n                          if (dataForSeoLogin.trim()) {\n                            updateDataForSeoLoginMutation.mutate(dataForSeoLogin.trim());\n                          }\n                        }}\n                        disabled={updateDataForSeoLoginMutation.isPending}\n                      >\n                        Ment√©s\n                      </Button>\n                    </div>\n\n                    <Label htmlFor=\"dataforseo-password\">DataForSEO Jelsz√≥</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"dataforseo-password\"\n                        type={showDataForSeoPassword ? \"text\" : \"password\"}\n                        placeholder=\"password...\"\n                        value={dataForSeoPassword}\n                        onChange={(e) => setDataForSeoPassword(e.target.value)}\n                      />\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setShowDataForSeoPassword(!showDataForSeoPassword)}\n                      >\n                        {showDataForSeoPassword ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={() => {\n                          if (dataForSeoPassword.trim()) {\n                            updateDataForSeoPasswordMutation.mutate(dataForSeoPassword.trim());\n                          }\n                        }}\n                        disabled={updateDataForSeoPasswordMutation.isPending}\n                      >\n                        Ment√©s\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Google keres√©si eredm√©nyek lek√©rdez√©s√©hez\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Key className=\"h-5 w-5\" />\n                    YouTube Data API\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"youtube-key\">YouTube API Kulcs</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"youtube-key\"\n                        type={showYoutubeKey ? \"text\" : \"password\"}\n                        placeholder=\"AIza...\"\n                        value={youtubeApiKey}\n                        onChange={(e) => setYoutubeApiKey(e.target.value)}\n                      />\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setShowYoutubeKey(!showYoutubeKey)}\n                      >\n                        {showYoutubeKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={() => {\n                          if (youtubeApiKey.trim()) {\n                            updateYoutubeApiKeyMutation.mutate(youtubeApiKey.trim());\n                          }\n                        }}\n                        disabled={updateYoutubeApiKeyMutation.isPending}\n                      >\n                        Ment√©s\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      YouTube vide√≥k keres√©se √©s adatok lek√©rdez√©se\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Key className=\"h-5 w-5\" />\n                    ElevenLabs - Sz√∂veg ‚Üí Besz√©d\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"elevenlabs-key\">ElevenLabs API Kulcs</Label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        id=\"elevenlabs-key\"\n                        type={showElevenLabsKey ? \"text\" : \"password\"}\n                        placeholder=\"sk_...\"\n                        value={elevenLabsKey}\n                        onChange={(e) => setElevenLabsKey(e.target.value)}\n                      />\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => setShowElevenLabsKey(!showElevenLabsKey)}\n                      >\n                        {showElevenLabsKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                      </Button>\n                      <Button \n                        size=\"sm\" \n                        onClick={() => {\n                          if (elevenLabsKey.trim()) {\n                            updateElevenLabsKeyMutation.mutate(elevenLabsKey.trim());\n                          }\n                        }}\n                        disabled={updateElevenLabsKeyMutation.isPending}\n                      >\n                        Ment√©s\n                      </Button>\n                    </div>\n                    <p className=\"text-xs text-muted-foreground\">\n                      Magas min≈ës√©g≈± hang szint√©zis\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5\" />\n                    AI Szolg√°ltat√≥ √©s Multi-API St√°tusz\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"space-y-3\">\n                    <Label>F≈ë AI Szolg√°ltat√≥</Label>\n                    <Select\n                      value={aiProvider}\n                      onValueChange={(value) => {\n                        setAiProvider(value);\n                        updateAIProviderMutation.mutate(value);\n                      }}\n                    >\n                      <SelectTrigger>\n                        <SelectValue placeholder=\"V√°lassz AI szolg√°ltat√≥t\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"openai\">OpenAI (GPT-4 Turbo)</SelectItem>\n                        <SelectItem value=\"gemini\">Google Gemini 2.5 Pro</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <p className=\"text-xs text-muted-foreground\">\n                      A f≈ë AI szolg√°ltat√≥ a tartalom gener√°l√°shoz. A specializ√°lt API-k automatikusan haszn√°latba ker√ºlnek.\n                    </p>\n                  </div>\n\n                  <div className=\"border-t pt-4\">\n                    <h4 className=\"font-medium mb-3\">Specializ√°lt API Szolg√°ltat√°sok</h4>\n                    <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n                      <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/50\">\n                        <div className={`w-3 h-3 rounded-full ${apiStatus?.openai ? 'bg-green-500' : 'bg-red-500'}`} />\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium\">OpenAI</div>\n                          <div className=\"text-xs text-muted-foreground\">Tartalom gener√°l√°s</div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/50\">\n                        <div className={`w-3 h-3 rounded-full ${apiStatus?.gemini ? 'bg-green-500' : 'bg-red-500'}`} />\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium\">Gemini</div>\n                          <div className=\"text-xs text-muted-foreground\">Alternat√≠v AI</div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/50\">\n                        <div className={`w-3 h-3 rounded-full ${apiStatus?.dataForSeo ? 'bg-green-500' : 'bg-red-500'}`} />\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium\">DataForSEO</div>\n                          <div className=\"text-xs text-muted-foreground\">Internet keres√©s</div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/50\">\n                        <div className={`w-3 h-3 rounded-full ${apiStatus?.youtube ? 'bg-green-500' : 'bg-red-500'}`} />\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium\">YouTube</div>\n                          <div className=\"text-xs text-muted-foreground\">Vide√≥ keres√©s</div>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center gap-2 p-3 rounded-lg bg-muted/50\">\n                        <div className={`w-3 h-3 rounded-full ${apiStatus?.elevenLabs ? 'bg-green-500' : 'bg-red-500'}`} />\n                        <div className=\"text-sm\">\n                          <div className=\"font-medium\">ElevenLabs</div>\n                          <div className=\"text-xs text-muted-foreground\">Besz√©d szint√©zis</div>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"mt-3 p-3 bg-blue-50 dark:bg-blue-950/20 rounded-lg\">\n                      <p className=\"text-xs text-blue-700 dark:text-blue-300\">\n                        <strong>Intelligens feladat √°tir√°ny√≠t√°s:</strong> A rendszer automatikusan a legmegfelel≈ëbb API-t haszn√°lja minden feladathoz - internet keres√©s, vide√≥ keres√©s, besz√©d gener√°l√°s √©s tartalom k√©sz√≠t√©s.\n                      </p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <MessageSquare className=\"h-5 w-5\" />\n                    AI Rendszer√ºzenet be√°ll√≠t√°sa\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"system-message\">Rendszer√ºzenet az AI sz√°m√°ra</Label>\n                    <Textarea\n                      id=\"system-message\"\n                      placeholder=\"Adj meg egy rendszer√ºzenetet, amely meghat√°rozza az AI viselked√©s√©t √©s v√°laszait...\"\n                      value={systemMessage}\n                      onChange={(e) => setSystemMessage(e.target.value)}\n                      rows={6}\n                      className=\"min-h-[150px]\"\n                    />\n                    <div className=\"flex justify-between items-center\">\n                      <p className=\"text-xs text-muted-foreground\">\n                        Ez az √ºzenet minden AI besz√©lget√©s elej√©n elk√ºld√©sre ker√ºl, meghat√°rozva az AI viselked√©s√©t. \n                        <strong>FONTOS:</strong> Adja meg a YouTube keres√©si strat√©gi√°t is a t√∫l sok keres√©s elker√ºl√©se √©rdek√©ben.\n                      </p>\n                      <Button \n                        onClick={() => {\n                          if (systemMessage.trim()) {\n                            updateSystemMessageMutation.mutate(systemMessage.trim());\n                          }\n                        }}\n                        disabled={updateSystemMessageMutation.isPending}\n                      >\n                        {updateSystemMessageMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                      </Button>\n                    </div>\n                  </div>\n                  \n                  {systemMessageData?.message && (\n                    <div className=\"p-4 bg-muted rounded-lg\">\n                      <p className=\"text-sm font-medium mb-2\">Jelenlegi rendszer√ºzenet:</p>\n                      <p className=\"text-sm text-muted-foreground\">\n                        {systemMessageData.message}\n                      </p>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n\n              <Card className=\"md:col-span-2\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center gap-2\">\n                    <Settings className=\"h-5 w-5\" />\n                    AI Tartalomgener√°l√°s - Szekvenci√°lis Prompt Be√°ll√≠t√°sok\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-6\">\n                  <div className=\"space-y-4\">\n                    <h4 className=\"font-medium text-sm\">1. l√©p√©s: Internet-alap√∫ tartalom kieg√©sz√≠t√©s</h4>\n                    <div className=\"space-y-3\">\n                      <Label htmlFor=\"internet-content-prompt\">Internet tartalom gener√°l√°si prompt</Label>\n                      <Textarea\n                        id=\"internet-content-prompt\"\n                        placeholder=\"Gener√°lj friss√≠tett, r√©szletes tartalmat az internet seg√≠ts√©g√©vel...\"\n                        value={internetContentPrompt}\n                        onChange={(e) => setInternetContentPrompt(e.target.value)}\n                        rows={4}\n                        className=\"min-h-[100px]\"\n                      />\n                      <div className=\"flex justify-between items-center\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          1. l√©p√©s: Eredeti tartalom kieg√©sz√≠t√©se internet-alap√∫ inform√°ci√≥kkal\n                        </p>\n                        <Button \n                          onClick={() => {\n                            if (internetContentPrompt.trim()) {\n                              updateInternetContentPromptMutation.mutate(internetContentPrompt.trim());\n                            }\n                          }}\n                          disabled={updateInternetContentPromptMutation.isPending}\n                          size=\"sm\"\n                        >\n                          {updateInternetContentPromptMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t pt-4 space-y-4\">\n                    <h4 className=\"font-medium text-sm\">1B. l√©p√©s: T√∂m√∂r tartalom gener√°l√°s</h4>\n                    <div className=\"space-y-3\">\n                      <Label htmlFor=\"concise-content-prompt\">T√∂m√∂r tartalom gener√°l√°si prompt</Label>\n                      <Textarea\n                        id=\"concise-content-prompt\"\n                        placeholder=\"K√©sz√≠ts t√∂m√∂r, l√©nyegre t√∂r≈ë tananyagot...\"\n                        value={conciseContentPrompt}\n                        onChange={(e) => setConciseContentPrompt(e.target.value)}\n                        rows={4}\n                        className=\"min-h-[100px]\"\n                      />\n                      <div className=\"flex justify-between items-center\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          1B. l√©p√©s: T√∂m√∂r verzi√≥ k√©sz√≠t√©se a r√©szletes tartalomb√≥l\n                        </p>\n                        <Button \n                          onClick={() => {\n                            if (conciseContentPrompt.trim()) {\n                              updateConciseContentPromptMutation.mutate(conciseContentPrompt.trim());\n                            }\n                          }}\n                          disabled={updateConciseContentPromptMutation.isPending}\n                          size=\"sm\"\n                        >\n                          {updateConciseContentPromptMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t pt-4 space-y-4\">\n                    <h4 className=\"font-medium text-sm\">2. l√©p√©s: Wikipedia kulcsszavak azonos√≠t√°sa</h4>\n                    <div className=\"space-y-3\">\n                      <Label htmlFor=\"wikipedia-prompt\">Wikipedia kulcssz√≥ keres√©si prompt</Label>\n                      <Textarea\n                        id=\"wikipedia-prompt\"\n                        placeholder=\"Azonos√≠tsd a modul legfontosabb szakmai kifejez√©seit...\"\n                        value={wikipediaPrompt}\n                        onChange={(e) => setWikipediaPrompt(e.target.value)}\n                        rows={4}\n                        className=\"min-h-[100px]\"\n                      />\n                      <div className=\"flex justify-between items-center\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          2. l√©p√©s: Wikipedia kulcsszavak azonos√≠t√°sa az internet-kieg√©sz√≠tett tartalomb√≥l\n                        </p>\n                        <Button \n                          onClick={() => {\n                            if (wikipediaPrompt.trim()) {\n                              updateWikipediaPromptMutation.mutate(wikipediaPrompt.trim());\n                            }\n                          }}\n                          disabled={updateWikipediaPromptMutation.isPending}\n                          size=\"sm\"\n                        >\n                          {updateWikipediaPromptMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t pt-4 space-y-4\">\n                    <h4 className=\"font-medium text-sm\">3. l√©p√©s: YouTube vide√≥ keres√©s</h4>\n                    <div className=\"space-y-3\">\n                      <Label htmlFor=\"youtube-prompt\">YouTube keres√©si prompt</Label>\n                      <Textarea\n                        id=\"youtube-prompt\"\n                        placeholder=\"Gener√°lj 1-2 konkr√©t YouTube keres√©si kifejez√©st...\"\n                        value={youtubePrompt}\n                        onChange={(e) => setYoutubePrompt(e.target.value)}\n                        rows={4}\n                        className=\"min-h-[100px]\"\n                      />\n                      <div className=\"flex justify-between items-center\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          3. l√©p√©s: YouTube keres√©si kifejez√©sek gener√°l√°sa a Wikipedia-linkelt tartalomb√≥l\n                        </p>\n                        <Button \n                          onClick={() => {\n                            if (youtubePrompt.trim()) {\n                              updateYoutubePromptMutation.mutate(youtubePrompt.trim());\n                            }\n                          }}\n                          disabled={updateYoutubePromptMutation.isPending}\n                          size=\"sm\"\n                        >\n                          {updateYoutubePromptMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t pt-4 space-y-4\">\n                    <h4 className=\"font-medium text-sm\">4. l√©p√©s: Hangos magyar√°zat gener√°l√°s</h4>\n                    <div className=\"space-y-3\">\n                      <Label htmlFor=\"audio-explanation-prompt\">Hangos magyar√°zat prompt</Label>\n                      <Textarea\n                        id=\"audio-explanation-prompt\"\n                        placeholder=\"K√©sz√≠ts r√∂vid, √©rthet≈ë hangos magyar√°zatot...\"\n                        value={audioExplanationPrompt}\n                        onChange={(e) => setAudioExplanationPrompt(e.target.value)}\n                        rows={4}\n                        className=\"min-h-[100px]\"\n                      />\n                      <div className=\"flex justify-between items-center\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          4. l√©p√©s: Hangos magyar√°zat prompt a tanul√≥k k√©rd√©seire\n                        </p>\n                        <Button \n                          onClick={() => {\n                            if (audioExplanationPrompt.trim()) {\n                              updateAudioExplanationPromptMutation.mutate(audioExplanationPrompt.trim());\n                            }\n                          }}\n                          disabled={updateAudioExplanationPromptMutation.isPending}\n                          size=\"sm\"\n                        >\n                          {updateAudioExplanationPromptMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"border-t pt-4 space-y-4\">\n                    <h4 className=\"font-medium text-sm\">5. l√©p√©s: Sz√∂veges magyar√°zat gener√°l√°s</h4>\n                    <div className=\"space-y-3\">\n                      <Label htmlFor=\"text-explanation-prompt\">Sz√∂veges magyar√°zat prompt</Label>\n                      <Textarea\n                        id=\"text-explanation-prompt\"\n                        placeholder=\"K√©sz√≠ts r√©szletes sz√∂veges magyar√°zatot...\"\n                        value={textExplanationPrompt}\n                        onChange={(e) => setTextExplanationPrompt(e.target.value)}\n                        rows={4}\n                        className=\"min-h-[100px]\"\n                      />\n                      <div className=\"flex justify-between items-center\">\n                        <p className=\"text-xs text-muted-foreground\">\n                          5. l√©p√©s: Sz√∂veges magyar√°zat prompt a tanul√≥k k√©rd√©seire\n                        </p>\n                        <Button \n                          onClick={() => {\n                            if (textExplanationPrompt.trim()) {\n                              updateTextExplanationPromptMutation.mutate(textExplanationPrompt.trim());\n                            }\n                          }}\n                          disabled={updateTextExplanationPromptMutation.isPending}\n                          size=\"sm\"\n                        >\n                          {updateTextExplanationPromptMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n                        </Button>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800\">\n                    <h5 className=\"font-medium text-sm mb-2 text-blue-900 dark:text-blue-100\">Szekvenci√°lis feldolgoz√°s</h5>\n                    <p className=\"text-xs text-blue-700 dark:text-blue-300\">\n                      Az AI gener√°l√°s √∂t egym√°sra √©p√ºl≈ë l√©p√©sben t√∂rt√©nik: tartalomkieg√©sz√≠t√©s, t√∂m√∂r verzi√≥, Wikipedia linkek, YouTube vide√≥k, \n                      majd hangos √©s sz√∂veges magyar√°zatok a tanul√≥i k√©rd√©sekre.\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Rendszer inform√°ci√≥k</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"text-sm space-y-2\">\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Platform:</span>\n                      <span>Global Learning System</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Verzi√≥:</span>\n                      <span>v1.0.0</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">Adatb√°zis:</span>\n                      <span className=\"text-green-600\">Kapcsol√≥dva</span>\n                    </div>\n                    <div className=\"flex justify-between\">\n                      <span className=\"text-muted-foreground\">AI szolg√°ltat√°s:</span>\n                      <span className=\"text-green-600\">Akt√≠v</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card>\n                <CardHeader>\n                  <CardTitle>Gyors m≈±veletek</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-3\">\n                  <div className=\"grid gap-2\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={() => setActiveTab(\"professions\")}\n                      className=\"justify-start\"\n                    >\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      √öj szakma hozz√°ad√°sa\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={() => setActiveTab(\"subjects\")}\n                      className=\"justify-start\"\n                    >\n                      <BookOpen className=\"h-4 w-4 mr-2\" />\n                      Tant√°rgy kezel√©se\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={() => setActiveTab(\"modules\")}\n                      className=\"justify-start\"\n                    >\n                      <GraduationCap className=\"h-4 w-4 mr-2\" />\n                      Modul szerkeszt√©se\n                    </Button>\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\" \n                      onClick={() => setActiveTab(\"users\")}\n                      className=\"justify-start\"\n                    >\n                      <Users className=\"h-4 w-4 mr-2\" />\n                      Felhaszn√°l√≥k megtekint√©se\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"text-red-600\">Vesz√©lyes m≈±veletek</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex items-center justify-between p-4 border border-red-200 rounded-lg bg-red-50\">\n                  <div>\n                    <h4 className=\"font-medium text-red-800\">Rendszer √∫jraind√≠t√°sa</h4>\n                    <p className=\"text-sm text-red-600\">Ez ideiglenesen megszak√≠tja a szolg√°ltat√°st</p>\n                  </div>\n                  <Button variant=\"destructive\" disabled>\n                    √öjraind√≠t√°s\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"school-admins\" className=\"space-y-6\">\n            <Card>\n              <CardHeader className=\"flex flex-row items-center justify-between\">\n                <div>\n                  <CardTitle>Iskolai adminisztr√°torok kezel√©se</CardTitle>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Iskolai adminisztr√°torok l√©trehoz√°sa √©s kezel√©se\n                  </p>\n                </div>\n                <Dialog open={isSchoolAdminDialogOpen} onOpenChange={setIsSchoolAdminDialogOpen}>\n                  <DialogTrigger asChild>\n                    <Button>\n                      <Plus className=\"h-4 w-4 mr-2\" />\n                      √öj iskolai admin\n                    </Button>\n                  </DialogTrigger>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>√öj iskolai admin regisztr√°l√°sa</DialogTitle>\n                    </DialogHeader>\n                    <Form {...schoolAdminForm}>\n                      <form onSubmit={schoolAdminForm.handleSubmit(onSchoolAdminSubmit)} className=\"space-y-4\">\n                        <FormField\n                          control={schoolAdminForm.control}\n                          name=\"firstName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Keresztn√©v</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"pl. J√°nos\" {...field} />\n                              </FormControl>\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={schoolAdminForm.control}\n                          name=\"lastName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Vezet√©kn√©v</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"pl. Nagy\" {...field} />\n                              </FormControl>\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={schoolAdminForm.control}\n                          name=\"schoolName\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Iskola neve</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"pl. V√°ci Szakk√©pz√©si Centrum\" {...field} />\n                              </FormControl>\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={schoolAdminForm.control}\n                          name=\"username\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Felhaszn√°l√≥n√©v</FormLabel>\n                              <FormControl>\n                                <Input placeholder=\"Bejelentkez√©si felhaszn√°l√≥n√©v\" {...field} />\n                              </FormControl>\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={schoolAdminForm.control}\n                          name=\"password\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Jelsz√≥</FormLabel>\n                              <FormControl>\n                                <Input type=\"password\" placeholder=\"Minimum 6 karakter\" {...field} />\n                              </FormControl>\n                            </FormItem>\n                          )}\n                        />\n                        <FormField\n                          control={schoolAdminForm.control}\n                          name=\"email\"\n                          render={({ field }) => (\n                            <FormItem>\n                              <FormLabel>Email (opcion√°lis)</FormLabel>\n                              <FormControl>\n                                <Input type=\"email\" placeholder=\"pl. admin@iskola.hu\" {...field} />\n                              </FormControl>\n                            </FormItem>\n                          )}\n                        />\n                        <div className=\"flex justify-end space-x-2\">\n                          <Button \n                            type=\"button\" \n                            variant=\"outline\" \n                            onClick={() => setIsSchoolAdminDialogOpen(false)}\n                          >\n                            M√©gse\n                          </Button>\n                          <Button \n                            type=\"submit\" \n                            disabled={createSchoolAdminMutation.isPending}\n                          >\n                            {createSchoolAdminMutation.isPending ? \"L√©trehoz√°s...\" : \"L√©trehoz√°s\"}\n                          </Button>\n                        </div>\n                      </form>\n                    </Form>\n                  </DialogContent>\n                </Dialog>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"text-sm text-muted-foreground\">\n                    Az iskolai adminisztr√°torok k√ºl√∂n bejelentkez√©ssel rendelkeznek √©s kezelhetik a di√°k-tan√°r hozz√°rendel√©seket.\n                  </div>\n                  \n                  {users?.filter((u: User) => u.role === 'school_admin').length > 0 ? (\n                    <div className=\"space-y-2\">\n                      <h4 className=\"font-medium\">Regisztr√°lt iskolai adminok:</h4>\n                      {users?.filter((u: User) => u.role === 'school_admin').map((admin: User) => (\n                        <div key={admin.id} className=\"flex items-center justify-between p-3 border rounded-lg\">\n                          <div>\n                            <p className=\"font-medium\">\n                              {admin.firstName && admin.lastName \n                                ? `${admin.firstName} ${admin.lastName}` \n                                : admin.username}\n                            </p>\n                            <p className=\"text-sm text-muted-foreground\">\n                              Felhaszn√°l√≥n√©v: {admin.username}\n                              {admin.email && ` ‚Ä¢ ${admin.email}`}\n                            </p>\n                            {admin.schoolName && (\n                              <p className=\"text-sm text-blue-600 font-medium\">\n                                Iskola: {admin.schoolName}\n                              </p>\n                            )}\n                          </div>\n                          <div className=\"flex space-x-2\">\n                            <Button \n                              variant=\"outline\" \n                              size=\"sm\"\n                              onClick={() => {\n                                setResetPasswordUserId(admin.id);\n                                setIsPasswordResetDialogOpen(true);\n                              }}\n                            >\n                              <Key className=\"h-4 w-4 mr-1\" />\n                              Jelsz√≥ vissza√°ll√≠t√°s\n                            </Button>\n                            <Button \n                              variant=\"destructive\" \n                              size=\"sm\"\n                              onClick={() => deleteUserMutation.mutate(admin.id)}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      M√©g nincsenek regisztr√°lt iskolai adminisztr√°torok.\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n\n        {/* Module Dialog */}\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n            <DialogHeader>\n              <DialogTitle>\n                {editingModule ? \"Modul szerkeszt√©se\" : \"√öj modul l√©trehoz√°sa\"}\n              </DialogTitle>\n            </DialogHeader>\n            <Form {...form}>\n              <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"title\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>C√≠m</FormLabel>\n                      <FormControl>\n                        <Input placeholder=\"Modul c√≠me\" {...field} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"content-field\">Alapvet≈ë tartalom</Label>\n                  <Textarea \n                    id=\"content-field\"\n                    placeholder=\"Modul alapvet≈ë tartalma...\" \n                    rows={8}\n                    value={form.watch(\"content\") || \"\"}\n                    onChange={(e) => {\n                      form.setValue(\"content\", e.target.value);\n                      form.trigger(\"content\");\n                    }}\n                    className=\"min-h-[200px] resize-y\"\n                  />\n                  <p className=\"text-xs text-gray-500\">\n                    Karakter sz√°m: {(form.watch(\"content\") || \"\").length}\n                  </p>\n                </div>\n\n                {/* AI Enhanced Content Editing */}\n                {editingModule && (editingModule.conciseContent || editingModule.detailedContent) && (\n                  <div className=\"space-y-4 border-t pt-4\">\n                    <h4 className=\"font-medium text-sm text-purple-700\">AI-gener√°lt tartalom szerkeszt√©se</h4>\n                    \n                    {editingModule.conciseContent && (\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"concise-content-field\">T√∂m√∂r verzi√≥ (tanul√≥k √°ltal l√°tott)</Label>\n                        <Textarea \n                          id=\"concise-content-field\"\n                          placeholder=\"AI-gener√°lt t√∂m√∂r tartalom...\" \n                          rows={6}\n                          value={form.watch(\"conciseContent\") || editingModule.conciseContent || \"\"}\n                          onChange={(e) => {\n                            form.setValue(\"conciseContent\", e.target.value);\n                            form.trigger(\"conciseContent\");\n                          }}\n                          className=\"min-h-[150px] resize-y bg-purple-50\"\n                        />\n                        <p className=\"text-xs text-purple-600\">\n                          Karakter sz√°m: {(form.watch(\"conciseContent\") || editingModule.conciseContent || \"\").length}\n                        </p>\n                      </div>\n                    )}\n\n                    {editingModule.detailedContent && (\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"detailed-content-field\">R√©szletes verzi√≥ (tanul√≥k √°ltal l√°tott)</Label>\n                        <Textarea \n                          id=\"detailed-content-field\"\n                          placeholder=\"AI-gener√°lt r√©szletes tartalom...\" \n                          rows={8}\n                          value={form.watch(\"detailedContent\") || editingModule.detailedContent || \"\"}\n                          onChange={(e) => {\n                            form.setValue(\"detailedContent\", e.target.value);\n                            form.trigger(\"detailedContent\");\n                          }}\n                          className=\"min-h-[200px] resize-y bg-purple-50\"\n                        />\n                        <p className=\"text-xs text-purple-600\">\n                          Karakter sz√°m: {(form.watch(\"detailedContent\") || editingModule.detailedContent || \"\").length}\n                        </p>\n                      </div>\n                    )}\n\n                    <p className=\"text-xs text-gray-500 italic\">\n                      Ez a tartalom jelenik meg a tanul√≥k sz√°m√°ra. Az √∫jragener√°l√°s gombbal lehet AI-vel friss√≠teni.\n                    </p>\n                  </div>\n                )}\n\n                {/* YouTube √©s Wikipedia linkek szerkeszt√©se */}\n                {editingModule && editingModule.keyConceptsData && Array.isArray(editingModule.keyConceptsData) && (\n                  <LinkEditor \n                    keyConceptsData={editingModule.keyConceptsData as KeyConceptsData} \n                    onUpdate={(updatedData: KeyConceptsData) => {\n                      form.setValue(\"keyConceptsData\", updatedData);\n                      form.trigger(\"keyConceptsData\");\n                    }}\n                  />\n                )}\n                \n                {/* Multim√©di√°s tartalom */}\n                <div className=\"space-y-4 border-t pt-4\">\n                  <h4 className=\"font-medium text-sm text-gray-700\">Multim√©di√°s tartalom</h4>\n                  \n                  {/* YouTube URL */}\n                  <FormField\n                    control={form.control}\n                    name=\"youtubeUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>YouTube vide√≥ URL</FormLabel>\n                        <FormControl>\n                          <Input {...field} value={field.value || \"\"} placeholder=\"https://www.youtube.com/watch?v=...\" />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                  \n                  {/* Vide√≥ felt√∂lt√©s vagy URL */}\n                  <div className=\"space-y-3\">\n                    <h5 className=\"text-sm font-medium\">Vide√≥</h5>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"text-sm text-gray-600 mb-2 block\">F√°jl felt√∂lt√©se</label>\n                        <FileUpload\n                          acceptedTypes=\"video/*\"\n                          maxSize={100 * 1024 * 1024} // 100MB\n                          onFileUploaded={(file) => {\n                            const url = `/uploads/${file.filename}`;\n                            form.setValue('videoUrl', url);\n                            form.trigger('videoUrl'); // Trigger validation to show the value\n                          }}\n                        />\n                      </div>\n                      <FormField\n                        control={form.control}\n                        name=\"videoUrl\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Vagy vide√≥ URL</FormLabel>\n                            <FormControl>\n                              <Input {...field} value={field.value || \"\"} placeholder=\"https://example.com/video.mp4\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  {/* Hang felt√∂lt√©s vagy URL */}\n                  <div className=\"space-y-3\">\n                    <h5 className=\"text-sm font-medium\">Hang/Podcast</h5>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"text-sm text-gray-600 mb-2 block\">F√°jl felt√∂lt√©se</label>\n                        <FileUpload\n                          acceptedTypes=\"audio/*\"\n                          maxSize={50 * 1024 * 1024} // 50MB\n                          onFileUploaded={(file) => {\n                            const url = `/uploads/${file.filename}`;\n                            form.setValue('audioUrl', url);\n                            form.trigger('audioUrl');\n                          }}\n                        />\n                      </div>\n                      <FormField\n                        control={form.control}\n                        name=\"audioUrl\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Vagy hang URL</FormLabel>\n                            <FormControl>\n                              <Input {...field} value={field.value || \"\"} placeholder=\"https://example.com/audio.mp3\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  {/* K√©p felt√∂lt√©s vagy URL */}\n                  <div className=\"space-y-3\">\n                    <h5 className=\"text-sm font-medium\">K√©p</h5>\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                      <div>\n                        <label className=\"text-sm text-gray-600 mb-2 block\">F√°jl felt√∂lt√©se</label>\n                        <FileUpload\n                          acceptedTypes=\"image/*\"\n                          maxSize={20 * 1024 * 1024} // 20MB\n                          onFileUploaded={(file) => {\n                            const url = `/uploads/${file.filename}`;\n                            form.setValue('imageUrl', url);\n                            form.trigger('imageUrl');\n                          }}\n                        />\n                      </div>\n                      <FormField\n                        control={form.control}\n                        name=\"imageUrl\"\n                        render={({ field }) => (\n                          <FormItem>\n                            <FormLabel>Vagy k√©p URL</FormLabel>\n                            <FormControl>\n                              <Input {...field} value={field.value || \"\"} placeholder=\"https://example.com/image.jpg\" />\n                            </FormControl>\n                          </FormItem>\n                        )}\n                      />\n                    </div>\n                  </div>\n                  \n                  <FormField\n                    control={form.control}\n                    name=\"podcastUrl\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>K√ºls≈ë podcast URL</FormLabel>\n                        <FormControl>\n                          <Input {...field} value={field.value || \"\"} placeholder=\"https://podcasts.example.com/episode\" />\n                        </FormControl>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n                \n                <FormField\n                  control={form.control}\n                  name=\"moduleNumber\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Modul sz√°ma</FormLabel>\n                      <FormControl>\n                        <Input type=\"number\" min=\"1\" {...field} onChange={(e) => field.onChange(parseInt(e.target.value))} />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"subjectId\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel>Tant√°rgy</FormLabel>\n                      <Select value={field.value.toString()} onValueChange={(value) => field.onChange(parseInt(value))}>\n                        <FormControl>\n                          <SelectTrigger>\n                            <SelectValue placeholder=\"V√°lassz tant√°rgyat\" />\n                          </SelectTrigger>\n                        </FormControl>\n                        <SelectContent>\n                          {subjects.map((subject: Subject) => (\n                            <SelectItem key={subject.id} value={subject.id.toString()}>\n                              {subject.name}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </FormItem>\n                  )}\n                />\n                <div className=\"flex justify-end space-x-2\">\n                  <Button\n                    type=\"button\"\n                    variant=\"outline\"\n                    onClick={() => {\n                      setIsDialogOpen(false);\n                      setEditingModule(null);\n                      form.reset();\n                    }}\n                  >\n                    M√©gse\n                  </Button>\n                  <Button\n                    type=\"submit\"\n                    disabled={createModuleMutation.isPending || updateModuleMutation.isPending}\n                  >\n                    {editingModule ? \"Friss√≠t√©s\" : \"L√©trehoz√°s\"}\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </DialogContent>\n        </Dialog>\n\n        {/* Jelsz√≥ vissza√°ll√≠t√°si dialog */}\n        <PasswordResetDialog\n          isOpen={isPasswordResetDialogOpen}\n          onClose={() => setIsPasswordResetDialogOpen(false)}\n          onReset={(password) => {\n            resetPasswordMutation.mutate({ \n              userId: resetPasswordUserId, \n              newPassword: password \n            });\n          }}\n          isPending={resetPasswordMutation.isPending}\n        />\n      </main>\n    </div>\n  );\n}\n\n// Szakma hozz√°rendel√©s komponens\nfunction ProfessionAssignmentForm({ userId, currentProfessions }: { userId: string, currentProfessions: number[] }) {\n  const { toast } = useToast();\n  const [selectedProfessions, setSelectedProfessions] = useState<number[]>(currentProfessions);\n\n  const { data: professions = [] } = useQuery<Profession[]>({\n    queryKey: ['/api/public/professions'],\n  });\n\n  const updateProfessionsMutation = useMutation({\n    mutationFn: async ({ userId, professionIds }: { userId: string, professionIds: number[] }) => {\n      const res = await apiRequest(\"PUT\", `/api/users/${userId}/assigned-professions`, {\n        professionIds\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/users'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      toast({\n        title: \"Sikeres friss√≠t√©s\",\n        description: \"A szakma hozz√°rendel√©sek friss√≠tve lettek.\",\n      });\n    },\n    onError: (error: Error) => {\n      console.error('Profession assignment error:', error);\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt friss√≠teni a szakma hozz√°rendel√©seket.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleToggleProfession = (professionId: number) => {\n    setSelectedProfessions(prev => \n      prev.includes(professionId)\n        ? prev.filter(id => id !== professionId)\n        : [...prev, professionId]\n    );\n  };\n\n  const handleSave = () => {\n    updateProfessionsMutation.mutate({ userId, professionIds: selectedProfessions });\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <p className=\"text-sm text-muted-foreground\">\n        V√°lassza ki, melyik szakm√°khoz f√©rjen hozz√° ez a tanul√≥:\n      </p>\n      \n      <div className=\"space-y-2 max-h-60 overflow-y-auto\">\n        {professions.map((profession: Profession) => (\n          <label key={profession.id} className=\"flex items-center space-x-2 cursor-pointer p-2 rounded hover:bg-muted\">\n            <input\n              type=\"checkbox\"\n              checked={selectedProfessions.includes(profession.id)}\n              onChange={() => handleToggleProfession(profession.id)}\n              className=\"rounded border-gray-300\"\n            />\n            <span className=\"flex-1\">{profession.name}</span>\n            {profession.description && (\n              <span className=\"text-xs text-muted-foreground\">\n                {profession.description.substring(0, 50)}...\n              </span>\n            )}\n          </label>\n        ))}\n      </div>\n\n      <div className=\"flex justify-end space-x-2 pt-4 border-t\">\n        <Button\n          onClick={handleSave}\n          disabled={updateProfessionsMutation.isPending}\n          className=\"bg-primary hover:bg-primary/90\"\n        >\n          {updateProfessionsMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n        </Button>\n      </div>\n    </div>\n  );\n}\n\n// Jelsz√≥ vissza√°ll√≠t√°si dialog komponens\nfunction PasswordResetDialog({ \n  isOpen, \n  onClose, \n  onReset, \n  isPending \n}: { \n  isOpen: boolean; \n  onClose: () => void; \n  onReset: (password: string) => void; \n  isPending: boolean; \n}) {\n  const { toast } = useToast();\n  const [password, setPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (password.length < 6) {\n      toast({\n        title: \"Hiba\",\n        description: \"A jelsz√≥nak legal√°bb 6 karakter hossz√∫nak kell lennie.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (password !== confirmPassword) {\n      toast({\n        title: \"Hiba\",\n        description: \"A k√©t jelsz√≥ nem egyezik meg.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    onReset(password);\n  };\n\n  const handleClose = () => {\n    setPassword(\"\");\n    setConfirmPassword(\"\");\n    onClose();\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Jelsz√≥ vissza√°ll√≠t√°sa</DialogTitle>\n          <DialogDescription>\n            Adjon meg egy √∫j jelsz√≥t a felhaszn√°l√≥ sz√°m√°ra.\n          </DialogDescription>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"password\">√öj jelsz√≥ (min. 6 karakter)</Label>\n            <Input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              placeholder=\"Adja meg az √∫j jelsz√≥t\"\n              required\n              minLength={6}\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"confirmPassword\">Jelsz√≥ meger≈ës√≠t√©se</Label>\n            <Input\n              id=\"confirmPassword\"\n              type=\"password\"\n              value={confirmPassword}\n              onChange={(e) => setConfirmPassword(e.target.value)}\n              placeholder=\"Er≈ës√≠tse meg az √∫j jelsz√≥t\"\n              required\n              minLength={6}\n            />\n          </div>\n          <DialogFooter>\n            <Button type=\"button\" variant=\"outline\" onClick={handleClose}>\n              M√©gse\n            </Button>\n            <Button type=\"submit\" disabled={isPending}>\n              {isPending ? \"Vissza√°ll√≠t√°s...\" : \"Jelsz√≥ vissza√°ll√≠t√°sa\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":164978},"client/src/pages/admin-login.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { BookOpen, Shield } from \"lucide-react\";\n\nexport default function AdminLogin() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const loginMutation = useMutation({\n    mutationFn: async (credentials: { username: string; password: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/admin/login\", credentials);\n      return await res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      setLocation(\"/admin\");\n      toast({\n        title: \"Sikeres bejelentkez√©s\",\n        description: \"√údv√∂z√∂lj√ºk az admin fel√ºleten!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Bejelentkez√©si hiba\",\n        description: \"Hib√°s felhaszn√°l√≥n√©v vagy jelsz√≥.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (username && password) {\n      loginMutation.mutate({ username, password });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-primary/5 to-secondary/5 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center space-x-3 mb-4\">\n            <div className=\"w-12 h-12 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center\">\n              <BookOpen className=\"text-white\" size={24} />\n            </div>\n            <div>\n              <h1 className=\"text-2xl font-bold text-neutral-700\">Global Learning System</h1>\n              <p className=\"text-sm text-neutral-500\">Admin Bejelentkez√©s</p>\n            </div>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"flex items-center justify-center space-x-2\">\n              <Shield size={20} />\n              <span>Adminisztr√°tor Bejelentkez√©s</span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Felhaszn√°l√≥n√©v</Label>\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  value={username}\n                  onChange={(e) => setUsername(e.target.value)}\n                  placeholder=\"Adja meg a felhaszn√°l√≥nevet\"\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Jelsz√≥</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  placeholder=\"Adja meg a jelsz√≥t\"\n                  required\n                />\n              </div>\n              <Button \n                type=\"submit\" \n                className=\"w-full\"\n                disabled={loginMutation.isPending}\n              >\n                {loginMutation.isPending ? \"Bejelentkez√©s...\" : \"Bejelentkez√©s\"}\n              </Button>\n            </form>\n            \n            <div className=\"mt-6 text-center\">\n              <p className=\"text-sm text-neutral-600 mb-2\">Vagy</p>\n              <Button \n                variant=\"outline\" \n                onClick={() => setLocation(\"/\")}\n                className=\"w-full\"\n              >\n                Vissza a f≈ëoldalra\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":4238},"client/src/pages/community-learning.tsx":{"content":"import { useState, useCallback } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger, DialogFooter } from \"@/components/ui/dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { AlertDialog, AlertDialogAction, AlertDialogCancel, AlertDialogContent, AlertDialogDescription, AlertDialogFooter, AlertDialogHeader, AlertDialogTitle, AlertDialogTrigger } from \"@/components/ui/alert-dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Users, Plus, MessageCircle, BookOpen, Star, Calendar, User, ArrowLeft, Mail, Edit, Trash2, MoreVertical } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useLocation } from \"wouter\";\n\ninterface CommunityGroup {\n  id: number;\n  name: string;\n  description: string;\n  professionId: number | null;\n  createdBy: string;\n  isActive: boolean;\n  memberLimit: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface CommunityProject {\n  id: number;\n  title: string;\n  description: string;\n  groupId: number;\n  moduleId: number | null;\n  createdBy: string;\n  status: string;\n  dueDate: string | null;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface Discussion {\n  id: number;\n  title: string;\n  content: string;\n  authorId: string;\n  groupId: number | null;\n  projectId: number | null;\n  parentId: number | null;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface Profession {\n  id: number;\n  name: string;\n  description: string;\n}\n\nexport default function CommunityLearning() {\n  const [activeTab, setActiveTab] = useState(\"groups\");\n  const [selectedGroupId, setSelectedGroupId] = useState<number | null>(null);\n  const [selectedProjectId, setSelectedProjectId] = useState<number | null>(null);\n  const [showAdminMessage, setShowAdminMessage] = useState(false);\n  const [adminMessageData, setAdminMessageData] = useState({\n    subject: \"\",\n    message: \"\"\n  });\n\n  // Admin message mutation\n  const adminMessageMutation = useMutation({\n    mutationFn: async (data: { subject: string; message: string }) => {\n      const response = await fetch('/api/admin/messages', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n      if (!response.ok) {\n        throw new Error('Nem siker√ºlt elk√ºldeni az √ºzenetet');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"√úzenet elk√ºldve\",\n        description: \"Az √ºzenetedet sikeresen elk√ºldt√ºk az adminisztr√°tornak.\",\n      });\n      setShowAdminMessage(false);\n      setAdminMessageData({ subject: \"\", message: \"\" });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message || \"Nem siker√ºlt elk√ºldeni az √ºzenetet.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [, navigate] = useLocation();\n\n  // Fetch data\n  const { data: groups, isLoading: groupsLoading } = useQuery<CommunityGroup[]>({\n    queryKey: [\"/api/community-groups\"],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: projects, isLoading: projectsLoading } = useQuery<CommunityProject[]>({\n    queryKey: [\"/api/community-projects\", selectedGroupId],\n    staleTime: 5 * 60 * 1000,\n  });\n\n  const { data: discussions, isLoading: discussionsLoading } = useQuery<Discussion[]>({\n    queryKey: [\"/api/discussions\", selectedGroupId, selectedProjectId],\n    staleTime: 30 * 1000,\n  });\n\n  const { data: professions } = useQuery<Profession[]>({\n    queryKey: [\"/api/public/professions\"],\n    staleTime: 10 * 60 * 1000,\n  });\n\n  const { data: currentUser } = useQuery<{ id: string; username?: string }>({\n    queryKey: [\"/api/auth/user\"],\n    staleTime: 10 * 60 * 1000,\n  });\n\n  // Mutations\n  const createGroupMutation = useMutation({\n    mutationFn: async (groupData: { name: string; description: string; professionId?: number }) => {\n      const response = await apiRequest(\"POST\", \"/api/community-groups\", groupData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-groups\"] });\n      toast({ title: \"K√∂z√∂ss√©g sikeresen l√©trehozva!\" });\n    },\n    onError: () => {\n      toast({ title: \"Hiba\", description: \"Nem siker√ºlt l√©trehozni a k√∂z√∂ss√©get\", variant: \"destructive\" });\n    },\n  });\n\n  const joinGroupMutation = useMutation({\n    mutationFn: async (groupId: number) => {\n      const response = await apiRequest(\"POST\", `/api/community-groups/${groupId}/join`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-groups\"] });\n      toast({ title: \"Sikeresen csatlakozt√°l a k√∂z√∂ss√©ghez!\" });\n    },\n    onError: () => {\n      toast({ title: \"Hiba\", description: \"Nem siker√ºlt csatlakozni\", variant: \"destructive\" });\n    },\n  });\n\n  const createProjectMutation = useMutation({\n    mutationFn: async (projectData: { title: string; description: string; groupId: number; moduleId?: number }) => {\n      const response = await apiRequest(\"POST\", \"/api/community-projects\", projectData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-projects\"] });\n      toast({ title: \"Projekt sikeresen l√©trehozva!\" });\n    },\n    onError: () => {\n      toast({ title: \"Hiba\", description: \"Nem siker√ºlt l√©trehozni a projektet\", variant: \"destructive\" });\n    },\n  });\n\n  const createDiscussionMutation = useMutation({\n    mutationFn: async (discussionData: { title: string; content: string; groupId?: number; projectId?: number }) => {\n      const response = await apiRequest(\"POST\", \"/api/discussions\", discussionData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/discussions\"] });\n      toast({ title: \"Besz√©lget√©s elind√≠tva!\" });\n    },\n    onError: () => {\n      toast({ title: \"Hiba\", description: \"Nem siker√ºlt elind√≠tani a besz√©lget√©st\", variant: \"destructive\" });\n    },\n  });\n\n  const sendAdminMessageMutation = useMutation({\n    mutationFn: async (messageData: { subject: string; message: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/messages\", messageData);\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"√úzenet elk√ºldve!\", description: \"Az admin hamarosan v√°laszol.\" });\n      setShowAdminMessage(false);\n      setAdminMessageData({ subject: \"\", message: \"\" });\n    },\n    onError: () => {\n      toast({ title: \"Hiba\", description: \"Nem siker√ºlt elk√ºldeni az √ºzenetet\", variant: \"destructive\" });\n    },\n  });\n\n  const updateGroupMutation = useMutation({\n    mutationFn: async ({ id, groupData }: { id: number; groupData: { name: string; description: string; professionId?: number } }) => {\n      const response = await apiRequest(\"PUT\", `/api/community-groups/${id}`, groupData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-groups\"] });\n      toast({ title: \"Csoport sikeresen friss√≠tve!\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Hiba\", \n        description: error?.message || \"Nem siker√ºlt friss√≠teni a csoportot\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  const deleteGroupMutation = useMutation({\n    mutationFn: async (groupId: number) => {\n      const response = await apiRequest(\"DELETE\", `/api/community-groups/${groupId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community-groups\"] });\n      toast({ title: \"Csoport sikeresen t√∂r√∂lve!\" });\n      setSelectedGroupId(null);\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Hiba\", \n        description: error?.message || \"Nem siker√ºlt t√∂r√∂lni a csoportot\", \n        variant: \"destructive\" \n      });\n    },\n  });\n\n  // Component for creating new group\n  const CreateGroupDialog = () => {\n    const [open, setOpen] = useState(false);\n    const [formData, setFormData] = useState({\n      name: \"\",\n      description: \"\",\n      professionId: \"\",\n    });\n\n    const handleSubmit = (e: React.FormEvent) => {\n      e.preventDefault();\n      const data = {\n        name: formData.name,\n        description: formData.description,\n        professionId: formData.professionId ? parseInt(formData.professionId) : undefined,\n      };\n      createGroupMutation.mutate(data);\n      setOpen(false);\n      setFormData({ name: \"\", description: \"\", professionId: \"\" });\n    };\n\n    return (\n      <Dialog open={open} onOpenChange={setOpen}>\n        <DialogTrigger asChild>\n          <Button className=\"mb-4\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            √öj K√∂z√∂ss√©g\n          </Button>\n        </DialogTrigger>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>√öj K√∂z√∂ss√©g L√©trehoz√°sa</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"name\">N√©v</Label>\n              <Input\n                id=\"name\"\n                value={formData.name}\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"description\">Le√≠r√°s</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"profession\">Szakmacsoport (opcion√°lis)</Label>\n              <Select value={formData.professionId} onValueChange={(value) => setFormData({ ...formData, professionId: value })}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"V√°lassz szakmacsoportot\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {professions?.map((profession) => (\n                    <SelectItem key={profession.id} value={profession.id.toString()}>\n                      {profession.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={createGroupMutation.isPending}>\n              {createGroupMutation.isPending ? \"L√©trehoz√°s...\" : \"L√©trehoz√°s\"}\n            </Button>\n          </form>\n        </DialogContent>\n      </Dialog>\n    );\n  };\n\n  // Component for editing group - moved to a separate function\n  const EditGroupDialog = ({ group }: { group: CommunityGroup }) => {\n    return (\n      <Dialog>\n        <DialogTrigger asChild>\n          <DropdownMenuItem onSelect={(e) => e.preventDefault()}>\n            <Edit className=\"w-4 h-4 mr-2\" />\n            Szerkeszt√©s\n          </DropdownMenuItem>\n        </DialogTrigger>\n        <EditGroupDialogContent group={group} />\n      </Dialog>\n    );\n  };\n\n  const EditGroupDialogContent = ({ group }: { group: CommunityGroup }) => {\n    const [formData, setFormData] = useState({\n      name: group.name,\n      description: group.description,\n      professionId: group.professionId?.toString() || \"\",\n    });\n\n    const handleSubmit = (e: React.FormEvent) => {\n      e.preventDefault();\n      const data = {\n        name: formData.name,\n        description: formData.description,\n        professionId: formData.professionId ? parseInt(formData.professionId) : undefined,\n      };\n      updateGroupMutation.mutate({ id: group.id, groupData: data });\n    };\n\n    return (\n      <DialogContent>\n        <DialogHeader>\n          <DialogTitle>Csoport Szerkeszt√©se</DialogTitle>\n        </DialogHeader>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <Label htmlFor=\"edit-name\">N√©v</Label>\n            <Input\n              id=\"edit-name\"\n              value={formData.name}\n              onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n              required\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"edit-description\">Le√≠r√°s</Label>\n            <Textarea\n              id=\"edit-description\"\n              value={formData.description}\n              onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n            />\n          </div>\n          <div>\n            <Label htmlFor=\"edit-profession\">Szakmacsoport (opcion√°lis)</Label>\n            <Select value={formData.professionId} onValueChange={(value) => setFormData({ ...formData, professionId: value })}>\n              <SelectTrigger>\n                <SelectValue placeholder=\"V√°lassz szakmacsoportot\" />\n              </SelectTrigger>\n              <SelectContent>\n                {professions?.map((profession) => (\n                  <SelectItem key={profession.id} value={profession.id.toString()}>\n                    {profession.name}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n          <DialogFooter>\n            <Button type=\"submit\" disabled={updateGroupMutation.isPending}>\n              {updateGroupMutation.isPending ? \"Ment√©s...\" : \"Ment√©s\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    );\n  };\n\n  // Component for creating new project\n  const CreateProjectDialog = () => {\n    const [open, setOpen] = useState(false);\n    const [formData, setFormData] = useState({\n      title: \"\",\n      description: \"\",\n      groupId: \"\",\n    });\n\n    const handleSubmit = (e: React.FormEvent) => {\n      e.preventDefault();\n      if (!formData.groupId) return;\n      \n      const data = {\n        title: formData.title,\n        description: formData.description,\n        groupId: parseInt(formData.groupId),\n      };\n      createProjectMutation.mutate(data);\n      setOpen(false);\n      setFormData({ title: \"\", description: \"\", groupId: \"\" });\n    };\n\n    return (\n      <Dialog open={open} onOpenChange={setOpen}>\n        <DialogTrigger asChild>\n          <Button className=\"mb-4\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            √öj Projekt\n          </Button>\n        </DialogTrigger>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>√öj Projekt L√©trehoz√°sa</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"groupSelect\">K√∂z√∂ss√©g</Label>\n              <Select value={formData.groupId} onValueChange={(value) => setFormData({ ...formData, groupId: value })}>\n                <SelectTrigger>\n                  <SelectValue placeholder=\"V√°lassz k√∂z√∂ss√©get\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {groups?.map((group) => (\n                    <SelectItem key={group.id} value={group.id.toString()}>\n                      {group.name}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div>\n              <Label htmlFor=\"title\">Projekt C√≠me</Label>\n              <Input\n                id=\"title\"\n                value={formData.title}\n                onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"description\">Le√≠r√°s</Label>\n              <Textarea\n                id=\"description\"\n                value={formData.description}\n                onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n              />\n            </div>\n            <Button type=\"submit\" className=\"w-full\" disabled={createProjectMutation.isPending}>\n              {createProjectMutation.isPending ? \"L√©trehoz√°s...\" : \"L√©trehoz√°s\"}\n            </Button>\n          </form>\n        </DialogContent>\n      </Dialog>\n    );\n  };\n\n  // Admin message dialog component - simple version to prevent focus jumping\n  const AdminMessageDialog = () => {\n    const handleSubmit = (e: any) => {\n      e.preventDefault();\n      if (!adminMessageData.subject.trim() || !adminMessageData.message.trim()) {\n        toast({\n          title: \"Hiba\",\n          description: \"K√©rj√ºk t√∂ltsd ki az √∂sszes mez≈ët.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      sendAdminMessageMutation.mutate(adminMessageData);\n    };\n\n    return (\n      <Dialog open={showAdminMessage} onOpenChange={setShowAdminMessage}>\n        <DialogContent className=\"sm:max-w-[500px]\">\n          <DialogHeader>\n            <DialogTitle>√úzenet az Adminnak</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div>\n              <Label htmlFor=\"msg-subject\">T√°rgy</Label>\n              <Input\n                id=\"msg-subject\"\n                value={adminMessageData.subject}\n                onChange={(e) => setAdminMessageData(prev => ({ ...prev, subject: e.target.value }))}\n                placeholder=\"Miben seg√≠thet√ºnk?\"\n                required\n              />\n            </div>\n            <div>\n              <Label htmlFor=\"msg-content\">√úzenet</Label>\n              <Textarea\n                id=\"msg-content\"\n                value={adminMessageData.message}\n                onChange={(e) => setAdminMessageData(prev => ({ ...prev, message: e.target.value }))}\n                placeholder=\"√çrja le r√©szletesen az ig√©ny√©t vagy k√©rd√©s√©t...\"\n                rows={4}\n                required\n              />\n            </div>\n            <div className=\"flex gap-3 pt-2\">\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={() => {\n                  setShowAdminMessage(false);\n                  setAdminMessageData({ subject: \"\", message: \"\" });\n                }}\n                className=\"flex-1\"\n              >\n                M√©gse\n              </Button>\n              <Button \n                type=\"submit\" \n                disabled={sendAdminMessageMutation.isPending}\n                className=\"flex-1\"\n              >\n                {sendAdminMessageMutation.isPending ? \"K√ºld√©s...\" : \"K√ºld√©s\"}\n              </Button>\n            </div>\n          </form>\n        </DialogContent>\n      </Dialog>\n    );\n  };\n\n  return (\n    <div className=\"min-h-screen bg-student-warm\">\n      <div className=\"container mx-auto p-6 max-w-7xl\">\n        <div className=\"mb-8 flex items-center justify-between\">\n          <div className=\"flex items-center space-x-4\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => navigate('/home')}\n              className=\"text-white/90 hover:text-white hover:bg-white/10\"\n            >\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Vissza\n            </Button>\n            <div>\n              <h1 className=\"text-3xl font-bold mb-2 text-white drop-shadow-lg\">K√∂z√∂ss√©gi Tanul√°s</h1>\n              <p className=\"text-white/90 drop-shadow-md\">\n                Csatlakozz szakmai k√∂z√∂ss√©gekhez, dolgozz egy√ºtt projekteken √©s tanulj t√°rsaiddal.\n              </p>\n            </div>\n          </div>\n          <Button\n            variant=\"outline\"\n            onClick={() => setShowAdminMessage(true)}\n            className=\"bg-white/10 border-white/20 text-white hover:bg-white/20\"\n          >\n            <Mail className=\"w-4 h-4 mr-2\" />\n            √úzenet az Adminnak\n          </Button>\n        </div>\n\n        <AdminMessageDialog />\n\n      <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n        <TabsList className=\"grid w-full grid-cols-3\">\n          <TabsTrigger value=\"groups\" className=\"flex items-center gap-2\">\n            <Users className=\"w-4 h-4\" />\n            K√∂z√∂ss√©gek\n          </TabsTrigger>\n          <TabsTrigger value=\"projects\" className=\"flex items-center gap-2\">\n            <BookOpen className=\"w-4 h-4\" />\n            Projektek\n          </TabsTrigger>\n          <TabsTrigger value=\"discussions\" className=\"flex items-center gap-2\">\n            <MessageCircle className=\"w-4 h-4\" />\n            Besz√©lget√©sek\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"groups\" className=\"space-y-6\">\n          <div className=\"flex justify-between items-center\">\n            <h2 className=\"text-2xl font-semibold\">Szakmai K√∂z√∂ss√©gek</h2>\n            <CreateGroupDialog />\n          </div>\n          \n          {groupsLoading ? (\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardHeader>\n                    <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n                    <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-3 bg-gray-200 rounded\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded w-5/6\"></div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {groups?.map((group) => (\n                <Card key={group.id} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center justify-between\">\n                      <span>{group.name}</span>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant=\"secondary\">\n                          <Users className=\"w-3 h-3 mr-1\" />\n                          {group.memberLimit}\n                        </Badge>\n                        {currentUser && currentUser.id === group.createdBy && (\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <MoreVertical className=\"w-4 h-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <EditGroupDialog group={group} />\n                              <AlertDialog>\n                                <AlertDialogTrigger asChild>\n                                  <DropdownMenuItem onSelect={(e) => e.preventDefault()}>\n                                    <Trash2 className=\"w-4 h-4 mr-2\" />\n                                    T√∂rl√©s\n                                  </DropdownMenuItem>\n                                </AlertDialogTrigger>\n                                <AlertDialogContent>\n                                  <AlertDialogHeader>\n                                    <AlertDialogTitle>Biztos vagy benne?</AlertDialogTitle>\n                                    <AlertDialogDescription>\n                                      Ez a m≈±velet nem vonhat√≥ vissza. Ez v√©glegesen t√∂rli a csoportot √©s az √∂sszes kapcsol√≥d√≥ adatot.\n                                    </AlertDialogDescription>\n                                  </AlertDialogHeader>\n                                  <AlertDialogFooter>\n                                    <AlertDialogCancel>M√©gse</AlertDialogCancel>\n                                    <AlertDialogAction\n                                      onClick={() => deleteGroupMutation.mutate(group.id)}\n                                      className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n                                    >\n                                      T√∂rl√©s\n                                    </AlertDialogAction>\n                                  </AlertDialogFooter>\n                                </AlertDialogContent>\n                              </AlertDialog>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        )}\n                      </div>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <p className=\"text-sm text-muted-foreground\">\n                      {group.description || \"Nincs le√≠r√°s el√©rhet≈ë\"}\n                    </p>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-xs text-muted-foreground\">\n                        L√©trehozva: {new Date(group.createdAt).toLocaleDateString('hu-HU')}\n                      </span>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => {\n                          joinGroupMutation.mutate(group.id);\n                          setSelectedGroupId(group.id);\n                        }}\n                        disabled={joinGroupMutation.isPending}\n                      >\n                        Csatlakoz√°s\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"projects\" className=\"space-y-6\">\n          <div className=\"flex justify-between items-center\">\n            <h2 className=\"text-2xl font-semibold\">K√∂z√∂ss√©gi Projektek</h2>\n            <CreateProjectDialog />\n          </div>\n\n          {projectsLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardHeader>\n                    <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-3 bg-gray-200 rounded\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded w-5/6\"></div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {projects?.map((project) => (\n                <Card key={project.id} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center justify-between\">\n                      <span>{project.title}</span>\n                      <div className=\"flex items-center gap-2\">\n                        <Badge variant={project.status === 'active' ? 'default' : 'secondary'}>\n                          {project.status === 'active' ? 'Akt√≠v' : project.status}\n                        </Badge>\n                        {project.dueDate && (\n                          <Badge variant=\"outline\">\n                            <Calendar className=\"w-3 h-3 mr-1\" />\n                            {new Date(project.dueDate).toLocaleDateString('hu-HU')}\n                          </Badge>\n                        )}\n                      </div>\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <p className=\"text-sm text-muted-foreground\">\n                      {project.description || \"Nincs le√≠r√°s el√©rhet≈ë\"}\n                    </p>\n                    <div className=\"flex justify-between items-center\">\n                      <span className=\"text-xs text-muted-foreground\">\n                        L√©trehozva: {new Date(project.createdAt).toLocaleDateString('hu-HU')}\n                      </span>\n                      <Button\n                        size=\"sm\"\n                        onClick={() => setSelectedProjectId(project.id)}\n                      >\n                        Megtekint√©s\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n\n        <TabsContent value=\"discussions\" className=\"space-y-6\">\n          <div className=\"flex justify-between items-center\">\n            <h2 className=\"text-2xl font-semibold\">Besz√©lget√©sek</h2>\n            <Button onClick={() => {\n              const title = prompt(\"Besz√©lget√©s c√≠me:\");\n              const content = prompt(\"Kezd≈ë √ºzenet:\");\n              if (title && content) {\n                createDiscussionMutation.mutate({\n                  title,\n                  content,\n                  groupId: selectedGroupId || undefined,\n                  projectId: selectedProjectId || undefined,\n                });\n              }\n            }}>\n              <Plus className=\"w-4 h-4 mr-2\" />\n              √öj Besz√©lget√©s\n            </Button>\n          </div>\n\n          {discussionsLoading ? (\n            <div className=\"space-y-4\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardHeader>\n                    <div className=\"h-4 bg-gray-200 rounded w-3/4\"></div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"space-y-2\">\n                      <div className=\"h-3 bg-gray-200 rounded\"></div>\n                      <div className=\"h-3 bg-gray-200 rounded w-5/6\"></div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {discussions?.map((discussion) => (\n                <Card key={discussion.id} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <MessageCircle className=\"w-4 h-4\" />\n                      {discussion.title}\n                    </CardTitle>\n                  </CardHeader>\n                  <CardContent className=\"space-y-4\">\n                    <p className=\"text-sm\">{discussion.content}</p>\n                    <div className=\"flex justify-between items-center text-xs text-muted-foreground\">\n                      <div className=\"flex items-center gap-1\">\n                        <User className=\"w-3 h-3\" />\n                        {discussion.authorId}\n                      </div>\n                      <span>{new Date(discussion.createdAt).toLocaleDateString('hu-HU')}</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":31654},"client/src/pages/home.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport OnboardingWizard from \"@/components/onboarding-wizard\";\nimport PresentationSlideshow from \"@/components/presentation-slideshow\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { BookOpen, Menu, ArrowRight, Target, Users, Award, Clock, Brain, CheckCircle, HelpCircle } from \"lucide-react\";\n\nexport default function HomePage() {\n  const { user } = useAuth();\n  const [, navigate] = useLocation();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n  const [showOnboarding, setShowOnboarding] = useState(false);\n  const [hasSeenOnboarding, setHasSeenOnboarding] = useState(false);\n\n  // Check if user has seen onboarding\n  useEffect(() => {\n    const hasSeenKey = `onboarding_seen_${user?.id}`;\n    const hasSeen = localStorage.getItem(hasSeenKey) === 'true';\n    setHasSeenOnboarding(hasSeen);\n    \n    // Show onboarding for new users\n    if (!hasSeen && user) {\n      setTimeout(() => setShowOnboarding(true), 1000);\n    }\n  }, [user]);\n\n  const handleOnboardingComplete = () => {\n    if (user) {\n      localStorage.setItem(`onboarding_seen_${user.id}`, 'true');\n      setHasSeenOnboarding(true);\n    }\n    setShowOnboarding(false);\n    navigate('/tananyagok');\n  };\n\n  const showOnboardingManually = () => {\n    setShowOnboarding(true);\n  };\n\n  if (!user) return null;\n\n  const features = [\n    {\n      icon: Brain,\n      title: \"AI-t√°mogatott tanul√°s\",\n      description: \"Intelligens chatbot seg√≠t a k√©rd√©seidben √©s magyar√°zza el a neh√©z fogalmakat\"\n    },\n    {\n      icon: Target,\n      title: \"Szakmaspecifikus tartalom\",\n      description: \"Pontosan a szakm√°dhoz igaz√≠tott tananyagok √©s gyakorlati p√©ld√°k\"\n    },\n    {\n      icon: CheckCircle,\n      title: \"Halad√°s k√∂vet√©se\",\n      description: \"Nyomon k√∂vetheted a fejl≈ëd√©sedet √©s l√°thatod, mit tanult√°l m√°r meg\"\n    },\n    {\n      icon: Award,\n      title: \"Modul√°ris rendszer\",\n      description: \"Kis l√©p√©sekben haladva minden modult alaposan elsaj√°t√≠thatsz\"\n    }\n  ];\n\n  const steps = [\n    {\n      number: \"1\",\n      title: \"V√°laszd ki a szakm√°d\",\n      description: \"Ha m√©g nem tetted meg, v√°laszd ki a tanulni k√≠v√°nt szakm√°t\"\n    },\n    {\n      number: \"2\", \n      title: \"B√∂ng√©szd a tant√°rgyakat\",\n      description: \"A Tananyagok f√ºl√∂n tal√°lod a szakm√°dhoz tartoz√≥ tant√°rgyakat\"\n    },\n    {\n      number: \"3\",\n      title: \"Tanulj modulr√≥l modulra\",\n      description: \"Minden tant√°rgy modulokra van osztva, √≠gy fokozatosan haldhatsz\"\n    },\n    {\n      number: \"4\",\n      title: \"Haszn√°ld az AI seg√≠ts√©get\",\n      description: \"Ha elakadsz, k√©rdezz az AI chatbott√≥l vagy k√©rj magyar√°zatot\"\n    }\n  ];\n\n  return (\n    <div className=\"flex min-h-screen bg-student-warm\">\n      <div className=\"hidden lg:block lg:w-64 lg:flex-shrink-0\">\n        <div className=\"sticky top-0 h-screen overflow-y-auto\">\n          <Sidebar user={user} />\n        </div>\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user} \n      />\n      \n      <div className=\"flex-1 overflow-auto\">\n        <header className=\"bg-white shadow-sm border-b border-neutral-100\">\n          <div className=\"flex items-center justify-between px-6 py-4\">\n            <div className=\"flex items-center space-x-4 flex-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMobileNavOpen(true)}\n                className=\"lg:hidden flex-shrink-0\"\n              >\n                <Menu size={20} />\n              </Button>\n              <div className=\"flex-1 min-w-0\">\n                <h1 className=\"text-xl lg:text-2xl font-bold text-neutral-800 truncate\">\n                  √údv√∂z√∂lj√ºk, {user.firstName || 'Tanul√≥'}!\n                </h1>\n                <p className=\"text-sm lg:text-base text-neutral-600 truncate\">\n                  Fedezze fel a Global Learning System lehet≈ës√©geit\n                </p>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"p-6\">\n          {/* Hero Section */}\n          <div className=\"mb-12\">\n            <div className=\"bg-gradient-to-r from-primary to-blue-700 rounded-xl p-8 text-white mb-8\">\n              <div className=\"max-w-4xl\">\n                <h2 className=\"text-3xl font-bold mb-4\">\n                  Modern szakmai k√©pz√©s AI-t√°mogat√°ssal\n                </h2>\n                <p className=\"text-xl mb-6 opacity-90\">\n                  A Global Learning System egy innovat√≠v tanul√°si platform, amely \n                  szakmaspecifikus tartalmakat k√≠n√°l intelligens mesters√©ges intelligencia \n                  t√°mogat√°ssal. Tanuljon hat√©konyan, modul√°ris rendszerben!\n                </p>\n                <div className=\"flex flex-col sm:flex-row gap-4\">\n                  <Button \n                    onClick={() => navigate('/tananyagok')} \n                    size=\"lg\" \n                    variant=\"secondary\"\n                    className=\"bg-white text-primary hover:bg-neutral-100\"\n                  >\n                    <BookOpen className=\"mr-2\" size={20} />\n                    Kezdje a tanul√°st \n                    <ArrowRight className=\"ml-2\" size={20} />\n                  </Button>\n                  <Button \n                    onClick={showOnboardingManually}\n                    size=\"lg\" \n                    variant=\"outline\"\n                    className=\"bg-white/10 text-white border-white hover:bg-white/20\"\n                  >\n                    <HelpCircle className=\"mr-2\" size={20} />\n                    Interakt√≠v √∫tmutat√≥\n                  </Button>\n                </div>\n              </div>\n            </div>\n\n            {/* AI Platform Presentation */}\n            <div className=\"mb-8\">\n              <h3 className=\"text-2xl font-bold text-neutral-800 mb-4\">Platform Bemutat√≥</h3>\n              <PresentationSlideshow />\n            </div>\n          </div>\n\n          {/* Features */}\n          <div className=\"mb-12\">\n            <h3 className=\"text-2xl font-bold text-neutral-800 mb-6\">Mi√©rt v√°lassza a Global Learning System-et?</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {features.map((feature, index) => (\n                <Card key={index} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center mb-3\">\n                      <feature.icon className=\"text-white\" size={24} />\n                    </div>\n                    <CardTitle className=\"text-lg\">{feature.title}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-neutral-600 text-sm\">{feature.description}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          {/* How it works */}\n          <div className=\"mb-12\">\n            <h3 className=\"text-2xl font-bold text-neutral-800 mb-6\">Hogyan m≈±k√∂dik?</h3>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              {steps.map((step, index) => (\n                <Card key={index} className=\"relative\">\n                  <CardHeader>\n                    <div className=\"w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold mb-3\">\n                      {step.number}\n                    </div>\n                    <CardTitle className=\"text-lg\">{step.title}</CardTitle>\n                  </CardHeader>\n                  <CardContent>\n                    <p className=\"text-neutral-600 text-sm\">{step.description}</p>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n\n          {/* Call to Action */}\n          <Card className=\"bg-gradient-to-r from-neutral-50 to-neutral-100 border-neutral-200\">\n            <CardContent className=\"p-8 text-center\">\n              <BookOpen className=\"mx-auto h-12 w-12 text-primary mb-4\" />\n              <h3 className=\"text-2xl font-bold text-neutral-800 mb-4\">K√©szen √°ll a tanul√°sra?</h3>\n              <p className=\"text-neutral-600 mb-6 max-w-2xl mx-auto\">\n                Kezdje el felfedezni a szakm√°j√°hoz tartoz√≥ tananyagokat. A modul√°ris rendszer lehet≈ëv√© teszi, \n                hogy a saj√°t temp√≥j√°ban haladjon, √©s az AI asszisztens mindig seg√≠t, ha k√©rd√©se van.\n              </p>\n              <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                <Button \n                  onClick={() => navigate('/tananyagok')} \n                  size=\"lg\"\n                  className=\"bg-primary hover:bg-primary/90\"\n                >\n                  Tananyagok b√∂ng√©sz√©se <BookOpen className=\"ml-2\" size={20} />\n                </Button>\n                <Button \n                  onClick={() => navigate('/chat')} \n                  size=\"lg\" \n                  variant=\"outline\"\n                >\n                  AI seg√≠ts√©g k√©r√©se\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </main>\n      </div>\n\n      {/* Onboarding Wizard */}\n      <OnboardingWizard\n        isOpen={showOnboarding}\n        onClose={() => setShowOnboarding(false)}\n        onComplete={handleOnboardingComplete}\n        userName={user.firstName || user.username || 'Tanul√≥'}\n      />\n    </div>\n  );\n}","size_bytes":9864},"client/src/pages/landing-futuristic-fixed.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Brain, \n  Cpu, \n  Sparkles, \n  Zap,\n  ArrowRight,\n  Play,\n  Users,\n  Award,\n  TrendingUp,\n  Shield,\n  Globe,\n  Rocket,\n  Target\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport AnimatedAIBackground from \"@/components/animated-ai-background\";\nimport PresentationSlideshow from \"@/components/presentation-slideshow\";\nimport futuristicImage from \"@assets/image_1749219808494.png\";\n\nexport default function FuturisticLanding() {\n  const scrollToFeatures = () => {\n    const featuresSection = document.getElementById('features');\n    if (featuresSection) {\n      featuresSection.scrollIntoView({ behavior: 'smooth' });\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen overflow-hidden relative bg-optimized-gradient\">\n      {/* Instant dark background for immediate display */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 via-blue-900 to-purple-900 opacity-95\"></div>\n      \n      {/* Animated AI Background - Loads progressively */}\n      <AnimatedAIBackground />\n      \n      {/* Content overlay with optimized performance */}\n      <div className=\"relative z-10 min-h-screen bg-black/20 animate-slide-up\">\n        {/* Navigation */}\n        <nav className=\"relative z-50 flex items-center justify-between p-6 backdrop-blur-sm bg-white/5 border-b border-white/10\">\n          <div className=\"flex items-center space-x-2\">\n            <div className=\"w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-lg flex items-center justify-center\">\n              <Brain className=\"text-white\" size={16} />\n            </div>\n            <span className=\"text-xl font-bold text-white\">Global Learning System</span>\n          </div>\n          \n          <div className=\"flex space-x-4\">\n            <Link href=\"/student-auth\">\n              <Button variant=\"outline\" className=\"border-green-400/30 text-green-300 hover:bg-green-400/10 hover:border-green-400/50\">\n                Tanul√≥\n              </Button>\n            </Link>\n            <Link href=\"/teacher-auth\">\n              <Button variant=\"outline\" className=\"border-orange-400/30 text-orange-300 hover:bg-orange-400/10 hover:border-orange-400/50\">\n                Tan√°r\n              </Button>\n            </Link>\n            <Link href=\"/school-admin-auth\">\n              <Button variant=\"outline\" className=\"border-blue-400/30 text-blue-300 hover:bg-blue-400/10 hover:border-blue-400/50\">\n                Iskolai Admin\n              </Button>\n            </Link>\n            <Link href=\"/admin-login\">\n              <Button className=\"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white border-0\">\n                Rendszer Admin\n              </Button>\n            </Link>\n          </div>\n        </nav>\n\n        {/* Hero Section */}\n        <section className=\"relative flex flex-col items-center justify-center min-h-screen px-6 text-center\">\n          <div className=\"max-w-4xl mx-auto space-y-8\">\n            {/* Hero Badge */}\n            <Badge className=\"bg-gradient-to-r from-cyan-500/20 to-blue-600/20 text-cyan-300 border-cyan-500/30 text-sm px-4 py-2\">\n              <Sparkles className=\"w-4 h-4 mr-2\" />\n              AI-t√°mogatott oktat√°si platform\n            </Badge>\n\n            {/* Main Heading */}\n            <h1 className=\"text-5xl md:text-7xl font-extrabold text-white leading-tight\">\n              A J√∂v≈ë\n              <span className=\"bg-gradient-to-r from-cyan-400 to-blue-600 bg-clip-text text-transparent\">\n                {\" \"}Oktat√°sa{\" \"}\n              </span>\n              Itt Van\n            </h1>\n\n            {/* Subtitle */}\n            <p className=\"text-xl md:text-2xl text-gray-300 max-w-2xl mx-auto leading-relaxed\">\n              Fedezd fel a mesters√©ges intelligencia erej√©t a tanul√°sban. \n              Szem√©lyre szabott modulok, interakt√≠v AI asszisztens √©s professzion√°lis k√∂z√∂ss√©gek.\n            </p>\n\n            {/* CTA Buttons */}\n            <div className=\"flex flex-col sm:flex-row gap-4 justify-center items-center pt-8\">\n              <Button \n                size=\"lg\" \n                variant=\"outline\" \n                className=\"bg-gradient-to-r from-purple-600/40 to-violet-700/40 border-purple-400/60 text-white hover:from-purple-600/60 hover:to-violet-700/60 hover:border-purple-400/80 px-8 py-4 text-lg backdrop-blur-sm shadow-lg shadow-purple-500/20\"\n                onClick={scrollToFeatures}\n              >\n                Tudj meg t√∂bbet\n                <ArrowRight className=\"w-5 h-5 ml-2\" />\n              </Button>\n            </div>\n\n            {/* Stats */}\n            <div className=\"grid grid-cols-3 gap-8 pt-16 max-w-2xl mx-auto\">\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-cyan-400\">1000+</div>\n                <div className=\"text-gray-400\">Akt√≠v tanul√≥</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-blue-400\">50+</div>\n                <div className=\"text-gray-400\">Tanul√°si modul</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-3xl font-bold text-purple-400\">95%</div>\n                <div className=\"text-gray-400\">El√©gedetts√©g</div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Platform Presentation */}\n        <section className=\"relative z-20 py-24 px-6\">\n          <div className=\"max-w-6xl mx-auto text-center\">\n            <Badge variant=\"outline\" className=\"mb-6 border-cyan-400/50 text-cyan-400 bg-cyan-400/10\">\n              <Sparkles className=\"w-4 h-4 mr-2\" />\n              Platform Bemutat√≥\n            </Badge>\n            \n            <h2 className=\"text-4xl md:text-5xl font-bold text-white mb-6\">\n              Fedezze fel az \n              <span className=\"bg-gradient-to-r from-cyan-400 to-blue-600 bg-clip-text text-transparent\">\n                {\" \"}AI Platform{\" \"}\n              </span>\n              lehet≈ës√©geit\n            </h2>\n            \n            <p className=\"text-xl text-gray-300 mb-12 max-w-3xl mx-auto\">\n              Interakt√≠v bemutat√≥ a Global Learning System f≈ëbb funkci√≥ir√≥l √©s innovat√≠v megold√°sair√≥l\n            </p>\n            \n            <div className=\"max-w-5xl mx-auto\">\n              <PresentationSlideshow />\n            </div>\n          </div>\n        </section>\n\n        {/* Features Section */}\n        <section id=\"features\" className=\"py-20 px-6\">\n          <div className=\"max-w-6xl mx-auto\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-4xl md:text-5xl font-bold text-white mb-4\">\n                Mi√©rt v√°laszd a \n                <span className=\"bg-gradient-to-r from-cyan-400 to-blue-600 bg-clip-text text-transparent\">\n                  {\" \"}Global Learning{\" \"}\n                </span>\n                rendszert?\n              </h2>\n              <p className=\"text-xl text-gray-300 max-w-2xl mx-auto\">\n                Cutting-edge technol√≥gia tal√°lkozik a szem√©lyre szabott oktat√°ssal\n              </p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n              {/* Feature Cards */}\n              <Card className=\"bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-lg flex items-center justify-center mb-4\">\n                    <Brain className=\"text-white\" size={24} />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">AI Asszisztens</h3>\n                  <p className=\"text-gray-300\">\n                    Intelligens chatbot, amely 24/7 seg√≠t k√©rd√©seidben √©s magyar√°zza el a neh√©z fogalmakat.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center mb-4\">\n                    <Users className=\"text-white\" size={24} />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">K√∂z√∂ss√©gi Tanul√°s</h3>\n                  <p className=\"text-gray-300\">\n                    Csatlakozz szakmai k√∂z√∂ss√©gekhez, dolgozz projekteken √©s tanulj t√°rsaiddal.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center mb-4\">\n                    <Target className=\"text-white\" size={24} />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">Szem√©lyre Szabott</h3>\n                  <p className=\"text-gray-300\">\n                    Adapt√≠v tanul√°si √∫tvonalak, amelyek alkalmazkodnak az egy√©ni temp√≥dhoz √©s ig√©nyekhez.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-lg flex items-center justify-center mb-4\">\n                    <Award className=\"text-white\" size={24} />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">Progressz√≠v Rendszer</h3>\n                  <p className=\"text-gray-300\">\n                    Modul√°ris fel√©p√≠t√©s szakmai szintekkel √©s automatikus el≈ërehalad√°s k√∂vet√©ssel.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mb-4\">\n                    <TrendingUp className=\"text-white\" size={24} />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">Analitika</h3>\n                  <p className=\"text-gray-300\">\n                    R√©szletes teljes√≠tm√©ny k√∂vet√©s √©s fejl≈ëd√©si javaslatok AI alap√∫ elemz√©ssel.\n                  </p>\n                </CardContent>\n              </Card>\n\n              <Card className=\"bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300\">\n                <CardContent className=\"p-6\">\n                  <div className=\"w-12 h-12 bg-gradient-to-br from-violet-500 to-purple-600 rounded-lg flex items-center justify-center mb-4\">\n                    <Shield className=\"text-white\" size={24} />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-white mb-2\">Biztons√°gos</h3>\n                  <p className=\"text-gray-300\">\n                    Enterprise szint≈± biztons√°g √©s adatv√©delem minden felhaszn√°l√≥i interakci√≥n√°l.\n                  </p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </section>\n\n        {/* CTA Section */}\n        <section className=\"py-20 px-6\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <div className=\"bg-gradient-to-r from-cyan-500/10 to-blue-600/10 border border-cyan-500/20 rounded-2xl p-12 backdrop-blur-sm\">\n              <h2 className=\"text-3xl md:text-4xl font-bold text-white mb-4\">\n                K√©szen √°llsz a j√∂v≈ë oktat√°s√°ra?\n              </h2>\n              <p className=\"text-xl text-gray-300 mb-8\">\n                Csatlakozz t√∂bb ezer tanul√≥hoz, akik m√°r felfedezt√©k az AI-t√°mogatott tanul√°s erej√©t.\n              </p>\n              <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n                <Button size=\"lg\" variant=\"outline\" className=\"bg-gradient-to-r from-cyan-600/40 to-blue-700/40 border-cyan-400/60 text-white hover:from-cyan-600/60 hover:to-blue-700/60 hover:border-cyan-400/80 px-8 py-4 backdrop-blur-sm shadow-lg shadow-cyan-500/20\">\n                  <Globe className=\"w-5 h-5 mr-2\" />\n                  Tudj meg t√∂bbet\n                </Button>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        {/* Footer */}\n        <footer className=\"border-t border-white/10 py-12 px-6 backdrop-blur-sm bg-white/5\">\n          <div className=\"max-w-4xl mx-auto text-center\">\n            <div className=\"flex items-center justify-center space-x-2 mb-4\">\n              <div className=\"w-8 h-8 bg-gradient-to-br from-cyan-400 to-blue-600 rounded-lg flex items-center justify-center\">\n                <Brain className=\"text-white\" size={16} />\n              </div>\n              <span className=\"text-xl font-bold text-white\">Global Learning System</span>\n            </div>\n            <p className=\"text-gray-400\">\n              ¬© 2025 Global Learning System. Minden jog fenntartva. A j√∂v≈ë m√°r itt van.\n            </p>\n          </div>\n        </footer>\n      </div>\n    </div>\n  );\n}","size_bytes":13758},"client/src/pages/landing-futuristic.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Brain, \n  Cpu, \n  Sparkles, \n  Zap,\n  ArrowRight,\n  Play,\n  Users,\n  Award,\n  TrendingUp,\n  Shield,\n  Globe,\n  Rocket\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport AnimatedAIBackground from \"@/components/animated-ai-background\";\nimport AnimatedSection from \"@/components/animated-section\";\nimport { useParallax, useSmoothScroll } from \"@/hooks/useScrollAnimation\";\nimport futuristicImage from \"@assets/image_1749219808494.png\";\n\nexport default function FuturisticLanding() {\n  const { scrollToElement } = useSmoothScroll();\n  const { ref: parallaxRef, offset } = useParallax(0.3);\n\n  return (\n    <div className=\"min-h-screen overflow-hidden relative bg-optimized-gradient smooth-scroll\">\n      {/* Instant CSS background for immediate display */}\n      <div className=\"absolute inset-0 bg-gradient-to-br from-slate-900 via-blue-900 to-purple-900 opacity-95\"></div>\n      \n      {/* Animated AI Background with parallax effect */}\n      <div \n        ref={parallaxRef as any}\n        className=\"parallax-bg\"\n        style={{ transform: `translateY(${offset * 0.5}px)` }}\n      >\n        <AnimatedAIBackground />\n      </div>\n      \n      {/* Content overlay with optimized backdrop */}\n      <div className=\"relative z-10 min-h-screen bg-black/20\">\n        {/* Gradient overlays for depth */}\n        <div className=\"absolute bottom-0 left-0 right-0 h-96 bg-gradient-to-t from-purple-500/10 to-transparent\"></div>\n\n      {/* Navigation with animations */}\n      <nav className=\"relative z-50 flex items-center justify-between p-6 backdrop-blur-sm bg-white/5 border-b border-white/10 fade-in-up\">\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-lg flex items-center justify-center hover-glow\">\n            <Brain className=\"h-5 w-5 text-white\" />\n          </div>\n          <span className=\"text-xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent\">\n            Global Learning System\n          </span>\n        </div>\n        <div className=\"flex items-center space-x-4\">\n          <Link href=\"/student-auth\">\n            <Button variant=\"ghost\" className=\"text-white hover:bg-white/10 hover-lift touch-friendly\">\n              Bejelentkez√©s\n            </Button>\n          </Link>\n          <Link href=\"/student-auth\">\n            <Button className=\"bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 text-white border-0 hover-lift touch-friendly\">\n              Kezd√©s\n            </Button>\n          </Link>\n        </div>\n      </nav>\n\n      {/* Hero Section */}\n      <section className=\"relative z-10 container mx-auto px-6 py-20\">\n        <div className=\"grid lg:grid-cols-2 gap-12 items-center\">\n          {/* Left Content */}\n          <AnimatedSection animation=\"fade-left\" delay={200}>\n            <div className=\"space-y-8\">\n              <div className=\"space-y-4\">\n                <Badge className=\"bg-gradient-to-r from-cyan-500/20 to-purple-500/20 text-cyan-300 border-cyan-500/30 hover-glow\">\n                  <Sparkles className=\"h-3 w-3 mr-1\" />\n                  AI-vez√©relt tanul√°s\n                </Badge>\n                <h1 className=\"responsive-heading text-5xl lg:text-6xl font-bold leading-tight\">\n                  <span className=\"text-white\">A j√∂v≈ë</span>\n                  <br />\n                  <span className=\"bg-gradient-to-r from-cyan-400 via-purple-400 to-pink-400 bg-clip-text text-transparent\">\n                    oktat√°si\n                  </span>\n                  <br />\n                  <span className=\"text-white\">platformja</span>\n                </h1>\n                <p className=\"responsive-text text-xl text-slate-300 leading-relaxed max-w-lg\">\n                  Fedezd fel a szakmai k√©pz√©s √∫j dimenzi√≥j√°t mesters√©ges intelligencia seg√≠ts√©g√©vel. \n                  Szem√©lyre szabott tanul√°si √∫tvonalak, interakt√≠v AI mentor√°l√°s √©s val√≥s idej≈± fejl≈ëd√©sk√∂vet√©s.\n                </p>\n              </div>\n\n              <AnimatedSection animation=\"fade-up\" delay={400}>\n                <div className=\"flex flex-col sm:flex-row gap-4\">\n                  <Link href=\"/student-auth\">\n                    <Button size=\"lg\" className=\"bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 text-white border-0 px-8 py-4 text-lg hover-lift touch-friendly\">\n                      <Play className=\"h-5 w-5 mr-2\" />\n                      Kezd√©s most\n                      <ArrowRight className=\"h-5 w-5 ml-2\" />\n                    </Button>\n                  </Link>\n                  <Button \n                    size=\"lg\" \n                    variant=\"outline\" \n                    className=\"border-white/20 text-white hover:bg-white/10 px-8 py-4 text-lg hover-lift touch-friendly\"\n                    onClick={() => scrollToElement('features-section')}\n                  >\n                    <Globe className=\"h-5 w-5 mr-2\" />\n                    Tudj meg t√∂bbet\n                  </Button>\n                </div>\n              </AnimatedSection>\n            </div>\n          {/* Right Content - Image */}\n          <AnimatedSection animation=\"fade-right\" delay={300}>\n            <div className=\"relative\">\n              <img \n                src={futuristicImage} \n                alt=\"AI Technology\" \n                className=\"w-full h-auto rounded-2xl shadow-2xl hover-lift\"\n                loading=\"lazy\"\n              />\n              \n              {/* Floating UI Elements */}\n              <div className=\"absolute -top-4 -left-4 backdrop-blur-sm bg-white/10 rounded-lg p-4 border border-white/20\">\n                <div className=\"flex items-center space-x-2\">\n                  <Cpu className=\"h-5 w-5 text-cyan-400\" />\n                  <span className=\"text-sm text-white font-medium\">AI Mentor</span>\n                </div>\n              </div>\n              \n              <div className=\"absolute -bottom-4 -right-4 backdrop-blur-sm bg-white/10 rounded-lg p-4 border border-white/20\">\n                <div className=\"flex items-center space-x-2\">\n                  <TrendingUp className=\"h-5 w-5 text-purple-400\" />\n                  <span className=\"text-sm text-white font-medium\">Val√≥s idej≈± elemz√©s</span>\n                </div>\n              </div>\n            </div>\n          </AnimatedSection>\n        </div>\n\n        {/* Stats */}\n        <AnimatedSection animation=\"fade-up\" delay={600}>\n          <div className=\"grid grid-cols-3 gap-6 pt-8\">\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-cyan-400\">1000+</div>\n                <div className=\"text-sm text-slate-400\">Akt√≠v tanul√≥</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-purple-400\">50+</div>\n                <div className=\"text-sm text-slate-400\">Szakma</div>\n              </div>\n              <div className=\"text-center\">\n                <div className=\"text-2xl font-bold text-pink-400\">98%</div>\n                <div className=\"text-sm text-slate-400\">Sikeress√©gi ar√°ny</div>\n              </div>\n            </div>\n          </div>\n\n          {/* Right Image */}\n          <div className=\"relative\">\n            <div className=\"relative overflow-hidden rounded-2xl border border-white/20 backdrop-blur-sm bg-white/5\">\n              <img \n                src={futuristicImage} \n                alt=\"Futurisztikus oktat√°si k√∂rnyezet AI technol√≥gi√°val\"\n                className=\"w-full h-auto object-cover\"\n              />\n              <div className=\"absolute inset-0 bg-gradient-to-t from-cyan-500/20 to-transparent\"></div>\n            </div>\n            \n            {/* Floating cards */}\n            <div className=\"absolute -top-4 -left-4 backdrop-blur-sm bg-white/10 rounded-lg p-4 border border-white/20\">\n              <div className=\"flex items-center space-x-2\">\n                <Cpu className=\"h-5 w-5 text-cyan-400\" />\n                <span className=\"text-sm text-white font-medium\">AI Mentor</span>\n              </div>\n            </div>\n            \n            <div className=\"absolute -bottom-4 -right-4 backdrop-blur-sm bg-white/10 rounded-lg p-4 border border-white/20\">\n              <div className=\"flex items-center space-x-2\">\n                <TrendingUp className=\"h-5 w-5 text-purple-400\" />\n                <span className=\"text-sm text-white font-medium\">Val√≥s idej≈± elemz√©s</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section id=\"features-section\" className=\"relative z-10 container mx-auto px-6 py-20\">\n        <div className=\"text-center mb-16\">\n          <h2 className=\"text-4xl font-bold text-white mb-4\">\n            Mi√©rt v√°laszd a <span className=\"bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent\">j√∂v≈ët?</span>\n          </h2>\n          <p className=\"text-xl text-slate-300 max-w-3xl mx-auto\">\n            Tapasztald meg a k√∂vetkez≈ë gener√°ci√≥s tanul√°si √©lm√©nyt, ahol a technol√≥gia √©s a pedag√≥gia t√∂k√©letesen √∂tv√∂z≈ëdik\n          </p>\n        </div>\n\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8\">\n          {[\n            {\n              icon: Brain,\n              title: \"AI-vez√©relt szem√©lyre szab√°s\",\n              description: \"A mesters√©ges intelligencia folyamatosan elemzi a tanul√°si st√≠lusodat √©s szem√©lyre szabja a tartalmat\",\n              gradient: \"from-cyan-500 to-blue-500\"\n            },\n            {\n              icon: Zap,\n              title: \"Val√≥s idej≈± visszajelz√©s\",\n              description: \"Azonnali √©rt√©kel√©s √©s javaslatok minden l√©p√©sn√©l, hogy maximaliz√°ld a tanul√°si hat√©konys√°got\",\n              gradient: \"from-purple-500 to-pink-500\"\n            },\n            {\n              icon: Users,\n              title: \"K√∂z√∂ss√©gi tanul√°s\",\n              description: \"Csatlakozz szakmai k√∂z√∂ss√©gekhez √©s tanulj t√°rsaiddal egy√ºtt interakt√≠v projekteken\",\n              gradient: \"from-emerald-500 to-teal-500\"\n            },\n            {\n              icon: Award,\n              title: \"Ipar√°g √°ltal elismert tan√∫s√≠tv√°nyok\",\n              description: \"Szerezz √©rt√©kes k√©pes√≠t√©seket, amelyeket az ipar√°g vezet≈ë v√°llalatai ismernek el\",\n              gradient: \"from-orange-500 to-red-500\"\n            },\n            {\n              icon: Shield,\n              title: \"Biztons√°gos √©s megb√≠zhat√≥\",\n              description: \"V√°llalati szint≈± biztons√°g √©s adatv√©delem garant√°lja a tanul√°si √©lm√©nyed v√©delm√©t\",\n              gradient: \"from-indigo-500 to-purple-500\"\n            },\n            {\n              icon: Rocket,\n              title: \"Karrierfejleszt√©s\",\n              description: \"Szem√©lyes karriertan√°csad√°s √©s √°ll√°saj√°nlatok seg√≠ts√©g√©vel √©p√≠tsd fel az √°lmaid karrierj√©t\",\n              gradient: \"from-pink-500 to-rose-500\"\n            }\n          ].map((feature, index) => (\n            <Card key={index} className=\"group bg-white/5 border-white/10 backdrop-blur-sm hover:bg-white/10 transition-all duration-300 hover:scale-105\">\n              <CardContent className=\"p-6 space-y-4\">\n                <div className={`w-12 h-12 rounded-lg bg-gradient-to-r ${feature.gradient} flex items-center justify-center group-hover:scale-110 transition-transform duration-300`}>\n                  <feature.icon className=\"h-6 w-6 text-white\" />\n                </div>\n                <h3 className=\"text-xl font-semibold text-white\">{feature.title}</h3>\n                <p className=\"text-slate-300 leading-relaxed\">{feature.description}</p>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"relative z-10 container mx-auto px-6 py-20\">\n        <div className=\"text-center space-y-8\">\n          <h2 className=\"text-4xl lg:text-5xl font-bold text-white\">\n            K√©szen √°llsz a <span className=\"bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent\">j√∂v≈ëre?</span>\n          </h2>\n          <p className=\"text-xl text-slate-300 max-w-2xl mx-auto\">\n            Csatlakozz m√°r ma a thousands tanul√≥hoz, akik m√°r felfedezt√©k a szem√©lyre szabott AI-tanul√°s erej√©t\n          </p>\n          <div className=\"flex flex-col sm:flex-row gap-4 justify-center\">\n            <Link href=\"/student-auth\">\n              <Button size=\"lg\" className=\"bg-gradient-to-r from-cyan-500 to-purple-500 hover:from-cyan-600 hover:to-purple-600 text-white border-0 px-12 py-4 text-lg\">\n                <Sparkles className=\"h-5 w-5 mr-2\" />\n                Kezdd el ingyen\n                <ArrowRight className=\"h-5 w-5 ml-2\" />\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"relative z-10 border-t border-white/10 backdrop-blur-sm bg-white/5\">\n        <div className=\"container mx-auto px-6 py-12\">\n          <div className=\"text-center space-y-4\">\n            <div className=\"flex items-center justify-center space-x-2\">\n              <div className=\"w-8 h-8 bg-gradient-to-r from-cyan-400 to-purple-400 rounded-lg flex items-center justify-center\">\n                <Brain className=\"h-5 w-5 text-white\" />\n              </div>\n              <span className=\"text-xl font-bold bg-gradient-to-r from-cyan-400 to-purple-400 bg-clip-text text-transparent\">\n                Global Learning System\n              </span>\n            </div>\n            <p className=\"text-slate-400\">\n              ¬© 2025 Global Learning System. Minden jog fenntartva. A j√∂v≈ë m√°r itt van.\n            </p>\n          </div>\n        </div>\n      </footer>\n      </div>\n    </div>\n  );\n}","size_bytes":14053},"client/src/pages/landing.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport PresentationSlideshow from \"@/components/presentation-slideshow\";\nimport { BookOpen, Bot, Users, TrendingUp } from \"lucide-react\";\n\nexport default function Landing() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-primary/5 to-secondary/5\">\n      {/* Header */}\n      <header className=\"bg-white/80 backdrop-blur-sm border-b border-neutral-200 sticky top-0 z-50\">\n        <div className=\"container mx-auto px-4 py-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center space-x-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center\">\n                <BookOpen className=\"text-white\" size={20} />\n              </div>\n              <div>\n                <h1 className=\"text-xl font-bold text-neutral-700\">Global Learning System</h1>\n                <p className=\"text-sm text-neutral-500\">AI Oktat√°si Platform</p>\n              </div>\n            </div>\n            <div className=\"flex space-x-3\">\n              <Button \n                onClick={() => window.location.href = '/student-auth'}\n                className=\"bg-primary hover:bg-blue-700\"\n              >\n                Bejelentkez√©s\n              </Button>\n              <Button \n                variant=\"outline\"\n                onClick={() => window.location.href = '/admin-login'}\n                className=\"border-primary text-primary hover:bg-primary hover:text-white\"\n              >\n                Admin\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <section className=\"container mx-auto px-4 py-16 text-center\">\n        <div className=\"max-w-4xl mx-auto\">\n          <h2 className=\"text-4xl lg:text-6xl font-bold text-neutral-800 mb-6\">\n            Tanulj az AI\n            <span className=\"bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent\">\n              {\" \"}seg√≠ts√©g√©vel\n            </span>\n          </h2>\n          <p className=\"text-xl text-neutral-600 mb-8 max-w-2xl mx-auto\">\n            A Global Learning System egy interakt√≠v online oktat√°si platform, mely AI-alap√∫ oktat√°st biztos√≠t. \n            Modulok felaj√°nl√°s√°val, halad√°sk√∂vet√©ssel √©s intelligens chatbot tan√°rral seg√≠tj√ºk a tanul√°st.\n          </p>\n          <Button \n            size=\"lg\"\n            onClick={() => window.location.href = '/student-auth'}\n            className=\"bg-primary hover:bg-blue-700 text-lg px-8 py-3\"\n          >\n            Kezdj el tanulni\n          </Button>\n        </div>\n      </section>\n\n      {/* Platform Presentation */}\n      <section className=\"container mx-auto px-4 py-16\">\n        <div className=\"text-center mb-12\">\n          <h3 className=\"text-3xl font-bold text-neutral-800 mb-4\">\n            Platform Bemutat√≥\n          </h3>\n          <p className=\"text-lg text-neutral-600 max-w-2xl mx-auto\">\n            Fedezze fel az AI Szakk√©pz√©si Platform f≈ëbb funkci√≥it √©s lehet≈ës√©geit.\n          </p>\n        </div>\n        <div className=\"max-w-4xl mx-auto\">\n          <PresentationSlideshow />\n        </div>\n      </section>\n\n      {/* Features Section */}\n      <section className=\"container mx-auto px-4 py-16\">\n        <div className=\"text-center mb-12\">\n          <h3 className=\"text-3xl font-bold text-neutral-800 mb-4\">\n            Mi√©rt v√°laszd a Global Learning System-et?\n          </h3>\n          <p className=\"text-lg text-neutral-600 max-w-2xl mx-auto\">\n            Modern technol√≥gi√°k √©s AI-alap√∫ megold√°sok a leghat√©konyabb tanul√°si √©lm√©ny√©rt.\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          <Card className=\"text-center\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <BookOpen className=\"text-primary\" size={24} />\n              </div>\n              <CardTitle>Struktur√°lt Modulok</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <CardDescription>\n                Gondosan √∂ssze√°ll√≠tott tananyagok, amelyek l√©p√©sr≈ël l√©p√©sre vezetik a tanul√°st.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-accent/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Bot className=\"text-accent\" size={24} />\n              </div>\n              <CardTitle>AI Tan√°r</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <CardDescription>\n                Intelligens chatbot, aki v√°laszol a k√©rd√©seidre √©s tesztk√©rd√©seket gener√°l.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <TrendingUp className=\"text-secondary\" size={24} />\n              </div>\n              <CardTitle>Halad√°sk√∂vet√©s</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <CardDescription>\n                R√©szletes statisztik√°k a tanul√°si folyamatr√≥l √©s az el√©rt eredm√©nyekr≈ël.\n              </CardDescription>\n            </CardContent>\n          </Card>\n\n          <Card className=\"text-center\">\n            <CardHeader>\n              <div className=\"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Users className=\"text-purple-600\" size={24} />\n              </div>\n              <CardTitle>K√∂z√∂ss√©g</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <CardDescription>\n                Csatlakozz a tanul√≥k k√∂z√∂ss√©g√©hez √©s osszd meg a tapasztalataidat.\n              </CardDescription>\n            </CardContent>\n          </Card>\n        </div>\n      </section>\n\n      {/* CTA Section */}\n      <section className=\"bg-gradient-to-r from-primary to-secondary py-16\">\n        <div className=\"container mx-auto px-4 text-center text-white\">\n          <h3 className=\"text-3xl font-bold mb-4\">\n            K√©szen √°llsz a tanul√°sra?\n          </h3>\n          <p className=\"text-lg mb-8 opacity-90\">\n            Regisztr√°lj most √©s kezdj el felfedezni az interakt√≠v tanul√°s vil√°g√°t!\n          </p>\n          <Button \n            size=\"lg\"\n            variant=\"secondary\"\n            onClick={() => window.location.href = '/student-auth'}\n            className=\"bg-white text-primary hover:bg-neutral-100 text-lg px-8 py-3\"\n          >\n            Ingyenes regisztr√°ci√≥\n          </Button>\n        </div>\n      </section>\n\n      {/* Footer */}\n      <footer className=\"bg-neutral-800 text-white py-8\">\n        <div className=\"container mx-auto px-4 text-center\">\n          <div className=\"flex items-center justify-center space-x-3 mb-4\">\n            <div className=\"w-8 h-8 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center\">\n              <BookOpen className=\"text-white\" size={16} />\n            </div>\n            <span className=\"text-lg font-semibold\">Global Learning System</span>\n          </div>\n          <p className=\"text-neutral-400\">\n            ¬© 2024 Global Learning System. Minden jog fenntartva.\n          </p>\n        </div>\n      </footer>\n    </div>\n  );\n}\n","size_bytes":7703},"client/src/pages/learning.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from \"@/components/ui/accordion\";\nimport { Loader2, BookOpen, PlayCircle, CheckCircle, Clock, ArrowRight } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\n\nexport default function Learning() {\n  const { user } = useAuth();\n  const [, setLocation] = useLocation();\n  const [selectedSubject, setSelectedSubject] = useState<number | null>(null);\n\n  // Ha nincs kiv√°lasztott szakma, √°tir√°ny√≠t√°s a szakma kiv√°laszt√°shoz\n  if (!user?.selectedProfessionId) {\n    setLocation(\"/profession-selection\");\n    return null;\n  }\n\n  const { data: subjects, isLoading: subjectsLoading } = useQuery<any[]>({\n    queryKey: [\"/api/public/subjects\", { professionId: user?.selectedProfessionId }],\n    queryFn: () => fetch(`/api/public/subjects?professionId=${user?.selectedProfessionId}`).then(res => res.json()),\n    enabled: !!user?.selectedProfessionId,\n  });\n\n  const { data: modules, isLoading: modulesLoading } = useQuery<any[]>({\n    queryKey: [\"/api/public/modules\", { subjectId: selectedSubject }],\n    queryFn: () => selectedSubject ? fetch(`/api/public/modules?subjectId=${selectedSubject}`).then(res => res.json()) : Promise.resolve([]),\n    enabled: !!selectedSubject,\n  });\n\n  const { data: profession } = useQuery<any>({\n    queryKey: [\"/api/public/professions\", user?.selectedProfessionId],\n    queryFn: () => fetch(`/api/public/professions`).then(res => res.json()).then(profs => profs.find((p: any) => p.id === user?.selectedProfessionId)),\n    enabled: !!user?.selectedProfessionId,\n  });\n\n  if (subjectsLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  const completedModules = user?.completedModules || [];\n\n  const isModuleCompleted = (moduleId: number) => {\n    return completedModules.includes(moduleId);\n  };\n\n  const getSubjectProgress = (subjectId: number) => {\n    const subjectModules = modules?.filter((m: any) => m.subjectId === subjectId) || [];\n    if (subjectModules.length === 0) return 0;\n    const completed = subjectModules.filter((m: any) => isModuleCompleted(m.id)).length;\n    return Math.round((completed / subjectModules.length) * 100);\n  };\n\n  return (\n    <div className=\"min-h-screen bg-student-warm dark:bg-gray-900\">\n      <div className=\"container mx-auto px-4 py-8\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n                {profession?.name || 'Tanul√°s'}\n              </h1>\n              <p className=\"text-gray-600 dark:text-gray-300\">\n                {profession?.description || 'V√°laszd ki a tant√°rgyakat √©s kezdj el tanulni'}\n              </p>\n            </div>\n            <div className=\"flex gap-2\">\n              <Link href=\"/chat\">\n                <Button variant=\"outline\">AI Asszisztens</Button>\n              </Link>\n              <Link href=\"/progress\">\n                <Button variant=\"outline\">Halad√°s</Button>\n              </Link>\n            </div>\n          </div>\n        </div>\n\n        <Tabs value={selectedSubject?.toString() || \"overview\"} onValueChange={(value) => {\n          if (value === \"overview\") {\n            setSelectedSubject(null);\n          } else {\n            setSelectedSubject(parseInt(value));\n          }\n        }}>\n          <TabsList className=\"grid w-full grid-cols-auto mb-6\">\n            <TabsTrigger value=\"overview\">√Åttekint√©s</TabsTrigger>\n            {subjects?.map((subject: any) => (\n              <TabsTrigger key={subject.id} value={subject.id.toString()}>\n                {subject.name}\n              </TabsTrigger>\n            ))}\n          </TabsList>\n\n          {/* Overview Tab */}\n          <TabsContent value=\"overview\">\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {subjects?.map((subject: any) => (\n                <Card key={subject.id} className=\"hover:shadow-lg transition-shadow\">\n                  <CardHeader>\n                    <CardTitle className=\"flex items-center gap-2\">\n                      <BookOpen className=\"h-5 w-5 text-blue-600\" />\n                      {subject.name}\n                    </CardTitle>\n                    <CardDescription>{subject.description}</CardDescription>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"flex justify-between items-center mb-4\">\n                      <Badge variant=\"secondary\">\n                        {modules?.filter((m: any) => m.subjectId === subject.id).length || 0} modul\n                      </Badge>\n                      <Badge variant={getSubjectProgress(subject.id) === 100 ? \"default\" : \"outline\"}>\n                        {getSubjectProgress(subject.id)}% k√©sz\n                      </Badge>\n                    </div>\n                    \n                    <Button \n                      onClick={() => setSelectedSubject(subject.id)}\n                      className=\"w-full\"\n                      variant={getSubjectProgress(subject.id) > 0 ? \"default\" : \"outline\"}\n                    >\n                      {getSubjectProgress(subject.id) > 0 ? 'Folytat√°s' : 'Kezd√©s'}\n                      <ArrowRight className=\"h-4 w-4 ml-2\" />\n                    </Button>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </TabsContent>\n\n          {/* Subject Tabs */}\n          {subjects?.map((subject: any) => (\n            <TabsContent key={subject.id} value={subject.id.toString()}>\n              <div className=\"mb-6\">\n                <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n                  {subject.name}\n                </h2>\n                <p className=\"text-gray-600 dark:text-gray-300 mb-4\">\n                  {subject.description}\n                </p>\n                <div className=\"flex gap-4 text-sm text-gray-500\">\n                  <span>\n                    {modules?.filter((m: any) => m.subjectId === subject.id).length || 0} modul\n                  </span>\n                  <span>\n                    {getSubjectProgress(subject.id)}% befejezve\n                  </span>\n                </div>\n              </div>\n\n              {modulesLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin\" />\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                  {modules?.filter((module: any) => module.subjectId === subject.id).map((module: any) => (\n                    <Card key={module.id} className=\"hover:shadow-lg transition-shadow\">\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          {isModuleCompleted(module.id) ? (\n                            <CheckCircle className=\"h-5 w-5 text-green-600\" />\n                          ) : (\n                            <PlayCircle className=\"h-5 w-5 text-blue-600\" />\n                          )}\n                          {module.title}\n                          <Badge variant=\"outline\" className=\"ml-auto\">\n                            {module.moduleNumber}. modul\n                          </Badge>\n                        </CardTitle>\n                      </CardHeader>\n                      <CardContent>\n                        <p className=\"text-sm text-gray-600 dark:text-gray-300 mb-4 line-clamp-3\">\n                          {module.content\n                            .replace(/<[^>]*>/g, '') // Remove HTML tags\n                            .replace(/\\[([^\\]]+)\\]\\([^)]+\\)/g, '$1') // Remove markdown links [text](url) -> text\n                            .replace(/https?:\\/\\/[^\\s]+/g, '') // Remove standalone URLs\n                            .replace(/\\s+/g, ' ') // Normalize whitespace\n                            .trim()\n                          }\n                        </p>\n                        \n                        <div className=\"flex justify-between items-center\">\n                          <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                            <Clock className=\"h-4 w-4\" />\n                            <span>El√©rhet≈ë</span>\n                          </div>\n                          \n                          <Link href={`/module/${module.id}`}>\n                            <Button \n                              variant={isModuleCompleted(module.id) ? \"outline\" : \"default\"}\n                              size=\"sm\"\n                            >\n                              {isModuleCompleted(module.id) ? '√Åttekint√©s' : 'Kezd√©s'}\n                            </Button>\n                          </Link>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  ))}\n                </div>\n              )}\n            </TabsContent>\n          ))}\n        </Tabs>\n      </div>\n    </div>\n  );\n}","size_bytes":9604},"client/src/pages/mermaid-test.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\n\nexport default function MermaidTest() {\n  const [mermaidCode, setMermaidCode] = useState(`flowchart TD\n    A[Kezd√©s] --> B[Feldolgoz√°s]\n    B --> C[D√∂nt√©s]\n    C -->|Igen| D[M≈±velet 1]\n    C -->|Nem| E[M≈±velet 2]\n    D --> F[Befejez√©s]\n    E --> F`);\n  \n  const [svgUrl, setSvgUrl] = useState<string>('');\n  const [loading, setLoading] = useState(false);\n\n  const generateSVG = async () => {\n    setLoading(true);\n    try {\n      const response = await fetch('/api/mermaid/svg', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ mermaidCode }),\n      });\n\n      if (response.ok) {\n        const svgText = await response.text();\n        const blob = new Blob([svgText], { type: 'image/svg+xml' });\n        const url = URL.createObjectURL(blob);\n        setSvgUrl(url);\n      } else {\n        console.error('Failed to generate SVG');\n      }\n    } catch (error) {\n      console.error('Error generating SVG:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const downloadSVG = () => {\n    if (svgUrl) {\n      const link = document.createElement('a');\n      link.href = svgUrl;\n      link.download = 'mermaid-diagram.svg';\n      link.click();\n    }\n  };\n\n  return (\n    <div className=\"container mx-auto py-8 space-y-6\">\n      <div className=\"text-center\">\n        <h1 className=\"text-3xl font-bold\">Mermaid Diagram Teszt</h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Mermaid k√≥db√≥l SVG k√©pek gener√°l√°sa\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Mermaid K√≥d</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Textarea\n              value={mermaidCode}\n              onChange={(e) => setMermaidCode(e.target.value)}\n              placeholder=\"√çrd be a Mermaid diagram k√≥dot...\"\n              rows={10}\n              className=\"font-mono text-sm\"\n            />\n            <Button \n              onClick={generateSVG} \n              disabled={loading || !mermaidCode.trim()}\n              className=\"w-full\"\n            >\n              {loading ? 'Gener√°l√°s...' : 'SVG Gener√°l√°s'}\n            </Button>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Gener√°lt SVG</CardTitle>\n          </CardHeader>\n          <CardContent>\n            {svgUrl ? (\n              <div className=\"space-y-4\">\n                <div className=\"border rounded-lg p-4 bg-white\">\n                  <img \n                    src={svgUrl} \n                    alt=\"Generated Mermaid Diagram\" \n                    className=\"w-full h-auto max-h-96 object-contain\"\n                  />\n                </div>\n                <Button onClick={downloadSVG} variant=\"outline\" className=\"w-full\">\n                  SVG Let√∂lt√©se\n                </Button>\n              </div>\n            ) : (\n              <div className=\"border rounded-lg p-8 text-center text-muted-foreground\">\n                Gener√°lj egy SVG-t a bal oldali k√≥db√≥l\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>P√©lda Mermaid K√≥dok</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setMermaidCode(`flowchart TD\n    A[Kezd√©s] --> B[Feldolgoz√°s]\n    B --> C[D√∂nt√©s]\n    C -->|Igen| D[M≈±velet 1]\n    C -->|Nem| E[M≈±velet 2]\n    D --> F[Befejez√©s]\n    E --> F`)}\n            >\n              Folyamat√°bra\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              onClick={() => setMermaidCode(`graph LR\n    A[Felhaszn√°l√≥] --> B[Bejelentkez√©s]\n    B --> C[Dashboard]\n    C --> D[Modulok]\n    D --> E[Tanul√°s]`)}\n            >\n              Rendszerdiagram\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              onClick={() => setMermaidCode(`sequenceDiagram\n    participant U as Felhaszn√°l√≥\n    participant S as Szerver\n    participant DB as Adatb√°zis\n    \n    U->>S: Bejelentkez√©s\n    S->>DB: Felhaszn√°l√≥ ellen≈ërz√©s\n    DB-->>S: Eredm√©ny\n    S-->>U: V√°lasz`)}\n            >\n              Szekvencia diagram\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              onClick={() => setMermaidCode(`classDiagram\n    class User {\n        +String name\n        +String email\n        +login()\n        +logout()\n    }\n    \n    class Module {\n        +String title\n        +String content\n        +complete()\n    }\n    \n    User --> Module : tanul`)}\n            >\n              Oszt√°lydiagram\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":5185},"client/src/pages/module-viewer-new.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport ChatInterface from \"@/components/chat-interface\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, CheckCircle, Menu, Play, MessageCircle, FileText, Volume2, Image as ImageIcon, Pause, Brain, Youtube, Headphones, X, Wand2 } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport type { Module } from \"@shared/schema\";\nimport QuizInterface from \"@/components/quiz-interface\";\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport mermaid from 'mermaid';\n\nexport default function ModuleViewer() {\n  const params = useParams();\n  const [, setLocation] = useLocation();\n  const { user, isAuthenticated, isLoading } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n  const [isChatOpen, setIsChatOpen] = useState(false);\n  const [showQuiz, setShowQuiz] = useState(false);\n  const [isPlaying, setIsPlaying] = useState(false);\n  const [currentAudio, setCurrentAudio] = useState<HTMLAudioElement | null>(null);\n  const [showImageModal, setShowImageModal] = useState(false);\n  const [showVideoModal, setShowVideoModal] = useState(false);\n  const [showYoutubeModal, setShowYoutubeModal] = useState(false);\n  const [showAudioModal, setShowAudioModal] = useState(false);\n  const [showPodcastModal, setShowPodcastModal] = useState(false);\n  const [showPodcastPlayer, setShowPodcastPlayer] = useState(false);\n  const [selectedVideoUrl, setSelectedVideoUrl] = useState<string>('');\n  const [contentVersion, setContentVersion] = useState<'concise' | 'detailed'>('concise');\n  const [isRegenerating, setIsRegenerating] = useState(false);\n  const [showWikipediaModal, setShowWikipediaModal] = useState(false);\n  const [wikipediaContent, setWikipediaContent] = useState<{title: string, content: string, url: string} | null>(null);\n  const [isLoadingWikipedia, setIsLoadingWikipedia] = useState(false);\n  const mermaidRef = useRef<HTMLDivElement>(null);\n\n  // Initialize mermaid\n  useEffect(() => {\n    mermaid.initialize({\n      startOnLoad: true,\n      theme: 'default',\n      securityLevel: 'loose',\n    });\n  }, []);\n\n  // Universal DOM change observer for Mermaid re-rendering\n  useEffect(() => {\n    const renderMermaidDiagrams = async () => {\n      const mermaidElements = document.querySelectorAll('code.language-mermaid, .mermaid');\n      if (mermaidElements.length > 0) {\n        console.log(`DOM changed: Re-rendering ${mermaidElements.length} Mermaid diagrams`);\n        \n        // Convert code blocks to mermaid divs if needed\n        mermaidElements.forEach((element, index) => {\n          if (element.tagName === 'CODE' && element.textContent) {\n            const mermaidDiv = document.createElement('div');\n            mermaidDiv.className = 'mermaid';\n            mermaidDiv.textContent = element.textContent;\n            mermaidDiv.id = `mermaid-diagram-dom-${index}`;\n            element.parentNode?.insertBefore(mermaidDiv, element);\n            if (element instanceof HTMLElement) {\n              element.style.display = 'none';\n            }\n          }\n        });\n        \n        // Re-run mermaid\n        setTimeout(async () => {\n          const mermaidDivs = document.querySelectorAll('.mermaid');\n          if (mermaidDivs.length > 0) {\n            try {\n              await mermaid.run({\n                querySelector: '.mermaid'\n              });\n              console.log('DOM changed: Mermaid diagrams re-rendered successfully');\n            } catch (error) {\n              console.warn('DOM changed: mermaid.run() failed, trying mermaid.init():', error);\n              await mermaid.init(undefined, mermaidDivs as any);\n              console.log('DOM changed: Mermaid diagrams re-rendered with mermaid.init()');\n            }\n          }\n        }, 100);\n      }\n    };\n\n    // Create MutationObserver to watch for DOM changes\n    let lastRenderTime = 0;\n    const observer = new MutationObserver((mutations) => {\n      let shouldRerender = false;\n      \n      mutations.forEach((mutation) => {\n        // Only trigger on significant content changes\n        if (mutation.type === 'childList') {\n          // Check if added nodes contain mermaid content\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n              const element = node as Element;\n              if (element.classList?.contains('prose') || \n                  element.querySelector?.('code.language-mermaid, .mermaid') ||\n                  element.textContent?.includes('mermaid')) {\n                shouldRerender = true;\n              }\n            }\n          });\n        }\n      });\n      \n      if (shouldRerender) {\n        const now = Date.now();\n        // Prevent excessive rendering (max once per 1000ms)\n        if (now - lastRenderTime > 1000) {\n          lastRenderTime = now;\n          setTimeout(() => {\n            renderMermaidDiagrams();\n          }, 300);\n        }\n      }\n    });\n\n    // Start observing the document body for changes\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: ['class']\n    });\n\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  const moduleId = parseInt(params.id as string);\n\n  console.log('ModuleViewer params:', params);\n  console.log('ModuleViewer moduleId:', moduleId);\n\n  // Redirect to home if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: module, isLoading: moduleLoading } = useQuery<Module>({\n    queryKey: [`/api/modules/${moduleId}`],\n    retry: false,\n  });\n\n  // Get all modules to check for next module\n  const { data: allModules = [] } = useQuery<Module[]>({\n    queryKey: ['/api/public/modules', module?.subjectId],\n    queryFn: async () => {\n      if (!module?.subjectId) return [];\n      const response = await fetch(`/api/public/modules?subjectId=${module.subjectId}`);\n      if (!response.ok) throw new Error('Failed to fetch modules');\n      return response.json();\n    },\n    enabled: !!module?.subjectId,\n    retry: false,\n  });\n\n  // Mermaid rendering for SPA environment\n  useEffect(() => {\n    const renderMermaidDiagrams = async () => {\n      try {\n        // Initialize mermaid if not already done\n        mermaid.initialize({ \n          startOnLoad: false, // We'll handle rendering manually\n          theme: 'default',\n          securityLevel: 'loose',\n        });\n        \n        // Find all possible mermaid selectors\n        const possibleSelectors = [\n          '.language-mermaid',\n          'code[class*=\"language-mermaid\"]',\n          'pre code.language-mermaid',\n          '.mermaid',\n          'code.mermaid'\n        ];\n        \n        let mermaidElements: Element[] = [];\n        \n        for (const selector of possibleSelectors) {\n          const elements = document.querySelectorAll(selector);\n          mermaidElements = mermaidElements.concat(Array.from(elements));\n        }\n        \n        // Remove duplicates\n        mermaidElements = Array.from(new Set(mermaidElements));\n        \n        console.log(`Found ${mermaidElements.length} potential Mermaid diagrams`);\n        console.log('Mermaid elements:', mermaidElements);\n        \n        if (mermaidElements.length > 0) {\n          // Convert code blocks to mermaid divs if needed\n          mermaidElements.forEach((element, index) => {\n            if (element.tagName === 'CODE' && element.textContent) {\n              const mermaidDiv = document.createElement('div');\n              mermaidDiv.className = 'mermaid';\n              mermaidDiv.textContent = element.textContent;\n              mermaidDiv.id = `mermaid-diagram-${index}`;\n              element.parentNode?.insertBefore(mermaidDiv, element);\n              if (element instanceof HTMLElement) {\n                element.style.display = 'none'; // Hide original code block\n              }\n            }\n          });\n          \n          // Now run mermaid on the converted elements\n          const mermaidDivs = document.querySelectorAll('.mermaid');\n          console.log(`Processing ${mermaidDivs.length} Mermaid divs`);\n          \n          if (mermaidDivs.length > 0) {\n            try {\n              await mermaid.run({\n                querySelector: '.mermaid'\n              });\n              console.log('Mermaid diagrams rendered successfully with mermaid.run()');\n            } catch (runError) {\n              console.warn('mermaid.run() failed, trying mermaid.init():', runError);\n              await mermaid.init(undefined, mermaidDivs as any);\n              console.log('Mermaid diagrams rendered successfully with mermaid.init()');\n            }\n          }\n        } else {\n          console.log('No Mermaid diagrams found in DOM');\n        }\n      } catch (error) {\n        console.warn('Mermaid rendering failed:', error);\n      }\n    };\n    \n    // Wait for DOM to be updated with content\n    const timer = setTimeout(renderMermaidDiagrams, 500);\n    return () => clearTimeout(timer);\n  }, [module?.content, contentVersion]);\n\n  const completeModuleMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest('POST', `/api/modules/${moduleId}/complete`);\n    },\n    onSuccess: async () => {\n      // Clear all cache and force fresh data fetch\n      queryClient.clear();\n      \n      // Force immediate refresh of user data to get updated completed_modules\n      await queryClient.refetchQueries({ queryKey: ['/api/auth/user'] });\n      \n      toast({\n        title: \"Modul befejezve!\",\n        description: \"Sikeresen teljes√≠tetted ezt a modult.\",\n        duration: 3000,\n      });\n\n      // Find the next module\n      if (module && allModules.length > 0) {\n        const sortedModules = allModules\n          .filter(m => m.subjectId === module.subjectId)\n          .sort((a, b) => a.moduleNumber - b.moduleNumber);\n        \n        const currentIndex = sortedModules.findIndex(m => m.id === module.id);\n        if (currentIndex !== -1 && currentIndex < sortedModules.length - 1) {\n          const nextModule = sortedModules[currentIndex + 1];\n          setTimeout(() => {\n            setLocation(`/modules/${nextModule.id}`);\n          }, 1000);\n        } else {\n          setTimeout(() => {\n            setLocation(`/subjects/${module.subjectId}`);\n          }, 1000);\n        }\n      }\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      \n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt befejezni a modult. Pr√≥b√°ld √∫jra!\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const regenerateModuleMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/modules/${moduleId}/ai-regenerate`, {\n        title: module?.title,\n        content: module?.content,\n      });\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/modules/${moduleId}`] });\n      toast({\n        title: \"AI regener√°l√°s sikeres!\",\n        description: \"A modul friss√≠tve lett AI-val b≈ëv√≠tett tartalommal.\",\n      });\n      setIsRegenerating(false);\n    },\n    onError: (error) => {\n      console.error('AI regeneration error:', error);\n      toast({\n        title: \"Hiba az AI regener√°l√°s sor√°n\",\n        description: \"Nem siker√ºlt regener√°lni a modult.\",\n        variant: \"destructive\",\n      });\n      setIsRegenerating(false);\n    },\n  });\n\n  const handleRegenerateModule = () => {\n    setIsRegenerating(true);\n    regenerateModuleMutation.mutate();\n  };\n\n  const handleBackToSubject = () => {\n    if (module?.subjectId) {\n      setLocation(`/subjects/${module.subjectId}`);\n    } else {\n      setLocation('/');\n    }\n  };\n\n  const playAudio = async (text: string) => {\n    try {\n      if (currentAudio) {\n        currentAudio.pause();\n        setCurrentAudio(null);\n        setIsPlaying(false);\n      }\n\n      const response = await fetch('/api/tts', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ \n          text: text.slice(0, 1000), // Limit text length\n          voice: 'Bella'\n        }),\n      });\n\n      if (!response.ok) throw new Error('TTS failed');\n\n      const audioBlob = await response.blob();\n      const audioUrl = URL.createObjectURL(audioBlob);\n      const audio = new Audio(audioUrl);\n      \n      audio.onended = () => {\n        setIsPlaying(false);\n        setCurrentAudio(null);\n        URL.revokeObjectURL(audioUrl);\n      };\n\n      setCurrentAudio(audio);\n      setIsPlaying(true);\n      await audio.play();\n    } catch (error) {\n      console.error('Audio playback error:', error);\n      toast({\n        title: \"Hang lej√°tsz√°si hiba\",\n        description: \"Nem siker√ºlt lej√°tszani a hangot.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const stopAudio = () => {\n    if (currentAudio) {\n      currentAudio.pause();\n      setCurrentAudio(null);\n      setIsPlaying(false);\n    }\n  };\n\n  if (isLoading || moduleLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4\"></div>\n            <p className=\"text-gray-600 dark:text-gray-300\">Modul bet√∂lt√©se...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!module) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800\">\n        <div className=\"flex items-center justify-center min-h-screen\">\n          <div className=\"text-center\">\n            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-4\">Modul nem tal√°lhat√≥</h1>\n            <Button onClick={() => setLocation('/')}>Vissza a f≈ëoldalra</Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const isCompleted = user?.completedModules?.includes(module.id) || false;\n\n  // Determine which content to show\n  const hasEnhancedContent = module.conciseContent || module.detailedContent;\n  let displayContent = '';\n  \n  if (hasEnhancedContent) {\n    if (contentVersion === 'concise' && module.conciseContent) {\n      displayContent = module.conciseContent;\n    } else if (contentVersion === 'detailed' && module.detailedContent) {\n      displayContent = module.detailedContent;\n    } else {\n      // Fallback to available content\n      displayContent = module.detailedContent || module.conciseContent || module.content;\n    }\n  } else {\n    displayContent = module.content;\n  }\n\n  return (\n    <>\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 dark:from-gray-900 dark:to-gray-800 lg:grid lg:grid-cols-[256px_1fr]\">\n        <div className=\"hidden lg:block\">\n          <Sidebar user={user!} />\n        </div>\n        \n        <div className=\"min-h-screen overflow-auto\">\n          <MobileNav user={user!} isOpen={isMobileNavOpen} onClose={() => setIsMobileNavOpen(false)} />\n          \n          <div className=\"sticky top-0 z-40 bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700\">\n            <div className=\"flex items-center justify-between p-4\">\n              <div className=\"flex items-center gap-4\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  className=\"lg:hidden\"\n                  onClick={() => setIsMobileNavOpen(true)}\n                >\n                  <Menu className=\"h-6 w-6\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  onClick={handleBackToSubject}\n                  className=\"flex items-center gap-2\"\n                >\n                  <ArrowLeft className=\"h-4 w-4\" />\n                  Vissza a tananyaghoz\n                </Button>\n              </div>\n              \n              <div className=\"flex items-center gap-2\">\n                {module.imageUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowImageModal(true)}\n                  >\n                    <ImageIcon className=\"h-4 w-4 mr-2\" />\n                    K√©p\n                  </Button>\n                )}\n                \n                {module.youtubeUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowYoutubeModal(true)}\n                  >\n                    <Youtube className=\"h-4 w-4 mr-2\" />\n                    YouTube\n                  </Button>\n                )}\n                \n                {module.videoUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowVideoModal(true)}\n                  >\n                    <Play className=\"h-4 w-4 mr-2\" />\n                    Vide√≥\n                  </Button>\n                )}\n                \n                {module.audioUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowAudioModal(true)}\n                  >\n                    <Headphones className=\"h-4 w-4 mr-2\" />\n                    Hang\n                  </Button>\n                )}\n\n                {module.podcastUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowPodcastModal(true)}\n                    className=\"hidden sm:flex\"\n                  >\n                    <Volume2 className=\"h-4 w-4 mr-2\" />\n                    {module.podcastUrl.includes('spotify') ? 'Spotify' : \n                     module.podcastUrl.includes('youtube') ? 'YouTube' : 'Podcast'}\n                  </Button>\n                )}\n                \n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setIsChatOpen(true)}\n                >\n                  <MessageCircle className=\"h-4 w-4 mr-2\" />\n                  Szabolcs AI\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"p-6 max-w-4xl mx-auto\">\n            <div className=\"mb-6\">\n              <Card>\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-4\">\n                      <Badge variant=\"secondary\">\n                        Modul {module.moduleNumber}\n                      </Badge>\n                      {isCompleted && (\n                        <Badge variant=\"default\" className=\"bg-green-100 text-green-800 border-green-200\">\n                          <CheckCircle className=\"h-3 w-3 mr-1\" />\n                          Befejezve\n                        </Badge>\n                      )}\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      {hasEnhancedContent && (\n                        <div className=\"flex rounded-lg border border-gray-200 dark:border-gray-700 p-1\">\n                          <Button\n                            variant={contentVersion === 'concise' ? 'default' : 'ghost'}\n                            size=\"sm\"\n                            onClick={() => setContentVersion('concise')}\n                            className=\"text-xs\"\n                          >\n                            T√∂m√∂r\n                          </Button>\n                          <Button\n                            variant={contentVersion === 'detailed' ? 'default' : 'ghost'}\n                            size=\"sm\"\n                            onClick={() => setContentVersion('detailed')}\n                            className=\"text-xs\"\n                          >\n                            R√©szletes\n                          </Button>\n                        </div>\n                      )}\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={handleRegenerateModule}\n                        disabled={isRegenerating}\n                        className=\"flex items-center gap-2\"\n                      >\n                        <Wand2 className=\"h-4 w-4\" />\n                        {isRegenerating ? 'AI Regener√°l√°s...' : 'AI Regener√°l√°s'}\n                      </Button>\n                    </div>\n                  </div>\n                  <CardTitle className=\"text-2xl\">{module.title}</CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div ref={mermaidRef} className=\"prose prose-neutral max-w-none dark:prose-invert\">\n                    <ReactMarkdown \n                      remarkPlugins={[remarkGfm]}\n                      components={{\n                        // Custom styling for markdown elements\n                        h1: ({children}) => <h1 className=\"text-2xl font-bold mb-4 text-primary\">{children}</h1>,\n                        h2: ({children}) => <h2 className=\"text-xl font-semibold mb-3 text-primary\">{children}</h2>,\n                        h3: ({children}) => <h3 className=\"text-lg font-medium mb-2 text-primary\">{children}</h3>,\n                        p: ({children}) => <p className=\"mb-4 text-gray-700 dark:text-gray-300 leading-relaxed\">{children}</p>,\n                        ul: ({children}) => <ul className=\"list-disc list-inside mb-4 space-y-1\">{children}</ul>,\n                        ol: ({children}) => <ol className=\"list-decimal list-inside mb-4 space-y-1\">{children}</ol>,\n                        li: ({children}) => <li className=\"text-gray-700 dark:text-gray-300\">{children}</li>,\n                        blockquote: ({children}) => (\n                          <blockquote className=\"border-l-4 border-blue-500 pl-4 italic my-4 bg-blue-50 dark:bg-blue-900/20 py-2\">\n                            {children}\n                          </blockquote>\n                        ),\n                        code: ({className, children, ...props}) => {\n                          const match = /language-(\\w+)/.exec(className || '');\n                          const language = match ? match[1] : '';\n                          \n                          if (language === 'mermaid') {\n                            return (\n                              <div className=\"mermaid bg-white p-4 border rounded-lg my-4\">\n                                {String(children).replace(/\\n$/, '')}\n                              </div>\n                            );\n                          }\n                          \n                          return (\n                            <code className=\"bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded text-sm font-mono\" {...props}>\n                              {children}\n                            </code>\n                          );\n                        },\n                        pre: ({children}) => (\n                          <pre className=\"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg overflow-x-auto my-4\">\n                            {children}\n                          </pre>\n                        ),\n                      }}\n                    >\n                      {displayContent}\n                    </ReactMarkdown>\n                  </div>\n                  \n                  <div className=\"mt-6 flex flex-wrap gap-3\">\n                    <Button\n                      onClick={() => playAudio(displayContent)}\n                      disabled={isPlaying}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      {isPlaying ? (\n                        <>\n                          <Pause className=\"h-4 w-4 mr-2\" />\n                          Lej√°tsz√°s...\n                        </>\n                      ) : (\n                        <>\n                          <Volume2 className=\"h-4 w-4 mr-2\" />\n                          Felolvas√°s\n                        </>\n                      )}\n                    </Button>\n\n                    {isPlaying && (\n                      <Button\n                        onClick={stopAudio}\n                        variant=\"outline\"\n                        size=\"sm\"\n                      >\n                        <Pause className=\"h-4 w-4 mr-2\" />\n                        √Ållj\n                      </Button>\n                    )}\n\n                    <Button\n                      onClick={() => setShowQuiz(true)}\n                      variant=\"outline\"\n                      size=\"sm\"\n                    >\n                      <Brain className=\"h-4 w-4 mr-2\" />\n                      Kv√≠z\n                    </Button>\n\n                    {!isCompleted && (\n                      <Button\n                        onClick={() => completeModuleMutation.mutate()}\n                        disabled={completeModuleMutation.isPending}\n                        className=\"bg-green-600 hover:bg-green-700\"\n                      >\n                        <CheckCircle className=\"h-4 w-4 mr-2\" />\n                        {completeModuleMutation.isPending ? 'Befejez√©s...' : 'Modul befejez√©se'}\n                      </Button>\n                    )}\n                  </div>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n\n      {/* Modals */}\n      <Dialog open={showImageModal} onOpenChange={setShowImageModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Modul k√©p</DialogTitle>\n          </DialogHeader>\n          {module.imageUrl && (\n            <img \n              src={module.imageUrl} \n              alt={module.title}\n              className=\"w-full h-auto rounded-lg\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showYoutubeModal} onOpenChange={setShowYoutubeModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>YouTube vide√≥</DialogTitle>\n          </DialogHeader>\n          {module.youtubeUrl && (\n            <div className=\"aspect-video\">\n              <iframe \n                src={module.youtubeUrl?.replace('watch?v=', 'embed/') || ''}\n                className=\"w-full h-full rounded-lg\"\n                allowFullScreen\n              />\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showVideoModal} onOpenChange={setShowVideoModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Vide√≥</DialogTitle>\n          </DialogHeader>\n          {module.videoUrl && (\n            <video \n              src={module.videoUrl} \n              controls \n              className=\"w-full rounded-lg\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showAudioModal} onOpenChange={setShowAudioModal}>\n        <DialogContent>\n          <DialogHeader>\n            <DialogTitle>Hang</DialogTitle>\n          </DialogHeader>\n          {module.audioUrl && (\n            <audio \n              src={module.audioUrl} \n              controls \n              className=\"w-full\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showPodcastModal} onOpenChange={setShowPodcastModal}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Podcast</DialogTitle>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setShowPodcastModal(false)}\n              className=\"absolute right-4 top-4\"\n            >\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </DialogHeader>\n          {module.podcastUrl && (\n            <div className=\"space-y-4\">\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                {module.podcastUrl.includes('spotify') ? 'Spotify podcast megnyit√°sa...' : \n                 module.podcastUrl.includes('youtube') ? 'YouTube podcast megnyit√°sa...' : 'Podcast megnyit√°sa...'}\n              </p>\n              <Button\n                onClick={() => module?.podcastUrl && window.open(module.podcastUrl, '_blank')}\n                className=\"w-full\"\n              >\n                Podcast megnyit√°sa k√ºls≈ë oldalon\n              </Button>\n            </div>\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {/* Modals - Outside grid layout */}\n      <Dialog open={showImageModal} onOpenChange={setShowImageModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Modul k√©p</DialogTitle>\n          </DialogHeader>\n          {module?.imageUrl && (\n            <img \n              src={module.imageUrl} \n              alt={module.title}\n              className=\"w-full h-auto rounded-lg\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showPodcastPlayer} onOpenChange={setShowPodcastPlayer}>\n        <DialogContent className=\"max-w-2xl\">\n          <DialogHeader>\n            <DialogTitle>Podcast lej√°tsz√°s</DialogTitle>\n          </DialogHeader>\n          {module?.podcastUrl && (\n            <audio \n              controls \n              className=\"w-full\"\n              src={module.podcastUrl}\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={showVideoModal} onOpenChange={setShowVideoModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Vide√≥ lej√°tsz√°s</DialogTitle>\n          </DialogHeader>\n          {selectedVideoUrl && (\n            <iframe\n              width=\"100%\"\n              height=\"400\"\n              src={selectedVideoUrl}\n              title=\"YouTube video player\"\n              frameBorder=\"0\"\n              allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n              allowFullScreen\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n\n      {isChatOpen && (\n        <ChatInterface \n          userId={user?.id || ''}\n          moduleId={moduleId}\n        />\n      )}\n\n      </div>\n\n      {isChatOpen && (\n        <ChatInterface \n          userId={user?.id || ''}\n          moduleId={moduleId}\n        />\n      )}\n\n      {showQuiz && (\n        <QuizInterface\n          moduleId={moduleId}\n          moduleTitle={module?.title || ''}\n          onModuleComplete={() => setShowQuiz(false)}\n        />\n      )}\n    </>\n  );\n}","size_bytes":32012},"client/src/pages/module-viewer.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport ChatInterface from \"@/components/chat-interface\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { ArrowLeft, CheckCircle, Menu, Play, MessageCircle, FileText, Volume2, Image as ImageIcon, Pause, Brain, Youtube, Headphones, X, Wand2 } from \"lucide-react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport type { Module } from \"@shared/schema\";\nimport QuizInterface from \"@/components/quiz-interface\";\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\nimport mermaid from 'mermaid';\n\n\nexport default function ModuleViewer() {\n  const params = useParams();\n  const [, setLocation] = useLocation();\n  const { user, isAuthenticated, isLoading } = useAuth();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n\n  const [showQuiz, setShowQuiz] = useState(false);\n  const [chatInterfaceKey, setChatInterfaceKey] = useState(0);\n  const [currentAudio, setCurrentAudio] = useState<HTMLAudioElement | null>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n  \n  // Multim√©dia modal state-ek\n  const [showImageModal, setShowImageModal] = useState(false);\n  const [showVideoModal, setShowVideoModal] = useState(false);\n  const [showYoutubeModal, setShowYoutubeModal] = useState(false);\n  const [showAudioModal, setShowAudioModal] = useState(false);\n  const [showPodcastModal, setShowPodcastModal] = useState(false);\n  const [selectedYoutubeVideo, setSelectedYoutubeVideo] = useState<{title: string, videoId: string} | null>(null);\n  const [contentVersion, setContentVersion] = useState<'concise' | 'detailed'>('concise');\n  const [isRegenerating, setIsRegenerating] = useState(false);\n  const mermaidRef = useRef<HTMLDivElement>(null);\n\n  // Initialize mermaid\n  useEffect(() => {\n    mermaid.initialize({\n      startOnLoad: true,\n      theme: 'default',\n      securityLevel: 'loose',\n    });\n  }, []);\n\n  // Wikipedia popup state\n  const [showWikipediaModal, setShowWikipediaModal] = useState(false);\n  const [wikipediaContent, setWikipediaContent] = useState<{title: string, content: string, url: string} | null>(null);\n  const [isLoadingWikipedia, setIsLoadingWikipedia] = useState(false);\n\n  // Universal DOM change observer for Mermaid re-rendering\n  useEffect(() => {\n    const renderMermaidDiagrams = async () => {\n      const mermaidElements = document.querySelectorAll('code.language-mermaid, .mermaid');\n      if (mermaidElements.length > 0) {\n        console.log(`DOM changed: Re-rendering ${mermaidElements.length} Mermaid diagrams`);\n        \n        // Convert code blocks to mermaid divs if needed\n        mermaidElements.forEach((element, index) => {\n          if (element.tagName === 'CODE' && element.textContent) {\n            const mermaidDiv = document.createElement('div');\n            mermaidDiv.className = 'mermaid';\n            mermaidDiv.textContent = element.textContent;\n            mermaidDiv.id = `mermaid-diagram-dom-${index}`;\n            element.parentNode?.insertBefore(mermaidDiv, element);\n            if (element instanceof HTMLElement) {\n              element.style.display = 'none';\n            }\n          }\n        });\n        \n        // Re-run mermaid\n        setTimeout(async () => {\n          const mermaidDivs = document.querySelectorAll('.mermaid');\n          if (mermaidDivs.length > 0) {\n            try {\n              await mermaid.run({\n                querySelector: '.mermaid'\n              });\n              console.log('DOM changed: Mermaid diagrams re-rendered successfully');\n            } catch (error) {\n              console.warn('DOM changed: mermaid.run() failed, trying mermaid.init():', error);\n              await mermaid.init(undefined, mermaidDivs as any);\n              console.log('DOM changed: Mermaid diagrams re-rendered with mermaid.init()');\n            }\n          }\n        }, 100);\n      }\n    };\n\n    // Create MutationObserver to watch for DOM changes\n    let lastRenderTime = 0;\n    const observer = new MutationObserver((mutations) => {\n      let shouldRerender = false;\n      \n      mutations.forEach((mutation) => {\n        // Only trigger on significant content changes\n        if (mutation.type === 'childList') {\n          // Check if added nodes contain mermaid content\n          mutation.addedNodes.forEach(node => {\n            if (node.nodeType === Node.ELEMENT_NODE) {\n              const element = node as Element;\n              if (element.classList?.contains('prose') || \n                  element.querySelector?.('code.language-mermaid, .mermaid') ||\n                  element.textContent?.includes('mermaid')) {\n                shouldRerender = true;\n              }\n            }\n          });\n        }\n      });\n      \n      if (shouldRerender) {\n        const now = Date.now();\n        // Prevent excessive rendering (max once per 1000ms)\n        if (now - lastRenderTime > 1000) {\n          lastRenderTime = now;\n          setTimeout(() => {\n            renderMermaidDiagrams();\n          }, 300);\n        }\n      }\n    });\n\n    // Start observing the document body for changes\n    observer.observe(document.body, {\n      childList: true,\n      subtree: true,\n      attributes: true,\n      attributeFilter: ['class']\n    });\n\n    return () => {\n      observer.disconnect();\n    };\n  }, []);\n\n  // Wikipedia content fetcher\n  const fetchWikipediaContent = async (wikipediaUrl: string) => {\n    setIsLoadingWikipedia(true);\n    try {\n      // Extract article title from URL\n      const urlParts = wikipediaUrl.split('/');\n      let articleTitle = decodeURIComponent(urlParts[urlParts.length - 1]);\n      \n      console.log(`Fetching Wikipedia content for: \"${articleTitle}\"`);\n      \n      // Use backend proxy with improved search capabilities\n      const response = await fetch(`/api/wikipedia/${encodeURIComponent(articleTitle)}`);\n      \n      if (response.ok) {\n        const data = await response.json();\n        \n        setWikipediaContent({\n          title: data.title || articleTitle,\n          content: data.content || 'Nincs el√©rhet≈ë tartalom',\n          url: data.url || wikipediaUrl\n        });\n        setShowWikipediaModal(true);\n        \n        console.log(`Successfully loaded Wikipedia content for: \"${data.title}\"`);\n      } else {\n        const errorData = await response.json();\n        console.log(`Wikipedia fetch failed: ${errorData.error} for \"${articleTitle}\"`);\n        \n        // Show user-friendly error with suggestions\n        setWikipediaContent({\n          title: articleTitle,\n          content: `Sajnos nem tal√°lhat√≥ Wikipedia tartalom ehhez a kifejez√©shez: \"${articleTitle}\"\\n\\n${errorData.suggestion || 'Pr√≥b√°lj meg egyszer≈±bb vagy √°ltal√°nosabb kifejez√©seket haszn√°lni.'}`,\n          url: wikipediaUrl\n        });\n        setShowWikipediaModal(true);\n        \n        toast({\n          title: \"Wikipedia tartalom nem tal√°lhat√≥\",\n          description: \"A keresett kifejez√©shez nincs el√©rhet≈ë Wikipedia cikk\",\n          variant: \"destructive\",\n        });\n      }\n      \n    } catch (error) {\n      console.error('Wikipedia fetch error:', error);\n      \n      // Show error content in modal instead of just toast\n      setWikipediaContent({\n        title: \"Hiba t√∂rt√©nt\",\n        content: \"H√°l√≥zati hiba t√∂rt√©nt a Wikipedia tartalom bet√∂lt√©se sor√°n. K√©rj√ºk, pr√≥b√°ld meg k√©s≈ëbb √∫jra.\",\n        url: wikipediaUrl\n      });\n      setShowWikipediaModal(true);\n      \n      toast({\n        title: \"H√°l√≥zati hiba\",\n        description: \"Nem siker√ºlt kapcsol√≥dni a Wikipedia-hoz\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoadingWikipedia(false);\n    }\n  };\n\n\n\n  const moduleId = parseInt(params.id as string);\n\n  console.log('ModuleViewer params:', params);\n  console.log('ModuleViewer moduleId:', moduleId);\n\n  // Redirect to home if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  const { data: module, isLoading: moduleLoading } = useQuery<Module>({\n    queryKey: [`/api/modules/${moduleId}`],\n    retry: false,\n    refetchOnMount: true,\n    refetchOnWindowFocus: true,\n    staleTime: 0,\n  });\n\n  // Mermaid rendering for SPA environment\n  useEffect(() => {\n    const renderMermaidDiagrams = async () => {\n      try {\n        // Initialize mermaid if not already done\n        mermaid.initialize({ \n          startOnLoad: false, // We'll handle rendering manually\n          theme: 'default',\n          securityLevel: 'loose',\n        });\n        \n        // Find all possible mermaid selectors\n        const possibleSelectors = [\n          '.language-mermaid',\n          'code[class*=\"language-mermaid\"]',\n          'pre code.language-mermaid',\n          '.mermaid',\n          'code.mermaid'\n        ];\n        \n        let mermaidElements: Element[] = [];\n        \n        for (const selector of possibleSelectors) {\n          const elements = document.querySelectorAll(selector);\n          mermaidElements = mermaidElements.concat(Array.from(elements));\n        }\n        \n        // Remove duplicates\n        mermaidElements = Array.from(new Set(mermaidElements));\n        \n        console.log(`Found ${mermaidElements.length} potential Mermaid diagrams`);\n        console.log('Mermaid elements:', mermaidElements);\n        \n        if (mermaidElements.length > 0) {\n          // Convert code blocks to mermaid divs if needed\n          mermaidElements.forEach((element, index) => {\n            if (element.tagName === 'CODE' && element.textContent) {\n              const mermaidDiv = document.createElement('div');\n              mermaidDiv.className = 'mermaid';\n              mermaidDiv.textContent = element.textContent;\n              mermaidDiv.id = `mermaid-diagram-${index}`;\n              element.parentNode?.insertBefore(mermaidDiv, element);\n              if (element instanceof HTMLElement) {\n                element.style.display = 'none'; // Hide original code block\n              }\n            }\n          });\n          \n          // Now run mermaid on the converted elements\n          const mermaidDivs = document.querySelectorAll('.mermaid');\n          console.log(`Processing ${mermaidDivs.length} Mermaid divs`);\n          \n          if (mermaidDivs.length > 0) {\n            try {\n              await mermaid.run({\n                querySelector: '.mermaid'\n              });\n              console.log('Mermaid diagrams rendered successfully with mermaid.run()');\n            } catch (runError) {\n              console.warn('mermaid.run() failed, trying mermaid.init():', runError);\n              await mermaid.init(undefined, mermaidDivs as any);\n              console.log('Mermaid diagrams rendered successfully with mermaid.init()');\n            }\n          }\n        } else {\n          console.log('No Mermaid diagrams found in DOM');\n        }\n      } catch (error) {\n        console.warn('Mermaid rendering failed:', error);\n      }\n    };\n    \n    // Wait for DOM to be updated with content\n    const timer = setTimeout(renderMermaidDiagrams, 500);\n    return () => clearTimeout(timer);\n  }, [module?.content, contentVersion]);\n\n  // Get all modules to check for next module\n  const { data: allModules = [] } = useQuery<Module[]>({\n    queryKey: ['/api/public/modules', module?.subjectId],\n    queryFn: async () => {\n      if (!module?.subjectId) return [];\n      const response = await fetch(`/api/public/modules?subjectId=${module.subjectId}`);\n      if (!response.ok) throw new Error('Failed to fetch modules');\n      return response.json();\n    },\n    enabled: !!module?.subjectId && !moduleLoading,\n    retry: false,\n  });\n\n  const completeModuleMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest('POST', `/api/modules/${moduleId}/complete`);\n    },\n    onSuccess: async () => {\n      // Clear all cache and force fresh data fetch\n      queryClient.clear();\n      \n      // Force immediate refresh of user data to get updated completed_modules\n      await queryClient.refetchQueries({ queryKey: ['/api/auth/user'] });\n      \n      // Show success message\n      toast({\n        title: \"Gratul√°lunk!\",\n        description: \"Sikeresen befejezted ezt a modult! A k√∂vetkez≈ë modul most m√°r el√©rhet≈ë.\",\n      });\n      \n      // Force page refresh after a short delay to ensure data sync\n      setTimeout(() => {\n        window.location.reload();\n      }, 1500);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Unauthorized\",\n          description: \"You are logged out. Logging in again...\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt befejezni a modult\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const regenerateModuleMutation = useMutation({\n    mutationFn: async () => {\n      setIsRegenerating(true);\n      const response = await apiRequest('POST', `/api/admin/modules/${moduleId}/regenerate-ai`, {\n        title: module?.title || '',\n        content: module?.content || ''\n      });\n      return response.json();\n    },\n    onSuccess: async () => {\n      // Clear all cache immediately\n      queryClient.clear();\n      \n      // Force refetch of the current module\n      await queryClient.refetchQueries({ \n        queryKey: [`/api/modules/${moduleId}`],\n        type: 'active'\n      });\n      \n      // Also invalidate related queries\n      queryClient.invalidateQueries({ queryKey: ['/api/modules'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/public/modules'] });\n      \n      toast({\n        title: \"AI √öjragener√°l√°s sikeres!\",\n        description: \"A modul tartalm√°t sikeresen friss√≠tette az AI - Wikipedia linkekkel √©s vide√≥kkal b≈ëv√≠tve.\",\n      });\n      setIsRegenerating(false);\n      \n      // Force component re-render by updating key\n      setChatInterfaceKey(prev => prev + 1);\n    },\n    onError: (error) => {\n      if (isUnauthorizedError(error)) {\n        toast({\n          title: \"Nincs enged√©ly\",\n          description: \"Jelentkezz be √∫jra a folytat√°shoz.\",\n          variant: \"destructive\",\n        });\n        setTimeout(() => {\n          window.location.href = \"/api/login\";\n        }, 500);\n        return;\n      }\n      toast({\n        title: \"√öjragener√°l√°s sikertelen\",\n        description: \"Az AI nem tudta friss√≠teni a modul tartalm√°t.\",\n        variant: \"destructive\",\n      });\n      setIsRegenerating(false);\n    },\n  });\n\n  const handleBackNavigation = () => {\n    if (module?.subjectId) {\n      setLocation(`/subjects/${module.subjectId}/modules`);\n    } else {\n      setLocation('/subjects');\n    }\n  };\n\n  if (isLoading || !user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-neutral-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (moduleLoading) {\n    return (\n      <div className=\"flex min-h-screen bg-student-warm\">\n        <div className=\"hidden lg:block\">\n          <Sidebar user={user} />\n        </div>\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n            <p className=\"text-neutral-600\">Modul bet√∂lt√©se...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!module) {\n    return (\n      <div className=\"flex min-h-screen bg-student-warm\">\n        <div className=\"hidden lg:block\">\n          <Sidebar user={user} />\n        </div>\n        <div className=\"flex-1 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <h2 className=\"text-xl font-semibold text-neutral-700 mb-2\">Modul nem tal√°lhat√≥</h2>\n            <p className=\"text-neutral-500 mb-4\">A keresett modul nem l√©tezik vagy nem el√©rhet≈ë.</p>\n            <Button onClick={() => setLocation(\"/\")}>\n              Vissza a f≈ëoldalra\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const isCompleted = user.completedModules?.includes(moduleId) || false;\n\n  return (\n    <div className=\"flex min-h-screen bg-student-warm\">\n      {/* Desktop Sidebar */}\n      <div className=\"hidden lg:block lg:w-64 lg:flex-shrink-0\">\n        <div className=\"sticky top-0 h-screen overflow-y-auto\">\n          <Sidebar user={user} />\n        </div>\n      </div>\n\n      {/* Mobile Navigation */}\n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)}\n        user={user}\n      />\n\n      {/* Main Content */}\n      <div className=\"flex-1 overflow-auto\">\n        {/* Mobile Header */}\n        <header className=\"bg-student-warm shadow-sm border-b border-neutral-100 lg:hidden\">\n          <div className=\"flex items-center justify-between p-4\">\n            <button \n              onClick={() => setIsMobileNavOpen(true)}\n              className=\"text-neutral-700\"\n            >\n              <Menu size={24} />\n            </button>\n            <h1 className=\"text-lg font-semibold text-neutral-700\">Modul</h1>\n            <div className=\"w-6\"></div>\n          </div>\n        </header>\n\n        {/* Content Area */}\n        <div className=\"flex flex-col\">\n          {/* Module Content */}\n          <main className=\"flex-1 p-4 lg:p-8 relative\">\n            {/* Back Button */}\n            <Button \n              variant=\"ghost\" \n              onClick={handleBackNavigation}\n              className=\"mb-6\"\n            >\n              <ArrowLeft className=\"mr-2\" size={16} />\n              Vissza\n            </Button>\n\n            {/* Multim√©dia oldals√°v */}\n            {module && (\n              <div className=\"fixed right-4 top-1/2 transform -translate-y-1/2 z-40 flex flex-col gap-2\">\n                {module.imageUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowImageModal(true)}\n                    className=\"w-12 h-12 rounded-full bg-student-warm shadow-lg hover:shadow-xl border-2 border-neutral-200 hover:border-blue-300\"\n                    title=\"K√©p megtekint√©se\"\n                  >\n                    <ImageIcon size={18} className=\"text-neutral-600\" />\n                  </Button>\n                )}\n                \n                {module.youtubeUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowYoutubeModal(true)}\n                    className=\"w-12 h-12 rounded-full bg-student-warm shadow-lg hover:shadow-xl border-2 border-neutral-200 hover:border-red-300\"\n                    title=\"YouTube vide√≥ megtekint√©se\"\n                  >\n                    <Youtube size={18} className=\"text-red-600\" />\n                  </Button>\n                )}\n                \n                {module.videoUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowVideoModal(true)}\n                    className=\"w-12 h-12 rounded-full bg-student-warm shadow-lg hover:shadow-xl border-2 border-neutral-200 hover:border-purple-300\"\n                    title=\"Vide√≥ lej√°tsz√°sa\"\n                  >\n                    <Play size={18} className=\"text-purple-600\" />\n                  </Button>\n                )}\n                \n                {module.audioUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowAudioModal(true)}\n                    className=\"w-12 h-12 rounded-full bg-student-warm shadow-lg hover:shadow-xl border-2 border-neutral-200 hover:border-green-300\"\n                    title=\"Hang lej√°tsz√°sa\"\n                  >\n                    <Volume2 size={18} className=\"text-green-600\" />\n                  </Button>\n                )}\n                \n                {module.podcastUrl && (\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => setShowPodcastModal(true)}\n                    className=\"w-12 h-12 rounded-full bg-student-warm shadow-lg hover:shadow-xl border-2 border-neutral-200 hover:border-orange-300\"\n                    title=\"Podcast meghallgat√°sa\"\n                  >\n                    <Headphones size={18} className=\"text-orange-600\" />\n                  </Button>\n                )}\n              </div>\n            )}\n\n            {/* Module Header */}\n            <div className=\"mb-6\">\n              <div className=\"flex items-center gap-3 mb-2\">\n                <Badge variant=\"outline\">#{module.moduleNumber}. modul</Badge>\n                {isCompleted && (\n                  <Badge className=\"bg-secondary text-secondary-foreground\">\n                    <CheckCircle className=\"mr-1\" size={14} />\n                    Befejezve\n                  </Badge>\n                )}\n              </div>\n              <h1 className=\"text-3xl font-bold text-neutral-800 mb-2\">{module.title}</h1>\n            </div>\n\n            {/* Multim√©dia tartalmak csak az oldals√°v ikonokon kereszt√ºl el√©rhet≈ëk */}\n\n\n\n\n\n            {/* Module Content */}\n            <Card className=\"mb-6\">\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle>Tananyag</CardTitle>\n                  <div className=\"flex gap-2\">\n                    {/* Content version selector for AI-enhanced modules */}\n                    {(module.conciseContent || module.detailedContent) && (\n                      <>\n                        <Button\n                          variant={contentVersion === 'concise' ? 'default' : 'outline'}\n                          size=\"sm\"\n                          onClick={() => setContentVersion('concise')}\n                          disabled={!module.conciseContent}\n                          className=\"text-xs\"\n                        >\n                          <Brain className=\"w-3 h-3 mr-1\" />\n                          T√∂m√∂r\n                        </Button>\n                        <Button\n                          variant={contentVersion === 'detailed' ? 'default' : 'outline'}\n                          size=\"sm\"\n                          onClick={() => setContentVersion('detailed')}\n                          disabled={!module.detailedContent}\n                          className=\"text-xs\"\n                        >\n                          <FileText className=\"w-3 h-3 mr-1\" />\n                          R√©szletes\n                        </Button>\n                      </>\n                    )}\n                    {/* AI Regenerate button for admins */}\n                    {user?.role === 'admin' && (\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={() => regenerateModuleMutation.mutate()}\n                        disabled={isRegenerating}\n                        className=\"text-xs\"\n                      >\n                        {isRegenerating ? (\n                          <>\n                            <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-current mr-1\"></div>\n                            √öjragener√°l√°s...\n                          </>\n                        ) : (\n                          <>\n                            <Wand2 className=\"w-3 h-3 mr-1\" />\n                            AI √öjragener√°l√°s\n                          </>\n                        )}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div ref={mermaidRef} className=\"prose prose-neutral max-w-none dark:prose-invert\">\n                  <ReactMarkdown \n                    remarkPlugins={[remarkGfm]}\n                    components={{\n                      // Custom styling for markdown elements\n                      h1: ({children}) => <h1 className=\"text-2xl font-bold mb-4 text-primary\">{children}</h1>,\n                      h2: ({children}) => <h2 className=\"text-xl font-semibold mb-3 text-primary\">{children}</h2>,\n                      h3: ({children}) => <h3 className=\"text-lg font-medium mb-2 text-primary\">{children}</h3>,\n                      p: ({children}) => <p className=\"mb-3 leading-relaxed\">{children}</p>,\n                      ul: ({children}) => <ul className=\"list-disc list-inside mb-4 space-y-1\">{children}</ul>,\n                      ol: ({children}) => <ol className=\"list-decimal list-inside mb-4 space-y-1\">{children}</ol>,\n                      li: ({children}) => <li className=\"mb-1\">{children}</li>,\n                      blockquote: ({children}) => <blockquote className=\"border-l-4 border-primary pl-4 italic mb-4 bg-student-warm py-2\">{children}</blockquote>,\n                      pre: ({children}) => <pre className=\"bg-neutral-100 p-4 rounded-lg overflow-x-auto mb-4\">{children}</pre>,\n                      strong: ({children}) => {\n                        // Convert strong text to Wikipedia links for key concepts\n                        const text = String(children);\n                        \n                        // Common cooking ingredients and technical terms that should get Wikipedia links\n                        const importantTerms = [\n                          'paprika', 'paradicsom', 'hagyma', 'kolb√°sz', 'lecs√≥', 'toj√°s', 'olaj',\n                          's√≥', 'bors', 'pirospaprika', 'cukor', 'fokhagyma', 'z√∂ldpaprika',\n                          'k√°piapaprika', 'szalonna', 'tejf√∂l', 'liszt', 'vaj', 'tej', 'sajt'\n                        ];\n                        \n                        // Check if this text is an important term\n                        const isImportantTerm = importantTerms.some(term => \n                          text.toLowerCase().includes(term.toLowerCase())\n                        );\n                        \n                        // Also check against key concepts data\n                        let keyConceptsData = [];\n                        try {\n                          keyConceptsData = module.keyConceptsData ? \n                            (typeof module.keyConceptsData === 'string' ? \n                              JSON.parse(module.keyConceptsData) : \n                              module.keyConceptsData) : [];\n                        } catch (e) {\n                          // If parsing fails, just use empty array\n                        }\n                        \n                        const matchingConcept = keyConceptsData.find((concept: any) => \n                          concept.concept && text.toLowerCase().includes(concept.concept.toLowerCase())\n                        );\n                        \n                        if (isImportantTerm || matchingConcept) {\n                          const wikipediaUrl = `https://hu.wikipedia.org/wiki/${encodeURIComponent(text)}`;\n                          return (\n                            <a \n                              href={wikipediaUrl} \n                              target=\"_blank\" \n                              rel=\"noopener noreferrer\"\n                              className=\"font-semibold text-primary hover:text-blue-600 hover:underline transition-colors inline-flex items-center gap-1\"\n                              title={`Wikipedia: ${text}`}\n                            >\n                              {children}\n                              <span className=\"text-xs\">üîó</span>\n                            </a>\n                          );\n                        }\n                        \n                        return <strong className=\"font-semibold text-primary\">{children}</strong>;\n                      },\n                      em: ({children}) => <em className=\"italic\">{children}</em>,\n                      table: ({children}) => <table className=\"w-full border-collapse border border-neutral-300 mb-4\">{children}</table>,\n                      th: ({children}) => <th className=\"border border-neutral-300 px-4 py-2 bg-neutral-100 font-semibold\">{children}</th>,\n                      td: ({children}) => <td className=\"border border-neutral-300 px-4 py-2\">{children}</td>,\n                      a: ({href, children}) => {\n                        // Check if this is a Wikipedia link\n                        if (href && href.includes('hu.wikipedia.org/wiki/')) {\n                          return (\n                            <button\n                              onClick={(e) => {\n                                e.preventDefault();\n                                fetchWikipediaContent(href);\n                              }}\n                              className=\"text-primary hover:underline cursor-pointer inline-flex items-center gap-1 font-medium\"\n                            >\n                              {children}\n                              <span className=\"text-xs bg-blue-100 text-blue-700 px-1 py-0.5 rounded font-medium\">W</span>\n                            </button>\n                          );\n                        }\n                        // Regular external links\n                        return <a href={href} className=\"text-primary hover:underline\" target=\"_blank\" rel=\"noopener noreferrer\">{children}</a>;\n                      },\n                      code: ({className, children, ...props}) => {\n                        const match = /language-(\\w+)/.exec(className || '');\n                        const language = match ? match[1] : '';\n                        \n                        if (language === 'mermaid') {\n                          return (\n                            <div className=\"mermaid bg-student-warm p-4 border rounded-lg my-4\">\n                              {String(children).replace(/\\n$/, '')}\n                            </div>\n                          );\n                        }\n                        \n                        return (\n                          <code className=\"bg-neutral-100 px-2 py-1 rounded text-sm font-mono\" {...props}>\n                            {children}\n                          </code>\n                        );\n                      }\n                    }}\n                  >\n                    {(() => {\n                      // AI enhanced modules: use selected version\n                      if (module.conciseContent || module.detailedContent) {\n                        if (contentVersion === 'concise' && module.conciseContent) {\n                          return module.conciseContent;\n                        }\n                        if (contentVersion === 'detailed' && module.detailedContent) {\n                          return module.detailedContent;\n                        }\n                        // Fallback to available content\n                        return module.detailedContent || module.conciseContent;\n                      }\n                      // Regular modules: use original content\n                      return module.content;\n                    })()}\n                  </ReactMarkdown>\n                  \n                  {/* Key Concepts with YouTube Videos */}\n                  {(() => {\n                    try {\n                      const keyConceptsData = typeof module.keyConceptsData === 'string' \n                        ? JSON.parse(module.keyConceptsData) \n                        : module.keyConceptsData;\n                      \n                      if (!keyConceptsData || !Array.isArray(keyConceptsData) || keyConceptsData.length === 0) {\n                        return null;\n                      }\n                      \n                      return (\n                        <div className=\"mt-8 border-t pt-6\">\n                          <h3 className=\"text-lg font-semibold mb-4 text-primary flex items-center\">\n                            <Youtube className=\"w-5 h-5 mr-2\" />\n                            Kulcsfogalmak vide√≥kkal\n                          </h3>\n                          {keyConceptsData.map((concept: any, index: number) => (\n                            <div key={index} className=\"mb-6 p-4 bg-student-warm rounded-lg\">\n                              <h4 className=\"font-semibold text-neutral-800 mb-2\">{concept.concept}</h4>\n                              <p className=\"text-neutral-700 mb-3\">{concept.definition}</p>\n                              {concept.youtubeVideos && concept.youtubeVideos.length > 0 && (\n                                <div className=\"space-y-2\">\n                                  <h5 className=\"text-sm font-medium text-neutral-600\">Kapcsol√≥d√≥ vide√≥k:</h5>\n                                  {concept.youtubeVideos.map((video: any, videoIndex: number) => (\n                                    <button\n                                      key={videoIndex}\n                                      onClick={() => {\n                                        setSelectedYoutubeVideo({\n                                          title: video.title,\n                                          videoId: video.videoId\n                                        });\n                                        setShowYoutubeModal(true);\n                                      }}\n                                      className=\"flex items-center gap-3 p-3 bg-student-warm rounded border hover:border-red-300 hover:bg-red-50 transition-colors w-full text-left\"\n                                    >\n                                      <Youtube className=\"w-5 h-5 text-red-600 flex-shrink-0\" />\n                                      <div className=\"flex-1 min-w-0\">\n                                        <div className=\"text-sm font-medium text-neutral-900 truncate\">\n                                          {video.title}\n                                        </div>\n                                        <div className=\"text-xs text-neutral-600 line-clamp-2\">\n                                          {video.description}\n                                        </div>\n                                      </div>\n                                    </button>\n                                  ))}\n                                </div>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      );\n                    } catch (error) {\n                      console.error('Error parsing key concepts data:', error);\n                      return null;\n                    }\n                  })()}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Module Navigation */}\n            {(() => {\n              const currentModule = allModules.find(m => m.id === moduleId);\n              if (!currentModule) return null;\n              \n              const subjectModules = allModules\n                .filter(m => m.subjectId === currentModule.subjectId)\n                .sort((a, b) => a.moduleNumber - b.moduleNumber);\n              \n              const currentIndex = subjectModules.findIndex(m => m.id === moduleId);\n              const previousModule = subjectModules[currentIndex - 1];\n              const nextModule = subjectModules[currentIndex + 1];\n              const completedModules = user?.completedModules || [];\n              const isCurrentCompleted = completedModules.includes(moduleId);\n              // A k√∂vetkez≈ë modul akkor ny√≠lik ki, ha az aktu√°lis modul befejezett\n              // De els≈ë esetben (nincs el≈ëz≈ë modul) mindig nyitott\n              const isNextUnlocked = !nextModule || isCurrentCompleted;\n              \n              // Debug logging\n              console.log('Progressive unlocking debug:', {\n                moduleId,\n                nextModuleId: nextModule?.id,\n                completedModules,\n                isCurrentCompleted,\n                isNextUnlocked\n              });\n              \n              return (\n                <div className=\"flex justify-between items-center mb-6 p-4 bg-student-warm rounded-lg\">\n                  <div>\n                    {previousModule ? (\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => setLocation(`/module/${previousModule.id}`)}\n                        className=\"flex items-center gap-2\"\n                      >\n                        <ArrowLeft size={16} />\n                        El≈ëz≈ë: {previousModule.title}\n                      </Button>\n                    ) : (\n                      <div></div>\n                    )}\n                  </div>\n                  \n                  <div className=\"text-center\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {currentIndex + 1} / {subjectModules.length} modul\n                    </span>\n                  </div>\n                  \n                  <div>\n                    {nextModule ? (\n                      <Button\n                        variant={isNextUnlocked ? \"default\" : \"outline\"}\n                        onClick={() => {\n                          if (isNextUnlocked) {\n                            setLocation(`/module/${nextModule.id}`);\n                          } else {\n                            toast({\n                              title: \"Modul z√°rolva\",\n                              description: \"El≈ësz√∂r fejezd be ezt a modult a tud√°spr√≥b√°val.\",\n                              variant: \"destructive\",\n                            });\n                          }\n                        }}\n                        className=\"flex items-center gap-2\"\n                        disabled={!isNextUnlocked}\n                      >\n                        K√∂vetkez≈ë: {nextModule.title}\n                        <ArrowLeft size={16} className=\"rotate-180\" />\n                      </Button>\n                    ) : (\n                      <div></div>\n                    )}\n                  </div>\n                </div>\n              );\n            })()}\n\n\n\n\n          </main>\n\n          {/* Chat Section - Below module content */}\n          <section className=\"border-t border-neutral-200 bg-student-warm\">\n            <div className=\"p-4 bg-student-warm border-b border-neutral-100\">\n              <div className=\"max-w-4xl mx-auto\">\n                <h3 className=\"font-semibold text-neutral-700\">AI Tan√°r</h3>\n                <p className=\"text-sm text-neutral-500\">Besz√©lgess a modulr√≥l, k√©rj magyar√°zatot vagy ind√≠tsd el a tud√°spr√≥b√°t!</p>\n              </div>\n            </div>\n            <div className=\"p-4\">\n              <div className=\"max-w-4xl mx-auto\">\n                <ChatInterface \n                  key={chatInterfaceKey} \n                  userId={user.id} \n                  moduleId={moduleId} \n                  onQuizStart={() => setShowQuiz(true)}\n                />\n              </div>\n            </div>\n          </section>\n\n          {/* Tud√°spr√≥ba most modal ablakban jelenik meg */}\n        </div>\n      </div>\n\n      {/* Multim√©dia Modal ablakok */}\n      \n      {/* K√©p Modal */}\n      <Dialog open={showImageModal} onOpenChange={setShowImageModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Illusztr√°ci√≥</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex justify-center\">\n            <img \n              src={module?.imageUrl || ''} \n              alt=\"Modul illusztr√°ci√≥\"\n              className=\"max-w-full max-h-[70vh] object-contain rounded-lg\"\n            />\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* YouTube Modal */}\n      <Dialog open={showYoutubeModal} onOpenChange={setShowYoutubeModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>{selectedYoutubeVideo?.title || 'YouTube Vide√≥'}</DialogTitle>\n          </DialogHeader>\n          <div className=\"aspect-video\">\n            {selectedYoutubeVideo?.videoId && (\n              <iframe\n                src={`https://www.youtube.com/embed/${selectedYoutubeVideo.videoId}`}\n                className=\"w-full h-full rounded-lg\"\n                allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                allowFullScreen\n              />\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Vide√≥ Modal */}\n      <Dialog open={showVideoModal} onOpenChange={setShowVideoModal}>\n        <DialogContent className=\"max-w-4xl\">\n          <DialogHeader>\n            <DialogTitle>Vide√≥</DialogTitle>\n          </DialogHeader>\n          <div className=\"aspect-video\">\n            {module?.videoUrl && (\n              <video \n                src={module.videoUrl}\n                controls\n                className=\"w-full h-full rounded-lg\"\n                preload=\"metadata\"\n              >\n                A b√∂ng√©sz≈ëd nem t√°mogatja a vide√≥ lej√°tsz√°st.\n              </video>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Audio Modal */}\n      <Dialog open={showAudioModal} onOpenChange={setShowAudioModal}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Hang lej√°tsz√°s</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex flex-col gap-4\">\n            {module?.audioUrl && (\n              <audio \n                src={module.audioUrl}\n                controls\n                className=\"w-full\"\n                preload=\"metadata\"\n              >\n                A b√∂ng√©sz≈ëd nem t√°mogatja a hang lej√°tsz√°st.\n              </audio>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Podcast Modal */}\n      <Dialog open={showPodcastModal} onOpenChange={setShowPodcastModal}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle>Podcast</DialogTitle>\n          </DialogHeader>\n          <div className=\"flex flex-col gap-4\">\n            {module?.podcastUrl && (\n              <div>\n                <p className=\"text-sm text-neutral-600 mb-3\">Podcast link:</p>\n                <a \n                  href={module.podcastUrl}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"text-blue-600 hover:underline break-all\"\n                >\n                  {module.podcastUrl}\n                </a>\n                <Button \n                  onClick={() => module.podcastUrl && window.open(module.podcastUrl, '_blank')}\n                  className=\"mt-3 w-full\"\n                >\n                  Podcast megnyit√°sa\n                </Button>\n              </div>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Wikipedia Modal */}\n      <Dialog open={showWikipediaModal} onOpenChange={setShowWikipediaModal}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <div className=\"w-6 h-6 bg-gray-100 rounded flex items-center justify-center\">\n                <span className=\"text-xs font-bold\">W</span>\n              </div>\n              {wikipediaContent?.title || 'Wikipedia'}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            {isLoadingWikipedia ? (\n              <div className=\"flex items-center justify-center py-8\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n                <span className=\"ml-3\">Wikipedia tartalom bet√∂lt√©se...</span>\n              </div>\n            ) : wikipediaContent ? (\n              <>\n                <div className=\"prose prose-sm max-w-none\">\n                  {wikipediaContent.content.split('\\n\\n').map((paragraph, index) => (\n                    <p key={index} className=\"text-gray-700 leading-relaxed mb-3\">\n                      {paragraph}\n                    </p>\n                  ))}\n                </div>\n                <div className=\"flex justify-between items-center pt-4 border-t\">\n                  <a \n                    href={wikipediaContent.url}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"text-blue-600 hover:underline text-sm\"\n                  >\n                    Teljes cikk megtekint√©se ‚Üí\n                  </a>\n                  <Button \n                    variant=\"outline\" \n                    size=\"sm\"\n                    onClick={() => setShowWikipediaModal(false)}\n                  >\n                    Bez√°r√°s\n                  </Button>\n                </div>\n              </>\n            ) : (\n              <p className=\"text-gray-500 text-center py-8\">\n                Nem siker√ºlt bet√∂lteni a Wikipedia tartalmat\n              </p>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n\n      {/* Tud√°spr√≥ba Modal */}\n      <Dialog open={showQuiz} onOpenChange={setShowQuiz}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Tud√°spr√≥ba - {module?.title}</DialogTitle>\n          </DialogHeader>\n          <div className=\"mt-4\">\n            <QuizInterface \n              moduleId={moduleId} \n              moduleTitle={module?.title || ''} \n              onModuleComplete={() => {\n                // Refresh user data and module data to show completion status\n                queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n                queryClient.invalidateQueries({ queryKey: ['/api/modules', moduleId] });\n                queryClient.invalidateQueries({ queryKey: ['/api/public/modules'] });\n                setShowQuiz(false);\n              }}\n            />\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","size_bytes":47199},"client/src/pages/modules.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useParams, useLocation } from \"wouter\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport ModuleCard from \"@/components/module-card\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { BookOpen, Menu, ArrowLeft } from \"lucide-react\";\nimport type { Module, Subject } from \"@shared/schema\";\n\nexport default function ModulesPage() {\n  const { user } = useAuth();\n  const params = useParams();\n  const [, navigate] = useLocation();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n  \n  const subjectId = params.subjectId ? parseInt(params.subjectId) : undefined;\n\n  const { data: modules = [], isLoading: modulesLoading } = useQuery({\n    queryKey: ['/api/public/modules', subjectId],\n    queryFn: async () => {\n      const url = subjectId ? `/api/public/modules?subjectId=${subjectId}` : '/api/public/modules';\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch modules');\n      return response.json();\n    },\n    retry: false,\n  });\n\n  const { data: subject } = useQuery({\n    queryKey: ['/api/public/subject', subjectId],\n    queryFn: async () => {\n      if (!subjectId) return null;\n      const response = await fetch(`/api/public/subjects?subjectId=${subjectId}`);\n      if (!response.ok) throw new Error('Failed to fetch subject');\n      const subjects = await response.json();\n      return subjects.find((s: Subject) => s.id === subjectId) || null;\n    },\n    enabled: !!subjectId,\n    retry: false,\n  });\n\n  const navigateBackToSubjects = () => {\n    if (subject?.professionId) {\n      navigate(`/tananyagok?profession=${subject.professionId}`);\n    } else {\n      navigate(\"/tananyagok\");\n    }\n  };\n\n  // Calculate which modules are unlocked based on completed modules\n  const getUnlockedModules = (modules: Module[], completedModules: number[]) => {\n    if (!modules.length) return new Set<number>();\n    \n    // Sort modules by creation order (assuming ID order represents learning sequence)\n    const sortedModules = [...modules].sort((a, b) => a.id - b.id);\n    const unlockedModules = new Set<number>();\n    \n    // First module is always unlocked\n    if (sortedModules.length > 0) {\n      unlockedModules.add(sortedModules[0].id);\n    }\n    \n    // Unlock subsequent modules if previous ones are completed\n    for (let i = 1; i < sortedModules.length; i++) {\n      const previousModule = sortedModules[i - 1];\n      if (completedModules.includes(previousModule.id)) {\n        unlockedModules.add(sortedModules[i].id);\n      }\n    }\n    \n    return unlockedModules;\n  };\n\n  const completedModules = user?.completedModules || [];\n  const unlockedModules = getUnlockedModules(modules, completedModules);\n\n  if (!user) return null;\n\n  return (\n    <div className=\"flex min-h-screen bg-student-warm\">\n      <div className=\"hidden lg:block lg:w-64 lg:flex-shrink-0\">\n        <div className=\"sticky top-0 h-screen overflow-y-auto\">\n          <Sidebar user={user} />\n        </div>\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user}\n      />\n      \n      <main className=\"flex-1 overflow-auto\">\n        <header className=\"bg-student-warm shadow-sm p-4 lg:hidden\">\n          <button \n            onClick={() => setIsMobileNavOpen(true)}\n            className=\"p-2 rounded-lg hover:bg-neutral-100\"\n          >\n            <Menu size={24} />\n          </button>\n        </header>\n\n        <div className=\"p-6\">\n          <div className=\"mb-8\">\n            <div className=\"flex items-center space-x-4 mb-4\">\n              {subjectId && (\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={navigateBackToSubjects}\n                  className=\"flex items-center space-x-2\"\n                >\n                  <ArrowLeft size={16} />\n                  <span>Vissza a tant√°rgyakhoz</span>\n                </Button>\n              )}\n            </div>\n            <h1 className=\"text-3xl font-bold text-neutral-800 mb-2\">\n              {subject?.name ? `${subject.name} - Modulok` : 'Tananyagok'}\n            </h1>\n            <p className=\"text-neutral-600\">B√∂ng√©szd √°t az el√©rhet≈ë tananyagokat √©s kezdj tanulni!</p>\n          </div>\n\n          {modulesLoading ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {[1, 2, 3].map((i) => (\n                <Card key={i} className=\"animate-pulse\">\n                  <CardHeader>\n                    <div className=\"h-4 bg-neutral-200 rounded w-3/4 mb-2\"></div>\n                    <div className=\"h-3 bg-neutral-200 rounded w-1/2\"></div>\n                  </CardHeader>\n                  <CardContent>\n                    <div className=\"h-20 bg-neutral-200 rounded mb-4\"></div>\n                    <div className=\"h-8 bg-neutral-200 rounded\"></div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : modules.length > 0 ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {modules.map((module: Module) => (\n                <ModuleCard \n                  key={module.id} \n                  module={module} \n                  isCompleted={user.completedModules?.includes(module.id) || false}\n                  userRole={user.role || 'student'}\n                  isUnlocked={user.role === 'admin' || unlockedModules.has(module.id)}\n                />\n              ))}\n            </div>\n          ) : (\n            <Card className=\"p-8 text-center\">\n              <BookOpen className=\"mx-auto h-12 w-12 text-neutral-400 mb-4\" />\n              <h3 className=\"text-lg font-semibold text-neutral-800 mb-2\">M√©g nincsenek tananyagok</h3>\n              <p className=\"text-neutral-600\">Hamarosan √∫j tananyagokat adunk hozz√°. K√©rj√ºk, l√°togass vissza k√©s≈ëbb!</p>\n            </Card>\n          )}\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":6234},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/pages/platform-info.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Brain, \n  MessageSquare, \n  BookOpen, \n  Mic, \n  Volume2, \n  CheckCircle, \n  Star, \n  Users, \n  Clock, \n  ArrowRight, \n  Lightbulb,\n  Target,\n  TrendingUp,\n  Headphones\n} from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function PlatformInfo() {\n  const { user } = useAuth();\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700\">\n      {/* Dekorat√≠v h√°tt√©r elemek */}\n      <div className=\"absolute inset-0 overflow-hidden\">\n        <div className=\"absolute -top-40 -right-40 w-80 h-80 rounded-full bg-gradient-to-br from-blue-400/20 to-purple-400/20 blur-3xl\"></div>\n        <div className=\"absolute -bottom-40 -left-40 w-80 h-80 rounded-full bg-gradient-to-br from-green-400/20 to-blue-400/20 blur-3xl\"></div>\n      </div>\n\n      <div className=\"relative z-10 container mx-auto px-4 py-12\">\n        {/* F≈ëc√≠m szekci√≥ */}\n        <div className=\"text-center mb-16\">\n          <div className=\"inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white mb-8\">\n            <Brain className=\"h-10 w-10\" />\n          </div>\n          <h1 className=\"text-6xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent mb-6\">\n            Global Learning System\n          </h1>\n          <p className=\"text-2xl text-gray-600 dark:text-gray-300 max-w-4xl mx-auto leading-relaxed mb-8\">\n            Intelligens AI-alap√∫ tanul√°si platform, amely szem√©lyre szabott oktat√°si √©lm√©nyt ny√∫jt \n            modern technol√≥gi√°k seg√≠ts√©g√©vel\n          </p>\n          <div className=\"flex items-center justify-center gap-3\">\n            <Badge variant=\"secondary\" className=\"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300 px-4 py-2\">\n              <Star className=\"h-4 w-4 mr-2 fill-current\" />\n              AI-vez√©relt tanul√°s\n            </Badge>\n            <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300 px-4 py-2\">\n              <Users className=\"h-4 w-4 mr-2\" />\n              Szak√©rt≈ë tan√°rok\n            </Badge>\n            <Badge variant=\"secondary\" className=\"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300 px-4 py-2\">\n              <TrendingUp className=\"h-4 w-4 mr-2\" />\n              Adapt√≠v rendszer\n            </Badge>\n          </div>\n        </div>\n\n        {/* AI k√©pess√©gek szekci√≥ */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-4xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Mesters√©ges Intelligencia K√©pess√©gek\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\n            <Card className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-xl transition-all duration-300\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 text-white flex items-center justify-center mb-4\">\n                  <MessageSquare className=\"h-6 w-6\" />\n                </div>\n                <CardTitle className=\"text-xl\">Intelligens Chat Asszisztens</CardTitle>\n                <CardDescription>\n                  24/7 el√©rhet≈ë AI tan√°r, aki azonnal v√°laszol a k√©rd√©seidre √©s szem√©lyre szabott magyar√°zatokat ad\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                  <li className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    Azonnali v√°laszok b√°rmilyen szakmai k√©rd√©sre\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    Szem√©lyre szabott magyar√°zatok\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    Kontextus-alap√∫ seg√≠ts√©gny√∫jt√°s\n                  </li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-xl transition-all duration-300\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 text-white flex items-center justify-center mb-4\">\n                  <Headphones className=\"h-6 w-6\" />\n                </div>\n                <CardTitle className=\"text-xl\">Hangalap√∫ Interakci√≥</CardTitle>\n                <CardDescription>\n                  Besz√©lj az AI-jal term√©szetes m√≥don - k√©rdezz hang√ºzenettel √©s hallgasd meg a v√°laszokat\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                  <li className=\"flex items-center gap-2\">\n                    <Mic className=\"h-4 w-4 text-blue-500\" />\n                    Hang√ºzenetek k√ºld√©se\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Volume2 className=\"h-4 w-4 text-blue-500\" />\n                    AI v√°laszok meghallgat√°sa\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <Brain className=\"h-4 w-4 text-blue-500\" />\n                    Term√©szetes besz√©dfelismer√©s\n                  </li>\n                </ul>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg hover:shadow-xl transition-all duration-300\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-green-500 to-teal-500 text-white flex items-center justify-center mb-4\">\n                  <Target className=\"h-6 w-6\" />\n                </div>\n                <CardTitle className=\"text-xl\">Automatikus Kv√≠zek</CardTitle>\n                <CardDescription>\n                  AI-gener√°lt kv√≠zek, amelyek automatikusan √©rt√©kelik a tud√°sodat √©s visszajelz√©st adnak\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <ul className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                  <li className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    Automatikus k√©rd√©s gener√°l√°s\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    Azonnali √©rt√©kel√©s √©s visszajelz√©s\n                  </li>\n                  <li className=\"flex items-center gap-2\">\n                    <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                    88% k√ºsz√∂b alap√∫ modul befejez√©s\n                  </li>\n                </ul>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Platform funkci√≥k */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-4xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Platform Funkci√≥k\n          </h2>\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n            <Card className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 text-white flex items-center justify-center mb-4\">\n                  <BookOpen className=\"h-6 w-6\" />\n                </div>\n                <CardTitle className=\"text-2xl\">Hierarchikus Tananyag Rendszer</CardTitle>\n                <CardDescription className=\"text-lg\">\n                  J√≥l struktur√°lt tanul√°si √∫tvonal szakm√°kt√≥l a modulokig\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n                  <h4 className=\"font-semibold mb-2\">üìö Szakmacsoport</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">V√°laszd ki az √©rdekel szakm√°dat</p>\n                </div>\n                <div className=\"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n                  <h4 className=\"font-semibold mb-2\">üìñ Tant√°rgyak</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">R√©szletes tant√°rgyak minden szakm√°hoz</p>\n                </div>\n                <div className=\"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n                  <h4 className=\"font-semibold mb-2\">üéØ Modulok</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">Kisebb, k√∂nnyen em√©szthet≈ë tanul√°si egys√©gek</p>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg\">\n              <CardHeader>\n                <div className=\"w-12 h-12 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-500 text-white flex items-center justify-center mb-4\">\n                  <Lightbulb className=\"h-6 w-6\" />\n                </div>\n                <CardTitle className=\"text-2xl\">Szem√©lyre Szabott Tanul√°s</CardTitle>\n                <CardDescription className=\"text-lg\">\n                  AI-alap√∫ adapt√≠v rendszer, amely a te temp√≥dhoz igazodik\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                  <TrendingUp className=\"h-5 w-5 text-blue-600\" />\n                  <span className=\"text-sm\">Halad√°s k√∂vet√©s √©s statisztik√°k</span>\n                </div>\n                <div className=\"flex items-center gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                  <Target className=\"h-5 w-5 text-green-600\" />\n                  <span className=\"text-sm\">Szem√©lyre szabott tanul√°si c√©lok</span>\n                </div>\n                <div className=\"flex items-center gap-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n                  <Brain className=\"h-5 w-5 text-purple-600\" />\n                  <span className=\"text-sm\">Adapt√≠v neh√©zs√©gi szint</span>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Hogyan m≈±k√∂dik szekci√≥ */}\n        <div className=\"mb-16\">\n          <h2 className=\"text-4xl font-bold text-center text-gray-900 dark:text-white mb-12\">\n            Hogyan M≈±k√∂dik?\n          </h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-8\">\n            {[\n              {\n                step: \"1\",\n                title: \"Regisztr√°ci√≥\",\n                description: \"Hozd l√©tre a fi√≥kodat √©s v√°laszd ki a szakm√°dat\",\n                icon: Users,\n                color: \"from-blue-500 to-cyan-500\"\n              },\n              {\n                step: \"2\", \n                title: \"Tananyag B√∂ng√©sz√©s\",\n                description: \"Fedezd fel a tant√°rgyakat √©s modulokat\",\n                icon: BookOpen,\n                color: \"from-green-500 to-teal-500\"\n              },\n              {\n                step: \"3\",\n                title: \"AI-val Tanul√°s\", \n                description: \"Haszn√°ld a chat asszisztenst √©s hangfunkci√≥kat\",\n                icon: Brain,\n                color: \"from-purple-500 to-pink-500\"\n              },\n              {\n                step: \"4\",\n                title: \"Halad√°s K√∂vet√©s\",\n                description: \"K√∂vesd nyomon az eredm√©nyeidet √©s teljes√≠tm√©nyedet\",\n                icon: TrendingUp,\n                color: \"from-orange-500 to-red-500\"\n              }\n            ].map((item, index) => (\n              <Card key={index} className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-0 shadow-lg text-center\">\n                <CardHeader>\n                  <div className={`w-16 h-16 rounded-full bg-gradient-to-br ${item.color} text-white flex items-center justify-center mx-auto mb-4`}>\n                    <item.icon className=\"h-8 w-8\" />\n                  </div>\n                  <div className=\"text-3xl font-bold text-gray-400 dark:text-gray-500 mb-2\">\n                    {item.step}\n                  </div>\n                  <CardTitle className=\"text-lg\">{item.title}</CardTitle>\n                  <CardDescription>{item.description}</CardDescription>\n                </CardHeader>\n              </Card>\n            ))}\n          </div>\n        </div>\n\n        {/* CTA szekci√≥ */}\n        <div className=\"text-center\">\n          <div className=\"inline-flex flex-col items-center gap-6 p-8 bg-white/60 dark:bg-gray-800/60 backdrop-blur-sm rounded-3xl border border-gray-200/50 dark:border-gray-700/50\">\n            <h3 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n              K√©szen √°llsz a tanul√°sra?\n            </h3>\n            <p className=\"text-lg text-gray-600 dark:text-gray-300 max-w-md\">\n              V√°laszd ki a szakm√°dat √©s kezdd el a szem√©lyre szabott tanul√°si utadat AI t√°mogat√°ssal\n            </p>\n            <Link href=\"/profession-selection\">\n              <Button size=\"lg\" className=\"bg-gradient-to-r from-blue-500 to-purple-600 hover:shadow-lg transition-all duration-300 text-lg px-8 py-4\">\n                <ArrowRight className=\"h-5 w-5 mr-2\" />\n                Szakma Kiv√°laszt√°sa\n              </Button>\n            </Link>\n            <div className=\"flex items-center gap-4 text-sm text-gray-500 dark:text-gray-400\">\n              <div className=\"flex items-center gap-1\">\n                <Clock className=\"h-4 w-4\" />\n                <span>2 perc alatt kezdhetsz</span>\n              </div>\n              <div className=\"flex items-center gap-1\">\n                <CheckCircle className=\"h-4 w-4 text-green-500\" />\n                <span>Ingyenes regisztr√°ci√≥</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":14756},"client/src/pages/profession-selection.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Loader2, BookOpen, Users, Clock, GraduationCap, Star, ArrowRight, Wrench, HardHat, Zap, Lightbulb } from \"lucide-react\";\nimport { queryClient, apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link, useLocation } from \"wouter\";\n\nexport default function ProfessionSelection() {\n  const { user } = useAuth();\n  const { toast } = useToast();\n  const [, setLocation] = useLocation();\n\n  const { data: professions, isLoading } = useQuery<any[]>({\n    queryKey: [\"/api/public/professions\"],\n  });\n\n  const selectProfessionMutation = useMutation({\n    mutationFn: async (professionId: number) => {\n      await apiRequest(\"PUT\", \"/api/user/profession\", { professionId });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      toast({\n        title: \"Szakma kiv√°lasztva\",\n        description: \"Sikeresen kiv√°lasztottad a szakm√°dat.\",\n      });\n      // Use requestAnimationFrame to avoid setState during render\n      requestAnimationFrame(() => {\n        setLocation(\"/home\");\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <Loader2 className=\"h-8 w-8 animate-spin\" />\n      </div>\n    );\n  }\n\n  // Ha m√°r van kiv√°lasztott szakma, √°tir√°ny√≠t√°s a tanul√°shoz\n  if (user?.selectedProfessionId) {\n    setLocation(\"/learning\");\n    return null;\n  }\n\n  // K√ºl√∂nb√∂z≈ë ikonok a szakm√°khoz\n  const getProfessionIcon = (professionName: string) => {\n    const name = professionName.toLowerCase();\n    if (name.includes('hegeszt≈ë') || name.includes('f√©m')) return Zap;\n    if (name.includes('√©p√≠t≈ë') || name.includes('√©p√ºlet')) return HardHat;\n    if (name.includes('szerel≈ë') || name.includes('g√©p')) return Wrench;\n    return GraduationCap;\n  };\n\n  const getProfessionGradient = (index: number) => {\n    const gradients = [\n      'from-blue-500 to-cyan-500',\n      'from-purple-500 to-pink-500',\n      'from-green-500 to-teal-500',\n      'from-orange-500 to-red-500',\n      'from-indigo-500 to-purple-500',\n      'from-yellow-500 to-orange-500',\n    ];\n    return gradients[index % gradients.length];\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-700\">\n      {/* Dekorat√≠v h√°tt√©r elemek */}\n      <div className=\"absolute inset-0 overflow-hidden\">\n        <div className=\"absolute -top-40 -right-40 w-80 h-80 rounded-full bg-gradient-to-br from-blue-400/20 to-purple-400/20 blur-3xl\"></div>\n        <div className=\"absolute -bottom-40 -left-40 w-80 h-80 rounded-full bg-gradient-to-br from-green-400/20 to-blue-400/20 blur-3xl\"></div>\n      </div>\n\n      <div className=\"relative z-10 container mx-auto px-4 py-12\">\n        {/* Fejl√©c szekci√≥ */}\n        <div className=\"text-center mb-12\">\n          <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-gradient-to-r from-blue-500 to-purple-600 text-white mb-6\">\n            <GraduationCap className=\"h-8 w-8\" />\n          </div>\n          <h1 className=\"text-5xl font-bold bg-gradient-to-r from-gray-900 to-gray-600 dark:from-white dark:to-gray-300 bg-clip-text text-transparent mb-4\">\n            V√°laszd ki a szakm√°d\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300 max-w-2xl mx-auto leading-relaxed\">\n            Kezdd el a tanul√°si utadat a v√°lasztott szakm√°dban. Minden szakma egyedi tananyagokkal √©s gyakorlati feladatokkal v√°r.\n          </p>\n          <div className=\"flex items-center justify-center gap-2 mt-4\">\n            <Star className=\"h-4 w-4 text-yellow-500 fill-current\" />\n            <span className=\"text-sm text-gray-500 dark:text-gray-400\">Szak√©rt≈ë tan√°rok √°ltal k√©sz√≠tett tananyagok</span>\n          </div>\n        </div>\n\n        {/* Szakm√°k r√°cs */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 max-w-7xl mx-auto\">\n          {professions?.map((profession: any, index: number) => {\n            const IconComponent = getProfessionIcon(profession.name);\n            const gradientClass = getProfessionGradient(index);\n            \n            return (\n              <Card \n                key={profession.id} \n                className=\"group hover:shadow-2xl transition-all duration-300 cursor-pointer border-0 bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm hover:scale-105 relative overflow-hidden\"\n              >\n                {/* Gradiens h√°tt√©r */}\n                <div className={`absolute inset-0 bg-gradient-to-br ${gradientClass} opacity-0 group-hover:opacity-10 transition-opacity duration-300`}></div>\n                \n                <CardHeader className=\"relative pb-3\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className={`inline-flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br ${gradientClass} text-white shadow-lg`}>\n                      <IconComponent className=\"h-6 w-6\" />\n                    </div>\n                    <Badge variant=\"secondary\" className=\"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\">\n                      <Clock className=\"h-3 w-3 mr-1\" />\n                      El√©rhet≈ë\n                    </Badge>\n                  </div>\n                  <CardTitle className=\"text-xl font-bold text-gray-900 dark:text-white group-hover:text-transparent group-hover:bg-gradient-to-r group-hover:from-blue-600 group-hover:to-purple-600 group-hover:bg-clip-text transition-all duration-300\">\n                    {profession.name}\n                  </CardTitle>\n                  <CardDescription className=\"text-gray-600 dark:text-gray-300 leading-relaxed\">\n                    {profession.description}\n                  </CardDescription>\n                </CardHeader>\n                \n                <CardContent className=\"relative pt-0\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400\">\n                      <Users className=\"h-4 w-4\" />\n                      <span>Szakmai k√©pz√©s</span>\n                    </div>\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400\">\n                      <BookOpen className=\"h-4 w-4\" />\n                      <span>Modulok</span>\n                    </div>\n                  </div>\n                  \n                  <Button \n                    onClick={() => selectProfessionMutation.mutate(profession.id)}\n                    disabled={selectProfessionMutation.isPending}\n                    className={`w-full bg-gradient-to-r ${gradientClass} hover:shadow-lg transition-all duration-300 text-white border-0 group-hover:scale-105`}\n                  >\n                    {selectProfessionMutation.isPending ? (\n                      <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                    ) : (\n                      <ArrowRight className=\"h-4 w-4 mr-2 transition-transform group-hover:translate-x-1\" />\n                    )}\n                    Kiv√°laszt√°s √©s indul√°s\n                  </Button>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* Als√≥ szekci√≥ */}\n        <div className=\"text-center mt-16\">\n          <div className=\"inline-flex items-center gap-4 p-4 bg-white/60 dark:bg-gray-800/60 backdrop-blur-sm rounded-2xl border border-gray-200/50 dark:border-gray-700/50\">\n            <Link href=\"/platform-info\">\n              <Button variant=\"outline\" className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700\">\n                <Lightbulb className=\"h-4 w-4 mr-2\" />\n                Platform Inform√°ci√≥k\n              </Button>\n            </Link>\n            <Link href=\"/settings\">\n              <Button variant=\"outline\" className=\"bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700\">\n                Be√°ll√≠t√°sok\n              </Button>\n            </Link>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":8830},"client/src/pages/progress.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport ProgressCard from \"@/components/progress-card\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { BookOpen, Clock, TrendingUp, Award, Menu } from \"lucide-react\";\nimport type { Module } from \"@shared/schema\";\n\nexport default function ProgressPage() {\n  const { user } = useAuth();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n\n  const { data: modules = [] } = useQuery({\n    queryKey: ['/api/modules'],\n    retry: false,\n  });\n\n  if (!user) return null;\n\n  const completedModules = user.completedModules?.length || 0;\n  const totalModules = modules.length || 0;\n  const progressPercentage = totalModules > 0 ? (completedModules / totalModules) * 100 : 0;\n\n  return (\n    <div className=\"min-h-screen bg-student-warm flex\">\n      <div className=\"hidden lg:block\">\n        <Sidebar user={user} />\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user}\n      />\n      \n      <main className=\"flex-1 lg:ml-0\">\n        <header className=\"bg-student-warm shadow-sm p-4 lg:hidden\">\n          <button \n            onClick={() => setIsMobileNavOpen(true)}\n            className=\"p-2 rounded-lg hover:bg-neutral-100\"\n          >\n            <Menu size={24} />\n          </button>\n        </header>\n\n        <div className=\"p-6\">\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl font-bold text-neutral-800 mb-2\">Tanulm√°nyi El≈ërehalad√°s</h1>\n            <p className=\"text-neutral-600\">K√∂vesd nyomon a tanul√°si eredm√©nyeidet √©s halad√°sodat.</p>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n            <ProgressCard\n              title=\"Befejezett Modulok\"\n              value={completedModules}\n              subtitle={`${totalModules} modulb√≥l`}\n              icon={BookOpen}\n              color=\"primary\"\n            />\n            <ProgressCard\n              title=\"Teljes√≠t√©s\"\n              value={Math.round(progressPercentage)}\n              subtitle=\"sz√°zal√©k\"\n              icon={TrendingUp}\n              color=\"secondary\"\n            />\n            <ProgressCard\n              title=\"Tanulm√°nyi Id≈ë\"\n              value={completedModules * 30}\n              subtitle=\"perc\"\n              icon={Clock}\n              color=\"accent\"\n            />\n            <ProgressCard\n              title=\"Szerzett Pontok\"\n              value={completedModules * 100}\n              subtitle=\"pont\"\n              icon={Award}\n              color=\"primary\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>√Åltal√°nos Halad√°s</CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div>\n                    <div className=\"flex justify-between mb-2\">\n                      <span className=\"text-sm font-medium\">Teljes El≈ërehalad√°s</span>\n                      <span className=\"text-sm text-neutral-600\">{Math.round(progressPercentage)}%</span>\n                    </div>\n                    <Progress value={progressPercentage} className=\"h-2\" />\n                  </div>\n                  <div className=\"text-sm text-neutral-600\">\n                    {completedModules} / {totalModules} modul befejezve\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle>Legut√≥bbi Aktivit√°s</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {completedModules > 0 ? (\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-2 h-2 bg-green-500 rounded-full\"></div>\n                      <span className=\"text-sm\">Modul befejezve</span>\n                      <span className=\"text-xs text-neutral-500 ml-auto\">Ma</span>\n                    </div>\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-2 h-2 bg-blue-500 rounded-full\"></div>\n                      <span className=\"text-sm\">√öj tananyag elkezdve</span>\n                      <span className=\"text-xs text-neutral-500 ml-auto\">Tegnap</span>\n                    </div>\n                  </div>\n                ) : (\n                  <p className=\"text-neutral-600 text-sm\">M√©g nincs tanulm√°nyi aktivit√°s. Kezdj el egy modult a tanul√°s megkezd√©s√©hez!</p>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":5045},"client/src/pages/school-admin-auth.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { School, Eye, EyeOff } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\nconst loginSchema = z.object({\n  username: z.string().min(1, \"Felhaszn√°l√≥n√©v sz√ºks√©ges\"),\n  password: z.string().min(1, \"Jelsz√≥ sz√ºks√©ges\"),\n});\n\ntype LoginForm = z.infer<typeof loginSchema>;\n\nexport default function SchoolAdminAuth() {\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n\n  const form = useForm<LoginForm>({\n    resolver: zodResolver(loginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n  const onSubmit = async (data: LoginForm) => {\n    setIsLoading(true);\n    try {\n      const response = await fetch(\"/api/school-admin/login\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(data),\n      });\n\n      if (response.ok) {\n        const result = await response.json();\n        toast({\n          title: \"Sikeres bejelentkez√©s\",\n          description: \"√údv√∂z√∂lj√ºk az iskolai admin fel√ºleten!\",\n        });\n        navigate(\"/school-admin-dashboard\");\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Bejelentkez√©si hiba\",\n          description: error.message || \"Helytelen felhaszn√°l√≥n√©v vagy jelsz√≥\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md shadow-2xl border-0 bg-white/90 backdrop-blur-sm\">\n        <CardHeader className=\"text-center space-y-4\">\n          <div className=\"w-20 h-20 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-2xl flex items-center justify-center mx-auto shadow-lg\">\n            <School size={40} className=\"text-white\" />\n          </div>\n          <CardTitle className=\"text-2xl font-bold text-gray-800\">\n            Iskolai Admin Bejelentkez√©s\n          </CardTitle>\n          <CardDescription className=\"text-gray-600\">\n            Jelentkezzen be az iskolai adminisztr√°ci√≥s fel√ºletre\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <Form {...form}>\n            <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-6\">\n              <FormField\n                control={form.control}\n                name=\"username\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-700 font-medium\">Felhaszn√°l√≥n√©v</FormLabel>\n                    <FormControl>\n                      <Input\n                        {...field}\n                        placeholder=\"Adja meg a felhaszn√°l√≥nev√©t\"\n                        className=\"h-12 border-gray-200 focus:border-blue-500 focus:ring-blue-500\"\n                        disabled={isLoading}\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n              \n              <FormField\n                control={form.control}\n                name=\"password\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-gray-700 font-medium\">Jelsz√≥</FormLabel>\n                    <FormControl>\n                      <div className=\"relative\">\n                        <Input\n                          {...field}\n                          type={showPassword ? \"text\" : \"password\"}\n                          placeholder=\"Adja meg a jelszav√°t\"\n                          className=\"h-12 border-gray-200 focus:border-blue-500 focus:ring-blue-500 pr-12\"\n                          disabled={isLoading}\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          className=\"absolute right-2 top-1/2 -translate-y-1/2 h-8 w-8 p-0 hover:bg-gray-100\"\n                          onClick={() => setShowPassword(!showPassword)}\n                          disabled={isLoading}\n                        >\n                          {showPassword ? (\n                            <EyeOff size={16} className=\"text-gray-500\" />\n                          ) : (\n                            <Eye size={16} className=\"text-gray-500\" />\n                          )}\n                        </Button>\n                      </div>\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <Button\n                type=\"submit\"\n                className=\"w-full h-12 bg-gradient-to-r from-blue-600 to-indigo-700 hover:from-blue-700 hover:to-indigo-800 text-white font-medium shadow-lg\"\n                disabled={isLoading}\n              >\n                {isLoading ? (\n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\n                    <span>Bejelentkez√©s...</span>\n                  </div>\n                ) : (\n                  \"Bejelentkez√©s\"\n                )}\n              </Button>\n            </form>\n          </Form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":6177},"client/src/pages/school-admin-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { School, Users, UserCheck, Search, LogOut, UserPlus, GraduationCap, Plus, Info, Edit, Save, X } from \"lucide-react\";\nimport { useLocation } from \"wouter\";\n\n// CreateClassForm komponens az oszt√°lyok l√©trehoz√°s√°hoz\nfunction CreateClassForm({ professions, onSuccess }: { professions: Profession[], onSuccess: () => void }) {\n  const [formData, setFormData] = useState({\n    name: \"\",\n    description: \"\",\n    professionId: \"\"\n  });\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsSubmitting(true);\n\n    try {\n      const response = await fetch(\"/api/school-admin/classes\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          name: formData.name,\n          description: formData.description || null,\n          professionId: formData.professionId && formData.professionId !== \"0\" ? parseInt(formData.professionId) : null\n        }),\n      });\n\n      if (response.ok) {\n        onSuccess();\n        setFormData({ name: \"\", description: \"\", professionId: \"\" });\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: errorData.message || \"Nem siker√ºlt l√©trehozni az oszt√°lyt\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      <div>\n        <Label htmlFor=\"class-name\">Oszt√°ly neve</Label>\n        <Input\n          id=\"class-name\"\n          value={formData.name}\n          onChange={(e) => setFormData({ ...formData, name: e.target.value })}\n          placeholder=\"pl. 9.A, Hegeszt≈ë 2024\"\n          required\n        />\n      </div>\n      <div>\n        <Label htmlFor=\"class-description\">Le√≠r√°s (opcion√°lis)</Label>\n        <Input\n          id=\"class-description\"\n          value={formData.description}\n          onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n          placeholder=\"Oszt√°ly le√≠r√°sa\"\n        />\n      </div>\n      <div>\n        <Label htmlFor=\"class-profession\">Szakma kiv√°laszt√°sa</Label>\n        <Select value={formData.professionId} onValueChange={(value) => setFormData({ ...formData, professionId: value })}>\n          <SelectTrigger>\n            <SelectValue placeholder=\"V√°lasszon szakm√°t\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"0\">Nincs szakma</SelectItem>\n            {professions.map((profession) => (\n              <SelectItem key={profession.id} value={profession.id.toString()}>\n                {profession.name}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n      <div className=\"flex justify-end space-x-2\">\n        <Button type=\"submit\" disabled={isSubmitting}>\n          {isSubmitting ? \"L√©trehoz√°s...\" : \"Oszt√°ly l√©trehoz√°sa\"}\n        </Button>\n      </div>\n    </form>\n  );\n}\n\ninterface Student {\n  id: string;\n  username: string;\n  firstName?: string;\n  lastName?: string;\n  email?: string;\n  assignedTeacherId?: string;\n  classId?: number;\n}\n\ninterface Teacher {\n  id: string;\n  username: string;\n  firstName?: string;\n  lastName?: string;\n  email?: string;\n}\n\ninterface Class {\n  id: number;\n  name: string;\n  description?: string;\n  schoolAdminId: string;\n  assignedTeacherId?: string;\n  professionId?: number;\n  createdAt: string;\n  updatedAt: string;\n}\n\ninterface Profession {\n  id: number;\n  name: string;\n  description?: string;\n}\n\nexport default function SchoolAdminDashboard() {\n  const [students, setStudents] = useState<Student[]>([]);\n  const [teachers, setTeachers] = useState<Teacher[]>([]);\n  const [classes, setClasses] = useState<Class[]>([]);\n  const [professions, setProfessions] = useState<Profession[]>([]);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [selectedTeacher, setSelectedTeacher] = useState<string>(\"\");\n  const [isLoading, setIsLoading] = useState(true);\n  const [editingClass, setEditingClass] = useState<number | null>(null);\n  const [managingStudents, setManagingStudents] = useState<number | null>(null);\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n\n  // Regisztr√°ci√≥s state v√°ltoz√≥k\n  const [isTeacherDialogOpen, setIsTeacherDialogOpen] = useState(false);\n  const [isStudentDialogOpen, setIsStudentDialogOpen] = useState(false);\n  const [teacherForm, setTeacherForm] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    username: \"\",\n    email: \"\",\n    password: \"\"\n  });\n  const [studentForm, setStudentForm] = useState({\n    firstName: \"\",\n    lastName: \"\",\n    username: \"\",\n    email: \"\",\n    password: \"\"\n  });\n\n  useEffect(() => {\n    fetchData();\n  }, []);\n\n  const fetchData = async () => {\n    try {\n      const [studentsResponse, teachersResponse, classesResponse, professionsResponse] = await Promise.all([\n        fetch(\"/api/school-admin/students\", { credentials: 'include' }),\n        fetch(\"/api/school-admin/teachers\", { credentials: 'include' }),\n        fetch(\"/api/school-admin/classes\", { credentials: 'include' }),\n        fetch(\"/api/professions\", { credentials: 'include' })\n      ]);\n\n      if (studentsResponse.ok && teachersResponse.ok && classesResponse.ok && professionsResponse.ok) {\n        const studentsData = await studentsResponse.json();\n        const teachersData = await teachersResponse.json();\n        const classesData = await classesResponse.json();\n        const professionsData = await professionsResponse.json();\n        \n        setStudents(studentsData);\n        setTeachers(teachersData);\n        setClasses(classesData);\n        setProfessions(professionsData);\n      } else {\n        toast({\n          title: \"Hiba\",\n          description: \"Nem siker√ºlt bet√∂lteni az adatokat\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const assignStudentToTeacher = async (studentId: string, teacherId: string) => {\n    try {\n      const response = await fetch(\"/api/school-admin/assign-student\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ studentId, teacherId }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Sikeres hozz√°rendel√©s\",\n          description: \"A tanul√≥ sikeresen hozz√° lett rendelve a tan√°rhoz\",\n        });\n        fetchData(); // Friss√≠tj√ºk az adatokat\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: error.message || \"Nem siker√ºlt a hozz√°rendel√©s\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const removeStudentFromTeacher = async (studentId: string) => {\n    try {\n      const response = await fetch(\"/api/school-admin/remove-student\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ studentId }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Sikeres elt√°vol√≠t√°s\",\n          description: \"A tanul√≥ el lett t√°vol√≠tva a tan√°rt√≥l\",\n        });\n        fetchData(); // Friss√≠tj√ºk az adatokat\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: error.message || \"Nem siker√ºlt az elt√°vol√≠t√°s\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const getTeacherName = (teacherId?: string) => {\n    if (!teacherId) return \"Nincs hozz√°rendelve\";\n    const teacher = teachers.find(t => t.id === teacherId);\n    if (!teacher) return \"Ismeretlen tan√°r\";\n    return teacher.firstName && teacher.lastName \n      ? `${teacher.firstName} ${teacher.lastName}` \n      : teacher.username;\n  };\n\n  const getProfessionName = (professionId?: number) => {\n    if (!professionId) return \"Nincs szakma\";\n    const profession = professions.find(p => p.id === professionId);\n    return profession ? profession.name : \"Ismeretlen szakma\";\n  };\n\n  const assignProfessionToClass = async (classId: number, professionId: number) => {\n    try {\n      const response = await fetch(`/api/school-admin/classes/${classId}/assign-profession`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: 'include',\n        body: JSON.stringify({ professionId }),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Siker\",\n          description: \"Szakma sikeresen hozz√°rendelve az oszt√°lyhoz √©s a di√°kokhoz\",\n        });\n        fetchData();\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: errorData.message || \"Nem siker√ºlt hozz√°rendelni a szakm√°t\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const assignTeacherToClass = async (classId: number, teacherId: string) => {\n    try {\n      const response = await fetch(`/api/school-admin/classes/${classId}/assign-teacher`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: 'include',\n        body: JSON.stringify({ teacherId: teacherId || null }),\n      });\n\n      if (response.ok) {\n        fetchData();\n        toast({\n          title: \"Siker\",\n          description: \"Tan√°r sikeresen hozz√°rendelve az oszt√°lyhoz\",\n        });\n        setEditingClass(null);\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: errorData.message || \"Nem siker√ºlt hozz√°rendelni a tan√°rt\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const addStudentToClass = async (classId: number, studentId: string) => {\n    try {\n      const response = await fetch(`/api/school-admin/classes/${classId}/add-student`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: 'include',\n        body: JSON.stringify({ studentId }),\n      });\n\n      if (response.ok) {\n        fetchData();\n        toast({\n          title: \"Siker\",\n          description: \"Di√°k sikeresen hozz√°adva az oszt√°lyhoz\",\n        });\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: errorData.message || \"Nem siker√ºlt hozz√°adni a di√°kot\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const removeStudentFromClass = async (classId: number, studentId: string) => {\n    try {\n      const response = await fetch(`/api/school-admin/classes/${classId}/remove-student`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        credentials: 'include',\n        body: JSON.stringify({ studentId }),\n      });\n\n      if (response.ok) {\n        fetchData();\n        toast({\n          title: \"Siker\",\n          description: \"Di√°k sikeresen elt√°vol√≠tva az oszt√°lyb√≥l\",\n        });\n      } else {\n        const errorData = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: errorData.message || \"Nem siker√ºlt elt√°vol√≠tani a di√°kot\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const handleLogout = async () => {\n    try {\n      const response = await fetch(\"/api/school-admin/logout\", { \n        method: \"GET\",\n        credentials: 'include'\n      });\n      \n      if (response.ok) {\n        toast({\n          title: \"Sikeres kijelentkez√©s\",\n          description: \"Sikeresen kijelentkezt√©l a rendszerb≈ël\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    } finally {\n      // Always navigate regardless of response status\n      navigate(\"/school-admin-auth\");\n    }\n  };\n\n  // Tan√°r regisztr√°ci√≥s funkci√≥\n  const registerTeacher = async () => {\n    try {\n      const response = await fetch(\"/api/school-admin/register-teacher\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(teacherForm),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Sikeres regisztr√°ci√≥\",\n          description: \"A tan√°r sikeresen regisztr√°lva lett\",\n        });\n        setTeacherForm({\n          firstName: \"\",\n          lastName: \"\",\n          username: \"\",\n          email: \"\",\n          password: \"\"\n        });\n        setIsTeacherDialogOpen(false);\n        fetchData(); // Friss√≠tj√ºk az adatokat\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: error.message || \"Nem siker√ºlt a regisztr√°ci√≥\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  // Di√°k regisztr√°ci√≥s funkci√≥\n  const registerStudent = async () => {\n    try {\n      const response = await fetch(\"/api/school-admin/register-student\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify(studentForm),\n      });\n\n      if (response.ok) {\n        toast({\n          title: \"Sikeres regisztr√°ci√≥\",\n          description: \"A di√°k sikeresen regisztr√°lva lett\",\n        });\n        setStudentForm({\n          firstName: \"\",\n          lastName: \"\",\n          username: \"\",\n          email: \"\",\n          password: \"\"\n        });\n        setIsStudentDialogOpen(false);\n        fetchData(); // Friss√≠tj√ºk az adatokat\n      } else {\n        const error = await response.json();\n        toast({\n          title: \"Hiba\",\n          description: error.message || \"Nem siker√ºlt a regisztr√°ci√≥\",\n          variant: \"destructive\",\n        });\n      }\n    } catch (error) {\n      toast({\n        title: \"Hiba\",\n        description: \"H√°l√≥zati hiba t√∂rt√©nt\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n\n\n  const filteredStudents = students.filter(student => {\n    const searchLower = searchTerm.toLowerCase();\n    const fullName = `${student.firstName || \"\"} ${student.lastName || \"\"}`.trim();\n    \n    const matchesSearch = searchTerm === \"\" || (\n      student.username.toLowerCase().includes(searchLower) ||\n      fullName.toLowerCase().includes(searchLower) ||\n      (student.email && student.email.toLowerCase().includes(searchLower))\n    );\n    \n    const matchesTeacher = selectedTeacher === \"all\" || selectedTeacher === \"\" || student.assignedTeacherId === selectedTeacher;\n    \n    return matchesSearch && matchesTeacher;\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 flex items-center justify-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50\">\n      <header className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between items-center py-6\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-700 rounded-xl flex items-center justify-center\">\n                <School size={24} className=\"text-white\" />\n              </div>\n              <div>\n                <h1 className=\"text-2xl font-bold text-gray-900\">Iskolai Admin Panel</h1>\n                <p className=\"text-gray-600\">Tanul√≥k √©s tan√°rok kezel√©se</p>\n              </div>\n            </div>\n            <Button \n              variant=\"outline\" \n              onClick={handleLogout}\n              className=\"flex items-center space-x-2\"\n            >\n              <LogOut size={16} />\n              <span>Kijelentkez√©s</span>\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {/* Statisztik√°k */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">√ñsszes tanul√≥</CardTitle>\n              <Users size={16} className=\"text-blue-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{students.length}</div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">√ñsszes tan√°r</CardTitle>\n              <UserCheck size={16} className=\"text-green-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">{teachers.length}</div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-sm font-medium\">Hozz√°rendelt tanul√≥k</CardTitle>\n              <UserCheck size={16} className=\"text-purple-600\" />\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-2xl font-bold\">\n                {students.filter(s => s.assignedTeacherId).length}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Tab rendszer */}\n        <Tabs defaultValue=\"assignments\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"assignments\">Hozz√°rendel√©sek</TabsTrigger>\n            <TabsTrigger value=\"register-teacher\">Tan√°r regisztr√°ci√≥</TabsTrigger>\n            <TabsTrigger value=\"register-student\">Di√°k regisztr√°ci√≥</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"assignments\">\n            {/* Oszt√°lyok √©s hozz√°rendel√©sek */}\n            <Card className=\"mb-6\">\n              <CardHeader>\n                <CardTitle>Oszt√°lyok kezel√©se</CardTitle>\n                <CardDescription>\n                  Hozzon l√©tre oszt√°lyokat √©s rendeljen hozz√°juk tan√°rokat √©s di√°kokat\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"flex flex-col sm:flex-row gap-4 mb-4\">\n                  <Dialog>\n                    <DialogTrigger asChild>\n                      <Button className=\"flex items-center space-x-2\">\n                        <Plus size={16} />\n                        <span>√öj oszt√°ly l√©trehoz√°sa</span>\n                      </Button>\n                    </DialogTrigger>\n                    <DialogContent>\n                      <DialogHeader>\n                        <DialogTitle>√öj oszt√°ly l√©trehoz√°sa</DialogTitle>\n                        <DialogDescription>\n                          Hozzon l√©tre egy √∫j oszt√°lyt a di√°kok szervez√©s√©hez √©s szakma hozz√°rendel√©s√©hez.\n                        </DialogDescription>\n                      </DialogHeader>\n                      <CreateClassForm \n                        professions={professions}\n                        onSuccess={() => {\n                          fetchData();\n                          toast({\n                            title: \"Siker\",\n                            description: \"Oszt√°ly sikeresen l√©trehozva\",\n                          });\n                        }}\n                      />\n                    </DialogContent>\n                  </Dialog>\n                </div>\n                <div className=\"text-sm text-gray-600 mb-4\">\n                  Jelenleg csak a saj√°t iskol√°j√°hoz tartoz√≥ di√°kok √©s tan√°rok l√°that√≥k.\n                </div>\n                \n                {/* Oszt√°lyok list√°ja */}\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold mb-3\">L√©trehozott oszt√°lyok ({classes.length})</h3>\n                  {classes.length > 0 ? (\n                    <div className=\"grid gap-4\">\n                      {classes.map((classItem) => (\n                        <div key={classItem.id} className=\"border rounded-lg p-4 bg-gray-50\">\n                          <div className=\"flex justify-between items-start\">\n                            <div>\n                              <h4 className=\"font-medium text-lg\">{classItem.name}</h4>\n                              {classItem.description && (\n                                <p className=\"text-sm text-gray-600 mt-1\">{classItem.description}</p>\n                              )}\n                              <div className=\"flex items-center space-x-4 mt-2\">\n                                {classItem.professionId ? (\n                                  <Badge variant=\"default\">\n                                    Szakma: {getProfessionName(classItem.professionId)}\n                                  </Badge>\n                                ) : (\n                                  <Badge variant=\"outline\">Nincs szakma</Badge>\n                                )}\n                                {classItem.assignedTeacherId && (\n                                  <Badge variant=\"secondary\">\n                                    Tan√°r: {getTeacherName(classItem.assignedTeacherId)}\n                                  </Badge>\n                                )}\n                              </div>\n                            </div>\n                            <div className=\"flex space-x-2\">\n                              {editingClass === classItem.id ? (\n                                <div className=\"flex space-x-2\">\n                                  <Select onValueChange={(professionId) => assignProfessionToClass(classItem.id, parseInt(professionId))}>\n                                    <SelectTrigger className=\"w-48\">\n                                      <SelectValue placeholder=\"Szakma m√≥dos√≠t√°sa\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"0\">Nincs szakma</SelectItem>\n                                      {professions.map((profession) => (\n                                        <SelectItem key={profession.id} value={profession.id.toString()}>\n                                          {profession.name}\n                                        </SelectItem>\n                                      ))}\n                                    </SelectContent>\n                                  </Select>\n                                  <Select onValueChange={(teacherId) => assignTeacherToClass(classItem.id, teacherId)}>\n                                    <SelectTrigger className=\"w-48\">\n                                      <SelectValue placeholder=\"Tan√°r m√≥dos√≠t√°sa\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"none\">Nincs tan√°r</SelectItem>\n                                      {teachers.map((teacher) => (\n                                        <SelectItem key={teacher.id} value={teacher.id}>\n                                          {teacher.firstName} {teacher.lastName}\n                                        </SelectItem>\n                                      ))}\n                                    </SelectContent>\n                                  </Select>\n                                  <Button size=\"sm\" onClick={() => setEditingClass(null)}>\n                                    <Save size={16} />\n                                  </Button>\n                                </div>\n                              ) : (\n                                <div className=\"flex space-x-2\">\n                                  {!classItem.professionId && (\n                                    <Select onValueChange={(professionId) => assignProfessionToClass(classItem.id, parseInt(professionId))}>\n                                      <SelectTrigger className=\"w-48\">\n                                        <SelectValue placeholder=\"Szakma hozz√°rendel√©se\" />\n                                      </SelectTrigger>\n                                      <SelectContent>\n                                        {professions.map((profession) => (\n                                          <SelectItem key={profession.id} value={profession.id.toString()}>\n                                            {profession.name}\n                                          </SelectItem>\n                                        ))}\n                                      </SelectContent>\n                                    </Select>\n                                  )}\n                                  {!classItem.assignedTeacherId && (\n                                    <Select onValueChange={(teacherId) => assignTeacherToClass(classItem.id, teacherId)}>\n                                      <SelectTrigger className=\"w-48\">\n                                        <SelectValue placeholder=\"Tan√°r hozz√°rendel√©se\" />\n                                      </SelectTrigger>\n                                      <SelectContent>\n                                        {teachers.map((teacher) => (\n                                          <SelectItem key={teacher.id} value={teacher.id}>\n                                            {teacher.firstName} {teacher.lastName}\n                                          </SelectItem>\n                                        ))}\n                                      </SelectContent>\n                                    </Select>\n                                  )}\n                                  <Button \n                                    size=\"sm\" \n                                    variant=\"outline\" \n                                    onClick={() => setEditingClass(classItem.id)}\n                                  >\n                                    <Edit size={16} />\n                                  </Button>\n                                  <Button \n                                    size=\"sm\" \n                                    variant=\"secondary\" \n                                    onClick={() => setManagingStudents(classItem.id)}\n                                  >\n                                    <Users size={16} />\n                                  </Button>\n                                </div>\n                              )}\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  ) : (\n                    <div className=\"text-center py-8 text-gray-500\">\n                      M√©g nincsenek oszt√°lyok l√©trehozva.\n                    </div>\n                  )}\n                </div>\n                <div className=\"flex flex-col sm:flex-row gap-4\">\n                  <div className=\"relative flex-1\">\n                    <Search size={16} className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400\" />\n                    <Input\n                      placeholder=\"Keres√©s n√©v, felhaszn√°l√≥n√©v vagy email alapj√°n...\"\n                      value={searchTerm}\n                      onChange={(e) => setSearchTerm(e.target.value)}\n                      className=\"pl-10\"\n                    />\n                  </div>\n                  <Select value={selectedTeacher} onValueChange={setSelectedTeacher}>\n                    <SelectTrigger className=\"w-full sm:w-64\">\n                      <SelectValue placeholder=\"Sz≈±r√©s tan√°r szerint\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"all\">√ñsszes tan√°r</SelectItem>\n                      {teachers.map((teacher) => (\n                        <SelectItem key={teacher.id} value={teacher.id}>\n                          {getTeacherName(teacher.id)}\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              </CardContent>\n            </Card>\n\n        {/* Tanul√≥k list√°ja */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Tanul√≥k ({filteredStudents.length})</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4\">\n                <div className=\"flex items-center space-x-2\">\n                  <Info size={16} className=\"text-blue-600\" />\n                  <p className=\"text-sm text-blue-800\">\n                    Csak az √ñn iskol√°j√°hoz tartoz√≥ di√°kok √©s tan√°rok l√°that√≥k. Az adatok elk√ºl√∂n√≠tve vannak t√°rolva.\n                  </p>\n                </div>\n              </div>\n              \n              {filteredStudents.map((student) => (\n                <div\n                  key={student.id}\n                  className=\"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50\"\n                >\n                  <div className=\"flex-1\">\n                    <h3 className=\"font-medium text-gray-900\">\n                      {`${student.firstName || \"\"} ${student.lastName || \"\"}`.trim() || student.username}\n                    </h3>\n                    <p className=\"text-sm text-gray-500\">@{student.username}</p>\n                    {student.email && (\n                      <p className=\"text-sm text-gray-500\">{student.email}</p>\n                    )}\n                    <div className=\"flex items-center space-x-2 mt-2\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        Saj√°t iskola\n                      </Badge>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-4\">\n                    {student.assignedTeacherId ? (\n                      <div className=\"flex items-center space-x-2\">\n                        <Badge variant=\"secondary\">\n                          {getTeacherName(student.assignedTeacherId)}\n                        </Badge>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={() => removeStudentFromTeacher(student.id)}\n                        >\n                          Elt√°vol√≠t√°s\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center space-x-2\">\n                        <Select\n                          onValueChange={(teacherId) => assignStudentToTeacher(student.id, teacherId)}\n                        >\n                          <SelectTrigger className=\"w-48\">\n                            <SelectValue placeholder=\"Tan√°r kiv√°laszt√°sa\" />\n                          </SelectTrigger>\n                          <SelectContent>\n                            {teachers.map((teacher) => (\n                              <SelectItem key={teacher.id} value={teacher.id}>\n                                {getTeacherName(teacher.id)}\n                              </SelectItem>\n                            ))}\n                          </SelectContent>\n                        </Select>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              ))}\n              \n              {filteredStudents.length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  {searchTerm || selectedTeacher !== 'all' \n                    ? 'Nem tal√°lhat√≥ tanul√≥ a keres√©si felt√©teleknek megfelel≈ëen' \n                    : 'M√©g nincsenek tanul√≥k regisztr√°lva az √ñn iskol√°j√°hoz'}\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n          </TabsContent>\n\n          {/* Tan√°r regisztr√°ci√≥ tab */}\n          <TabsContent value=\"register-teacher\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <GraduationCap size={20} />\n                  <span>√öj tan√°r regisztr√°l√°sa</span>\n                </CardTitle>\n                <CardDescription>\n                  Hozzon l√©tre √∫j tan√°r fi√≥kot az iskol√°ban\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"teacher-firstName\">Keresztn√©v</Label>\n                    <Input\n                      id=\"teacher-firstName\"\n                      value={teacherForm.firstName}\n                      onChange={(e) => setTeacherForm({...teacherForm, firstName: e.target.value})}\n                      placeholder=\"Keresztn√©v\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"teacher-lastName\">Vezet√©kn√©v</Label>\n                    <Input\n                      id=\"teacher-lastName\"\n                      value={teacherForm.lastName}\n                      onChange={(e) => setTeacherForm({...teacherForm, lastName: e.target.value})}\n                      placeholder=\"Vezet√©kn√©v\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"teacher-username\">Felhaszn√°l√≥n√©v</Label>\n                    <Input\n                      id=\"teacher-username\"\n                      value={teacherForm.username}\n                      onChange={(e) => setTeacherForm({...teacherForm, username: e.target.value})}\n                      placeholder=\"Felhaszn√°l√≥n√©v\"\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"teacher-email\">Email (opcion√°lis)</Label>\n                    <Input\n                      id=\"teacher-email\"\n                      type=\"email\"\n                      value={teacherForm.email}\n                      onChange={(e) => setTeacherForm({...teacherForm, email: e.target.value})}\n                      placeholder=\"email@example.com\"\n                    />\n                  </div>\n                  <div className=\"md:col-span-2\">\n                    <Label htmlFor=\"teacher-password\">Jelsz√≥</Label>\n                    <Input\n                      id=\"teacher-password\"\n                      type=\"password\"\n                      value={teacherForm.password}\n                      onChange={(e) => setTeacherForm({...teacherForm, password: e.target.value})}\n                      placeholder=\"Minimum 6 karakter\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div className=\"flex justify-end mt-6\">\n                  <Button \n                    onClick={registerTeacher}\n                    disabled={!teacherForm.username || !teacherForm.password || teacherForm.password.length < 6}\n                    className=\"flex items-center space-x-2\"\n                  >\n                    <UserPlus size={16} />\n                    <span>Tan√°r regisztr√°l√°sa</span>\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          {/* Di√°k regisztr√°ci√≥ tab */}\n          <TabsContent value=\"register-student\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Users size={20} />\n                  <span>√öj di√°k regisztr√°l√°sa</span>\n                </CardTitle>\n                <CardDescription>\n                  Hozzon l√©tre √∫j di√°k fi√≥kot az iskol√°ban\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label htmlFor=\"student-firstName\">Keresztn√©v</Label>\n                    <Input\n                      id=\"student-firstName\"\n                      value={studentForm.firstName}\n                      onChange={(e) => setStudentForm({...studentForm, firstName: e.target.value})}\n                      placeholder=\"Keresztn√©v\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"student-lastName\">Vezet√©kn√©v</Label>\n                    <Input\n                      id=\"student-lastName\"\n                      value={studentForm.lastName}\n                      onChange={(e) => setStudentForm({...studentForm, lastName: e.target.value})}\n                      placeholder=\"Vezet√©kn√©v\"\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"student-username\">Felhaszn√°l√≥n√©v</Label>\n                    <Input\n                      id=\"student-username\"\n                      value={studentForm.username}\n                      onChange={(e) => setStudentForm({...studentForm, username: e.target.value})}\n                      placeholder=\"Felhaszn√°l√≥n√©v\"\n                      required\n                    />\n                  </div>\n                  <div>\n                    <Label htmlFor=\"student-email\">Email (opcion√°lis)</Label>\n                    <Input\n                      id=\"student-email\"\n                      type=\"email\"\n                      value={studentForm.email}\n                      onChange={(e) => setStudentForm({...studentForm, email: e.target.value})}\n                      placeholder=\"email@example.com\"\n                    />\n                  </div>\n                  <div className=\"md:col-span-2\">\n                    <Label htmlFor=\"student-password\">Jelsz√≥</Label>\n                    <Input\n                      id=\"student-password\"\n                      type=\"password\"\n                      value={studentForm.password}\n                      onChange={(e) => setStudentForm({...studentForm, password: e.target.value})}\n                      placeholder=\"Minimum 6 karakter\"\n                      required\n                    />\n                  </div>\n                </div>\n                <div className=\"flex justify-end mt-6\">\n                  <Button \n                    onClick={registerStudent}\n                    disabled={!studentForm.username || !studentForm.password || studentForm.password.length < 6}\n                    className=\"flex items-center space-x-2\"\n                  >\n                    <UserPlus size={16} />\n                    <span>Di√°k regisztr√°l√°sa</span>\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </main>\n\n      {/* Di√°k kezel√©s modal */}\n      {managingStudents && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-6\">\n              <h2 className=\"text-2xl font-bold\">Di√°kok kezel√©se - {classes.find(c => c.id === managingStudents)?.name}</h2>\n              <Button \n                variant=\"outline\" \n                onClick={() => setManagingStudents(null)}\n              >\n                Bez√°r√°s\n              </Button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Oszt√°lyban l√©v≈ë di√°kok */}\n              <div>\n                <h3 className=\"text-lg font-semibold mb-4\">Oszt√°lyban l√©v≈ë di√°kok</h3>\n                <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n                  {students\n                    .filter(student => student.classId === managingStudents)\n                    .map(student => (\n                      <div key={student.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                        <div>\n                          <p className=\"font-medium\">{student.firstName} {student.lastName}</p>\n                          <p className=\"text-sm text-gray-600\">{student.username}</p>\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          onClick={() => removeStudentFromClass(managingStudents, student.id)}\n                        >\n                          Elt√°vol√≠t√°s\n                        </Button>\n                      </div>\n                    ))}\n                  {students.filter(student => student.classId === managingStudents).length === 0 && (\n                    <p className=\"text-gray-500 text-center py-4\">Nincsenek di√°kok az oszt√°lyban</p>\n                  )}\n                </div>\n              </div>\n\n              {/* El√©rhet≈ë di√°kok */}\n              <div>\n                <h3 className=\"text-lg font-semibold mb-4\">El√©rhet≈ë di√°kok</h3>\n                <div className=\"space-y-2 max-h-96 overflow-y-auto\">\n                  {students\n                    .filter(student => !student.classId || student.classId !== managingStudents)\n                    .map(student => (\n                      <div key={student.id} className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\">\n                        <div>\n                          <p className=\"font-medium\">{student.firstName} {student.lastName}</p>\n                          <p className=\"text-sm text-gray-600\">{student.username}</p>\n                          {student.classId && (\n                            <p className=\"text-xs text-orange-600\">\n                              M√°r m√°sik oszt√°lyban: {classes.find(c => c.id === student.classId)?.name}\n                            </p>\n                          )}\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant=\"default\"\n                          onClick={() => addStudentToClass(managingStudents, student.id)}\n                        >\n                          Hozz√°ad√°s\n                        </Button>\n                      </div>\n                    ))}\n                  {students.filter(student => !student.classId || student.classId !== managingStudents).length === 0 && (\n                    <p className=\"text-gray-500 text-center py-4\">Nincsenek el√©rhet≈ë di√°kok</p>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":44963},"client/src/pages/settings.tsx":{"content":"import { useState } from \"react\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Settings as SettingsIcon, User, Bell, Shield, Menu } from \"lucide-react\";\n\nexport default function SettingsPage() {\n  const { user } = useAuth();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n\n  if (!user) return null;\n\n  const handleLogout = () => {\n    window.location.href = \"/api/logout\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-student-warm flex\">\n      <div className=\"hidden lg:block\">\n        <Sidebar user={user} />\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user}\n      />\n      \n      <main className=\"flex-1 lg:ml-0\">\n        <header className=\"bg-student-warm shadow-sm p-4 lg:hidden\">\n          <button \n            onClick={() => setIsMobileNavOpen(true)}\n            className=\"p-2 rounded-lg hover:bg-neutral-100\"\n          >\n            <Menu size={24} />\n          </button>\n        </header>\n\n        <div className=\"p-6\">\n          <div className=\"mb-8\">\n            <h1 className=\"text-3xl font-bold text-neutral-800 mb-2\">Be√°ll√≠t√°sok</h1>\n            <p className=\"text-neutral-600\">Kezelje a fi√≥kj√°t √©s az alkalmaz√°s be√°ll√≠t√°sait.</p>\n          </div>\n\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <User size={20} />\n                  <span>Profil Inform√°ci√≥k</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"flex items-center space-x-4\">\n                  <Avatar className=\"h-16 w-16\">\n                    <AvatarImage src={user.profileImageUrl || undefined} />\n                    <AvatarFallback>\n                      {user.firstName?.[0]}{user.lastName?.[0]}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div>\n                    <h3 className=\"font-semibold\">{user.firstName} {user.lastName}</h3>\n                    <p className=\"text-sm text-neutral-600\">{user.email}</p>\n                    <p className=\"text-xs text-neutral-500 capitalize\">{user.role}</p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Bell size={20} />\n                  <span>√ârtes√≠t√©sek</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">√öj tananyag √©rtes√≠t√©sek</span>\n                    <Button variant=\"outline\" size=\"sm\">Bekapcsolva</Button>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">AI tan√°r v√°laszok</span>\n                    <Button variant=\"outline\" size=\"sm\">Bekapcsolva</Button>\n                  </div>\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm\">Halad√°s eml√©keztet≈ëk</span>\n                    <Button variant=\"outline\" size=\"sm\">Kikapcsolva</Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <Shield size={20} />\n                  <span>Biztons√°g</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"text-sm text-neutral-600\">\n                  A fi√≥kja Replit Auth √°ltal v√©dett, amely biztons√°gos hiteles√≠t√©st biztos√≠t.\n                </div>\n                <Button \n                  variant=\"destructive\" \n                  onClick={handleLogout}\n                  className=\"w-full\"\n                >\n                  Kijelentkez√©s\n                </Button>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center space-x-2\">\n                  <SettingsIcon size={20} />\n                  <span>Alkalmaz√°s Be√°ll√≠t√°sok</span>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-3\">\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm\">S√∂t√©t t√©ma</span>\n                  <Button variant=\"outline\" size=\"sm\">Kikapcsolva</Button>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm\">Nyelv</span>\n                  <Button variant=\"outline\" size=\"sm\">Magyar</Button>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span className=\"text-sm\">Automatikus ment√©s</span>\n                  <Button variant=\"outline\" size=\"sm\">Bekapcsolva</Button>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":5728},"client/src/pages/student-auth.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Loader2, User, Globe } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { localUserLoginSchema } from \"@shared/schema\";\nimport { signInWithGoogle, handleGoogleRedirect, isFirebaseEnabled } from \"@/lib/firebase\";\nimport AnimatedSection from \"@/components/animated-section\";\nimport loginBackground from \"@/assets/login-background.svg\";\nimport type { z } from \"zod\";\n\ntype LoginFormData = z.infer<typeof localUserLoginSchema>;\n\nexport default function StudentAuth() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const [isLoading, setIsLoading] = useState(false);\n\n  const loginForm = useForm<LoginFormData>({\n    resolver: zodResolver(localUserLoginSchema),\n    defaultValues: {\n      username: \"\",\n      password: \"\",\n    },\n  });\n\n\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: LoginFormData) => {\n      const response = await apiRequest('POST', '/api/auth/login', data);\n      return await response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      toast({\n        title: \"Sikeres bejelentkez√©s\",\n        description: \"√údv√∂z√∂lj√ºk a Global Learning System-ben!\",\n      });\n      setLocation(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Bejelentkez√©si hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n\n\n  // Handle Firebase redirect on page load\n  useEffect(() => {\n    const handleFirebaseRedirect = async () => {\n      try {\n        const result = await handleGoogleRedirect();\n        if (result?.user) {\n          // User signed in with Google, create or login user on backend\n          const userData = {\n            id: result.user.uid,\n            email: result.user.email,\n            firstName: result.user.displayName?.split(' ')[0] || '',\n            lastName: result.user.displayName?.split(' ')[1] || '',\n            profileImageUrl: result.user.photoURL,\n            authType: 'google'\n          };\n          \n          // Send to backend to create/login user\n          const response = await apiRequest('POST', '/api/auth/google-login', userData);\n          const user = await response.json();\n          \n          queryClient.setQueryData(['/api/auth/user'], user);\n          toast({\n            title: \"Sikeres bejelentkez√©s\",\n            description: \"√údv√∂z√∂lj√ºk a Global Learning System-ben!\",\n          });\n          setLocation(\"/\");\n        }\n      } catch (error: any) {\n        console.error('Firebase redirect error:', error);\n        toast({\n          title: \"Bejelentkez√©si hiba\",\n          description: \"Google bejelentkez√©s sikertelen\",\n          variant: \"destructive\",\n        });\n      }\n    };\n\n    handleFirebaseRedirect();\n  }, []);\n\n  const handleGoogleLogin = async () => {\n    try {\n      setIsLoading(true);\n      await signInWithGoogle();\n    } catch (error: any) {\n      setIsLoading(false);\n      toast({\n        title: \"Google bejelentkez√©si hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const onLoginSubmit = (data: LoginFormData) => {\n    loginMutation.mutate(data);\n  };\n\n\n\n  return (\n    <div \n      className=\"min-h-screen bg-student-warm flex items-center justify-center p-4 animate-slide-up relative\"\n    >\n      {/* Overlay for better text readability */}\n      <div className=\"absolute inset-0 bg-black/20 backdrop-blur-[1px]\"></div>\n      <div className=\"w-full max-w-4xl relative z-10\">\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {/* Hero Section */}\n          <AnimatedSection animation=\"fade-left\" delay={200}>\n            <div className=\"flex flex-col justify-center space-y-6\">\n              <div>\n                <h1 className=\"responsive-heading text-4xl font-bold text-white mb-4 drop-shadow-lg\">\n                  Global Learning System\n                </h1>\n                <p className=\"responsive-text text-lg text-white/90 mb-6 drop-shadow-md\">\n                  AI-alap√∫ szem√©lyre szabott tanul√°si √©lm√©ny. Csatlakozz √©s fejleszd k√©szs√©geidet intelligens oktat√°si rendszer√ºnkkel.\n                </p>\n              </div>\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-2 h-2 bg-green-400 rounded-full shadow-lg\"></div>\n                  <span className=\"text-white/90 drop-shadow-md\">AI-gener√°lt k√©rd√©sek √©s √©rt√©kel√©s</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-2 h-2 bg-blue-400 rounded-full shadow-lg\"></div>\n                  <span className=\"text-white/90 drop-shadow-md\">Hangos magyar√°zatok √©s interakt√≠v chat</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <div className=\"w-2 h-2 bg-purple-400 rounded-full shadow-lg\"></div>\n                  <span className=\"text-white/90 drop-shadow-md\">Szakm√°k √©s modulok struktur√°lt tanul√°sa</span>\n                </div>\n              </div>\n            </div>\n          </AnimatedSection>\n\n          {/* Auth Section */}\n          <div className=\"flex items-center justify-center\">\n            <Card className=\"w-full max-w-md\">\n              <CardHeader className=\"text-center\">\n                <CardTitle className=\"text-2xl\">Bejelentkez√©s</CardTitle>\n                <CardDescription>\n                  V√°lassz bejelentkez√©si m√≥dot a folytat√°shoz\n                </CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  {/* Google Login - csak ha Firebase be van √°ll√≠tva */}\n                  {isFirebaseEnabled() && (\n                    <Button\n                      onClick={handleGoogleLogin}\n                      disabled={isLoading}\n                      className=\"w-full bg-blue-600 hover:bg-blue-700\"\n                      size=\"lg\"\n                    >\n                      {isLoading ? (\n                        <>\n                          <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                          √Åtir√°ny√≠t√°s...\n                        </>\n                      ) : (\n                        <>\n                          <svg className=\"mr-2 h-4 w-4\" viewBox=\"0 0 24 24\">\n                            <path fill=\"currentColor\" d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\"/>\n                            <path fill=\"currentColor\" d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\"/>\n                            <path fill=\"currentColor\" d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\"/>\n                            <path fill=\"currentColor\" d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\"/>\n                          </svg>\n                          Bejelentkez√©s Google-lel\n                        </>\n                      )}\n                    </Button>\n                  )}\n\n                  <div className=\"relative\">\n                    <div className=\"absolute inset-0 flex items-center\">\n                      <Separator className=\"w-full\" />\n                    </div>\n                    <div className=\"relative flex justify-center text-xs uppercase\">\n                      <span className=\"bg-background px-2 text-muted-foreground\">\n                        Vagy\n                      </span>\n                    </div>\n                  </div>\n\n                  {/* Csak bejelentkez√©s - regisztr√°ci√≥t az iskolai admin kezeli */}\n                  <div className=\"w-full\">\n                    <div className=\"text-center mb-4\">\n                      <div className=\"inline-flex items-center justify-center w-full p-2 border rounded-lg bg-muted\">\n                        <User className=\"mr-2 h-4 w-4\" />\n                        <span>Bejelentkez√©s</span>\n                      </div>\n                      <p className=\"text-xs text-gray-500 mt-2\">\n                        √öj tanul√≥k regisztr√°ci√≥j√°t az iskolai admin kezeli\n                      </p>\n                    </div>\n\n                    <div className=\"space-y-4\">\n                      <Form {...loginForm}>\n                        <form onSubmit={loginForm.handleSubmit(onLoginSubmit)} className=\"space-y-4\">\n                          <FormField\n                            control={loginForm.control}\n                            name=\"username\"\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Felhaszn√°l√≥n√©v</FormLabel>\n                                <FormControl>\n                                  <Input placeholder=\"felhaszn√°l√≥n√©v\" {...field} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          <FormField\n                            control={loginForm.control}\n                            name=\"password\"\n                            render={({ field }) => (\n                              <FormItem>\n                                <FormLabel>Jelsz√≥</FormLabel>\n                                <FormControl>\n                                  <Input type=\"password\" placeholder=\"jelsz√≥\" {...field} />\n                                </FormControl>\n                                <FormMessage />\n                              </FormItem>\n                            )}\n                          />\n                          <Button\n                            type=\"submit\"\n                            className=\"w-full\"\n                            disabled={loginMutation.isPending}\n                          >\n                            {loginMutation.isPending ? (\n                              <>\n                                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                                Bejelentkez√©s...\n                              </>\n                            ) : (\n                              'Bejelentkez√©s'\n                            )}\n                          </Button>\n                        </form>\n                      </Form>\n                    </div>\n\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":11488},"client/src/pages/student-dashboard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { isUnauthorizedError } from \"@/lib/authUtils\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport ChatInterface from \"@/components/chat-interface\";\nimport ModuleCard from \"@/components/module-card\";\nimport ProgressCard from \"@/components/progress-card\";\nimport DynamicBackground from \"@/components/dynamic-background\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { BookOpen, Clock, MessageSquare, Menu } from \"lucide-react\";\nimport type { Module } from \"@shared/schema\";\n\nexport default function StudentDashboard() {\n  const { user, isAuthenticated, isLoading } = useAuth();\n  const { toast } = useToast();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n\n  const { data: modules = [], isLoading: modulesLoading } = useQuery<Module[]>({\n    queryKey: ['/api/public/modules'],\n    queryFn: async () => {\n      const response = await fetch('/api/public/modules');\n      if (!response.ok) throw new Error('Failed to fetch modules');\n      return response.json();\n    },\n    retry: false,\n  });\n\n  // Redirect to home if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      toast({\n        title: \"Unauthorized\",\n        description: \"You are logged out. Logging in again...\",\n        variant: \"destructive\",\n      });\n      setTimeout(() => {\n        window.location.href = \"/api/login\";\n      }, 500);\n      return;\n    }\n  }, [isAuthenticated, isLoading, toast]);\n\n  if (isLoading || !user) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4\"></div>\n          <p className=\"text-neutral-600\">Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Calculate which modules are unlocked based on completed modules\n  const getUnlockedModules = (modules: Module[], completedModules: number[]) => {\n    if (!modules.length) return new Set<number>();\n    \n    // Sort modules by creation order (assuming ID order represents learning sequence)\n    const sortedModules = [...modules].sort((a, b) => a.id - b.id);\n    const unlockedModules = new Set<number>();\n    \n    // First module is always unlocked\n    if (sortedModules.length > 0) {\n      unlockedModules.add(sortedModules[0].id);\n    }\n    \n    // Unlock subsequent modules if previous ones are completed\n    for (let i = 1; i < sortedModules.length; i++) {\n      const previousModule = sortedModules[i - 1];\n      if (completedModules.includes(previousModule.id)) {\n        unlockedModules.add(sortedModules[i].id);\n      }\n    }\n    \n    return unlockedModules;\n  };\n\n  const completedModules = user.completedModules || [];\n  const unlockedModules = getUnlockedModules(modules, completedModules);\n  const totalModules = modules.length;\n  const overallProgress = totalModules > 0 ? Math.round((completedModules.length / totalModules) * 100) : 0;\n\n  return (\n    <div className=\"flex min-h-screen bg-neutral-50 relative\">\n      <DynamicBackground />\n      {/* Desktop Sidebar */}\n      <div className=\"hidden lg:block\">\n        <Sidebar user={user} />\n      </div>\n\n      {/* Mobile Navigation */}\n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)}\n        user={user}\n      />\n\n      {/* Main Content */}\n      <div className=\"flex-1 flex flex-col\">\n        {/* Mobile Header */}\n        <header className=\"bg-white shadow-sm border-b border-neutral-100 lg:hidden\">\n          <div className=\"flex items-center justify-between p-4\">\n            <button \n              onClick={() => setIsMobileNavOpen(true)}\n              className=\"text-neutral-700\"\n            >\n              <Menu size={24} />\n            </button>\n            <h1 className=\"text-lg font-semibold text-neutral-700\">Global Learning System</h1>\n            <div className=\"w-6\"></div>\n          </div>\n        </header>\n\n        {/* Main Content Area */}\n        <main className=\"flex-1 p-4 lg:p-8\">\n          {/* Welcome Section */}\n          <div className=\"mb-8\">\n            <h2 className=\"text-2xl lg:text-3xl font-bold text-neutral-700 mb-2\">\n              √údv√∂zl√ºnk, {user.firstName || user.email}!\n            </h2>\n            <p className=\"text-neutral-400\">Folytasd a tanul√°st ott, ahol abbahagytad</p>\n          </div>\n\n          {/* Progress Overview */}\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n            <ProgressCard\n              title=\"Befejezett modulok\"\n              value={completedModules.length}\n              subtitle={`${totalModules}-b≈ël`}\n              icon={BookOpen}\n              color=\"secondary\"\n            />\n            <ProgressCard\n              title=\"Tanul√°si id≈ë\"\n              value={Math.floor(completedModules.length * 2.5)}\n              subtitle=\"√≥ra √∂sszesen\"\n              icon={Clock}\n              color=\"accent\"\n            />\n            <ProgressCard\n              title=\"AI besz√©lget√©sek\"\n              value={42}\n              subtitle=\"√ºzenet\"\n              icon={MessageSquare}\n              color=\"primary\"\n            />\n          </div>\n\n          {/* Overall Progress */}\n          <Card className=\"mb-8\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-xl font-semibold text-neutral-700\">\n                  √Åltal√°nos halad√°s\n                </CardTitle>\n                <span className=\"text-lg font-semibold text-primary\">\n                  {overallProgress}%\n                </span>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <Progress value={overallProgress} className=\"mb-3\" />\n              <p className=\"text-sm text-neutral-400\">\n                {completedModules.length} modul a {totalModules}-b≈ël teljes√≠tve\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* Modules Grid */}\n          <div className=\"mb-8\">\n            <div className=\"flex items-center justify-between mb-6\">\n              <h3 className=\"text-xl font-semibold text-neutral-700\">El√©rhet≈ë modulok</h3>\n            </div>\n\n            {modulesLoading ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {[...Array(6)].map((_, i) => (\n                  <div key={i} className=\"bg-white rounded-xl p-6 animate-pulse\">\n                    <div className=\"h-48 bg-neutral-200 rounded-lg mb-4\"></div>\n                    <div className=\"h-4 bg-neutral-200 rounded mb-2\"></div>\n                    <div className=\"h-3 bg-neutral-200 rounded mb-4\"></div>\n                    <div className=\"h-3 bg-neutral-200 rounded w-1/2\"></div>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {modules.map((module: Module) => (\n                  <ModuleCard\n                    key={module.id}\n                    module={module}\n                    isCompleted={completedModules.includes(module.id)}\n                    userRole=\"student\"\n                    isUnlocked={unlockedModules.has(module.id)}\n                  />\n                ))}\n              </div>\n            )}\n          </div>\n\n          {/* AI Tutor Section */}\n          <ChatInterface userId={user.id} />\n        </main>\n      </div>\n    </div>\n  );\n}\n","size_bytes":7776},"client/src/pages/subjects.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { BookOpen, Menu, ArrowRight } from \"lucide-react\";\nimport type { Subject } from \"@shared/schema\";\n\nexport default function SubjectsPage() {\n  const { user } = useAuth();\n  const [, navigate] = useLocation();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n\n  const { data: subjects = [], isLoading: subjectsLoading } = useQuery({\n    queryKey: ['/api/public/subjects', user?.selectedProfessionId],\n    queryFn: async () => {\n      if (!user?.selectedProfessionId) return [];\n      const params = new URLSearchParams({ professionId: user.selectedProfessionId.toString() });\n      const response = await fetch(`/api/public/subjects?${params}`);\n      if (!response.ok) throw new Error('Failed to fetch subjects');\n      return response.json();\n    },\n    retry: false,\n    enabled: !!user?.selectedProfessionId,\n  });\n\n  if (!user) return null;\n\n  const handleSubjectSelect = (subjectId: number) => {\n    navigate(`/subjects/${subjectId}/modules`);\n  };\n\n  return (\n    <div className=\"flex min-h-screen bg-student-warm\">\n      <div className=\"hidden lg:block lg:w-64 lg:flex-shrink-0\">\n        <div className=\"sticky top-0 h-screen overflow-y-auto\">\n          <Sidebar user={user} />\n        </div>\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user} \n      />\n      \n      <div className=\"flex-1 overflow-auto\">\n        <header className=\"bg-student-warm shadow-sm border-b border-neutral-100\">\n          <div className=\"flex items-center justify-between px-6 py-4\">\n            <div className=\"flex items-center space-x-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMobileNavOpen(true)}\n                className=\"lg:hidden\"\n              >\n                <Menu size={20} />\n              </Button>\n              <div>\n                <h1 className=\"text-2xl font-bold text-neutral-800\">Tant√°rgyak</h1>\n                <p className=\"text-neutral-600\">V√°lassza ki a tanulni k√≠v√°nt tant√°rgyat</p>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"p-6\">\n          {subjectsLoading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n              {subjects.map((subject: Subject) => (\n                <Card \n                  key={subject.id}\n                  className=\"hover:shadow-lg transition-shadow cursor-pointer\"\n                  onClick={() => handleSubjectSelect(subject.id)}\n                >\n                  <CardHeader className=\"pb-3\">\n                    <div className=\"flex items-center space-x-3\">\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-primary to-blue-700 rounded-lg flex items-center justify-center\">\n                        <BookOpen className=\"text-white\" size={24} />\n                      </div>\n                      <div className=\"flex-1\">\n                        <CardTitle className=\"text-lg\">{subject.name}</CardTitle>\n                      </div>\n                      <ArrowRight className=\"text-neutral-400\" size={20} />\n                    </div>\n                  </CardHeader>\n                  \n                  <CardContent>\n                    {subject.description && (\n                      <p className=\"text-neutral-600 text-sm mb-4\">{subject.description}</p>\n                    )}\n                    \n                    <Button \n                      className=\"w-full\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        handleSubjectSelect(subject.id);\n                      }}\n                    >\n                      Modulok megtekint√©se\n                    </Button>\n                  </CardContent>\n                </Card>\n              ))}\n              \n              {subjects.length === 0 && (\n                <div className=\"col-span-full text-center py-12\">\n                  <BookOpen className=\"mx-auto h-12 w-12 text-neutral-400 mb-4\" />\n                  <h3 className=\"text-lg font-medium text-neutral-900 mb-2\">Nincsenek el√©rhet≈ë tant√°rgyak</h3>\n                  <p className=\"text-neutral-600\">Jelenleg nincsenek tant√°rgyak hozz√°rendelve a szakm√°j√°hoz.</p>\n                </div>\n              )}\n            </div>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":5016},"client/src/pages/tananyagok.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useAuth } from \"@/hooks/useAuth\";\nimport { useLocation } from \"wouter\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport DynamicBackground from \"@/components/dynamic-background\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { BookOpen, Menu, ArrowRight, GraduationCap, ArrowLeft, Wrench, HardHat, Cpu, Hammer, Zap, Car, Briefcase, Heart, Utensils, Building } from \"lucide-react\";\nimport type { Profession, Subject } from \"@shared/schema\";\n\nexport default function TananyagokPage() {\n  const { user } = useAuth();\n  const [location, navigate] = useLocation();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n  const [selectedProfession, setSelectedProfession] = useState<number | null>(null);\n\n  // Check URL for profession parameter and auto-select class profession\n  useEffect(() => {\n    const urlParams = new URLSearchParams(window.location.search);\n    const professionParam = urlParams.get('profession');\n    \n    // Always start with profession selection view first\n    if (professionParam) {\n      setSelectedProfession(parseInt(professionParam));\n    } else {\n      // Always start with null to show profession selection\n      setSelectedProfession(null);\n    }\n  }, [location, user]);\n\n  const { data: professions = [], isLoading: professionsLoading } = useQuery<Profession[]>({\n    queryKey: ['/api/public/professions'],\n    retry: false,\n    select: (data) => {\n      // Sort professions to show user's assigned profession first\n      if (user?.assignedProfessionIds && user.assignedProfessionIds.length > 0) {\n        const assignedId = user.assignedProfessionIds[0];\n        const assigned = data.find(p => p.id === assignedId);\n        const others = data.filter(p => p.id !== assignedId);\n        return assigned ? [assigned, ...others] : data;\n      }\n      return data;\n    },\n  });\n\n  const { data: subjects = [], isLoading: subjectsLoading } = useQuery({\n    queryKey: ['/api/public/subjects', selectedProfession],\n    queryFn: async () => {\n      if (!selectedProfession) return [];\n      const response = await fetch(`/api/public/subjects?professionId=${selectedProfession}`);\n      if (!response.ok) throw new Error('Failed to fetch subjects');\n      return response.json();\n    },\n    enabled: !!selectedProfession,\n    retry: false,\n  });\n\n  if (!user) return null;\n\n  const { toast } = useToast();\n\n  // Mutation for students to select their first profession\n  const selectProfessionMutation = useMutation({\n    mutationFn: async (professionId: number) => {\n      const res = await apiRequest(\"POST\", `/api/student/select-profession`, {\n        professionId\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] });\n      toast({\n        title: \"Szakma kiv√°lasztva\",\n        description: \"A szakma sikeresen hozz√°rendelve a profilj√°hoz.\",\n      });\n    },\n    onError: (error: Error) => {\n      console.error('Profession selection error:', error);\n      toast({\n        title: \"Hiba\",\n        description: \"Nem siker√ºlt kiv√°lasztani a szakm√°t.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleProfessionSelect = (professionId: number) => {\n    const hasAssignedProfessions = user?.assignedProfessionIds && user.assignedProfessionIds.length > 0;\n    const isInClass = user?.classId;\n    \n    // Ellen≈ërizz√ºk, hogy a di√°k hozz√°f√©rhet-e ehhez a szakm√°hoz\n    const isAccessible = user?.role === 'admin' || user?.role === 'teacher' || \n      (!hasAssignedProfessions && user?.role === 'student') ||\n      (hasAssignedProfessions && user?.assignedProfessionIds?.includes(professionId));\n    \n    if (!isAccessible) {\n      toast({\n        title: \"Hozz√°f√©r√©s megtagadva\",\n        description: \"√ñn nem f√©rhet hozz√° ehhez a szakm√°hoz.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    // Ha a tanul√≥ m√©g nem v√°lasztott szakm√°t √©s nincs oszt√°lyban, automatikusan hozz√°rendelj√ºk\n    if (user?.role === 'student' && !hasAssignedProfessions && !isInClass) {\n      selectProfessionMutation.mutate(professionId);\n    }\n    \n    setSelectedProfession(professionId);\n    // Update URL with profession parameter\n    navigate(`/tananyagok?profession=${professionId}`);\n  };\n\n  // Icon mapping for professions\n  const getIconForProfession = (profession: Profession) => {\n    if (profession.iconName) {\n      const iconMap: { [key: string]: any } = {\n        'wrench': Wrench,\n        'hard-hat': HardHat,\n        'cpu': Cpu,\n        'hammer': Hammer,\n        'zap': Zap,\n        'car': Car,\n        'briefcase': Briefcase,\n        'heart': Heart,\n        'utensils': Utensils,\n        'building': Building,\n        'graduation-cap': GraduationCap\n      };\n      return iconMap[profession.iconName] || GraduationCap;\n    }\n    return GraduationCap;\n  };\n\n  const handleSubjectSelect = (subjectId: number) => {\n    navigate(`/subjects/${subjectId}/modules`);\n  };\n\n  const handleBackToProfessions = () => {\n    setSelectedProfession(null);\n    navigate('/tananyagok');\n  };\n\n  return (\n    <div className=\"flex min-h-screen bg-student-warm relative\">\n      <DynamicBackground />\n      <div className=\"hidden lg:block lg:w-64 lg:flex-shrink-0\">\n        <div className=\"sticky top-0 h-screen overflow-y-auto\">\n          <Sidebar user={user} />\n        </div>\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user} \n      />\n      \n      <div className=\"flex-1 overflow-auto\">\n        <header className=\"bg-student-warm shadow-sm border-b border-neutral-100\">\n          <div className=\"flex items-center justify-between px-6 py-4\">\n            <div className=\"flex items-center space-x-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMobileNavOpen(true)}\n                className=\"lg:hidden\"\n              >\n                <Menu size={20} />\n              </Button>\n              <div>\n                <h1 className=\"text-2xl font-bold text-neutral-800\">\n                  {selectedProfession ? \"Tananyagok\" : \"Szakm√°k\"}\n                </h1>\n                <p className=\"text-neutral-600\">\n                  {selectedProfession ? \"V√°lassza ki a tant√°rgyat √©s kezdje a tanul√°st\" : \"V√°lassza ki a szakm√°t √©s kezdje a tanul√°st\"}\n                </p>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"p-6\">\n          {/* Profession Selection */}\n          {!selectedProfession && (\n            <div className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold text-neutral-800 mb-4\">\n                1. V√°lassza ki a szakm√°t\n              </h2>\n              {professionsLoading ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {professions.map((profession: Profession) => {\n                    const IconComponent = getIconForProfession(profession);\n                    // Ha admin vagy tan√°r, minden el√©rhet≈ë\n                    // Ha tanul√≥ √©s nincs m√©g hozz√°rendelt szakma, minden v√°laszthat√≥\n                    // Ha tanul√≥ √©s m√°r van hozz√°rendelt szakma, csak azok √©rhet≈ëk el\n                    const hasAssignedProfessions = user?.assignedProfessionIds && user.assignedProfessionIds.length > 0;\n                    const isAccessible = user?.role === 'admin' || user?.role === 'teacher' || \n                      (!hasAssignedProfessions && user?.role === 'student') ||\n                      (hasAssignedProfessions && user?.assignedProfessionIds?.includes(profession.id));\n                    \n                    return (\n                      <Card \n                        key={profession.id}\n                        className={`neumorphism hover-lift gradient-overlay transition-all duration-300 flex flex-col h-full ${\n                          isAccessible \n                            ? \"cursor-pointer interactive-element\" \n                            : \"opacity-50 cursor-not-allowed\"\n                        } border-0`}\n                        onClick={() => isAccessible && handleProfessionSelect(profession.id)}\n                      >\n                        <CardHeader className=\"pb-3 flex-shrink-0\">\n                          <div className=\"flex items-start space-x-3\">\n                            <div className=\"w-16 h-16 bg-gradient-to-br from-primary to-blue-700 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\n                              {profession.iconUrl ? (\n                                <img \n                                  src={profession.iconUrl} \n                                  alt={profession.name}\n                                  className=\"w-10 h-10 object-contain\"\n                                />\n                              ) : (\n                                <IconComponent className=\"text-white\" size={28} />\n                              )}\n                            </div>\n                            <div className=\"flex-1 min-w-0 pr-2\">\n                              <CardTitle className=\"text-base font-bold text-neutral-800 leading-tight break-words\">\n                                {profession.name}\n                              </CardTitle>\n                            </div>\n                            <ArrowRight className=\"text-neutral-400 flex-shrink-0 mt-1\" size={18} />\n                          </div>\n                        </CardHeader>\n                        \n                        <CardContent className=\"flex flex-col flex-grow\">\n                          <div className=\"flex-grow\">\n                            {profession.description && (\n                              <p className=\"text-neutral-600 text-sm leading-relaxed line-clamp-3 mb-4\">\n                                {profession.description}\n                              </p>\n                            )}\n                          </div>\n                          \n                          <Button \n                            className={`w-full mt-auto transition-colors ${\n                              isAccessible \n                                ? \"bg-primary hover:bg-primary/90\" \n                                : \"bg-neutral-300 cursor-not-allowed\"\n                            }`}\n                            disabled={!isAccessible}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              if (isAccessible) {\n                                handleProfessionSelect(profession.id);\n                              }\n                            }}\n                          >\n                            <BookOpen className=\"mr-2\" size={16} />\n                            Tant√°rgyak megtekint√©se\n                          </Button>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n          )}\n\n          {/* Subject Selection */}\n          {selectedProfession && (\n            <div>\n              <div className=\"flex items-center justify-between mb-6\">\n                <h2 className=\"text-xl font-semibold text-neutral-800\">\n                  2. V√°lassza ki a tant√°rgyat\n                </h2>\n                <Button\n                  variant=\"outline\"\n                  onClick={handleBackToProfessions}\n                  className=\"flex items-center space-x-2\"\n                >\n                  <ArrowLeft size={16} />\n                  <span>Vissza a szakm√°khoz</span>\n                </Button>\n              </div>\n\n              {subjectsLoading ? (\n                <div className=\"flex items-center justify-center py-12\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                  {subjects.map((subject: Subject) => (\n                    <Card \n                      key={subject.id}\n                      className=\"glassmorphism gradient-overlay hover-lift transition-all duration-300 cursor-pointer flex flex-col h-full interactive-element border-white/20\"\n                      onClick={() => handleSubjectSelect(subject.id)}\n                    >\n                      <CardHeader className=\"pb-3 flex-shrink-0\">\n                        <div className=\"flex items-start space-x-3\">\n                          <div className=\"w-16 h-16 bg-gradient-to-br from-secondary to-green-700 rounded-xl flex items-center justify-center shadow-lg flex-shrink-0\">\n                            <BookOpen className=\"text-white\" size={28} />\n                          </div>\n                          <div className=\"flex-1 min-w-0 pr-2\">\n                            <CardTitle className=\"text-base font-bold text-neutral-800 leading-tight break-words\">\n                              {subject.name}\n                            </CardTitle>\n                          </div>\n                          <ArrowRight className=\"text-neutral-400 flex-shrink-0 mt-1\" size={18} />\n                        </div>\n                      </CardHeader>\n                      \n                      <CardContent className=\"flex flex-col flex-grow\">\n                        <div className=\"flex-grow\">\n                          {subject.description && (\n                            <p className=\"text-neutral-600 text-sm leading-relaxed line-clamp-3 mb-4\">\n                              {subject.description}\n                            </p>\n                          )}\n                        </div>\n                        \n                        <Button \n                          className=\"w-full mt-auto bg-secondary hover:bg-secondary/90 transition-colors\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleSubjectSelect(subject.id);\n                          }}\n                        >\n                          <BookOpen className=\"mr-2\" size={16} />\n                          Modulok megtekint√©se\n                        </Button>\n                      </CardContent>\n                    </Card>\n                  ))}\n                  \n                  {subjects.length === 0 && (\n                    <div className=\"col-span-full text-center py-12\">\n                      <BookOpen className=\"mx-auto h-12 w-12 text-neutral-400 mb-4\" />\n                      <h3 className=\"text-lg font-medium text-neutral-900 mb-2\">Nincsenek el√©rhet≈ë tant√°rgyak</h3>\n                      <p className=\"text-neutral-600\">Jelenleg nincsenek tant√°rgyak hozz√°rendelve ehhez a szakm√°hoz.</p>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":15559},"client/src/pages/teacher-auth.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link, useLocation } from \"wouter\";\nimport { BookOpen, GraduationCap, Loader2 } from \"lucide-react\";\n\nexport default function TeacherAuth() {\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [formData, setFormData] = useState({\n    username: \"\",\n    password: \"\",\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await fetch(\"/api/auth/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ ...data, role: \"teacher\" }),\n        credentials: \"include\",\n      });\n\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Bejelentkez√©si hiba\");\n      }\n\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Sikeres bejelentkez√©s!\",\n        description: \"√údv√∂z√∂lj√ºk a tan√°ri fel√ºleten!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      setLocation(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Hiba\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(formData);\n  };\n\n  const handleInputChange = (field: keyof typeof formData) => (e: React.ChangeEvent<HTMLInputElement>) => {\n    setFormData(prev => ({ ...prev, [field]: e.target.value }));\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <GraduationCap className=\"h-12 w-12 text-blue-600 mr-2\" />\n            <BookOpen className=\"h-12 w-12 text-indigo-600\" />\n          </div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Tan√°ri Port√°l</h1>\n          <p className=\"text-gray-600 mt-2\">\n            Szakmai k√©pz√©si platform tan√°roknak\n          </p>\n        </div>\n\n        <Card className=\"shadow-lg border-0\">\n          <CardHeader className=\"space-y-2 text-center\">\n            <CardTitle className=\"text-2xl\">\n              Tan√°ri bejelentkez√©s\n            </CardTitle>\n            <p className=\"text-sm text-gray-600\">\n              Jelentkezzen be tan√°ri fi√≥kj√°val\n            </p>\n            <p className=\"text-xs text-gray-500\">\n              √öj tan√°rok regisztr√°ci√≥j√°t az iskolai admin kezeli\n            </p>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"username\">Felhaszn√°l√≥n√©v</Label>\n                <Input\n                  id=\"username\"\n                  type=\"text\"\n                  placeholder=\"felhaszn√°l√≥n√©v\"\n                  value={formData.username}\n                  onChange={handleInputChange(\"username\")}\n                  required\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"password\">Jelsz√≥</Label>\n                <Input\n                  id=\"password\"\n                  type=\"password\"\n                  placeholder=\"jelsz√≥\"\n                  value={formData.password}\n                  onChange={handleInputChange(\"password\")}\n                  required\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-blue-600 hover:bg-blue-700\"\n                disabled={loginMutation.isPending}\n              >\n                {loginMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Bejelentkez√©s...\n                  </>\n                ) : (\n                  \"Bejelentkez√©s\"\n                )}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        <div className=\"text-center mt-6\">\n          <p className=\"text-sm text-gray-600\">\n            Vissza a{\" \"}\n            <Link href=\"/\" className=\"text-blue-600 hover:underline\">\n              f≈ëoldalra\n            </Link>\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":4804},"client/src/pages/teacher-dashboard.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { \n  Users, \n  BookOpen, \n  TrendingUp, \n  Award, \n  Search,\n  GraduationCap,\n  Clock,\n  CheckCircle,\n  ArrowLeft\n} from \"lucide-react\";\n\ninterface Student {\n  id: string;\n  username: string;\n  firstName?: string;\n  lastName?: string;\n  email?: string;\n  selectedProfessionId?: number;\n  completedModules: number[];\n  createdAt: string;\n}\n\ninterface Module {\n  id: number;\n  title: string;\n  subjectId: number;\n  subjectName?: string;\n}\n\ninterface Profession {\n  id: number;\n  name: string;\n  description: string;\n}\n\nexport default function TeacherDashboard() {\n  const [, setLocation] = useLocation();\n  const [searchTerm, setSearchTerm] = useState(\"\");\n\n  // Fetch students\n  const { data: students = [], isLoading: studentsLoading } = useQuery({\n    queryKey: [\"/api/teacher/students\"],\n  });\n\n  // Fetch modules\n  const { data: modules = [], isLoading: modulesLoading } = useQuery({\n    queryKey: [\"/api/public/modules\"],\n  });\n\n  // Fetch professions\n  const { data: professions = [], isLoading: professionsLoading } = useQuery({\n    queryKey: [\"/api/public/professions\"],\n  });\n\n  const filteredStudents = students.filter((student: Student) => {\n    const fullName = `${student.firstName || ''} ${student.lastName || ''}`.toLowerCase();\n    const username = student.username?.toLowerCase() || '';\n    const search = searchTerm.toLowerCase();\n    return fullName.includes(search) || username.includes(search);\n  });\n\n  const getStudentProgress = (student: Student) => {\n    const totalModules = modules.length;\n    const completedCount = student.completedModules?.length || 0;\n    return totalModules > 0 ? Math.round((completedCount / totalModules) * 100) : 0;\n  };\n\n  const getProfessionName = (professionId?: number) => {\n    if (!professionId) return \"Nincs kiv√°lasztva\";\n    const profession = professions.find((p: Profession) => p.id === professionId);\n    return profession?.name || \"Ismeretlen\";\n  };\n\n  const getModuleName = (moduleId: number) => {\n    const module = modules.find((m: Module) => m.id === moduleId);\n    return module?.title || `Modul ${moduleId}`;\n  };\n\n  const totalStudents = students.length;\n  const activeStudents = students.filter((s: Student) => s.completedModules?.length > 0).length;\n  const averageProgress = students.length > 0 \n    ? Math.round(students.reduce((sum: number, s: Student) => sum + getStudentProgress(s), 0) / students.length)\n    : 0;\n\n  if (studentsLoading || modulesLoading || professionsLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <GraduationCap className=\"h-12 w-12 text-blue-600 mx-auto mb-4 animate-spin\" />\n          <p className=\"text-gray-600\">Adatok bet√∂lt√©se...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"container mx-auto p-6 max-w-7xl\">\n        {/* Header */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setLocation(\"/\")}\n                className=\"mr-4 text-gray-600 hover:text-gray-900\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Vissza\n              </Button>\n              <div>\n                <h1 className=\"text-3xl font-bold text-gray-900 flex items-center\">\n                  <GraduationCap className=\"h-8 w-8 text-blue-600 mr-3\" />\n                  Tanul√≥im\n                </h1>\n                <p className=\"text-gray-600 mt-2\">\n                  Tanul√≥k halad√°s√°nak √©s eredm√©nyeinek k√∂vet√©se\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Stats Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">√ñsszes tanul√≥</p>\n                  <p className=\"text-3xl font-bold text-gray-900\">{totalStudents}</p>\n                </div>\n                <div className=\"h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                  <Users className=\"h-6 w-6 text-blue-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">Akt√≠v tanul√≥k</p>\n                  <p className=\"text-3xl font-bold text-gray-900\">{activeStudents}</p>\n                </div>\n                <div className=\"h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center\">\n                  <TrendingUp className=\"h-6 w-6 text-green-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm font-medium text-gray-600\">√Åtlagos halad√°s</p>\n                  <p className=\"text-3xl font-bold text-gray-900\">{averageProgress}%</p>\n                </div>\n                <div className=\"h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center\">\n                  <Award className=\"h-6 w-6 text-purple-600\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Search and Filters */}\n        <Card className=\"mb-6\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"relative flex-1\">\n                <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4\" />\n                <Input\n                  placeholder=\"Keres√©s n√©v vagy felhaszn√°l√≥n√©v alapj√°n...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10\"\n                />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Students List */}\n        <div className=\"grid gap-6\">\n          {filteredStudents.length === 0 ? (\n            <Card>\n              <CardContent className=\"p-12 text-center\">\n                <Users className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                  {searchTerm ? \"Nincs tal√°lat\" : \"Nincsenek tanul√≥k\"}\n                </h3>\n                <p className=\"text-gray-500\">\n                  {searchTerm \n                    ? \"Pr√≥b√°ljon meg m√°s keres√©si felt√©telekkel.\" \n                    : \"M√©g nincsenek regisztr√°lt tanul√≥k a rendszerben.\"\n                  }\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            filteredStudents.map((student: Student) => {\n              const progress = getStudentProgress(student);\n              const completedCount = student.completedModules?.length || 0;\n              const recentModules = student.completedModules?.slice(-3) || [];\n\n              return (\n                <Card key={student.id} className=\"hover:shadow-md transition-shadow\">\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-start justify-between\">\n                      <div className=\"flex items-start space-x-4 flex-1\">\n                        <Avatar className=\"h-12 w-12\">\n                          <AvatarImage src={`https://api.dicebear.com/7.x/initials/svg?seed=${student.firstName} ${student.lastName}`} />\n                          <AvatarFallback>\n                            {(student.firstName?.[0] || '') + (student.lastName?.[0] || student.username?.[0] || 'T')}\n                          </AvatarFallback>\n                        </Avatar>\n\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center justify-between mb-2\">\n                            <div>\n                              <h3 className=\"text-lg font-semibold text-gray-900\">\n                                {student.firstName && student.lastName \n                                  ? `${student.firstName} ${student.lastName}`\n                                  : student.username\n                                }\n                              </h3>\n                              <p className=\"text-sm text-gray-500\">@{student.username}</p>\n                            </div>\n                            <div className=\"text-right\">\n                              <Badge variant={progress > 50 ? \"default\" : \"secondary\"}>\n                                {progress}% k√©sz\n                              </Badge>\n                            </div>\n                          </div>\n\n                          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n                            <div>\n                              <p className=\"text-sm font-medium text-gray-600 mb-1\">Szakma</p>\n                              <p className=\"text-sm text-gray-900\">\n                                {getProfessionName(student.selectedProfessionId)}\n                              </p>\n                            </div>\n                            <div>\n                              <p className=\"text-sm font-medium text-gray-600 mb-1\">Teljes√≠tett modulok</p>\n                              <p className=\"text-sm text-gray-900\">\n                                {completedCount} / {modules.length}\n                              </p>\n                            </div>\n                          </div>\n\n                          <div className=\"mb-4\">\n                            <div className=\"flex items-center justify-between mb-2\">\n                              <p className=\"text-sm font-medium text-gray-600\">Halad√°s</p>\n                              <p className=\"text-sm text-gray-500\">{progress}%</p>\n                            </div>\n                            <Progress value={progress} className=\"h-2\" />\n                          </div>\n\n                          {recentModules.length > 0 && (\n                            <div>\n                              <p className=\"text-sm font-medium text-gray-600 mb-2\">\n                                Legut√≥bb teljes√≠tett modulok\n                              </p>\n                              <div className=\"flex flex-wrap gap-2\">\n                                {recentModules.map((moduleId: number) => (\n                                  <Badge key={moduleId} variant=\"outline\" className=\"text-xs\">\n                                    <CheckCircle className=\"h-3 w-3 mr-1\" />\n                                    {getModuleName(moduleId)}\n                                  </Badge>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              );\n            })\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":12029},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/components/cookie-banner.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { X, Settings, Shield, Cookie } from 'lucide-react';\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog';\nimport { Switch } from '@/components/ui/switch';\nimport { Label } from '@/components/ui/label';\nimport { apiRequest } from '@/lib/queryClient';\nimport { Link } from 'wouter';\n\ninterface ConsentSettings {\n  necessary: boolean;\n  analytics: boolean;\n  marketing: boolean;\n  functional: boolean;\n}\n\nconst DEFAULT_CONSENT: ConsentSettings = {\n  necessary: true, // Always true, cannot be disabled\n  analytics: false,\n  marketing: false,\n  functional: false\n};\n\nexport default function CookieBanner() {\n  const [showBanner, setShowBanner] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [consent, setConsent] = useState<ConsentSettings>(DEFAULT_CONSENT);\n\n  useEffect(() => {\n    // Check if user has already given consent\n    const storedConsent = localStorage.getItem('cookie-consent');\n    if (!storedConsent) {\n      setShowBanner(true);\n    } else {\n      setConsent(JSON.parse(storedConsent));\n    }\n  }, []);\n\n  const saveConsent = async (consentData: ConsentSettings) => {\n    try {\n      // Save to localStorage for immediate use\n      localStorage.setItem('cookie-consent', JSON.stringify(consentData));\n      localStorage.setItem('cookie-consent-date', new Date().toISOString());\n      \n      // Save to backend if user is logged in\n      const sessionId = Math.random().toString(36).substring(2, 15);\n      \n      // Save each consent type\n      for (const [type, value] of Object.entries(consentData)) {\n        try {\n          await apiRequest('POST', '/api/privacy/consent', {\n            consentType: type,\n            consentValue: value,\n            sessionId\n          });\n        } catch (error) {\n          // Continue if backend call fails\n          console.warn('Failed to save consent to backend:', error);\n        }\n      }\n      \n      setConsent(consentData);\n      setShowBanner(false);\n      setShowSettings(false);\n    } catch (error) {\n      console.error('Error saving consent:', error);\n    }\n  };\n\n  const acceptAll = () => {\n    saveConsent({\n      necessary: true,\n      analytics: true,\n      marketing: true,\n      functional: true\n    });\n  };\n\n  const acceptNecessary = () => {\n    saveConsent(DEFAULT_CONSENT);\n  };\n\n  const saveCustom = () => {\n    saveConsent(consent);\n  };\n\n  if (!showBanner) return null;\n\n  return (\n    <>\n      <div className=\"fixed bottom-0 left-0 right-0 z-50 p-4 bg-gradient-to-t from-black/80 to-transparent\">\n        <Card className=\"max-w-4xl mx-auto bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm border-gray-200/50 dark:border-gray-700/50 shadow-xl\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"flex-shrink-0\">\n                <Cookie className=\"h-8 w-8 text-orange-500\" />\n              </div>\n              \n              <div className=\"flex-1\">\n                <div className=\"flex items-start justify-between gap-4\">\n                  <div>\n                    <h3 className=\"font-semibold text-lg text-gray-900 dark:text-white mb-2\">\n                      üç™ S√ºtikezel√©si t√°j√©koztat√°s\n                    </h3>\n                    <p className=\"text-gray-600 dark:text-gray-300 text-sm leading-relaxed mb-4\">\n                      A Global Learning System s√ºtiket √©s hasonl√≥ technol√≥gi√°kat haszn√°l a weboldal m≈±k√∂d√©s√©hez, \n                      teljes√≠tm√©ny√©nek jav√≠t√°s√°hoz √©s szem√©lyre szabott tartalom biztos√≠t√°s√°hoz. \n                      Az <Link href=\"/privacy-policy\" className=\"text-blue-600 hover:underline\">adatv√©delmi t√°j√©koztat√≥nkban</Link> r√©szletesen \n                      olvashat arr√≥l, hogy milyen adatokat gy≈±jt√ºnk √©s hogyan haszn√°ljuk fel ≈ëket.\n                    </p>\n                    \n                    <div className=\"flex flex-wrap gap-2 mb-4\">\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        <Shield className=\"h-3 w-3 mr-1\" />\n                        GDPR megfelel≈ë\n                      </Badge>\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        Magyar adatv√©delmi jogszab√°lyok\n                      </Badge>\n                    </div>\n                  </div>\n                  \n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    onClick={() => setShowBanner(false)}\n                    className=\"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200\"\n                  >\n                    <X className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n                \n                <div className=\"flex flex-wrap gap-3\">\n                  <Button\n                    onClick={acceptAll}\n                    className=\"bg-green-600 hover:bg-green-700 text-white\"\n                  >\n                    √ñsszes s√ºti elfogad√°sa\n                  </Button>\n                  \n                  <Button\n                    onClick={acceptNecessary}\n                    variant=\"outline\"\n                  >\n                    Csak sz√ºks√©ges s√ºtik\n                  </Button>\n                  \n                  <Dialog open={showSettings} onOpenChange={setShowSettings}>\n                    <DialogTrigger asChild>\n                      <Button variant=\"outline\">\n                        <Settings className=\"h-4 w-4 mr-2\" />\n                        Be√°ll√≠t√°sok\n                      </Button>\n                    </DialogTrigger>\n                    \n                    <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\">\n                      <DialogHeader>\n                        <DialogTitle className=\"flex items-center gap-2\">\n                          <Cookie className=\"h-5 w-5 text-orange-500\" />\n                          S√ºti be√°ll√≠t√°sok\n                        </DialogTitle>\n                        <DialogDescription>\n                          V√°lassza ki, hogy milyen t√≠pus√∫ s√ºtiket enged√©lyez. A sz√ºks√©ges s√ºtik mindig akt√≠vak a weboldal m≈±k√∂d√©s√©hez.\n                        </DialogDescription>\n                      </DialogHeader>\n                      \n                      <div className=\"space-y-6\">\n                        {/* Necessary Cookies */}\n                        <div className=\"flex items-start justify-between p-4 border rounded-lg bg-gray-50 dark:bg-gray-800\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2 mb-2\">\n                              <Label className=\"font-medium\">Sz√ºks√©ges s√ºtik</Label>\n                              <Badge variant=\"secondary\" className=\"text-xs\">K√∂telez≈ë</Badge>\n                            </div>\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                              Ezek a s√ºtik elengedhetetlenek a weboldal alapvet≈ë funkci√≥ihoz, \n                              mint a bejelentkez√©s, navig√°ci√≥ √©s biztons√°g.\n                            </p>\n                          </div>\n                          <Switch checked={true} disabled />\n                        </div>\n                        \n                        {/* Functional Cookies */}\n                        <div className=\"flex items-start justify-between p-4 border rounded-lg\">\n                          <div className=\"flex-1\">\n                            <Label className=\"font-medium mb-2 block\">Funkcion√°lis s√ºtik</Label>\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                              Jav√≠tj√°k a felhaszn√°l√≥i √©lm√©nyt, megjegyzik a be√°ll√≠t√°sokat \n                              √©s preferenci√°kat (pl. nyelv, t√©ma).\n                            </p>\n                          </div>\n                          <Switch \n                            checked={consent.functional}\n                            onCheckedChange={(checked) => \n                              setConsent(prev => ({ ...prev, functional: checked }))\n                            }\n                          />\n                        </div>\n                        \n                        {/* Analytics Cookies */}\n                        <div className=\"flex items-start justify-between p-4 border rounded-lg\">\n                          <div className=\"flex-1\">\n                            <Label className=\"font-medium mb-2 block\">Analitikai s√ºtik</Label>\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                              Seg√≠tenek meg√©rteni, hogyan haszn√°lja a weboldalt, \n                              √≠gy jav√≠thatjuk a szolg√°ltat√°sainkat. Az adatok n√©vtelenek.\n                            </p>\n                          </div>\n                          <Switch \n                            checked={consent.analytics}\n                            onCheckedChange={(checked) => \n                              setConsent(prev => ({ ...prev, analytics: checked }))\n                            }\n                          />\n                        </div>\n                        \n                        {/* Marketing Cookies */}\n                        <div className=\"flex items-start justify-between p-4 border rounded-lg\">\n                          <div className=\"flex-1\">\n                            <Label className=\"font-medium mb-2 block\">Marketing s√ºtik</Label>\n                            <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                              Szem√©lyre szabott tartalmak √©s relev√°ns aj√°nlatok \n                              megjelen√≠t√©s√©hez haszn√°ljuk.\n                            </p>\n                          </div>\n                          <Switch \n                            checked={consent.marketing}\n                            onCheckedChange={(checked) => \n                              setConsent(prev => ({ ...prev, marketing: checked }))\n                            }\n                          />\n                        </div>\n                      </div>\n                      \n                      <div className=\"flex justify-end gap-2 pt-4 border-t\">\n                        <Button variant=\"outline\" onClick={() => setShowSettings(false)}>\n                          M√©gse\n                        </Button>\n                        <Button onClick={saveCustom} className=\"bg-green-600 hover:bg-green-700\">\n                          Be√°ll√≠t√°sok ment√©se\n                        </Button>\n                      </div>\n                    </DialogContent>\n                  </Dialog>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </>\n  );\n}","size_bytes":11148},"client/src/pages/privacy-policy.tsx":{"content":"import React from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { ArrowLeft, Shield, Mail, Clock, Download, Trash2, Edit, StopCircle } from 'lucide-react';\nimport { Link } from 'wouter';\n\nexport default function PrivacyPolicy() {\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href=\"/\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Vissza a f≈ëoldalra\n            </Button>\n          </Link>\n          <div className=\"flex items-center gap-2\">\n            <Shield className=\"h-6 w-6 text-blue-600\" />\n            <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n              Adatv√©delmi T√°j√©koztat√≥\n            </h1>\n          </div>\n        </div>\n\n        {/* Status badges */}\n        <div className=\"flex flex-wrap gap-2 mb-6\">\n          <Badge className=\"bg-green-100 text-green-800 border-green-200\">\n            <Shield className=\"h-3 w-3 mr-1\" />\n            GDPR megfelel≈ë\n          </Badge>\n          <Badge variant=\"outline\">\n            Magyar Info t√∂rv√©ny 2011. √©vi CXII. tv.\n          </Badge>\n          <Badge variant=\"outline\">\n            Utols√≥ friss√≠t√©s: 2025. augusztus 25.\n          </Badge>\n        </div>\n\n        {/* Data Controller Information */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Mail className=\"h-5 w-5\" />\n              Adatkezel≈ë adatai\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div>\n              <h4 className=\"font-semibold\">Adatkezel≈ë neve:</h4>\n              <p>Global Learning System Kft.</p>\n            </div>\n            <div>\n              <h4 className=\"font-semibold\">Sz√©khely:</h4>\n              <p>1111 Budapest, P√©lda utca 1. (p√©lda c√≠m)</p>\n            </div>\n            <div>\n              <h4 className=\"font-semibold\">Kapcsolat:</h4>\n              <p>Email: privacy@globalsystem.com</p>\n              <p>Telefon: +36 1 234 5678</p>\n            </div>\n            <div>\n              <h4 className=\"font-semibold\">Adatv√©delmi tisztvisel≈ë:</h4>\n              <p>dpo@globalsystem.com</p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Data Processing Activities */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Adatkezel√©si tev√©kenys√©gek</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"border-l-4 border-blue-500 pl-4\">\n              <h4 className=\"font-semibold mb-2\">1. Felhaszn√°l√≥i regisztr√°ci√≥ √©s bejelentkez√©s</h4>\n              <div className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                <p><strong>Kezelt adatok:</strong> n√©v, email c√≠m, felhaszn√°l√≥n√©v, jelsz√≥ (titkos√≠tva)</p>\n                <p><strong>Jogalap:</strong> hozz√°j√°rul√°s (GDPR 6. cikk 1. pont a)</p>\n                <p><strong>C√©l:</strong> felhaszn√°l√≥i fi√≥k l√©trehoz√°sa √©s kezel√©se</p>\n                <p><strong>Meg≈ërz√©si id≈ë:</strong> a fi√≥k t√∂rl√©sig vagy 3 √©v inaktivit√°s ut√°n</p>\n              </div>\n            </div>\n\n            <div className=\"border-l-4 border-green-500 pl-4\">\n              <h4 className=\"font-semibold mb-2\">2. Oktat√°si tartalom √©s halad√°s k√∂vet√©se</h4>\n              <div className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                <p><strong>Kezelt adatok:</strong> tanul√°si modulok teljes√≠t√©se, pontsz√°mok, halad√°si adatok</p>\n                <p><strong>Jogalap:</strong> szolg√°ltat√°s teljes√≠t√©se (GDPR 6. cikk 1. pont b)</p>\n                <p><strong>C√©l:</strong> oktat√°si szolg√°ltat√°s ny√∫jt√°sa, halad√°s nyomon k√∂vet√©se</p>\n                <p><strong>Meg≈ërz√©si id≈ë:</strong> a szolg√°ltat√°s haszn√°lat√°nak befejez√©s√©t≈ël sz√°m√≠tott 5 √©v</p>\n              </div>\n            </div>\n\n            <div className=\"border-l-4 border-orange-500 pl-4\">\n              <h4 className=\"font-semibold mb-2\">3. AI szolg√°ltat√°sok √©s API h√≠v√°sok</h4>\n              <div className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                <p><strong>Kezelt adatok:</strong> API haszn√°lati statisztik√°k, k√∂lts√©gadatok felhaszn√°l√≥hoz rendelve</p>\n                <p><strong>Jogalap:</strong> jogos √©rdek (GDPR 6. cikk 1. pont f)</p>\n                <p><strong>C√©l:</strong> szolg√°ltat√°s optimaliz√°l√°sa, k√∂lts√©gkontroll</p>\n                <p><strong>Meg≈ërz√©si id≈ë:</strong> 2 √©v</p>\n              </div>\n            </div>\n\n            <div className=\"border-l-4 border-purple-500 pl-4\">\n              <h4 className=\"font-semibold mb-2\">4. Munkamenetkezel√©s (session adatok)</h4>\n              <div className=\"space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                <p><strong>Kezelt adatok:</strong> session azonos√≠t√≥, bejelentkez√©si st√°tusz</p>\n                <p><strong>Jogalap:</strong> jogos √©rdek (GDPR 6. cikk 1. pont f)</p>\n                <p><strong>C√©l:</strong> biztons√°gos munkamenet fenntart√°sa</p>\n                <p><strong>Meg≈ërz√©si id≈ë:</strong> 7 nap vagy kijelentkez√©s</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* User Rights */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Az √ñn jogai</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"flex items-start gap-3 p-4 border rounded-lg\">\n                <Download className=\"h-5 w-5 text-blue-500 mt-1\" />\n                <div>\n                  <h4 className=\"font-semibold\">Adathordozhat√≥s√°g</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                    K√©rheti adatai g√©ppel olvashat√≥ form√°tumban t√∂rt√©n≈ë kiad√°s√°t.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-3 p-4 border rounded-lg\">\n                <Edit className=\"h-5 w-5 text-green-500 mt-1\" />\n                <div>\n                  <h4 className=\"font-semibold\">Helyesb√≠t√©s</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                    K√©rheti pontatlan vagy hi√°nyos adatai jav√≠t√°s√°t.\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-3 p-4 border rounded-lg\">\n                <Trash2 className=\"h-5 w-5 text-red-500 mt-1\" />\n                <div>\n                  <h4 className=\"font-semibold\">T√∂rl√©s</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                    K√©rheti szem√©lyes adatai t√∂rl√©s√©t (‚Äûelfeledtet√©shez val√≥ jog\").\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"flex items-start gap-3 p-4 border rounded-lg\">\n                <StopCircle className=\"h-5 w-5 text-orange-500 mt-1\" />\n                <div>\n                  <h4 className=\"font-semibold\">Korl√°toz√°s</h4>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                    K√©rheti adatkezel√©s korl√°toz√°s√°t bizonyos esetekben.\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg\">\n              <h4 className=\"font-semibold mb-2\">Hogyan √©rv√©nyes√≠tse jogait?</h4>\n              <p className=\"text-sm mb-3\">\n                Jogai √©rv√©nyes√≠t√©s√©hez √≠rjon nek√ºnk a privacy@globalsystem.com c√≠mre, \n                vagy haszn√°lja a <Link href=\"/privacy-requests\" className=\"text-blue-600 hover:underline\">\n                online k√©relem rendszert</Link>.\n              </p>\n              <p className=\"text-sm\">\n                <strong>V√°laszid≈ë:</strong> K√©relm√©t 30 napon bel√ºl elb√≠r√°luk √©s v√°laszolunk.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Cookies and Tracking */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>S√ºtik (cookies) √©s nyomk√∂vet√©s</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-3\">\n              <div>\n                <h4 className=\"font-semibold\">Sz√ºks√©ges s√ºtik</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  A weboldal alapvet≈ë m≈±k√∂d√©s√©hez sz√ºks√©gesek (bejelentkez√©s, navig√°ci√≥, biztons√°g).\n                  Ezek letilt√°sa eset√©n a weboldal nem m≈±k√∂dik megfelel≈ëen.\n                </p>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold\">Funkcion√°lis s√ºtik</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  A felhaszn√°l√≥i √©lm√©ny jav√≠t√°s√°ra szolg√°lnak (be√°ll√≠t√°sok megjegyz√©se, szem√©lyre szab√°s).\n                </p>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold\">Analitikai s√ºtik</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  N√©vtelen statisztik√°k gy≈±jt√©s√©re a weboldal haszn√°lat√°r√≥l, a szolg√°ltat√°s fejleszt√©se √©rdek√©ben.\n                </p>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold\">Marketing s√ºtik</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  Szem√©lyre szabott tartalom √©s relev√°ns aj√°nlatok megjelen√≠t√©s√©re.\n                </p>\n              </div>\n            </div>\n\n            <div className=\"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-lg\">\n              <p className=\"text-sm\">\n                <strong>S√ºti be√°ll√≠t√°sok m√≥dos√≠t√°sa:</strong> A s√ºti banner √∫jboli megjelen√≠t√©s√©hez \n                t√∂rlje a b√∂ng√©sz≈ë helyi t√°rol√≥j√°ban (localStorage) a \"cookie-consent\" bejegyz√©st, \n                majd friss√≠tse az oldalt.\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Data Security */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Adatbiztons√°g</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div>\n                <h4 className=\"font-semibold\">Technikai v√©delmi int√©zked√©sek:</h4>\n                <ul className=\"text-sm text-gray-600 dark:text-gray-300 list-disc list-inside space-y-1\">\n                  <li>HTTPS titkos√≠t√°s minden kommunik√°ci√≥ban</li>\n                  <li>Jelszavak biztons√°gos hash-el√©se (scrypt)</li>\n                  <li>Adatb√°zis access control √©s monitoring</li>\n                  <li>Rendszeres biztons√°gi friss√≠t√©sek</li>\n                </ul>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold\">Szervez√©si int√©zked√©sek:</h4>\n                <ul className=\"text-sm text-gray-600 dark:text-gray-300 list-disc list-inside space-y-1\">\n                  <li>Adatv√©delmi tisztvisel≈ë kijel√∂l√©se</li>\n                  <li>Munkat√°rsak adatv√©delmi k√©pz√©se</li>\n                  <li>Adatkezel√©si folyamatok dokument√°l√°sa</li>\n                  <li>Incidenskezel√©si elj√°r√°sok</li>\n                </ul>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Contact and Complaints */}\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Kapcsolat √©s panaszkezel√©s</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-3\">\n              <div>\n                <h4 className=\"font-semibold\">Adatv√©delmi k√©rd√©sek:</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  privacy@globalsystem.com | +36 1 234 5678\n                </p>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold\">Panaszkezel√©s:</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  Panaszait el≈ësz√∂r n√°lunk jelezheti (privacy@globalsystem.com). \n                  El√©gedetlens√©g eset√©n fordulhat a Nemzeti Adatv√©delmi √©s Inform√°ci√≥szabads√°g Hat√≥s√°ghoz \n                  (NAIH): <a href=\"https://naih.hu\" className=\"text-blue-600 hover:underline\">naih.hu</a>\n                </p>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold\">Hat√≥s√°gi kapcsolat:</h4>\n                <p className=\"text-sm text-gray-600 dark:text-gray-300\">\n                  Nemzeti Adatv√©delmi √©s Inform√°ci√≥szabads√°g Hat√≥s√°g<br/>\n                  1055 Budapest, Falk Miksa utca 9-11.<br/>\n                  Email: ugyfelszolgalat@naih.hu | Tel: +36 1 391 1400\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Links to other pages */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Tov√°bbi inform√°ci√≥k</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-wrap gap-3\">\n              <Link href=\"/privacy-requests\">\n                <Button variant=\"outline\">\n                  <Edit className=\"h-4 w-4 mr-2\" />\n                  Adatv√©delmi k√©relmek\n                </Button>\n              </Link>\n              <Link href=\"/terms-of-service\">\n                <Button variant=\"outline\">\n                  √Åltal√°nos Szerz≈ëd√©si Felt√©telek\n                </Button>\n              </Link>\n              <a href=\"mailto:privacy@globalsystem.com\" className=\"inline-block\">\n                <Button variant=\"outline\">\n                  <Mail className=\"h-4 w-4 mr-2\" />\n                  Kapcsolat\n                </Button>\n              </a>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":14462},"client/src/pages/privacy-requests.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { Button } from '@/components/ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Input } from '@/components/ui/input';\nimport { Label } from '@/components/ui/label';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { useToast } from '@/hooks/use-toast';\nimport { \n  ArrowLeft, \n  Download, \n  Trash2, \n  Edit, \n  StopCircle, \n  FileText, \n  CheckCircle, \n  Clock,\n  AlertTriangle \n} from 'lucide-react';\nimport { Link } from 'wouter';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\n\ninterface PrivacyRequest {\n  id: number;\n  email: string;\n  requestType: 'data_export' | 'data_deletion' | 'data_correction' | 'restrict_processing';\n  status: 'pending' | 'in_progress' | 'completed' | 'rejected';\n  requestData: any;\n  responseData: any;\n  createdAt: string;\n  completedAt?: string;\n}\n\nconst REQUEST_TYPES = {\n  data_export: {\n    icon: Download,\n    label: 'Adatok export√°l√°sa',\n    description: 'Az √∂sszes r√≥lam t√°rolt adat k√©r√©se g√©ppel olvashat√≥ form√°tumban',\n    color: 'blue'\n  },\n  data_deletion: {\n    icon: Trash2,\n    label: 'Adatok t√∂rl√©se',\n    description: 'Az √∂sszes r√≥lam t√°rolt adat t√∂rl√©se (elfeledtet√©shez val√≥ jog)',\n    color: 'red'\n  },\n  data_correction: {\n    icon: Edit,\n    label: 'Adatok jav√≠t√°sa',\n    description: 'Pontatlan vagy hi√°nyos adataim jav√≠t√°sa',\n    color: 'green'\n  },\n  restrict_processing: {\n    icon: StopCircle,\n    label: 'Adatkezel√©s korl√°toz√°sa',\n    description: 'Adataim kezel√©s√©nek korl√°toz√°sa vagy felf√ºggeszt√©se',\n    color: 'orange'\n  }\n};\n\nconst STATUS_CONFIG = {\n  pending: { label: 'F√ºgg≈ëben', icon: Clock, color: 'yellow' },\n  in_progress: { label: 'Feldolgoz√°s alatt', icon: FileText, color: 'blue' },\n  completed: { label: 'Befejezve', icon: CheckCircle, color: 'green' },\n  rejected: { label: 'Elutas√≠tva', icon: AlertTriangle, color: 'red' }\n};\n\nexport default function PrivacyRequests() {\n  const [requestType, setRequestType] = useState<string>('');\n  const [email, setEmail] = useState('');\n  const [details, setDetails] = useState('');\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch existing requests for the user\n  const { data: requests = [], isLoading } = useQuery({\n    queryKey: ['/api/privacy/requests'],\n    enabled: !!email && email.includes('@'),\n  });\n\n  const submitRequestMutation = useMutation({\n    mutationFn: (data: any) => apiRequest('POST', '/api/privacy/requests', data),\n    onSuccess: () => {\n      toast({\n        title: \"K√©relem elk√ºldve\",\n        description: \"Adatv√©delmi k√©relm√©t sikeresen r√∂gz√≠tett√ºk. 30 napon bel√ºl v√°laszolunk.\",\n      });\n      setRequestType('');\n      setDetails('');\n      queryClient.invalidateQueries({ queryKey: ['/api/privacy/requests'] });\n    },\n    onError: () => {\n      toast({\n        title: \"Hiba t√∂rt√©nt\",\n        description: \"Nem siker√ºlt elk√ºldeni a k√©relmet. K√©rj√ºk pr√≥b√°lja √∫jra.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!email || !requestType) {\n      toast({\n        title: \"Hi√°nyos adatok\",\n        description: \"K√©rj√ºk adja meg az email c√≠m√©t √©s v√°lassza ki a k√©relem t√≠pus√°t.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    submitRequestMutation.mutate({\n      email,\n      requestType,\n      requestData: { details, timestamp: new Date().toISOString() }\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-900\">\n      <div className=\"container mx-auto px-4 py-8 max-w-4xl\">\n        {/* Header */}\n        <div className=\"flex items-center gap-4 mb-8\">\n          <Link href=\"/privacy-policy\">\n            <Button variant=\"outline\" size=\"sm\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Vissza az adatv√©delmi t√°j√©koztat√≥hoz\n            </Button>\n          </Link>\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">\n            Adatv√©delmi k√©relmek\n          </h1>\n        </div>\n\n        <div className=\"space-y-6\">\n          {/* Information Card */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Inform√°ci√≥ a k√©relmekr≈ël</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <p className=\"text-gray-600 dark:text-gray-300\">\n                A GDPR √©s a magyar adatv√©delmi jogszab√°lyok √©rtelm√©ben √ñnnek joga van:\n              </p>\n              <ul className=\"list-disc list-inside space-y-2 text-sm text-gray-600 dark:text-gray-300\">\n                <li><strong>Hozz√°f√©r√©s:</strong> megtudni, hogy milyen adatait kezelj√ºk</li>\n                <li><strong>Helyesb√≠t√©s:</strong> k√©rni pontatlan adatai jav√≠t√°s√°t</li>\n                <li><strong>T√∂rl√©s:</strong> k√©rni adatai t√∂rl√©s√©t (elfeledtet√©shez val√≥ jog)</li>\n                <li><strong>Korl√°toz√°s:</strong> k√©rni adatkezel√©s korl√°toz√°s√°t bizonyos esetekben</li>\n                <li><strong>Hordozhat√≥s√°g:</strong> k√©rni adatai √°tad√°s√°t g√©ppel olvashat√≥ form√°tumban</li>\n              </ul>\n              <p className=\"text-sm text-blue-600 dark:text-blue-400 font-medium\">\n                ‚è∞ V√°laszid≈ë: 30 nap\n              </p>\n            </CardContent>\n          </Card>\n\n          {/* New Request Form */}\n          <Card>\n            <CardHeader>\n              <CardTitle>√öj k√©relem beny√∫jt√°sa</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <form onSubmit={handleSubmit} className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"email\">Email c√≠m *</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    placeholder=\"email@example.com\"\n                    required\n                  />\n                  <p className=\"text-sm text-gray-500\">\n                    Az email c√≠mre k√ºldj√ºk a v√°laszunkat √©s a k√©rt adatokat.\n                  </p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label>K√©relem t√≠pusa *</Label>\n                  <Select value={requestType} onValueChange={setRequestType}>\n                    <SelectTrigger>\n                      <SelectValue placeholder=\"V√°lasszon k√©relem t√≠pust\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {Object.entries(REQUEST_TYPES).map(([key, config]) => {\n                        const Icon = config.icon;\n                        return (\n                          <SelectItem key={key} value={key}>\n                            <div className=\"flex items-center gap-2\">\n                              <Icon className=\"h-4 w-4\" />\n                              {config.label}\n                            </div>\n                          </SelectItem>\n                        );\n                      })}\n                    </SelectContent>\n                  </Select>\n\n                  {requestType && (\n                    <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md\">\n                      <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                        {REQUEST_TYPES[requestType as keyof typeof REQUEST_TYPES].description}\n                      </p>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"details\">Tov√°bbi r√©szletek</Label>\n                  <Textarea\n                    id=\"details\"\n                    value={details}\n                    onChange={(e) => setDetails(e.target.value)}\n                    placeholder=\"√çrja le r√©szletesen a k√©relm√©t...\"\n                    rows={4}\n                  />\n                  <p className=\"text-sm text-gray-500\">\n                    P√©ld√°ul: mely adatok jav√≠t√°sa sz√ºks√©ges, mi a t√∂rl√©si k√©relem oka, stb.\n                  </p>\n                </div>\n\n                <Button \n                  type=\"submit\" \n                  disabled={submitRequestMutation.isPending}\n                  className=\"w-full sm:w-auto\"\n                >\n                  {submitRequestMutation.isPending ? 'K√ºld√©s...' : 'K√©relem bek√ºld√©se'}\n                </Button>\n              </form>\n            </CardContent>\n          </Card>\n\n          {/* Existing Requests */}\n          {email && email.includes('@') && (\n            <Card>\n              <CardHeader>\n                <CardTitle>Kor√°bbi k√©relmek</CardTitle>\n              </CardHeader>\n              <CardContent>\n                {isLoading ? (\n                  <p className=\"text-gray-500\">K√©relmek bet√∂lt√©se...</p>\n                ) : requests.length === 0 ? (\n                  <p className=\"text-gray-500\">M√©g nem ny√∫jtott be k√©relmet.</p>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {requests.map((request: PrivacyRequest) => {\n                      const typeConfig = REQUEST_TYPES[request.requestType];\n                      const statusConfig = STATUS_CONFIG[request.status];\n                      const TypeIcon = typeConfig.icon;\n                      const StatusIcon = statusConfig.icon;\n\n                      return (\n                        <div key={request.id} className=\"border rounded-lg p-4\">\n                          <div className=\"flex items-start justify-between\">\n                            <div className=\"flex items-center gap-3\">\n                              <TypeIcon className=\"h-5 w-5 text-gray-600\" />\n                              <div>\n                                <h4 className=\"font-medium\">{typeConfig.label}</h4>\n                                <p className=\"text-sm text-gray-500\">\n                                  Beny√∫jtva: {new Date(request.createdAt).toLocaleDateString('hu-HU')}\n                                </p>\n                              </div>\n                            </div>\n                            \n                            <Badge \n                              variant={statusConfig.color === 'green' ? 'default' : 'secondary'}\n                              className={\n                                statusConfig.color === 'green' ? 'bg-green-100 text-green-800' :\n                                statusConfig.color === 'blue' ? 'bg-blue-100 text-blue-800' :\n                                statusConfig.color === 'yellow' ? 'bg-yellow-100 text-yellow-800' :\n                                'bg-red-100 text-red-800'\n                              }\n                            >\n                              <StatusIcon className=\"h-3 w-3 mr-1\" />\n                              {statusConfig.label}\n                            </Badge>\n                          </div>\n\n                          {request.requestData?.details && (\n                            <p className=\"text-sm text-gray-600 mt-2 pl-8\">\n                              {request.requestData.details}\n                            </p>\n                          )}\n\n                          {request.completedAt && (\n                            <p className=\"text-sm text-gray-500 mt-2 pl-8\">\n                              Lez√°rva: {new Date(request.completedAt).toLocaleDateString('hu-HU')}\n                            </p>\n                          )}\n                        </div>\n                      );\n                    })}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Contact Information */}\n          <Card>\n            <CardHeader>\n              <CardTitle>Kapcsolat</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <p className=\"text-gray-600 dark:text-gray-300\">\n                K√©rd√©se van a k√©relmeivel kapcsolatban? Vegye fel vel√ºnk a kapcsolatot:\n              </p>\n              <div className=\"space-y-2\">\n                <p className=\"text-sm\">\n                  <strong>Email:</strong> privacy@globalsystem.com\n                </p>\n                <p className=\"text-sm\">\n                  <strong>Telefon:</strong> +36 1 234 5678\n                </p>\n                <p className=\"text-sm\">\n                  <strong>Postai c√≠m:</strong> 1111 Budapest, P√©lda utca 1.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":12933},"client/src/pages/chat.tsx":{"content":"import { useAuth } from \"@/hooks/useAuth\";\nimport Sidebar from \"@/components/sidebar\";\nimport MobileNav from \"@/components/mobile-nav\";\nimport ChatInterface from \"@/components/chat-interface\";\nimport { Button } from \"@/components/ui/button\";\nimport { Menu } from \"lucide-react\";\nimport { useState } from \"react\";\n\nexport default function ChatPage() {\n  const { user } = useAuth();\n  const [isMobileNavOpen, setIsMobileNavOpen] = useState(false);\n\n  if (!user) return null;\n\n  return (\n    <div className=\"flex min-h-screen bg-student-warm\">\n      <div className=\"hidden lg:block lg:w-64 lg:flex-shrink-0\">\n        <div className=\"sticky top-0 h-screen overflow-y-auto\">\n          <Sidebar user={user} />\n        </div>\n      </div>\n      \n      <MobileNav \n        isOpen={isMobileNavOpen} \n        onClose={() => setIsMobileNavOpen(false)} \n        user={user} \n      />\n      \n      <div className=\"flex-1 overflow-auto\">\n        <header className=\"bg-white shadow-sm border-b border-neutral-100\">\n          <div className=\"flex items-center justify-between px-6 py-4\">\n            <div className=\"flex items-center space-x-4 flex-1\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setIsMobileNavOpen(true)}\n                className=\"lg:hidden flex-shrink-0\"\n              >\n                <Menu size={20} />\n              </Button>\n              <div className=\"flex-1 min-w-0\">\n                <h1 className=\"text-xl lg:text-2xl font-bold text-neutral-800 truncate\">\n                  AI Tan√°r Chat\n                </h1>\n                <p className=\"text-sm lg:text-base text-neutral-600 truncate\">\n                  Besz√©lgess az AI tan√°rral √©s k√©rdezz b√°rmit a tananyaggal kapcsolatban\n                </p>\n              </div>\n            </div>\n          </div>\n        </header>\n\n        <main className=\"p-6\">\n          <div className=\"max-w-4xl mx-auto\">\n            <ChatInterface \n              userId={user.id} \n              onQuizStart={() => console.log(\"Quiz started from chat page\")}\n            />\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":2154}},"version":1}